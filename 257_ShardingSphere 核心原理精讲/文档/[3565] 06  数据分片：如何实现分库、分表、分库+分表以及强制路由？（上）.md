<p data-nodeid="1" class="">é€šè¿‡å‰é¢å‡ ä¸ªè¯¾æ—¶çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ ShardingSphere å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†å¸¦é¢†ä½ é€šè¿‡æ¡ˆä¾‹åˆ†æé€æ­¥æŒæ¡ ShardingSphere çš„å„é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨æœºåˆ¶ã€‚</p>
<h3 data-nodeid="2">å•åº“å•è¡¨ç³»ç»Ÿ</h3>
<p data-nodeid="3">æˆ‘ä»¬å…ˆä»å•åº“å•è¡¨ç³»ç»Ÿè¯´èµ·ã€‚åœ¨æ•´ä¸ªè¯¾ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šå¼ºè°ƒï¼Œæˆ‘ä»¬å°†é»˜è®¤ä½¿ç”¨ Spring Boot é›†æˆå’Œ ShardingSphere æ¡†æ¶ï¼ŒåŒæ—¶åŸºäº Mybatis å®ç°å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚</p>
<h4 data-nodeid="4">å¯¼å…¥å¼€å‘æ¡†æ¶</h4>
<p data-nodeid="5">ç³»ç»Ÿå¼€å‘çš„ç¬¬ä¸€æ­¥æ˜¯å¯¼å…¥æ‰€éœ€çš„å¼€å‘æ¡†æ¶ã€‚åœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ª Spring Boot ä»£ç å·¥ç¨‹ï¼Œåœ¨ pom æ–‡ä»¶ä¸­éœ€è¦æ·»åŠ å¯¹ sharding-jdbc-spring-boot-starter å’Œ mybatis-spring-boot-starter è¿™ä¸¤ä¸ª starter çš„å¼•ç”¨ï¼š</p>
<pre class="lang-xml" data-nodeid="6"><code data-language="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
&nbsp;
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p data-nodeid="7">å¼€å‘ç¯å¢ƒåˆå§‹åŒ–è¦åšçš„å·¥ä½œä¹Ÿå°±æ˜¯è¿™äº›ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»æ¡ˆä¾‹çš„ä¸šåŠ¡åœºæ™¯ã€‚</p>
<h4 data-nodeid="8">æ¢³ç†ä¸šåŠ¡åœºæ™¯</h4>
<p data-nodeid="9">æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªåœ¨åŒ»ç–—å¥åº·é¢†åŸŸä¸­æ¯”è¾ƒå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚åœ¨è¿™ç±»åœºæ™¯ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·ï¼ˆUserï¼‰éƒ½æœ‰ä¸€ä»½å¥åº·è®°å½•ï¼ˆHealthRecordï¼‰ï¼Œå­˜å‚¨ç€ä»£è¡¨ç”¨æˆ·å½“å‰å¥åº·çŠ¶å†µçš„å¥åº·ç­‰çº§ï¼ˆHealthLevelï¼‰ï¼Œä»¥åŠä¸€ç³»åˆ—å¥åº·ä»»åŠ¡ï¼ˆHealthTaskï¼‰ã€‚é€šå¸¸ï¼ŒåŒ»ç”Ÿé€šè¿‡ç”¨æˆ·å½“å‰çš„å¥åº·è®°å½•åˆ›å»ºä¸åŒçš„å¥åº·ä»»åŠ¡ï¼Œç„¶åç”¨æˆ·å¯ä»¥é€šè¿‡å®ŒæˆåŒ»ç”Ÿæ‰€æŒ‡å®šçš„ä»»åŠ¡æ¥è·å–ä¸€å®šçš„å¥åº·ç§¯åˆ†ï¼Œè€Œè¿™ä¸ªç§¯åˆ†å†³å®šäº†ç”¨æˆ·çš„å¥åº·ç­‰çº§ï¼Œå¹¶æœ€ç»ˆå½±å“åˆ°æ•´ä¸ªå¥åº·è®°å½•ã€‚å¥åº·ä»»åŠ¡åšå¾—è¶Šå¤šï¼Œå¥åº·ç­‰çº§å°±è¶Šé«˜ï¼Œç”¨æˆ·çš„å¥åº·è®°å½•ä¹Ÿå°±è¶Šå®Œå–„ï¼Œåè¿‡æ¥å¥åº·ä»»åŠ¡ä¹Ÿå°±å¯ä»¥è¶Šåšè¶Šå°‘ï¼Œä»è€Œå½¢æˆä¸€ä¸ªæ­£å‘çš„ä¸šåŠ¡é—­ç¯ã€‚è¿™é‡Œï¼Œ<strong data-nodeid="85">æˆ‘ä»¬æ— æ„å¯¹æ•´ä¸ªä¸šåŠ¡é—­ç¯åšè¿‡å¤šçš„é˜è¿°ï¼Œè€Œæ˜¯å…³æ³¨è¿™ä¸€ä¸šåŠ¡åœºæ™¯ä¸‹å‡ ä¸ªæ ¸å¿ƒä¸šåŠ¡å¯¹è±¡çš„å­˜å‚¨å’Œè®¿é—®æ–¹å¼ã€‚</strong></p>
<p data-nodeid="10">åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å…³æ³¨ Userã€HealthRecordã€HealthLevel å’Œ HealthTask è¿™å››ä¸ªä¸šåŠ¡å¯¹è±¡ã€‚åœ¨ä¸‹é¢è¿™å¼ å›¾ä¸­ï¼Œå¯¹æ¯ä¸ªä¸šåŠ¡å¯¹è±¡ç»™å‡ºæœ€åŸºç¡€çš„å­—æ®µå®šä¹‰ï¼Œä»¥åŠè¿™å››ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³è”å…³ç³»ï¼š</p>
<p data-nodeid="11"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79xmuAcgDXAABZ98dOvow631.png" alt="Drawing 0.png" data-nodeid="89"></p>
<h4 data-nodeid="12">å®ŒæˆåŸºç¡€åŠŸèƒ½</h4>
<p data-nodeid="13">æ—¢ç„¶é‡‡ç”¨ Mybatis ä½œä¸º ORM æ¡†æ¶ï¼Œé‚£ä¹ˆå°±éœ€è¦éµå¾ª Mybatis çš„å¼€å‘æµç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå„ä¸ªä¸šåŠ¡å®ä½“çš„å®šä¹‰ï¼š</p>
<p data-nodeid="14"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79xn2AZ5AlAAANShGk9Ss532.png" alt="Drawing 2.png" data-nodeid="94"><br>
ä¸šåŠ¡å®ä½“çš„ç±»å®šä¹‰</p>
<p data-nodeid="15">åŸºäºè¿™äº›ä¸šåŠ¡å®ä½“ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå¯¹åº”çš„ Mapper æ–‡ä»¶ç¼–å†™ï¼Œæˆ‘æŠŠè¿™äº› Mapper æ–‡ä»¶æ”¾åœ¨ä»£ç å·¥ç¨‹çš„ resources ç›®å½•ä¸‹ï¼š</p>
<p data-nodeid="16"><img src="https://s0.lgstatic.com/i/image/M00/2B/3B/CgqCHl79xouAFJaOAAAN0iT9QRU187.png" alt="Drawing 3.png" data-nodeid="100"><br>
Mybatis Mapper æ–‡ä»¶å®šä¹‰</p>
<p data-nodeid="17">ä¸‹ä¸€æ­¥æ˜¯æ•°æ®æºä¿¡æ¯çš„é…ç½®ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ application-traditional.properties é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<pre class="lang-java" data-nodeid="18"><code data-language="java">spring.datasource.driverClassName = com.mysql.jdbc.Driver
spring.datasource.url = jdbc:mysql:<span class="hljs-comment">//localhost:3306/ds</span>
spring.datasource.username = root
spring.datasource.password = root
</code></pre>
<p data-nodeid="19">æŒ‰ç…§ Spring Boot çš„é…ç½®çº¦å®šï¼Œæˆ‘ä»¬åœ¨ application.properties é…ç½®æ–‡ä»¶ä¸­æŠŠä¸Šè¿°é…ç½®æ–‡ä»¶è®¾ç½®ä¸ºå¯åŠ¨ profileã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„ profileï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆä¸åŒé…ç½®ä½“ç³»ä¹‹é—´çš„åˆ‡æ¢ã€‚</p>
<pre class="lang-java" data-nodeid="20"><code data-language="java">spring.profiles.active=traditional
</code></pre>
<p data-nodeid="21">æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…å°±æ˜¯åˆ›å»º Repository å±‚ç»„ä»¶ï¼š</p>
<p data-nodeid="22"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79xqWAWcuSAAAQHxH2EJw496.png" alt="Drawing 4.png" data-nodeid="108"><br>
Repository å±‚æ¥å£å®šä¹‰</p>
<p data-nodeid="23">æœ€åï¼Œæˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†ç›¸å…³çš„ä¸‰ä¸ªæœåŠ¡ç±»ï¼Œåˆ†åˆ«æ˜¯ UserServiceã€HealthLevelService å’Œ HealthRecordServiceã€‚</p>
<p data-nodeid="24"><img src="https://s0.lgstatic.com/i/image/M00/2B/3B/CgqCHl79xruAfTx6AAAXfz-iHSU716.png" alt="Drawing 5.png" data-nodeid="114"><br>
Service å±‚æ¥å£å’Œå®ç°ç±»å®šä¹‰</p>
<p data-nodeid="25">é€šè¿‡ UserServiceï¼Œæˆ‘ä»¬ä¼šæ’å…¥ä¸€æ‰¹ç”¨æˆ·æ•°æ®ç”¨äºå®Œæˆç”¨æˆ·ä¿¡æ¯çš„åˆå§‹åŒ–ã€‚ç„¶åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª HealthLevelServiceï¼Œä¸“é—¨ç”¨æ¥åˆå§‹åŒ–å¥åº·ç­‰çº§ä¿¡æ¯ã€‚<strong data-nodeid="122">è¯·æ³¨æ„ï¼Œä¸å…¶ä»–ä¸šåŠ¡å¯¹è±¡ä¸åŒï¼Œå¥åº·ç­‰çº§ä¿¡æ¯æ˜¯ç³»ç»Ÿä¸­çš„ä¸€ç§å…¸å‹å­—å…¸ä¿¡æ¯</strong>ï¼Œæˆ‘ä»¬å‡å®šç³»ç»Ÿä¸­å­˜åœ¨ 5 ç§å¥åº·ç­‰çº§ã€‚</p>
<p data-nodeid="26">ç¬¬ä¸‰ä¸ªï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„æœåŠ¡å°±æ˜¯ HealthRecordServiceï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å®Œæˆ HealthRecord ä»¥åŠ HealthTask æ•°æ®çš„å­˜å‚¨å’Œè®¿é—®ã€‚è¿™é‡Œä»¥ HealthRecordService æœåŠ¡ä¸ºä¾‹ï¼Œä¸‹é¢è¿™æ®µä»£ç ç»™å‡ºäº†å®ƒçš„å®ç°è¿‡ç¨‹ï¼š</p>
<pre class="lang-java" data-nodeid="27"><code data-language="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HealthRecordServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HealthRecordService</span> </span>{ 
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Autowired</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">private</span> HealthRecordRepository healthRecordRepository;
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Autowired</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">private</span> HealthTaskRepository healthTaskRepository;
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processHealthRecords</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insertHealthRecords();
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;Integer&gt; <span class="hljs-title">insertHealthRecords</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List&lt;Integer&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-number">10</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  HealthRecord healthRecord = insertHealthRecord(i);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; insertHealthTask(i, healthRecord);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result.add(healthRecord.getRecordId());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> result;
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">private</span> HealthRecord <span class="hljs-title">insertHealthRecord</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException </span>{
&nbsp;&nbsp;&nbsp;  HealthRecord healthRecord = <span class="hljs-keyword">new</span> HealthRecord();
&nbsp;&nbsp;&nbsp;  healthRecord.setUserId(i);
&nbsp;&nbsp;&nbsp;  healthRecord.setLevelId(i % <span class="hljs-number">5</span>);
&nbsp;&nbsp;&nbsp;  healthRecord.setRemark(<span class="hljs-string">"Remark"</span> + i);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; healthRecordRepository.addEntity(healthRecord);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> healthRecord;
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertHealthTask</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">final</span> HealthRecord healthRecord)</span> <span class="hljs-keyword">throws</span> SQLException </span>{
&nbsp;&nbsp;&nbsp;  HealthTask healthTask = <span class="hljs-keyword">new</span> HealthTask();
&nbsp;&nbsp;&nbsp;  healthTask.setRecordId(healthRecord.getRecordId());
&nbsp;&nbsp;&nbsp;  healthTask.setUserId(i);
&nbsp;&nbsp;&nbsp;  healthTask.setTaskName(<span class="hljs-string">"TaskName"</span> + i);
&nbsp;&nbsp;&nbsp;  healthTaskRepository.addEntity(healthTask);
&nbsp;&nbsp;&nbsp; }
}
</code></pre>
<p data-nodeid="28">ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä»é›¶å¼€å§‹å®ç°äº†ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡åœºæ™¯æ‰€éœ€è¦çš„ DAO å±‚å’Œ Service å±‚ç»„ä»¶ã€‚è¿™äº›ç»„ä»¶åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šéƒ½éå¸¸ç®€å•ï¼Œè€Œåœ¨æŠ€æœ¯ä¸Šä¹Ÿæ˜¯å®Œå…¨é‡‡ç”¨äº† Mybatis çš„ç»å…¸å¼€å‘è¿‡ç¨‹ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç»„ç®€å•çš„å•å…ƒæµ‹è¯•æ¥éªŒè¯è¿™äº›ç»„ä»¶æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ä¸‹é¢è¿™æ®µä»£ç ä»¥ UserServiceTest ç±»ä¸ºä¾‹ç»™å‡ºå®ƒçš„å®ç°ï¼Œæ¶‰åŠ @RunWithã€@SpringBootTest ç­‰å¸¸è§å•å…ƒæµ‹è¯•æ³¨è§£çš„ä½¿ç”¨ï¼š</p>
<pre class="lang-java" data-nodeid="29"><code data-language="java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceTest</span> </span>{
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Autowired</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">private</span> UserService userService;

&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Test</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testProcessUsers</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; userService.processUsers();
&nbsp;&nbsp;&nbsp; }
}
</code></pre>
<p data-nodeid="30">è¿è¡Œè¿™ä¸ªå•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµ‹è¯•é€šè¿‡ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“çš„ User è¡¨ä¸­ä¹Ÿçœ‹åˆ°äº†æ’å…¥çš„æ•°æ®ã€‚è‡³æ­¤ï¼Œä¸€ä¸ªå•åº“å•è¡¨çš„ç³»ç»Ÿå·²ç»æ„å»ºå®Œæˆã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¯¹è¿™ä¸ªç³»ç»Ÿåšåˆ†åº“åˆ†è¡¨æ”¹é€ ã€‚</p>
<p data-nodeid="31">åœ¨ä¼ ç»Ÿå•åº“å•è¡¨çš„æ•°æ®æ¶æ„ä¸Šè¿›è¡Œåˆ†åº“åˆ†è¡¨çš„æ”¹é€ ï¼Œå¼€å‘äººå‘˜åªéœ€è¦åšä¸€ä»¶äº‹æƒ…ï¼Œé‚£å°±æ˜¯åŸºäºä¸Šä¸€è¯¾æ—¶ä»‹ç»çš„ ShardingSphere é…ç½®ä½“ç³»å®Œæˆé’ˆå¯¹å…·ä½“åœºæ™¯çš„é…ç½®å·¥ä½œå³å¯ï¼Œæ‰€æœ‰å·²ç»å­˜åœ¨çš„ä¸šåŠ¡ä»£ç éƒ½ä¸éœ€è¦åšä»»ä½•çš„å˜åŠ¨ï¼Œè¿™å°±æ˜¯ ShardingSphere çš„å¼ºå¤§ä¹‹å¤„ã€‚è®©æˆ‘ä»¬ä¸€èµ·å¼€å§‹å§ã€‚</p>
<h3 data-nodeid="32">ç³»ç»Ÿæ”¹é€ ï¼šå¦‚ä½•å®ç°åˆ†åº“ï¼Ÿ</h3>
<p data-nodeid="33">ä½œä¸ºç³»ç»Ÿæ”¹é€ çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å¦‚ä½•åŸºäºé…ç½®ä½“ç³»å®ç°æ•°æ®çš„åˆ†åº“è®¿é—®ã€‚</p>
<h4 data-nodeid="34">åˆå§‹åŒ–æ•°æ®æº</h4>
<p data-nodeid="35">é’ˆå¯¹åˆ†åº“åœºæ™¯ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸¤ä¸ªæ•°æ®åº“ï¼Œåˆ†åˆ«å« ds0 å’Œ ds1ã€‚æ˜¾ç„¶ï¼Œé’ˆå¯¹ä¸¤ä¸ªæ•°æ®æºï¼Œæˆ‘ä»¬å°±éœ€è¦åˆå§‹åŒ–ä¸¤ä¸ª DataSource å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ª DataSource å¯¹è±¡å°†ç»„æˆä¸€ä¸ª Map å¹¶ä¼ é€’ç»™ ShardingDataSourceFactory å·¥å‚ç±»ï¼š</p>
<pre class="lang-java" data-nodeid="36"><code data-language="java">spring.shardingsphere.datasource.names=ds0,ds1
&nbsp;
spring.shardingsphere.datasource.ds0.type=com.alibaba.druid.pool.DruidDataSource
spring.shardingsphere.datasource.ds0.driver-<span class="hljs-class"><span class="hljs-keyword">class</span>-<span class="hljs-title">name</span></span>=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.ds0.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/ds0</span>
spring.shardingsphere.datasource.ds0.username=root
spring.shardingsphere.datasource.ds0.password=root
&nbsp;
spring.shardingsphere.datasource.ds1.type=com.alibaba.druid.pool.DruidDataSource
spring.shardingsphere.datasource.ds1.driver-<span class="hljs-class"><span class="hljs-keyword">class</span>-<span class="hljs-title">name</span></span>=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.ds1.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/ds1</span>
spring.shardingsphere.datasource.ds1.username=root
spring.shardingsphere.datasource.ds1.password=root
</code></pre>
<h4 data-nodeid="37">è®¾ç½®åˆ†ç‰‡ç­–ç•¥</h4>
<p data-nodeid="38">æ˜ç¡®äº†æ•°æ®æºä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®é’ˆå¯¹åˆ†åº“çš„åˆ†ç‰‡ç­–ç•¥ï¼š</p>
<pre class="lang-java" data-nodeid="39"><code data-language="java">spring.shardingsphere.sharding.<span class="hljs-keyword">default</span>-database-strategy.inline.sharding-column=user_id
spring.shardingsphere.sharding.<span class="hljs-keyword">default</span>-database-strategy.inline.algorithm-expression=ds$-&gt;{user_id % <span class="hljs-number">2</span>}
</code></pre>
<p data-nodeid="40">æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ ShardingSphere ä¸­å­˜åœ¨ä¸€ç»„ ShardingStrategyConfigurationï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯åŸºäºè¡Œè¡¨è¾¾å¼çš„ InlineShardingStrategyConfigurationã€‚<br>
InlineShardingStrategyConfiguration åŒ…å«ä¸¤ä¸ªéœ€è¦è®¾ç½®çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯æŒ‡å®šåˆ†ç‰‡åˆ—åç§°çš„ shardingColumnï¼Œå¦ä¸€ä¸ªæ˜¯æŒ‡å®šåˆ†ç‰‡ç®—æ³•è¡Œè¡¨è¾¾å¼çš„ algorithmExpressionã€‚åœ¨æˆ‘ä»¬çš„é…ç½®æ–¹æ¡ˆä¸­ï¼Œå°†åŸºäº user_id åˆ—å¯¹ 2 çš„å–æ¨¡å€¼æ¥ç¡®å®šæ•°æ®åº”è¯¥å­˜å‚¨åœ¨å“ªä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚åŒæ—¶ï¼Œæ³¨æ„åˆ°è¿™é‡Œé…ç½®çš„æ˜¯â€œdefault-database-strategyâ€é¡¹ã€‚ç»“åˆä¸Šä¸€è¯¾æ—¶çš„å†…å®¹ï¼Œè®¾ç½®è¿™ä¸ªé…ç½®é¡¹ç›¸å½“äºæ˜¯åœ¨ ShardingRuleConfiguration ä¸­æŒ‡å®šäº†é»˜è®¤çš„åˆ†åº“ ShardingStrategyã€‚</p>
<h4 data-nodeid="41">è®¾ç½®ç»‘å®šè¡¨å’Œå¹¿æ’­è¡¨</h4>
<p data-nodeid="42">æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è®¾ç½®ç»‘å®šè¡¨ã€‚ç»‘å®šè¡¨ï¼ˆBindingTableï¼‰æ˜¯ ShardingSphere ä¸­æå‡ºçš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œæˆ‘æ¥ç»™ä½ è§£é‡Šä¸€ä¸‹ã€‚</p>
<p data-nodeid="43">æ‰€è°“ç»‘å®šè¡¨ï¼Œæ˜¯æŒ‡ä¸åˆ†ç‰‡è§„åˆ™ä¸€è‡´çš„ä¸€ç»„ä¸»è¡¨å’Œå­è¡¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œhealth_record è¡¨å’Œ health_task è¡¨ä¸­éƒ½å­˜åœ¨ä¸€ä¸ª record_id å­—æ®µã€‚å¦‚æœæˆ‘ä»¬åœ¨åº”ç”¨è¿‡ç¨‹ä¸­æŒ‰ç…§è¿™ä¸ª record_id å­—æ®µè¿›è¡Œåˆ†ç‰‡ï¼Œé‚£ä¹ˆè¿™ä¸¤å¼ è¡¨å°±å¯ä»¥æ„æˆäº’ä¸ºç»‘å®šè¡¨å…³ç³»ã€‚</p>
<p data-nodeid="44">å¼•å…¥ç»‘å®šè¡¨æ¦‚å¿µçš„æ ¹æœ¬åŸå› åœ¨äºï¼Œäº’ä¸ºç»‘å®šè¡¨å…³ç³»çš„å¤šè¡¨å…³è”æŸ¥è¯¢ä¸ä¼šå‡ºç°ç¬›å¡å°”ç§¯ï¼Œå› æ­¤å…³è”æŸ¥è¯¢æ•ˆç‡å°†å¤§å¤§æå‡ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œå¦‚æœæ‰€æ‰§è¡Œçš„ä¸ºä¸‹é¢è¿™æ¡ SQLï¼š</p>
<pre class="lang-java" data-nodeid="45"><code data-language="java">SELECT record.remark_name FROM health_record record JOIN health_task task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
</code></pre>
<p data-nodeid="46">å¦‚æœæˆ‘ä»¬ä¸æ˜¾å¼é…ç½®ç»‘å®šè¡¨å…³ç³»ï¼Œå‡è®¾åˆ†ç‰‡é”® record_id å°†å€¼ 1 è·¯ç”±è‡³ç¬¬ 1 ç‰‡ï¼Œå°†æ•°å€¼ 2 è·¯ç”±è‡³ç¬¬ 0 ç‰‡ï¼Œé‚£ä¹ˆè·¯ç”±åçš„ SQL åº”è¯¥ä¸º 4 æ¡ï¼Œå®ƒä»¬å‘ˆç°ä¸ºç¬›å¡å°”ç§¯ï¼š</p>
<pre class="lang-java" data-nodeid="47"><code data-language="java">SELECT record.remark_name FROM health_record0 record JOIN health_task0 task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
&nbsp;
SELECT record.remark_name FROM health_record0 record JOIN health_task1 task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
&nbsp;
SELECT record.remark_name FROM health_record1 record JOIN health_task0 task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
&nbsp;
SELECT record.remark_name FROM health_record1 record JOIN health_task1 task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
</code></pre>
<p data-nodeid="48">ç„¶åï¼Œåœ¨é…ç½®ç»‘å®šè¡¨å…³ç³»åï¼Œè·¯ç”±çš„ SQL å°±ä¼šå‡å°‘åˆ° 2 æ¡ï¼š</p>
<pre class="lang-java" data-nodeid="49"><code data-language="java">SELECT record.remark_name FROM health_record0 record JOIN health_task0 task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
&nbsp;
SELECT record.remark_name FROM health_record1 record JOIN health_task1 task ON record.record_id=task.record_id WHERE record.<span class="hljs-function">record_id <span class="hljs-title">in</span> <span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
</code></pre>
<p data-nodeid="50"><strong data-nodeid="160">è¯·æ³¨æ„ï¼Œå¦‚æœæƒ³è¦è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œäº’ä¸ºç»‘å®šè¡¨çš„å„ä¸ªè¡¨çš„åˆ†ç‰‡é”®è¦å®Œå…¨ç›¸åŒ</strong>ã€‚åœ¨ä¸Šé¢çš„è¿™äº› SQL è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºï¼Œè¿™ä¸ªéœ€è¦å®Œå…¨ç›¸åŒçš„åˆ†ç‰‡é”®å°±æ˜¯ record_idã€‚</p>
<p data-nodeid="51">è®©æˆ‘ä»¬å›åˆ°æ¡ˆä¾‹ä¸­çš„åœºæ™¯ï¼Œæ˜¾ç„¶ï¼Œhealth_record å’Œ health_task åº”è¯¥äº’ä¸ºç»‘å®šè¡¨å…³ç³»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹è¿™ç§å…³ç³»çš„é…ç½®ï¼š</p>
<pre class="lang-java" data-nodeid="52"><code data-language="java">spring.shardingsphere.sharding.binding-tables=health_record, health_task
</code></pre>
<p data-nodeid="53">ä»‹ç»å®Œç»‘å®šè¡¨ï¼Œå†æ¥çœ‹å¹¿æ’­è¡¨çš„æ¦‚å¿µã€‚<strong data-nodeid="171">æ‰€è°“å¹¿æ’­è¡¨ï¼ˆBroadCastTableï¼‰ï¼Œæ˜¯æŒ‡æ‰€æœ‰åˆ†ç‰‡æ•°æ®æºä¸­éƒ½å­˜åœ¨çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§è¡¨çš„è¡¨ç»“æ„å’Œè¡¨ä¸­çš„æ•°æ®åœ¨æ¯ä¸ªæ•°æ®åº“ä¸­éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„</strong>ã€‚å¹¿æ’­è¡¨çš„é€‚ç”¨åœºæ™¯æ¯”è¾ƒæ˜ç¡®ï¼Œé€šå¸¸é’ˆå¯¹æ•°æ®é‡ä¸å¤§ä¸”éœ€è¦ä¸æµ·é‡æ•°æ®è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢çš„åº”ç”¨åœºæ™¯ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯æ¯ä¸ªåˆ†ç‰‡æ•°æ®åº“ä¸­éƒ½åº”è¯¥å­˜åœ¨çš„å­—å…¸è¡¨ã€‚</p>
<p data-nodeid="54">åŒæ ·å›åˆ°æˆ‘ä»¬çš„åœºæ™¯ï¼Œå¯¹äº health_level è¡¨è€Œè¨€ï¼Œç”±äºå®ƒä¿å­˜ç€æœ‰é™çš„å¥åº·ç­‰çº§ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯è¿™æ ·çš„ä¸€ç§å­—å…¸è¡¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†å¯¹å¹¿æ’­è¡¨çš„å®šä¹‰ï¼Œåœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼š</p>
<pre class="lang-java" data-nodeid="55"><code data-language="java">spring.shardingsphere.sharding.broadcast-tables=health_level
</code></pre>
<h4 data-nodeid="56">è®¾ç½®è¡¨åˆ†ç‰‡è§„åˆ™</h4>
<p data-nodeid="57">é€šè¿‡å‰é¢çš„è¿™äº›é…ç½®é¡¹ï¼Œæˆ‘ä»¬æ ¹æ®éœ€æ±‚å®Œæˆäº† ShardingRuleConfiguration ä¸­ä¸åˆ†åº“æ“ä½œç›¸å…³çš„é…ç½®ä¿¡æ¯è®¾ç½®ã€‚æˆ‘ä»¬çŸ¥é“ ShardingRuleConfiguration ä¸­çš„ TableRuleConfiguration æ˜¯å¿…å¡«é¡¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ä¸‹åº”è¯¥å¦‚ä½•å¯¹è¡¨åˆ†ç‰‡è¿›è¡Œè®¾ç½®ã€‚</p>
<p data-nodeid="58">TableRuleConfiguration æ˜¯è¡¨åˆ†ç‰‡è§„åˆ™é…ç½®ï¼ŒåŒ…å«äº†ç”¨äºè®¾ç½®çœŸå®æ•°æ®èŠ‚ç‚¹çš„ actualDataNodesï¼›ç”¨äºè®¾ç½®åˆ†åº“ç­–ç•¥çš„ databaseShardingStrategyConfigï¼›ä»¥åŠç”¨äºè®¾ç½®åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è‡ªå¢åˆ—ç”Ÿæˆå™¨çš„ keyGeneratorConfigã€‚å‰é¢å·²ç»åœ¨ ShardingRuleConfiguration ä¸­è®¾ç½®äº†é»˜è®¤çš„ databaseShardingStrategyConfigï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å®Œæˆå‰©ä¸‹çš„ actualDataNodes å’Œ keyGeneratorConfig çš„è®¾ç½®ã€‚</p>
<p data-nodeid="59">å¯¹äº health_record è¡¨è€Œè¨€ï¼Œç”±äºå­˜åœ¨ä¸¤ä¸ªæ•°æ®æºï¼Œæ‰€ä»¥ï¼Œå®ƒæ‰€å±äºçš„ actual-data-nodes å¯ä»¥ç”¨è¡Œè¡¨è¾¾å¼ ds$-&gt;{0..1}.health_record æ¥è¿›è¡Œè¡¨ç¤ºï¼Œä»£è¡¨åœ¨ ds0 å’Œ ds1 ä¸­éƒ½å­˜åœ¨è¡¨ health_recordã€‚è€Œå¯¹äº keyGeneratorConfig è€Œè¨€ï¼Œé€šå¸¸å»ºè®®ä½ ä½¿ç”¨é›ªèŠ±ç®—æ³•ã€‚æ˜ç¡®äº†è¿™äº›ä¿¡æ¯ä¹‹åï¼Œhealth_record è¡¨å¯¹åº”çš„ TableRuleConfiguration é…ç½®ä¹Ÿå°±é¡ºç†æˆç« äº†ï¼š</p>
<pre class="lang-java" data-nodeid="929"><code data-language="java">spring.shardingsphere.sharding.tables.health_record.actual-data-nodes=ds$-&gt;{<span class="hljs-number">0.</span>.<span class="hljs-number">1</span>}.health_record
spring.shardingsphere.sharding.tables.health_record.key-generator.column=record_id
spring.shardingsphere.sharding.tables.health_record.key-generator.type=SNOWFLAKE
spring.shardingsphere.sharding.tables.health_record.key-generator.props.worker.id=<span class="hljs-number">33</span>
</code></pre>

<p data-nodeid="61">åŒæ ·çš„ï¼Œhealth_task è¡¨çš„é…ç½®ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ key-generator.column çš„å…·ä½“æ•°æ®åˆ—ï¼š</p>
<pre class="lang-java te-preview-highlight" data-nodeid="1394"><code data-language="java">spring.shardingsphere.sharding.tables.health_task.actual-data-nodes=ds$-&gt;{<span class="hljs-number">0.</span>.<span class="hljs-number">1</span>}.health_task
spring.shardingsphere.sharding.tables.health_task.key-generator.column=task_id
spring.shardingsphere.sharding.tables.health_task.key-generator.type=SNOWFLAKE
spring.shardingsphere.sharding.tables.health_task.key-generator.props.worker.id=<span class="hljs-number">33</span>
</code></pre>

<p data-nodeid="63">è®©æˆ‘ä»¬é‡æ–°æ‰§è¡Œ HealthRecordTest å•å…ƒæµ‹è¯•ï¼Œå¹¶æ£€æŸ¥æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯ ds0 ä¸­çš„ health_record å’Œ health_task è¡¨ï¼š</p>
<p data-nodeid="64"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79x0uAMmoLAAAni5nGp94973.png" alt="Drawing 6.png" data-nodeid="197"><br>
ds0 ä¸­ health_record è¡¨æ•°æ®</p>
<p data-nodeid="65"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79xzCAJRa1AAAsmwNVR2c289.png" alt="Drawing 7.png" data-nodeid="204"><br>
ds0 ä¸­ health_task è¡¨æ•°æ®</p>
<p data-nodeid="66">è€Œè¿™å¼ å›¾æ˜¯ ds1 ä¸­çš„ health_record å’Œ health_task è¡¨ï¼š</p>
<p data-nodeid="67"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79x1aAcKcKAAAnnGtKSYI997.png" alt="Drawing 8.png" data-nodeid="216"><br>
ds1 ä¸­ health_record è¡¨æ•°æ®</p>
<p data-nodeid="68"><img src="https://s0.lgstatic.com/i/image/M00/2B/30/Ciqc1F79x12ACkcOAAAugYxPEXc765.png" alt="Drawing 9.png" data-nodeid="223"><br>
ds1 ä¸­ health_task è¡¨æ•°æ®</p>
<p data-nodeid="69">æ˜¾ç„¶ï¼Œè¿™ä¸¤å¼ è¡¨çš„æ•°æ®å·²ç»æ­£ç¡®è¿›è¡Œäº†åˆ†åº“ã€‚</p>
<h3 data-nodeid="70">å°ç»“</h3>
<p data-nodeid="71">ä»æœ¬è¯¾æ—¶å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼è¿›å…¥åˆ° ShardingSphere æ ¸å¿ƒåŠŸèƒ½çš„è®²è§£ã€‚ä¸ºäº†ä»‹ç»è¿™äº›åŠŸèƒ½ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†ä»å•åº“å•è¡¨æ¶æ„è®²èµ·ï¼ŒåŸºäºä¸€ä¸ªå…¸å‹çš„ä¸šåŠ¡åœºæ™¯æ¢³ç†æ•°æ®æ“ä½œçš„éœ€æ±‚ï¼Œå¹¶ç»™å‡ºæ•´ä¸ªä»£ç å·¥ç¨‹çš„æ¡†æ¶ï¼Œä»¥åŠåŸºäºæµ‹è¯•ç”¨ä¾‹éªŒè¯æ•°æ®æ“ä½œç»“æœçš„å®ç°è¿‡ç¨‹ã€‚ä»Šå¤©çš„å†…å®¹å…³æ³¨äºå¦‚ä½•å®ç°åˆ†åº“æ“ä½œï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥ ShardingSphere ä¸­å¼ºå¤§çš„é…ç½®ä½“ç³»å®ç°äº†åˆ†åº“æ•ˆæœã€‚</p>
<p data-nodeid="72">è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šå¦‚ä½•ç†è§£ç»‘å®šè¡¨å’Œå¹¿æ’­è¡¨çš„å«ä¹‰å’Œä½œç”¨ï¼Ÿ</p>
<p data-nodeid="73">åˆ†åº“æ˜¯ ShardingSphere ä¸­åˆ†ç‰‡å¼•æ“çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„åŠŸèƒ½ä¹‹ä¸€ã€‚åœ¨ä¸‹ä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä»‹ç»åˆ†è¡¨ã€åˆ†åº“+åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ç­‰åˆ†ç‰‡æœºåˆ¶ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### **æµ©ï¼š
> æˆ‘æ„Ÿè§‰è®²è§£çš„å¾ˆå¥½ï¼Œå¦‚æœèƒ½æŠŠæ–‡ç« ä¸­å¯¹åº”çš„å·¥ç¨‹ä»£ç æä¾›å‡ºæ¥å°±æ›´å¥½å•¦ï½

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æºç éƒ½åœ¨githubä¸Šï¼šhttps://github.com/tianyilan12/shardingsphere-demo

##### *å…µï¼š
> åˆ†åº“ä¹‹åå¦‚ä½•è§£å†³å…³è”æŸ¥è¯¢å’Œæ¨¡ç³ŠæŸ¥è¯¢å‘¢

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ShardingSphereå¯¹äºæ™®é€šçš„å…³è”æŸ¥è¯¢å’Œæ¨¡ç³ŠæŸ¥è¯¢æ˜¯é€æ˜çš„ï¼Œä¼šåŸºäºè¾“å…¥çš„SQLè¯­å¥è‡ªåŠ¨ä»å„ä¸ªåº“ä¸­è·å–ç›®æ ‡æ•°æ®è¿›è¡Œå½’å¹¶ã€‚å½“ç„¶ï¼Œå¯¹æœ‰äº›SQLè¯­å¥æ˜¯æœ‰é™åˆ¶çš„ï¼Œå®˜ç½‘ä¸Šæœ‰è¯´æ˜ã€‚

##### **æ½®ï¼š
> æœªåˆ†ç‰‡æ—¶å‘æ•°æ®åº“ä¸­æ’å…¥å¼å±€æŠ¥é”™è§£å†³æ–¹æ³•ï¼ŒæŠŠspring.shardingsphere.enableè®¾ç½®ä¸ºfalseã€‚å› ä¸ºå¼€å¯å®ƒçš„è¯å¥½åƒè¯»å–æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„æ–¹å¼å˜äº†ï¼Œéœ€è¦é€šè¿‡ spring.shardingsphere.datasourceæ¥è®¾å®šã€‚ã€‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯¹çš„ï¼Œå¦‚æœä¸åˆ†ç‰‡å°±ä¸è¦å¯åŠ¨shardingsphereï¼Œshardingsphereä¼šæ‹¦æˆªåŸæœ‰sqlåšå¯¹åº”çš„å¤„ç†

##### *æ³¢ï¼š
> é…ç½®äº†åˆ†åº“ç­–ç•¥spring.shardingsphere.sharding.default-database-strategy.inline.algorithm-expression=ds$-{user_id % 2}ä½†æ˜¯å‘ç°ï¼Œåœ¨ ds0 ä¸­çš„ userè¡¨ä¸­å±…ç„¶æœ‰user_id=7å’Œuser_id=9çš„æ•°æ®ã€‚æŒ‰é“ç†æ˜¯åº”è¯¥å‡ºç°åœ¨ ds1ä¸­çš„å‘€ã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ

##### **è¶…ï¼š
> è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘æŒ‰ç…§æ‚¨çš„æ“ä½œé‡åˆ°äº†ä¸ª ERROR 10002(C1000)ï¼š2Unknown exceptionï¼š[null]ï¼Œè¯·æ•™ä¸‹ è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ï¼Œä¸€ç›´æ²¡æŸ¥åˆ°è§£å†³åŠæ³•ï¼Ÿå¦å¤– åªåˆ†è¡¨ä¸åˆ†åº“ ä½†æœ‰äº›è¡¨æ˜¯å•è¡¨çš„ï¼Œè¯¥å¦‚ä½•é…ç½®ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å…·ä½“é—®é¢˜è¦çœ‹ä¸€ä¸‹ï¼Œåªåˆ†è¡¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬çš„è¯¾ç¨‹é‡Œæœ‰ç›¸å…³çš„æè¿°å’Œç¤ºä¾‹ä»£ç 

##### **å³°ï¼š
> mysql æˆ‘èƒ½ç™»å½•ä¸Šå»ã€‚

##### *äºšï¼š
> è¯·é—®è€å¸ˆï¼ŒShardingSphereä¸æ”¯æŒæ‰¹é‡æ›´æ–°å—ï¼Ÿ æœ‰ä»€ä¹ˆæŠ˜ä¸­è§£å†³åŠæ³•

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; åº”è¯¥æ˜¯æ”¯æŒæ‰¹é‡æ›´æ–°çš„

##### **å›½ï¼š
> é‹è¡Œé€™å€‹spring.profiles.active=traditionalå ±éŒ¯äº†ï¼Œå“ªè£å•é¡Œï¼ŸCaused by: java.lang.IllegalArgumentException: Data sources cannot be empty.

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ç¡®è®¤ä¸€ä¸‹æ•°æ®åº“åœ°å€æ˜¯å¦è®¾ç½®æ­£ç¡®

##### **åˆï¼š
> è€å¸ˆæ‚¨å¥½ï¼Œåœ¨åšsaasç³»ç»Ÿæ—¶ï¼Œåªåˆ†åº“ä¸åˆ†è¡¨ï¼Œä½†æ˜¯é…ç½®å¼ºåˆ¶è·¯ç”±ç­–ç•¥æ—¶ï¼Œéœ€è¦ç»‘åœ¨å…·ä½“è¡¨çš„ç­–ç•¥ï¼Œå¦‚æœè¡¨å¤šçš„æ—¶å€™å°±éœ€è¦é…ç½®å¾ˆå¤šä¿¡æ¯ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€è¦é…ç½®åˆ†åº“çš„å¼ºåˆ¶è·¯ç”±ç­–ç•¥å³å¯ï¼Œä¸ç”¨é…ç½®å…·ä½“çš„è¡¨å‘¢ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¼ºåˆ¶è·¯ç”±æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®åº“æä¾›çš„Hintæœºåˆ¶ï¼Œæˆ‘ç†è§£Hintæœºåˆ¶åº”è¯¥æ˜¯è¦å’Œè¡¨ä¸€èµ·æ‰èƒ½è¿ä½œçš„

##### **ç”¨æˆ·1024ï¼š
> Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.æºç æŠ¥è¿™ä¸ªé—®é¢˜ ï¼Œä½†å®é™…æˆ‘çœ‹éƒ½é…ç½®äº†

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯å“ªä¸ªä»£ç ç¤ºä¾‹å‡ºç°é—®é¢˜ï¼Ÿ

##### **å¤ï¼š
> è€å¸ˆä½ å¥½ï¼Œè¯·æ•™ä¸‰ä¸ªé—®é¢˜ï¼š1ã€å¯¹å­˜é‡æ•°æ®å¤§è¡¨å¦‚è®¢å•è¡¨ï¼Œæ€ä¹ˆé€šè¿‡ShardingSphereè¿›è¡Œåˆ†åº“åˆ†è¡¨å­˜å‚¨ï¼Ÿ2ã€ç±»æ¯”æ­¤å°èŠ‚demoï¼Œå¦‚æœåŒæ—¶å­˜åœ¨å¤šå¯¹ç»‘å®šè¡¨ å¦‚health_record/health_taské‡‡ç”¨user_idåˆ†ç‰‡ã€order/order_itemé‡‡ç”¨order_idåˆ†ç‰‡ï¼Œé‚£ä¹ˆåˆ†ç‰‡é”® è¦åˆ†åˆ«æ€ä¹ˆæŒ‡å®šï¼Œå› ä¸ºæ„Ÿè§‰spring.shardingsphere.sharding.default-database-strategy.inline.sharding-column åœ¨å­˜åœ¨ä¸€å¯¹ç»‘å®šè¡¨çš„è¯è¿˜å¥½è¯´ï¼Œå¦‚æœå­˜åœ¨å¤šå¯¹ç»‘å®šè¡¨è¿™ç§è®¾ç½®æ–¹å¼ä¸èƒ½å°†åˆ†ç‰‡é”®ä¸å…·ä½“ç›¸å…³çš„ç»‘å®šè¡¨è¿›è¡Œè”ç³»3ã€ç±»æ¯”æ­¤å°èŠ‚demoï¼Œhealth_record/health_task å‚ä¸åˆ†ç‰‡å› è€Œè¿›è¡Œåˆ†ç‰‡è®¾ç½®ï¼Œå¯å¦‚æœuserè¡¨ ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆå¤„ç†ï¼Ÿå½“å‰ç›´æ¥æ“ä½œuser è¿›è¡Œæ’å…¥æ˜¯ä¼šæŠ¥é”™çš„ã€Missing the data source name: 'null'ã€‘

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; 1.è¿™ä¸ªç›´æ¥ä½¿ç”¨ShardingSphereçš„åˆ†åº“åˆ†è¡¨åŠŸèƒ½å³å¯
2.åˆ†åˆ«è®¾ç½®å¤šç»„ç»‘å®šè¡¨å’Œåˆ†ç‰‡é”®
3.åº”è¯¥æ˜¯å¯ä»¥ç›´æ¥æ’å…¥userçš„ï¼ŒæŠ¥é”™æ„Ÿè§‰æ˜¯æ•°æ®æºè®¾ç½®é—®é¢˜ï¼Œä¸æ˜¯æœºåˆ¶é—®é¢˜

##### **è¾‰ï¼š
> userè¡¨ä¸éœ€è¦åˆ†åº“ä¹ˆ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™é‡Œæ¡ˆä¾‹æ˜¯æ¼”ç¤ºçš„æ˜¯health_recordå’Œhealth_taskçš„åˆ†åº“ï¼Œä¸æ˜¯é’ˆå¯¹userè¡¨çš„ï¼Œuserè¡¨å½“ç„¶ä¹Ÿå¯ä»¥åˆ†åº“

##### **å·«ï¼š
> è€å¸ˆï¼Œå¤§è¡¨çš„æ•°æ®ä¹Ÿä¼šåˆ†è¡¨è‡ªåŠ¨è¿ç§»è¿‡å»å—

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; åˆ†è¡¨å°±æ˜¯ä¸ºäº†è§£å†³å¤§è¡¨çš„æ•°æ®å’¯

##### *æ¶›ï¼š
> key-generator.props.worker.idæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œä¸ºä»€ä¹ˆæ˜¯33

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™æ˜¯æ˜¯é›ªèŠ±ç®—æ³•ä¸­çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šworkeridçš„ï¼Œè¿™ä¸ª33åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒç¬¬14è¯¾æ—¶çš„å†…å®¹

##### **æ™–ï¼š
> æ·»åŠ äº†shardingsphereä»¥åæ€ä¹ˆé€šè¿‡mybatis @DataSourceæ‰‹åŠ¨åˆ‡æ¢æ•°æ®æº

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™ä¸ªæˆ‘ç†è§£æ‰€æœ‰DataSourceéƒ½åº”è¯¥ç”±ShardingSphereæ¥ç»Ÿä¸€ç®¡ç†äº†ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸åº”è¯¥å†é€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ç±»åˆ‡æ¢æ•°æ®æº

##### **4562ï¼š
> åˆ†è¡¨åˆ†åº“ä¹‹åæ€ä¹ˆåˆ†é¡µå‘¢

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ShardingSphereè‡ªåŠ¨é›†æˆäº†åˆ†é¡µæœºåˆ¶çš„ï¼Œå¯ä»¥çœ‹åé¢çš„â€œå½’å¹¶å¼•æ“â€ç›¸å…³çš„å†…å®¹

##### **5052ï¼š
> æˆ‘çœ‹äº†ä¸€ä¸‹ç»‘å®šè¡¨çš„é…ç½®ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç»‘å®šè¡¨çš„è¯ï¼Œé…ç½®èµ·æ¥ä¸æ˜¯éå¸¸çš„å¤šï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„ï¼Œé’ˆå¯¹æ¯ä¸ªç»‘å®šè¡¨éƒ½éœ€è¦é…ç½®ã€‚ä¸€èˆ¬ä¸€ä¸ªç³»ç»Ÿä¸­ï¼ŒçœŸæ­£ç”¨åˆ°åˆ†åº“åˆ†è¡¨çš„è¡¨ä¸ä¼šå¤ªå¤šçš„ï¼Œå¤ªå¤šçš„è¯å°±ä¸é€‚åˆç”¨å…³ç³»å‹æ•°æ®åº“äº†ï¼Œæ‰€ä»¥ç»‘å®šè¡¨ä¹Ÿéƒ½æœ‰é™ã€‚

##### **å¤ï¼š
> Missing the data source name: 'null'è¿™ä¸ªé”™çš„åŸå› æ˜¯éœ€è¦æ’å…¥æ•°æ®çš„è¡¨æ²¡æœ‰åœ¨ "spring.shardingsphere.sharding.tables" é…ç½®å¯¹åº”çš„è¡¨

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™ä¸ªdatasource nameä¸ºnullåº”è¯¥æ˜¯æ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¸æ˜¯æ•°æ®è¡¨ä¸å­˜åœ¨

##### **å¨ï¼š
> åŸæ¨¡åŸæ ·çš„ä»£ç æ‹‰ä¸‹æ¥è·‘ä¸äº†å•Š,2020-10-08 20:21:12.839 nested exception is java.lang.IllegalArgumentException: qualifiedColumns is required.

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æˆ‘ä»¬çš„demoä¸­æ˜¯æœ‰ä¸€äº›SQLè„šæœ¬çš„ï¼Œéœ€è¦å…ˆæ‰§è¡Œã€‚è¯·åŒå­¦åœ¨è·‘ä»£ç ä¹‹å‰æ‰§è¡Œä¸€ä¸‹æ•°æ®åº“è„šæœ¬ã€‚

##### *å•Šï¼š
> å¦‚ä½•åšå‚ç›´åˆ†åº“åçš„è·¨åº“è¿è¡¨æŸ¥è¯¢ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; åŸºæœ¬çš„è·¨åº“è¿è¡¨æŸ¥è¯¢ShardingSphereéƒ½å·²ç»å¸®å¿™å¤„ç†å¥½äº†ï¼Œå†…éƒ¨ä½¿ç”¨äº†è·¯ç”±å’Œå½’å¹¶ç­‰æœºåˆ¶ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰SQLéƒ½å¯ä»¥åšå¾—åˆ°ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å®˜ç½‘ä¸Šçš„ä½¿ç”¨è¯´æ˜ï¼Œä¸Šé¢æœ‰ä½¿ç”¨ä¸Šçš„ä¸€äº›é™åˆ¶æ¡ä»¶

##### *å•Šï¼š
> è¯·é—®ï¼Œå¦‚ä½•åšåˆ°åªåˆ†åº“ä¸åˆ†è¡¨ï¼Ÿå¦‚orderè¡¨åªåœ¨è®¢å•åº“ï¼Œgoodsè¡¨åªåœ¨å•†å“åº“

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; åªåˆ†åº“çš„è¯å°±é‡‡ç”¨åªé‡‡ç”¨æ–‡ç« ä¸­æåˆ°çš„åˆ†åº“ç­–ç•¥å°±å¯ä»¥äº†ï¼Œæ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹å¼

##### *å•Šï¼š
> ç»‘å®šè¡¨è®¾ç½®ï¼šå¦‚æœaã€bäº’ä¸ºç»‘å®šè¡¨ cã€däº’ä¸ºç»‘å®šè¡¨ï¼Œæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å°±åˆ†åˆ«è®¾ç½®ä¸¤å¯¹ç»‘å®šè¡¨å…³ç³»å°±å¥½äº†ï¼Œaå’Œbæ˜¯ä¸€å¯¹ï¼Œcå’Œdæ˜¯ä¸€å¯¹

##### **å¹³ï¼š
> æä¾›çš„æºç  traditionalé…ç½®æ–‡ä»¶ä¹Ÿè¦æŒ‡å®šdatasource.namesç­‰å±æ€§ï¼Œä¸ç„¶ä¼šæŠ¥datasource is empty

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯¹çš„ï¼Œå¦‚æœç”¨åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶çš„è¯ä¹Ÿè¦é…ç½®çš„

##### **2538ï¼š
> æˆ‘åœ¨ä½¿ç”¨application-sharding-databases.propertiesé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŠ¥äº†ä»¥ä¸‹é”™è¯¯ï¼Œè¯·å¸®å¿™çœ‹çœ‹æ˜¯ä»€ä¹ˆåŸå› ï¼šException in thread "main" org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.PersistenceException:### Error updating database. Cause: java.lang.IllegalStateException: Missing the data source name: 'null'### The error may involve defaultParameterMap### The error occurred while setting parameters### SQL: INSERT INTO user (user_id, user_name) VALUES (?, ?)### Cause: java.lang.IllegalStateException: Missing the data source name: 'null'	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:79)

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™ä¸ªåº”è¯¥è¿˜æ˜¯ç¬¬ä¸‰æ–¹çš„æ•°æ®æºçš„å®ç°åº“å¼•ç”¨æœ‰é—®é¢˜ï¼Œå¤§æ¦‚ç‡æ•°æ®æºå·¥å…·ç‰ˆæœ¬é—®é¢˜

##### **9434ï¼š
> org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [org/apache/shardingsphere/shardingjdbc/spring/boot/SpringBootConfiguration.class]è¯·æ•™ä¸‹è¿™ä¸ªDataSourceä¸ºç©ºæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿä»£ç ä»gitä¸Šæ‹‰ä¸‹æ¥çš„

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™ä¸ªé—®é¢˜å¾ˆå¤§ç¨‹åº¦æ˜¯æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹DataSourceåº“ç‰ˆæœ¬çš„é—®é¢˜ï¼Œç¡®è®¤ä¸€ä¸‹gitä¸Šæ‹‰ä¸‹æ¥çš„ä»£ç ä¸­æ‰§è¡Œçš„æ˜¯å“ªéƒ¨åˆ†åŠŸèƒ½ï¼Œä¸è¦ä¿®æ”¹ç¬¬ä¸‰æ–¹å·¥å…·åº“çš„ç‰ˆæœ¬

##### **ç‹ï¼š
> æŒ‰è¯¾ç¨‹é…ç½®å®Œ insertçš„æ—¶å€™æŠ¥ç©ºæŒ‡é’ˆï¼Œåº”è¯¥æ˜¯æ‰¾ä¸åˆ°driverClassNameï¼Œçœ‹ä¸å‡ºæ¥å•¥é—®é¢˜ğŸ˜‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ‰¾ä¸åˆ°driverClassNameçš„è¯ï¼Œéœ€è¦åœ¨mavenä¸­æ·»åŠ Druidç­‰ç›¸å…³çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚å¦‚æœæ·»åŠ ä¹‹åè¿˜æ˜¯æŠ¥é”™ï¼Œé‚£éœ€è¦æ³¨æ„æ¡†æ¶çš„ç‰ˆæœ¬ã€‚å¦‚æœæ¡†æ¶å·²ç»æ·»åŠ äº†ç‰ˆæœ¬ä¹Ÿå’Œæ¡ˆä¾‹ä¸­çš„ä¸€è‡´ï¼Œåº”è¯¥æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚

##### **å¼€æŒ‚ï¼š
> è¿™ç« èŠ‚ä¸­health_recordå’Œhealth_taskä¸­çš„æ•°æ®éƒ½æ˜¯æ ¹æ®userIdå¯¹2å–æ¨¡è¿›è¡Œåˆ†åº“çš„å§ï¼Ÿuserè¡¨ä¸­æ’å…¥æ•°æ®æ˜¯éšæœºåˆ†é…çš„ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„ï¼Œæ˜¯å¯¹userIdå¯¹2å–æ¨¡ï¼Œuserè¡¨ä¸­æ’å…¥çš„æ•°æ®æ˜¯æ¨¡æ‹Ÿçš„æ•°æ®ï¼Œä»£ç ä¸­æœ‰å…·ä½“çš„æ•°æ®æ„å»ºæ–¹å¼

##### **ç³»æ˜¯æ·±äº•å†°ï¼š
> health_levelè¡¨åœ¨æ–°å¢çš„æ—¶å€™ä¼šåŒæ—¶æ’å…¥åˆ°å¤šä¸ªåº“é‡Œé¢ä¹ˆï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„

##### *æ¬¢ï¼š
> è¯·æ•™è€å¸ˆï¼Œå¦‚æœè¯´ç»‘å®šè¡¨çš„åˆ†ç‰‡é”®å¿…é¡»ä¸€è‡´çš„è¯ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç‰¹åˆ«æŒ‡æ˜ç»‘å®šå…³ç³»å‘¢ï¼Ÿç›´æ¥ç”¨å„è‡ªçš„åˆ†ç‰‡é”®ç›´æ¥åˆ¤æ–­ä¸å°±å¥½äº†å—ã€‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å„è‡ªç”¨åˆ†ç‰‡é”®çš„è¯åªæ˜¯é’ˆå¯¹å•ç‹¬ä¸€ä¸ªè¡¨ï¼Œè®¾ç½®ç»‘å®šè¡¨çš„ç›®çš„å°±æ˜¯å‡ å¼ è¡¨é€šè¿‡åŒä¸€ä¸ªåˆ†ç‰‡é”®ç»Ÿä¸€æ“ä½œ


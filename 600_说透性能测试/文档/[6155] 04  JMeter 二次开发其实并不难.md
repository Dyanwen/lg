<p data-nodeid="16782" class="">ä¸Šä¸€è®²æˆ‘ä»¬é€šè¿‡å­¦ä¹  JMeter çš„è„šæœ¬ç¼–å†™æ–¹å¼å’Œæ‰§è¡Œæ–¹å¼ï¼ŒæŒæ¡äº†å¦‚ä½•è®© JMeter æ›´åŠ æœ‰æ•ˆåœ°è¿è¡Œï¼Œå…¶æŠ€æœ¯æ€è·¯æ˜¯ä½¿ç”¨ JMeter æœ¬èº«æˆ–è€…ç¤¾åŒºæä¾›çš„ç°æˆæ–¹æ¡ˆå»å®ç°ï¼Œè¿™åŸºæœ¬å·²ç»æ»¡è¶³äº†ç»å¤§å¤šæ•°æ€§èƒ½æµ‹è¯•çš„éœ€æ±‚ã€‚</p>
<p data-nodeid="16783">éšç€äº’è”ç½‘è¡Œä¸šå‘å±•ï¼Œå„ç§æŠ€æœ¯æ–¹æ¡ˆå±‚å‡ºä¸ç©·ï¼Œä½†æ˜¯ä»»ä½•æ–¹æ¡ˆéƒ½ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæœ‰äº›éœ€æ±‚æ˜¯è¦æˆ‘ä»¬è‡ªå·±å†™ä»£ç å»å®ç°çš„ï¼ŒJMeter ä¹Ÿç•™äº†ç›¸åº”çš„å…¥å£ä¾¿äºæˆ‘ä»¬ç¼–å†™ä»£ç ï¼Œæ‰€ä»¥æœ¬è®²å°†ä»‹ç»ä¸‰ç§æ’ä»¶ç¼–å†™æ–¹å¼ï¼š</p>
<ul data-nodeid="16784">
<li data-nodeid="16785">
<p data-nodeid="16786">è‡ªå®šä¹‰ BeanShell åŠŸèƒ½</p>
</li>
<li data-nodeid="16787">
<p data-nodeid="16788">è‡ªå®šä¹‰è¯·æ±‚ç¼–å†™ï¼ˆJava&nbsp;Samplerï¼‰</p>
</li>
<li data-nodeid="16789">
<p data-nodeid="16790">è‡ªå®šä¹‰å‡½æ•°åŠ©æ‰‹</p>
</li>
</ul>
<p data-nodeid="16791"><img src="https://s0.lgstatic.com/i/image2/M01/06/91/Cip5yGAFWiKADSIlAAEajo52AJ8631.png" alt="Lark20210118-174730.png" data-nodeid="16923"></p>
<h3 data-nodeid="16792">è‡ªå®šä¹‰ BeanShell åŠŸèƒ½</h3>
<h4 data-nodeid="16793">ä»€ä¹ˆæ˜¯ BeanShell</h4>
<p data-nodeid="16794">BeanShell æ˜¯ç”± Java ç¼–å†™çš„ï¼Œç›¸å½“äºä¸€ä¸ªå°å·§çš„ Java <strong data-nodeid="16931">æºç è§£é‡Šå™¨</strong>ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä½ å¯ä»¥åœ¨é‡Œé¢å†™ä»£ç ï¼Œç„¶åé€šè¿‡ Beanshell ç¿»è¯‘æˆæ’ä»¶å¯ä»¥è¯†åˆ«çš„æŒ‡ä»¤å»æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p>
<h4 data-nodeid="16795">JMeter ä¸­ç”¨ BeanShell çš„ä¼˜åŠ¿</h4>
<p data-nodeid="16796">JMeter ä¹Ÿæ˜¯ç”± Java ç¼–å†™çš„ï¼Œè€Œ Java è¿è¡Œå‰éœ€è¦å…ˆç¼–è¯‘ï¼Œè€Œ BeanShell ä½œä¸ºä¸€æ¬¾è§£é‡Šå™¨ç›´æ¥è¿è¡Œæºä»£ç å°±å¯ä»¥ã€‚</p>
<h4 data-nodeid="16797">BeanShell åœ¨ JMeter çš„ä½œç”¨</h4>
<p data-nodeid="16798">BeanShell åœ¨ JMeter ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼ŒåŒ…æ‹¬å‰ç½®å¤„ç†å™¨ã€åç½®å¤„ç†å™¨ã€Sampler ç­‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™äº›ä¸»è¦åº”ç”¨æ˜¯åšä»€ä¹ˆçš„ã€‚</p>
<ul data-nodeid="16799">
<li data-nodeid="16800">
<p data-nodeid="16801">å‰ç½®å¤„ç†å™¨ï¼šä¸»è¦æ˜¯åœ¨æ¥å£è¯·æ±‚å‰åšä¸€äº›é€»è¾‘ï¼Œç”Ÿæˆå‚æ•°åŒ–æ•°æ®ã€‚</p>
</li>
<li data-nodeid="16802">
<p data-nodeid="16803">åç½®å¤„ç†å™¨ï¼šç”¨äºæå–å‚æ•°ã€å‚æ•°æ ¼å¼è®¾ç½®ç­‰ã€‚</p>
</li>
<li data-nodeid="16804">
<p data-nodeid="16805">Samplerï¼šå¯ä»¥ä½œä¸ºç‹¬ç«‹çš„è¯·æ±‚ï¼Œæ”¯æŒå„ç±»è¯·æ±‚ç¼–å†™ã€æ•°æ®ç”Ÿæˆã€‚</p>
</li>
</ul>
<h4 data-nodeid="16806">BeanShell çš„å¸¸è§ç”¨æ³•ä¸¾ä¾‹</h4>
<p data-nodeid="16807">å¯¹æˆ‘æ¥è¯´ï¼ŒBeanShell æœ€å¸¸è¢«ç”¨äºå¯¹è¯·æ±‚æˆ–è€…è¿”å›å†…å®¹è¿›è¡Œè·å–æˆ–è€…åŠ å·¥ï¼Œå…¶ä¸­ prev æ˜¯å¯¹å½“å‰çš„å–æ ·è¿›è¡Œè®¿é—®ï¼Œæ‰§è¡Œäº†å¯¹å“åº”çŠ¶æ€ç ã€å“åº”ä¿¡æ¯ã€è¯·æ±‚å¤´ç­‰çš„æ“ä½œï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="16808"><code data-language="java">log.info("code&nbsp;is&nbsp;&nbsp;"+prev.getResponseCode());
#è·å–å“åº”çš„çŠ¶æ€ç 
log.info("response&nbsp;is&nbsp;"+prev.getResponseDataAsString());
#è·å–å“åº”ä¿¡æ¯
log.info("content_type&nbsp;&nbsp;"+prev.getContentType());
#è·å–å¤´æ–‡ä»¶ä¸­ContentTypeç±»å‹
log.info("header&nbsp;"+prev.getRequestHeaders());
#è·å–å–æ ·å™¨è¯·æ±‚é¦–éƒ¨å­—æ®µ
</code></pre>
<p data-nodeid="16809">é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼ŒåŸºæœ¬å®ç°äº†å¯¹è¯·æ±‚çš„åŸºæœ¬ä¿¡æ¯çš„è·å–ï¼Œç„¶åä½ å°±å¯ä»¥å¯¹è¿™äº›ä¿¡æ¯åšè¿›ä¸€æ­¥çš„æå–ã€åˆ¤æ–­ç­‰æ“ä½œã€‚å¯èƒ½ä½ ä¼šé—®æˆ‘ï¼Œä½¿ç”¨ info çº§åˆ«çš„æ—¥å¿—æ‰“å°ï¼ŒJMeter è¿˜æ”¯æŒ error çº§åˆ«çš„æ—¥å¿—æ‰“å°å—ï¼Ÿç­”æ¡ˆæ˜¯æ”¯æŒçš„ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="16810"><code data-language="java">log.error(<span class="hljs-string">"cctester"</span>);
log.info(<span class="hljs-string">"cctester"</span>);
</code></pre>
<p data-nodeid="16811">ä½ å¯ä»¥åœ¨ BeanShell ä¸­è‡ªè¡ŒéªŒè¯ä¸‹ï¼Œä½¿ç”¨ log å’Œ error çš„æ–¹å¼å¯¹äº JMeter çš„ç•Œé¢æç¤ºä¿¡æ¯æ˜¯å¦æœ‰åŒºåˆ«ã€‚</p>
<p data-nodeid="16812">JMeter è°ƒç”¨ BeanShell è§£é‡Šå™¨æ¥è¿è¡Œè„šæœ¬ï¼ŒåŒæ ·éœ€è¦æ³¨æ„çš„æ˜¯ä¸å»ºè®®è¿‡åº¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œ å› ä¸ºåœ¨ JMeter é«˜å¹¶å‘æ—¶ï¼Œå®ƒå°†ä¼š<strong data-nodeid="16948">æ¶ˆè€—è¾ƒå¤šçš„æœ¬åœ°èµ„æº</strong>ï¼Œæ‰€ä»¥ä¸€èˆ¬é‡åˆ°é€»è¾‘ç›¸å¯¹å¤æ‚ä¸”ä»£ç é‡è¾ƒå¤§çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ JMeter çš„å¦ä¸€ç§ç‰¹è‰²åŠŸèƒ½ï¼šå¼€å‘è‡ªå®šä¹‰æ’ä»¶ï¼ˆjar å½¢å¼ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´è‡ªå®šä¹‰çš„æ’ä»¶ä¼šå¸®åŠ©æˆ‘ä»¬å®ç°ä¸¤æ–¹é¢åŠŸèƒ½ï¼š</p>
<ul data-nodeid="16813">
<li data-nodeid="16814">
<p data-nodeid="16815">JMeter æœ¬èº«éœ€è¦è‡ªè¡Œæ‹“å±•çš„è¯·æ±‚æˆ–è€…ä¸æ”¯æŒçš„æµ‹è¯•åè®®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java è¯·æ±‚æ¥å®Œæˆï¼›</p>
</li>
<li data-nodeid="16816">
<p data-nodeid="16817"><strong data-nodeid="16954">è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°</strong>ï¼ŒååŠ©æˆ‘ä»¬è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚</p>
</li>
</ul>
<h3 data-nodeid="16818">è‡ªå®šä¹‰è¯·æ±‚ç¼–å†™ï¼ˆJava&nbsp;Samplerï¼‰</h3>
<p data-nodeid="16819">ä¸ºäº†è®©ä½ èƒ½å¤Ÿç³»ç»Ÿåœ°å­¦ä¹  Java Sampler çš„ç¼–å†™ï¼Œæˆ‘å°†åˆ†ä¸ºå¦‚ä¸‹å››éƒ¨åˆ†æ¥ä»‹ç»ã€‚</p>
<ul data-nodeid="16820">
<li data-nodeid="16821">
<p data-nodeid="16822">ä»€ä¹ˆæ˜¯ Maven</p>
</li>
<li data-nodeid="16823">
<p data-nodeid="16824">ä»€ä¹ˆæ˜¯ Pom</p>
</li>
<li data-nodeid="16825">
<p data-nodeid="16826">å®ç° Java Sampler åŠŸèƒ½çš„ä¸¤ç§æ–¹å¼</p>
</li>
<li data-nodeid="16827">
<p data-nodeid="16828">å®ä¾‹ï¼šä½¿ç”¨ Java Sampler é‡å†™ POST è¯·æ±‚</p>
</li>
</ul>
<h4 data-nodeid="16829">ä»€ä¹ˆæ˜¯ Maven</h4>
<p data-nodeid="16830">Maven æ˜¯ä¸€ä¸ª<strong data-nodeid="16967">é¡¹ç›®ç®¡ç†å·¥å…·</strong>ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç®¡ç†é¡¹ç›®ä¾èµ–çš„ç¬¬ä¸‰æ–¹ç±»åº“åŠå…¶ç‰ˆæœ¬ï¼Œè¯´å¾—å†é€šä¿—ä¸€ç‚¹ï¼š</p>
<ul data-nodeid="16831">
<li data-nodeid="16832">
<p data-nodeid="16833">æ²¡æœ‰å®ƒä¹‹å‰ä½ å¾—æ‰‹åŠ¨ä¸‹è½½å¯¹åº”çš„ jarï¼Œå¹¶ä¸”å¤åˆ¶åˆ°é¡¹ç›®é‡Œé¢ï¼Œå‡çº§çš„è¯åˆå¾—é‡æ–°ä¸‹è½½ï¼›</p>
</li>
<li data-nodeid="16834">
<p data-nodeid="16835">æœ‰äº† Maven ä¹‹åä½ åªéœ€è¦å¡«å†™ä¾èµ–çš„åŒ…åè¯åŠå…¶ç‰ˆæœ¬å·ï¼Œå°±èƒ½è‡ªåŠ¨å¸®ä½ ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ç„¶åè‡ªåŠ¨è¿›è¡Œæ„å»ºï¼Œå¦‚æœè¯´ Maven åªæ˜¯åå­—æˆ–è€…ä»£å·ï¼Œé‚£ä¹ˆçµé­‚å°±æ˜¯ Pom äº†ã€‚</p>
</li>
</ul>
<h4 data-nodeid="16836">ä»€ä¹ˆæ˜¯ Pom</h4>
<p data-nodeid="16837">åœ¨ Maven é‡Œï¼Œproject å¯ä»¥æ²¡æœ‰ä»£ç ï¼Œä½†æ˜¯å¿…é¡»åŒ…å« pom.xml æ–‡ä»¶ã€‚pom æ–‡ä»¶æ˜¯ Maven å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¾èµ–çš„ç›¸å…³ä¿¡æ¯å¯ä»¥åœ¨ pom.xml ä¸­è¿›è¡Œé…ç½®ï¼Œå®ƒå¿…é¡»åŒ…å« modelVersionã€groupIdã€artifactId å’Œ version è¿™å››ä¸ªå…ƒç´ ï¼Œä¸‹é¢æ¥çœ‹ä¸‹è¿™äº›å…ƒç´ å…·ä½“çš„ä½œç”¨ã€‚</p>
<ul data-nodeid="16838">
<li data-nodeid="16839">
<p data-nodeid="16840"><strong data-nodeid="16976">modelVersion</strong>ï¼šæŒ‡å®šäº†å½“å‰ POM æ¨¡å‹çš„ç‰ˆæœ¬ï¼Œå¯¹äº Maven 2 åŠ Maven 3 æ¥è¯´éƒ½æ˜¯ 4.0.0ã€‚</p>
</li>
</ul>
<pre class="lang-java" data-nodeid="16841"><code data-language="java">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
</code></pre>
<ul data-nodeid="16842">
<li data-nodeid="16843">
<p data-nodeid="16844"><strong data-nodeid="16981">groupId</strong>ï¼šç»„ç»‡æ ‡è¯†ã€é¡¹ç›®åç§°ã€‚</p>
</li>
</ul>
<pre class="lang-java" data-nodeid="16845"><code data-language="java">&lt;groupId&gt;com.cctester&lt;/groupId&gt;
</code></pre>
<ul data-nodeid="16846">
<li data-nodeid="16847">
<p data-nodeid="16848"><strong data-nodeid="16986">artifactId</strong>ï¼šæ¨¡å—åç§°ï¼Œå½“å‰é¡¹ç›®ç»„ä¸­å”¯ä¸€çš„ IDã€‚</p>
</li>
</ul>
<pre class="lang-java" data-nodeid="16849"><code data-language="java">&lt;artifactId&gt;mavenTest&lt;/artifactId&gt;
</code></pre>
<ul data-nodeid="16850">
<li data-nodeid="16851">
<p data-nodeid="16852"><strong data-nodeid="16991">version</strong>ï¼šé¡¹ç›®å½“å‰çš„ç‰ˆæœ¬å·ã€‚</p>
</li>
</ul>
<pre class="lang-java" data-nodeid="16853"><code data-language="java">&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
</code></pre>
<ul data-nodeid="16854">
<li data-nodeid="16855">
<p data-nodeid="16856"><strong data-nodeid="16996">packaging</strong>ï¼šæ‰“åŒ…æ ¼å¼ï¼Œå¯ä»¥ä¸º jarã€war ç­‰ã€‚</p>
</li>
</ul>
<pre class="lang-java" data-nodeid="16857"><code data-language="java">&lt;packaging&gt;jar&lt;packaging&gt;
</code></pre>
<p data-nodeid="16858">å¼€å‘ä¹‹å‰åœ¨ pom æ–‡ä»¶é‡Œå¼•å…¥ç›¸åº”çš„ jar åŒ…ï¼Œè¿™äº› jar åŒ…ä¼šç»™æˆ‘ä»¬æä¾›ç›¸åº”çš„ç±»æˆ–è€…æ¥å£ï¼Œå¼•å…¥æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="lang-java" data-nodeid="16859"><code data-language="java">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.jmeter&lt;/groupId&gt;
    &lt;artifactId&gt;ApacheJMeter_core&lt;/artifactId&gt;
    &lt;version&gt;5.3&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.jmeter&lt;/groupId&gt;
    &lt;artifactId&gt;ApacheJMeter_java&lt;/artifactId&gt;
    &lt;version&gt;5.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 data-nodeid="16860"><strong data-nodeid="17001">å®ç° Java Sampler åŠŸèƒ½çš„ä¸¤ç§æ–¹å¼</strong></h4>
<ul data-nodeid="16861">
<li data-nodeid="16862">
<p data-nodeid="16863">ç»§æ‰¿ AbstractJavaSamplerClient&nbsp;æŠ½è±¡ç±»ï¼›</p>
</li>
<li data-nodeid="16864">
<p data-nodeid="16865">å®ç° JavaSamplerClient æ¥å£ã€‚</p>
</li>
</ul>
<p data-nodeid="16866">é€šè¿‡é˜…è¯»æºç å¯ä»¥å‘ç° AbstractJavaSamplerClient æŠ½è±¡ç±»æ˜¯ JavaSamplerClient æ¥å£çš„å­ç±»ï¼Œæƒ³å¿…æˆ‘ä»¬éƒ½çŸ¥é“å®ç°ä¸€ä¸ªæ¥å£å°±å¿…é¡»å®ç°æ¥å£é‡Œçš„æ‰€æœ‰æ–¹æ³•ï¼Œç„¶è€Œå½“ä½ ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•æ—¶ï¼Œç»§æ‰¿ AbstractJavaSamplerClient æŠ½è±¡ç±»ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä¸ºäº†å­¦ä¹ çš„å…¨é¢æ€§æˆ‘å°±ä»¥å®ç° JavaSamplerClient æ¥å£çš„æ–¹å¼å»è®²è§£æ‰€æ¶‰åŠçš„å››ä¸ªæ–¹æ³•ã€‚</p>
<p data-nodeid="16867">ï¼ˆ1ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸ªæ–¹æ³•ç”± JMeter åœ¨è¿›è¡Œæ·»åŠ  JavaRequest æ—¶ç¬¬ä¸€ä¸ªè¿è¡Œï¼Œå®ƒå†³å®šäº†ä½ è¦åœ¨ GUI ä¸­é»˜è®¤æ˜¾ç¤ºå“ªäº›å±æ€§ã€‚å½“æ¯æ¬¡åœ¨ GUI é‡Œç‚¹å‡»å»ºç«‹ java requst sampler çš„æ—¶å€™ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚è¯¥æ–¹æ³•è®¾ç½®äº† parameters çš„åˆå§‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ sampler çš„ GUI ç•Œé¢åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ã€‚</p>
<pre class="lang-java" data-nodeid="16868"><code data-language="java">&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span> Arguments <span class="hljs-title">getDefaultParameters</span><span class="hljs-params">()</span> </span>{}
</code></pre>
<p data-nodeid="16869">ï¼ˆ2ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºåˆå§‹åŒ–æµ‹è¯•è„šæœ¬é‡Œé¢ç”¨åˆ°çš„å˜é‡ï¼Œè¿™äº›å˜é‡ä¼šåœ¨åç»­æ‰§è¡Œä¸­ä½¿ç”¨ã€‚</p>
<pre class="lang-java" data-nodeid="16870"><code data-language="java">&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setupTest</span><span class="hljs-params">(JavaSamplerContext context)</span> </span>{}
</code></pre>
<p data-nodeid="16871">ï¼ˆ3ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œ<strong data-nodeid="17012">è¿™ä¸ªæ–¹æ³•æ˜¯å®ç°åŠŸèƒ½é€»è¾‘çš„ä¸»æ–¹æ³•</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šå¾ªç¯æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p>
<pre class="lang-java" data-nodeid="16872"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> SampleResult <span class="hljs-title">runTest</span><span class="hljs-params">(JavaSamplerContext context)</span> </span>{}
</code></pre>
<ul data-nodeid="19850">
<li data-nodeid="19851">
<p data-nodeid="19852">è®¡æ—¶å¼€å§‹çš„æ—¶åˆ»æ˜¯ä» SampleResult ç±»é‡Œé¢çš„ sampleStart() æ–¹æ³•æ‰§è¡Œå¼€å§‹ã€‚</p>
</li>
<li data-nodeid="19853">
<p data-nodeid="19854">è®¡æ—¶ç»“æŸçš„æ—¶åˆ»æ˜¯ sampleEnd() æ–¹æ³•æ‰§è¡Œç»“æŸã€‚</p>
</li>
<li data-nodeid="19855">
<p data-nodeid="19856" class="">setSuccessful() æ–¹æ³•ç”¨æ¥è¡¨ç¤ºæµ‹è¯•çš„æˆåŠŸä¸å¦ï¼Œé€šå¸¸ä½¿ç”¨ try catch æ¥è®¾ç½®ç»“æœï¼Œä¹Ÿå¯ä»¥ç”¨ if è¯­å¥ã€‚</p>
</li>
<li data-nodeid="19857" class="te-preview-highlight">
<p data-nodeid="19858">setResponseData() æ–¹æ³•ç”¨æ¥ä¸ºæµ‹è¯•ç»“æœä¼ é€’æ•°æ®ã€‚</p>
</li>
</ul>






<p data-nodeid="16882">ï¼ˆ4ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ‰€æœ‰çš„æµ‹è¯•å·¥ä½œä¹‹åæ‰§è¡Œï¼Œæœ‰ç‚¹åƒ finally çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œæˆ‘å¼€äº†ä¸€ä¸ªæ•°æ®åº“çš„è¿æ¥ï¼Œé‚£ä¹ˆæˆ‘è¦åœ¨æ‰€æœ‰çš„çº¿ç¨‹å®Œæˆå·¥ä½œåå…³é—­ã€‚</p>
<pre class="lang-java" data-nodeid="16883"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">teardownTest</span><span class="hljs-params">(JavaSamplerContext context)</span> </span>{}
</code></pre>
<h4 data-nodeid="16884">æ¡ˆä¾‹ï¼šä½¿ç”¨ JavaSampler é‡å†™ HTTP çš„ POST è¯·æ±‚</h4>
<p data-nodeid="16885">ç›¸ä¿¡ä½ åœ¨å¹³æ—¶å·¥ä½œä¸­ä¼šç»å¸¸æ¥è§¦åˆ° POST è¯·æ±‚ï¼Œæ¥ä¸‹æ¥æˆ‘å°†ä¸¾ä¸€ä¸ªæœ‰æ›´å¤šä»£å…¥æ„Ÿçš„ä¾‹å­ã€‚</p>
<p data-nodeid="16886">ï¼ˆ1ï¼‰é¦–å…ˆæˆ‘ä»¬æ¥å®Œæˆ POST è¯·æ±‚çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå…ˆä½¿ç”¨ HttpClients å‘é€æ„å»ºçš„ POST æ•°æ®åŒ…ï¼Œç„¶åè·å–åˆ°è¿”å›å€¼ï¼Œè¿™ä¸€æ­¥æ˜¯å®Œæˆ POST è¯·æ±‚çš„åŸºæœ¬æ­¥éª¤ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="16887"><code data-language="java"><span class="hljs-comment">//HttpClientsæä¾›åŠŸæ”¯æŒ HTTP åè®®çš„å®¢æˆ·ç«¯å·¥å…·</span>
httpClient = HttpClients.createDefault();
<span class="hljs-comment">//æ–°å»ºä¸€ä¸ªHttpPostè¯·æ±‚çš„å¯¹è±¡å°†urlï¼Œæ¥å£å‚æ•°ç­‰ä¿¡æ¯ä¼ ç»™è¿™ä¸ªå¯¹è±¡</span>
HttpPost httpPost = <span class="hljs-keyword">new</span> HttpPost(URL);
<span class="hljs-comment">//ä¼ å…¥è¯·æ±‚å‚æ•°</span>
httpPost.setEntity(<span class="hljs-keyword">new</span> UrlEncodedFormEntity(Value, UTF8_CHARSET));
<span class="hljs-comment">// è®¾ç½®headerä¿¡æ¯ï¼ŒæŒ‡å®šæŠ¥æ–‡å¤´Content-typeç­‰</span>
httpPost.setHeader(<span class="hljs-string">"Content-type"</span>, <span class="hljs-string">"xxxxx"</span>)ï¼›
<span class="hljs-comment">// æ‰§è¡Œè¯·æ±‚æ“ä½œï¼Œå¹¶æ‹¿åˆ°ç»“æœ</span>
response = httpClient.execute(httpPost);
</code></pre>
<p data-nodeid="16888">ï¼ˆ2ï¼‰æ¥ä¸‹æ¥å®ç° JavaSamplerClient æ¥å£ï¼Œè¿™æ˜¯ç¼–å†™ Java Sampler æ’ä»¶éœ€è¦å®ç°çš„æ ¸å¿ƒæ¥å£ï¼Œæ¶‰åŠçš„æ–¹æ³•æ˜¯ getDefaultParameters() å’Œ runTest()ï¼Œä½œç”¨ä¸Šæ–‡å·²ç»æè¿°è¿‡ã€‚ä¸‹é¢å¸¦ä½ æ¥çœ‹å…·ä½“æ€ä¹ˆä½¿ç”¨çš„ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre class="lang-java" data-nodeid="16889"><code data-language="java"><span class="hljs-comment">//è¿™æ˜¯å†³å®šæˆ‘ä»¬JMeterç•Œé¢éœ€è¦è¾“å…¥çš„å†…å®¹ï¼Œä½ å¯ä»¥çœ‹åˆ°æœ‰äº†urlï¼Œusername å’Œpasswordä¿¡æ¯ï¼Œå¹¶ä¸”ç»™å‡ºäº†é»˜è®¤å€¼</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Arguments <span class="hljs-title">getDefaultParameters</span><span class="hljs-params">()</span> </span>{
    Arguments arguments = <span class="hljs-keyword">new</span> Arguments();
    arguments.addArgument(<span class="hljs-string">"url"</span>,<span class="hljs-string">"127.0.0.1:9081"</span>);
    arguments.addArgument(<span class="hljs-string">"username"</span>, <span class="hljs-string">"cctester"</span>);
    arguments.addArgument(<span class="hljs-string">"password"</span>, <span class="hljs-string">"password"</span>);
    <span class="hljs-keyword">return</span> arguments;
}
</code></pre>
<p data-nodeid="16890">è¿™ä¸€æ­¥å®é™…çš„æ•ˆæœå›¾å¯ä»¥çœ‹ä¸‹æ–¹çš„åˆå§‹ç•Œé¢å›¾ã€‚</p>
<p data-nodeid="16891"><img src="https://s0.lgstatic.com/i/image2/M01/06/8C/Cip5yGAFPAKAEmBcAAB8OFXAQYo399.png" alt="Drawing 0.png" data-nodeid="17025"></p>
<div data-nodeid="16892"><p style="text-align:center">åˆå§‹ç•Œé¢å›¾</p></div>
<p data-nodeid="16893">ï¼ˆ3ï¼‰åœ¨ä¸Šä¸€æ­¥éª¤è¿›è¡Œäº†å‚æ•°çš„è¾“å…¥ï¼Œæ¥ä¸‹æ¥å®ç°æ¥æ”¶è¿™äº›å‚æ•°ï¼Œå¹¶è¿›è¡Œå‚æ•°çš„è¾“å…¥ã€å‘é€ã€è¿”å›åˆ¤æ–­ç­‰ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre class="lang-java" data-nodeid="16894"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> SampleResult <span class="hljs-title">runTest</span><span class="hljs-params">(JavaSamplerContext javaSamplerContext)</span> </span>{
    <span class="hljs-comment">//ç”ŸæˆsampleResultå¯¹è±¡ï¼Œç”¨äºè¯·æ±‚çš„å‘½åã€æ ‡è®°çŠ¶æ€ã€æ·»åŠ è¿”å›å†…å®¹ç­‰</span>
    SampleResult sampleResult=<span class="hljs-keyword">new</span> SampleResult();
    sampleResult.setSampleLabel(<span class="hljs-string">"cctester_login"</span>);
    <span class="hljs-comment">//è°ƒç”¨ä¸Šæ–‡ä¸­å®ç°çš„postè¯·æ±‚</span>
    PostTest postTest=<span class="hljs-keyword">new</span> PostTest();
    <span class="hljs-comment">//æ¥å—JMeterç•Œé¢ä¸Šä¼ è¾“çš„å‚æ•°</span>
    String username = javaSamplerContext.getParameter(<span class="hljs-string">"username"</span>);
    String password = javaSamplerContext.getParameter(<span class="hljs-string">"password"</span>);
    String url = javaSamplerContext.getParameter(<span class="hljs-string">"url"</span>);
    <span class="hljs-comment">//æ ‡è®°è¯·æ±‚å¼€å§‹</span>
    sampleResult.sampleStart();
    <span class="hljs-keyword">try</span> {
        HttpResponse result =postTest.Request(url,username,password);
        String entity= EntityUtils.toString(result.getEntity());
        <span class="hljs-comment">//æ ¹æ®è¿”å›å†…å®¹åˆ¤æ–­ç»“æœçŠ¶æ€å¹¶å±•ç¤ºç»“æœ</span>
        <span class="hljs-keyword">if</span> (result.getStatusLine().getStatusCode()==<span class="hljs-number">200</span>){
            sampleResult.setSuccessful(<span class="hljs-keyword">true</span>);
            sampleResult.setResponseCodeOK();
            sampleResult.setResponseData(entity, <span class="hljs-string">"utf-8"</span>);
        }<span class="hljs-keyword">else</span> {
            sampleResult.setSuccessful(<span class="hljs-keyword">false</span>);
            sampleResult.setResponseData(entity, <span class="hljs-string">"utf-8"</span>);
   ï¼‰
</code></pre>
<p data-nodeid="16895">ï¼ˆ4ï¼‰å®Œæˆåæ‰“æˆ jar åŒ…æ”¾åˆ° /lib/ext ä¸‹é‡å¯ JMeter å³å¯ï¼Œå®é™…çš„æ•ˆæœå›¾ä½ å¯ä»¥å‚è€ƒä¸Šæ–¹çš„åˆå§‹ç•Œé¢å›¾å’Œä¸‹æ–¹çš„è¿è¡Œå›¾ã€‚</p>
<p data-nodeid="16896"><img src="https://s0.lgstatic.com/i/image2/M01/06/8C/Cip5yGAFPBOAecdTAAC22dYxB2Q653.png" alt="Drawing 1.png" data-nodeid="17030"></p>
<div data-nodeid="16897"><p style="text-align:center">è¿è¡Œå›¾</p></div>
<h3 data-nodeid="16898">è‡ªå®šä¹‰å‡½æ•°åŠ©æ‰‹</h3>
<p data-nodeid="16899">é€šè¿‡ Java Sampler æ’ä»¶å¼€å‘çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ JMeter ç›¸å…³æ’ä»¶çš„å¼€å‘å…¶å®éƒ½æ˜¯æœ‰ä¸€å®šçš„å¥—è·¯å¯å¾ªï¼Œé‚£ JMeter å‡½æ•°åŠ©æ‰‹å¼€å‘ä¹Ÿä¸ä¾‹å¤–ï¼Œæ¥ä¸‹æ¥è¿›è¡Œå‡½æ•°åŠ©æ‰‹å¼€å‘æµç¨‹çš„äº†è§£ã€‚</p>
<p data-nodeid="16900">ï¼ˆ1ï¼‰å¼•å…¥ Maven åŒ…ï¼Œè¿™ä¸ªåŒ…ä¼šç»™æˆ‘ä»¬æä¾›å‡½æ•°åŠ©æ‰‹å¼€å‘ç›¸å…³çš„ç±»ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre class="lang-java" data-nodeid="16901"><code data-language="java">&lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.apache.jmeter&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;ApacheJMeter_functions&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;5.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p data-nodeid="16902">ï¼ˆ2ï¼‰æ¥ä¸‹æ¥æ–°å»ºæˆ‘ä»¬çš„ç±»åŒ…ï¼Œæ­¤æ—¶æ–°å»ºçš„åŒ…éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œ<strong data-nodeid="17039">åå­—åªèƒ½æ˜¯ functions ç»“å°¾</strong>ï¼Œå¦åˆ™æ‰“åŒ…æ”¾åˆ° JMeter ä¸­æ˜¯æ²¡æœ‰åŠæ³•è¯†åˆ«è¿™ä¸ªæ’ä»¶çš„ï¼Œç„¶åä»£ç ä¸­ç»§æ‰¿ AbstractFunction ç±»å°±å¯ä»¥å®ç°ï¼Œä¸€èµ·çœ‹ä¸‹éœ€è¦å®ç°å“ªäº›æ–¹æ³•ã€‚</p>
<pre class="lang-java" data-nodeid="16903"><code data-language="java">&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;String&nbsp;<span class="hljs-title">getReferenceKey</span><span class="hljs-params">()</span>&nbsp;</span>{}
</code></pre>
<p data-nodeid="16904">è¿™ä¸€æ–¹æ³•è¡¨ç¤ºå‡½æ•°åŠ©æ‰‹å¯¹è¯æ¡†ä¸­çš„ä¸‹æ‹‰æ¡†ä¸­æ˜¾ç¤ºçš„å‡½æ•°åç§°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p data-nodeid="16905"><img src="https://s0.lgstatic.com/i/image2/M01/06/8C/Cip5yGAFPB6ADKzZAAB86ItSH7Q951.png" alt="Drawing 2.png" data-nodeid="17043"></p>
<pre class="lang-java" data-nodeid="16906"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getArgumentDesc</span><span class="hljs-params">()</span> </span>{}
</code></pre>
<p data-nodeid="16907">è¿™ä¸€æ–¹æ³•æ˜¯è®¾ç½®å…¥å‚çš„æè¿°è¯­ï¼Œç”¨äºå‡½æ•°åŠ©æ‰‹å¯¹è¯æ¡†ä¸­ï¼Œæ˜¾ç¤ºå‡½æ•°åç§°æç¤ºã€‚</p>
<pre class="lang-java" data-nodeid="16908"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setParameters</span><span class="hljs-params">(Collection&lt;CompoundVariable&gt; collection)</span> </span>{}
</code></pre>
<p data-nodeid="16909">è¿™ä¸€æ–¹æ³•ç”¨äºæˆ‘ä»¬çš„å‚æ•°å€¼ä¼ å…¥ã€‚</p>
<pre class="lang-java" data-nodeid="16910"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">(SampleResult sampleResult, Sampler sampler)</span></span>{}
</code></pre>
<p data-nodeid="16911">è¿™ä¸€æ–¹æ³•æ˜¯æ ¹æ®å…¥å‚ï¼Œæ‰§è¡Œæ ¸å¿ƒé€»è¾‘ï¼Œä¿å­˜ç»“æœè‡³ç›¸åº”çš„å˜é‡ä¸­ã€‚</p>
<h3 data-nodeid="16912">æ€»ç»“</h3>
<p data-nodeid="16913">é€šè¿‡æœ¬è®²çš„å­¦ä¹ ï¼Œä½ çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨ä»£ç æ–¹å¼å®ç°è‡ªå·±éœ€è¦çš„æ’ä»¶ï¼Œbeanshell å’Œ jar åŒ…å¼•å…¥éƒ½æ˜¯å·¥ä½œä¸­å¸¸è§çš„ï¼Œç›¸ä¿¡è¿™éƒ¨åˆ†çŸ¥è¯†ä¼šå¯¹ä½ çš„å·¥ä½œäº§ç”Ÿæ¯”è¾ƒå¤§çš„å¸®åŠ©ï¼Œè¿™ä¹Ÿæ˜¯ JMeter çš„ç‰¹è‰²åŠŸèƒ½ï¼Œä¸ä»…è½åœ°æ€§å¼ºè€Œä¸”ç¤¾åŒºèµ„æ–™å®Œå–„ã€‚</p>
<p data-nodeid="16914"><strong data-nodeid="17053">è¿™é‡Œç»™ä½ ç•™ä¸ªå°ä½œä¸š</strong>ï¼šç›¸ä¿¡ç»è¿‡ä¸Šæ–‡çš„è®²è§£ä»¥åŠå®ä¾‹ï¼Œä½ æ¯”è¾ƒæ¸…æ¥šåœ°çŸ¥é“äº†æ’ä»¶å¼€å‘çš„æ ¸å¿ƒæµç¨‹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±å·¥ä½œä¸­çš„è‡ªå®šä¹‰å‡½æ•°åŠ©æ‰‹çš„éœ€æ±‚ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ä»£ç ç»“æ„è‡ªè¡Œå®Œæˆã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºç•™è¨€ã€‚</p>
<p data-nodeid="16915" class="">ä¸‹ä¸€è®²æˆ‘å°†ç»§ç»­å¸¦ä½ ä¸€èµ·è¿›è¡Œæ€§èƒ½æµ‹è¯•å¹³å°å¼€å‘çš„æµç¨‹è®²è§£ï¼Œç›¸ä¿¡å¯¹äºå·¥å…·å±‚é¢çš„è®¤çŸ¥ä¼šæ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### **åŠï¼š
> è¿™æ‰æ˜¯å¹²è´§ï¼Œä¹‹å‰è€è§‰å¾—JmeteräºŒæ¬¡å¼€å‘å¾ˆç¥ç§˜ï¼Œå¾ˆé«˜ç«¯ï¼Œå­¦è¿‡ä¹‹åå‘ç°æˆ‘ä¹Ÿèƒ½è¿›è¡ŒjmeteräºŒæ¬¡å¼€å‘äº†,å‘¨è€å¸ˆå†™çš„å¾ˆé€šä¿—æ˜“æ‡‚ï¼Œå¾ˆæ¸…æ™°.ç‚¹ä¸ªèµ.

##### **ä¸½ï¼š
> è°¢è°¢è€å¸ˆè®²è§£è¿™ä¹ˆç»†è‡´ï¼Œä»¥å‰ä¹°è¿‡å…¶ä»–çš„è¯¾ç¨‹ï¼Œå¿ƒé‡Œè®¤ä¸ºè¿™ä¸ªè€å¸ˆè®²çš„æœ€å¥½äº†ï¼æ„Ÿè°¢ğŸ™

##### **å…ƒï¼š
> éå¸¸åˆ°ä½ï¼Œç»™åŠ›

##### *é‘«ï¼š
> è€å¸ˆå¥½ï¼Œè¯·é—®ä¸‹é‡å†™sampleræˆ–è€…functionsï¼Œpom.xmlä¾èµ–çš„ç‰ˆæœ¬å·å¿…é¡»å’Œä½¿ç”¨çš„jmeterä¸€ä¸ªç‰ˆæœ¬ä¹ˆï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å°½é‡åŒä¸€ä¸ªç‰ˆæœ¬å·ã€‚

##### *å¼ºï¼š
> éœ€è¦ä¸€å®šåŸºç¡€æ‰çœ‹çš„æ˜ç™½ï¼Œæ¶è¡¥ç›¸å…³çŸ¥è¯†ã€‚ã€‚ã€‚ã€‚


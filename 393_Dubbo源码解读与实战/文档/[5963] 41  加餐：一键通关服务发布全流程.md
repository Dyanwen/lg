<p data-nodeid="184375" class="">åœ¨å‰é¢çš„è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»å°†æ•´ä¸ª Dubbo çš„æ ¸å¿ƒå®ç°è¿›è¡Œäº†åˆ†æã€‚æ¥ä¸‹æ¥çš„ä¸¤ä¸ªè¯¾æ—¶ï¼Œæˆ‘ä»¬å°†ä¸²è” Dubbo ä¸­çš„è¿™äº›æ ¸å¿ƒå®ç°ï¼Œåˆ†æ Dubbo<strong data-nodeid="184470">æœåŠ¡å‘å¸ƒ</strong>å’Œ<strong data-nodeid="184471">æœåŠ¡å¼•ç”¨</strong>çš„å…¨æµç¨‹ï¼Œå¸®åŠ©ä½ å°†ä¹‹å‰è¯¾æ—¶ä»‹ç»çš„ç‹¬ç«‹çŸ¥è¯†ç‚¹è”ç³»èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´æ•´ä½“ã€‚</p>
<p data-nodeid="184376">æœ¬è¯¾æ—¶æˆ‘ä»¬å°±å…ˆæ¥é‡ç‚¹å…³æ³¨ Provider èŠ‚ç‚¹å‘å¸ƒæœåŠ¡çš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ°ä¹‹å‰ä»‹ç»çš„å¾ˆå¤š Dubbo æ ¸å¿ƒç»„ä»¶ã€‚æˆ‘ä»¬ä» DubboBootstrap è¿™ä¸ªå…¥å£ç±»å¼€å§‹ä»‹ç»ï¼Œåˆ†æ Provider URL çš„ç»„è£…ä»¥åŠæœåŠ¡å‘å¸ƒæµç¨‹ï¼Œå…¶ä¸­ä¼šè¯¦ç»†ä»‹ç»æœ¬åœ°å‘å¸ƒå’Œè¿œç¨‹å‘å¸ƒçš„æ ¸å¿ƒæµç¨‹ã€‚</p>
<h3 data-nodeid="184377">DubboBootstrap å…¥å£</h3>
<p data-nodeid="184378">åœ¨<a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=393#/detail/pc?id=4257" data-nodeid="184477">ç¬¬ 01 è¯¾æ—¶</a>dubbo-demo-api-provider ç¤ºä¾‹çš„ Provider å®ç°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ª Provider èŠ‚ç‚¹çš„å¯åŠ¨å…¥å£æ˜¯ DubboBootstrap.start() æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä¼šæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œä»¥åŠä¸€äº›çŠ¶æ€æ§åˆ¶å­—æ®µçš„æ›´æ–°ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="184379"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> DubboBootstrap <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (started.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) { <span class="hljs-comment">// CASæ“ä½œï¼Œä¿è¯å¯åŠ¨ä¸€æ¬¡</span>
&nbsp; &nbsp; &nbsp; &nbsp; ready.set(<span class="hljs-keyword">false</span>); <span class="hljs-comment">// ç”¨äºåˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å·²ç»å¯åŠ¨å®Œæ¯•ï¼Œåœ¨åé¢çš„Dubbo QoSä¸­ä¼šä½¿ç”¨åˆ°è¯¥å­—æ®µ</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// åˆå§‹åŒ–ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œä¾‹å¦‚ï¼Œé…ç½®ä¸­å¿ƒç›¸å…³ç»„ä»¶ã€äº‹ä»¶ç›‘å¬ã€å…ƒæ•°æ®ç›¸å…³ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶åœ¨åé¢å°†ä¼šè¿›è¡Œä»‹ç»</span>
&nbsp; &nbsp; &nbsp; &nbsp; initialize();&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// é‡ç‚¹ï¼šå‘å¸ƒæœåŠ¡</span>
&nbsp; &nbsp; &nbsp; &nbsp; exportServices();
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (!isOnlyRegisterProvider() || hasExportedServices()) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// ç”¨äºæš´éœ²æœ¬åœ°å…ƒæ•°æ®æœåŠ¡ï¼Œåé¢ä»‹ç»å…ƒæ•°æ®çš„æ—¶å€™ä¼šæ·±å…¥ä»‹ç»è¯¥éƒ¨åˆ†çš„å†…å®¹</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exportMetadataService();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// ç”¨äºå°†æœåŠ¡å®ä¾‹æ³¨å†Œåˆ°ä¸“ç”¨äºæœåŠ¡å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; registerServiceInstance();
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// å¤„ç†Consumerçš„ReferenceConfig</span>
&nbsp; &nbsp; &nbsp; &nbsp; referServices();
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (asyncExportingFutures.size() &gt; <span class="hljs-number">0</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// å¼‚æ­¥å‘å¸ƒæœåŠ¡ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ç›‘å¬å‘å¸ƒæ˜¯å¦å®Œæˆï¼Œå®Œæˆä¹‹åä¼šå°†readyè®¾ç½®ä¸ºtrue</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">new</span> Thread(() -&gt; {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">this</span>.awaitFinish();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ready.set(<span class="hljs-keyword">true</span>);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }).start();
&nbsp; &nbsp; &nbsp; &nbsp; } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// åŒæ­¥å‘å¸ƒæœåŠ¡æˆåŠŸä¹‹åï¼Œä¼šå°†readyè®¾ç½®ä¸ºtrue</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ready.set(<span class="hljs-keyword">true</span>);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
}
</code></pre>
<p data-nodeid="184380"><strong data-nodeid="184483">ä¸ä»…æ˜¯ç›´æ¥é€šè¿‡ API å¯åŠ¨ Provider çš„æ–¹å¼ä¼šä½¿ç”¨åˆ° DubboBootstrapï¼Œåœ¨ Spring ä¸ Dubbo é›†æˆçš„æ—¶å€™ä¹Ÿæ˜¯ä½¿ç”¨ DubboBootstrap ä½œä¸ºæœåŠ¡å‘å¸ƒå…¥å£çš„</strong>ï¼Œå…·ä½“é€»è¾‘åœ¨ DubboBootstrapApplicationListener è¿™ä¸ª Spring Context ç›‘å¬å™¨ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="lang-java" data-nodeid="184381"><code data-language="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DubboBootstrapApplicationListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OneTimeExecutionApplicationContextEventListener</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">implements</span> <span class="hljs-title">Ordered</span> </span>{
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DubboBootstrap dubboBootstrap;
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DubboBootstrapApplicationListener</span><span class="hljs-params">()</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="hljs-comment">// åˆå§‹åŒ–DubboBootstrapå¯¹è±¡</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">this</span>.dubboBootstrap = DubboBootstrap.getInstance();
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-meta">@Override</span>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onApplicationContextEvent</span><span class="hljs-params">(ApplicationContextEvent event)</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="hljs-comment">// ç›‘å¬ContextRefreshedEventäº‹ä»¶å’ŒContextClosedEventäº‹ä»¶</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ContextRefreshedEvent) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onContextRefreshedEvent((ContextRefreshedEvent) event);
&nbsp; &nbsp; &nbsp; &nbsp; } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ContextClosedEvent) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onContextClosedEvent((ContextClosedEvent) event);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onContextRefreshedEvent</span><span class="hljs-params">(ContextRefreshedEvent event)</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; dubboBootstrap.start(); <span class="hljs-comment">// å¯åŠ¨DubboBootstrap</span>
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onContextClosedEvent</span><span class="hljs-params">(ContextClosedEvent event)</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; dubboBootstrap.stop();
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-meta">@Override</span>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> LOWEST_PRECEDENCE;
&nbsp; &nbsp; }
}
</code></pre>
<p data-nodeid="184382">è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯<strong data-nodeid="184489">exportServices() æ–¹æ³•ï¼Œå®ƒæ˜¯æœåŠ¡å‘å¸ƒæ ¸å¿ƒé€»è¾‘çš„å…¥å£</strong>ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªæœåŠ¡æ¥å£éƒ½ä¼šè½¬æ¢ä¸ºå¯¹åº”çš„ ServiceConfig å®ä¾‹ï¼Œç„¶åé€šè¿‡ä»£ç†çš„æ–¹å¼è½¬æ¢æˆ Invokerï¼Œæœ€ç»ˆè½¬æ¢æˆ Exporter è¿›è¡Œå‘å¸ƒã€‚æœåŠ¡å‘å¸ƒæµç¨‹ä¸­æ¶‰åŠçš„æ ¸å¿ƒå¯¹è±¡è½¬æ¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p data-nodeid="184584" class="te-preview-highlight"><img src="https://s0.lgstatic.com/i/image/M00/89/79/Ciqc1F_YdkGABhTFAACpT-2oDtw867.png" alt="Lark20201215-163844.png" data-nodeid="184588"></p>
<div data-nodeid="184585"><p style="text-align:center">æœåŠ¡å‘å¸ƒæ ¸å¿ƒæµç¨‹å›¾</p></div>


<p data-nodeid="184385">exportServices() æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="184386"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exportServices</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// ä»é…ç½®ç®¡ç†å™¨ä¸­è·å–åˆ°æ‰€æœ‰çš„è¦æš´éœ²çš„æœåŠ¡é…ç½®ï¼Œä¸€ä¸ªæ¥å£ç±»å¯¹åº”ä¸€ä¸ªServiceConfigBaseå®ä¾‹</span>
&nbsp; &nbsp; configManager.getServices().forEach(sc -&gt; {
&nbsp; &nbsp; &nbsp; &nbsp; ServiceConfig serviceConfig = (ServiceConfig) sc;
&nbsp; &nbsp; &nbsp; &nbsp; serviceConfig.setBootstrap(<span class="hljs-keyword">this</span>);
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (exportAsync) { <span class="hljs-comment">// å¼‚æ­¥æ¨¡å¼ï¼Œè·å–ä¸€ä¸ªçº¿ç¨‹æ± æ¥å¼‚æ­¥æ‰§è¡ŒæœåŠ¡å‘å¸ƒé€»è¾‘</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ExecutorService executor = executorRepository.getServiceExporterExecutor();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Future&lt;?&gt; future = executor.submit(() -&gt; {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc.export();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exportedServices.add(sc);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="hljs-comment">// è®°å½•å¼‚æ­¥å‘å¸ƒçš„Future</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asyncExportingFutures.add(future);
&nbsp; &nbsp; &nbsp; &nbsp; } <span class="hljs-keyword">else</span> {<span class="hljs-comment">// åŒæ­¥å‘å¸ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc.export(); 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exportedServices.add(sc);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; });
}
</code></pre>
<h3 data-nodeid="184387">ServiceConfig</h3>
<p data-nodeid="184388">åœ¨ ServiceConfig.export() æ–¹æ³•ä¸­ï¼ŒæœåŠ¡å‘å¸ƒçš„ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥å‚æ•°ï¼Œç¬¬äºŒæ­¥ä¼šæ ¹æ®å½“å‰é…ç½®å†³å®šæ˜¯å»¶è¿Ÿå‘å¸ƒè¿˜æ˜¯ç«‹å³è°ƒç”¨ doExport() æ–¹æ³•è¿›è¡Œå‘å¸ƒï¼Œç¬¬ä¸‰æ­¥ä¼šé€šè¿‡ exported() æ–¹æ³•å›è°ƒç›¸å…³ç›‘å¬å™¨ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="184389"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">export</span><span class="hljs-params">()</span> </span>{
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (!shouldExport()) {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span>;
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (bootstrap == <span class="hljs-keyword">null</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; bootstrap = DubboBootstrap.getInstance();
&nbsp; &nbsp; &nbsp; &nbsp; bootstrap.init();
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-comment">// æ£€æŸ¥å¹¶æ›´æ–°å„é¡¹é…ç½®</span>
&nbsp; &nbsp; checkAndUpdateSubConfigs();
&nbsp; &nbsp; ... <span class="hljs-comment">// åˆå§‹åŒ–å…ƒæ•°æ®ç›¸å…³æœåŠ¡</span>
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (shouldDelay()) { <span class="hljs-comment">// å»¶è¿Ÿå‘å¸ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; DELAY_EXPORT_EXECUTOR.schedule(<span class="hljs-keyword">this</span>::doExport, getDelay(), TimeUnit.MILLISECONDS);
&nbsp; &nbsp; } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// ç«‹å³å‘å¸ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; doExport();
&nbsp; &nbsp; }
&nbsp; &nbsp; exported(); <span class="hljs-comment">// å›è°ƒç›‘å¬å™¨</span>
}
</code></pre>
<p data-nodeid="184390">åœ¨ checkAndUpdateSubConfigs() æ–¹æ³•ä¸­ï¼Œä¼šå»æ£€æŸ¥å„é¡¹é…ç½®æ˜¯å¦åˆç†ï¼Œå¹¶è¡¥é½ä¸€äº›ç¼ºçœçš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸å†—é•¿ï¼Œè¿™é‡Œå°±ä¸å†å±•ç¤ºï¼Œä½ è‹¥æ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒ<a href="https://github.com/xxxlxy2008/dubbo" data-nodeid="184499">æºç </a>è¿›è¡Œå­¦ä¹ ã€‚</p>
<p data-nodeid="184391">å®Œæˆé…ç½®çš„æ£€æŸ¥ä¹‹åï¼Œå†æ¥çœ‹ doExport() æ–¹æ³•ï¼Œå…¶ä¸­é¦–å…ˆè°ƒç”¨ loadRegistries() æ–¹æ³•åŠ è½½æ³¨å†Œä¸­å¿ƒä¿¡æ¯ï¼Œå³å°† RegistryConfig é…ç½®è§£ææˆ registryUrlã€‚æ— è®ºæ˜¯ä½¿ç”¨ XMLã€Annotationï¼Œè¿˜æ˜¯ API é…ç½®æ–¹å¼ï¼Œéƒ½å¯ä»¥é…ç½®å¤šä¸ªæ³¨å†Œä¸­å¿ƒåœ°å€ï¼Œä¸€ä¸ªæœåŠ¡æ¥å£å¯ä»¥åŒæ—¶æ³¨å†Œåœ¨å¤šä¸ªä¸åŒçš„æ³¨å†Œä¸­å¿ƒã€‚</p>
<p data-nodeid="184392">RegistryConfig æ˜¯ Dubbo çš„å¤šä¸ªé…ç½®å¯¹è±¡ä¹‹ä¸€ï¼Œå¯ä»¥é€šè¿‡è§£æ XMLã€Annotation ä¸­æ³¨å†Œä¸­å¿ƒç›¸å…³çš„é…ç½®å¾—åˆ°ï¼Œå¯¹åº”çš„é…ç½®å¦‚ä¸‹ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ API åˆ›å»ºå¾—åˆ°ï¼‰ï¼š</p>
<pre class="lang-java" data-nodeid="184393"><code data-language="java">&lt;dubbo:registry address=<span class="hljs-string">"zookeeper://127.0.0.1:2181"</span> protocol=<span class="hljs-string">"zookeeper"</span> port=<span class="hljs-string">"2181"</span> /&gt;
</code></pre>
<p data-nodeid="184394">RegistryUrl çš„æ ¼å¼å¤§è‡´å¦‚ä¸‹ï¼ˆä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œè¿™é‡Œå°†æ¯ä¸ª URL å‚æ•°å•ç‹¬æ”¾åœ¨ä¸€è¡Œä¸­å±•ç¤ºï¼‰ï¼š</p>
<pre class="lang-java" data-nodeid="184395"><code data-language="java"><span class="hljs-comment">// pathæ˜¯Zookeeperçš„åœ°å€</span>
registry:<span class="hljs-comment">//127.0.0.1:2181/org.apache.dubbo.registry.RegistryService?</span>
application=dubbo-demo-api-provider
&amp;dubbo=<span class="hljs-number">2.0</span><span class="hljs-number">.2</span>
&amp;pid=<span class="hljs-number">9405</span>
&amp;registry=zookeeper <span class="hljs-comment">// ä½¿ç”¨çš„æ³¨å†Œä¸­å¿ƒæ˜¯Zookeeper</span>
&amp;timestamp=<span class="hljs-number">1600307343086</span>
</code></pre>
<p data-nodeid="184396">åŠ è½½æ³¨å†Œä¸­å¿ƒä¿¡æ¯å¾—åˆ° RegistryUrl ä¹‹åï¼Œä¼šéå†æ‰€æœ‰çš„ ProtocolConfigï¼Œä¾æ¬¡è°ƒç”¨&nbsp;doExportUrlsFor1Protocol(protocolConfig, registryURLs)&nbsp;åœ¨æ¯ä¸ªæ³¨å†Œä¸­å¿ƒå‘å¸ƒæœåŠ¡ã€‚ä¸€ä¸ªæœåŠ¡æ¥å£å¯ä»¥ä»¥å¤šç§åè®®è¿›è¡Œå‘å¸ƒï¼Œæ¯ç§åè®®éƒ½å¯¹åº”ä¸€ä¸ª ProtocolConfigï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨ Demo ç¤ºä¾‹ä¸­ï¼Œåªä½¿ç”¨äº† dubbo åè®®ï¼Œå¯¹åº”çš„é…ç½®æ˜¯ï¼š<code data-backticks="1" data-nodeid="184505">&lt;dubbo:protocol name="dubbo" /&gt;</code>ã€‚</p>
<h3 data-nodeid="184397">ç»„è£…æœåŠ¡ URL</h3>
<p data-nodeid="184398">doExportUrlsFor1Protocol() æ–¹æ³•çš„ä»£ç éå¸¸é•¿ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼šä¸€éƒ¨åˆ†æ˜¯ç»„è£…æœåŠ¡çš„ URLï¼Œå¦ä¸€éƒ¨åˆ†å°±æ˜¯åé¢ç´§æ¥ç€ä»‹ç»çš„æœåŠ¡å‘å¸ƒã€‚</p>
<p data-nodeid="184399"><strong data-nodeid="184513">ç»„è£…æœåŠ¡çš„ URL</strong>æ ¸å¿ƒæ­¥éª¤æœ‰å¦‚ä¸‹ 7 æ­¥ã€‚</p>
<ol data-nodeid="184400">
<li data-nodeid="184401">
<p data-nodeid="184402">è·å–æ­¤æ¬¡å‘å¸ƒä½¿ç”¨çš„åè®®ï¼Œé»˜è®¤ä½¿ç”¨ dubbo åè®®ã€‚</p>
</li>
<li data-nodeid="184403">
<p data-nodeid="184404">è®¾ç½®æœåŠ¡ URL ä¸­çš„å‚æ•°ï¼Œè¿™é‡Œä¼šä» MetricsConfigã€ApplicationConfigã€ModuleConfigã€ProviderConfigã€ProtocolConfig ä¸­è·å–é…ç½®ä¿¡æ¯ï¼Œå¹¶ä½œä¸ºå‚æ•°æ·»åŠ åˆ° URL ä¸­ã€‚è¿™é‡Œè°ƒç”¨çš„ appendParameters()&nbsp;æ–¹æ³•ä¼šå°† AbstractConfig ä¸­çš„é…ç½®ä¿¡æ¯å­˜å‚¨åˆ° Map é›†åˆä¸­ï¼Œåç»­åœ¨æ„é€  URL çš„æ—¶å€™ï¼Œä¼šå°†è¯¥é›†åˆä¸­çš„ KV ä½œä¸º URL çš„å‚æ•°ã€‚</p>
</li>
<li data-nodeid="184405">
<p data-nodeid="184406">è§£ææŒ‡å®šæ–¹æ³•çš„ MethodConfig é…ç½®ä»¥åŠæ–¹æ³•å‚æ•°çš„ ArgumentConfig é…ç½®ï¼Œå¾—åˆ°çš„é…ç½®ä¿¡æ¯ä¹Ÿæ˜¯è®°å½•åˆ° Map é›†åˆä¸­ï¼Œåç»­ä½œä¸º URL å‚æ•°ã€‚</p>
</li>
<li data-nodeid="184407">
<p data-nodeid="184408">æ ¹æ®æ­¤æ¬¡è°ƒç”¨æ˜¯æ³›åŒ–è°ƒç”¨è¿˜æ˜¯æ™®é€šè°ƒç”¨ï¼Œå‘ Map é›†åˆä¸­æ·»åŠ ä¸åŒçš„é”®å€¼å¯¹ã€‚</p>
</li>
<li data-nodeid="184409">
<p data-nodeid="184410">è·å– token é…ç½®ï¼Œå¹¶æ·»åŠ åˆ° Map é›†åˆä¸­ï¼Œé»˜è®¤éšæœºç”Ÿæˆ UUIDã€‚</p>
</li>
<li data-nodeid="184411">
<p data-nodeid="184412">è·å– hostã€port å€¼ï¼Œå¹¶å¼€å§‹ç»„è£…æœåŠ¡çš„ URLã€‚</p>
</li>
<li data-nodeid="184413">
<p data-nodeid="184414">æ ¹æ® Configurator è¦†ç›–æˆ–æ–°å¢ URL å‚æ•°ã€‚</p>
</li>
</ol>
<p data-nodeid="184415">ä¸‹é¢æ˜¯ doExportUrlsFor1Protocol() æ–¹æ³•ç»„è£… URL çš„æ ¸å¿ƒå®ç°ï¼š</p>
<pre class="lang-java" data-nodeid="184416"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doExportUrlsFor1Protocol</span><span class="hljs-params">(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs)</span> </span>{
&nbsp; &nbsp; String name = protocolConfig.getName(); <span class="hljs-comment">// è·å–åè®®åç§°</span>
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (StringUtils.isEmpty(name)) { <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨Dubboåè®®</span>
&nbsp; &nbsp; &nbsp; &nbsp; name = DUBBO;
&nbsp; &nbsp; }
&nbsp; &nbsp; Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;(); <span class="hljs-comment">// è®°å½•URLçš„å‚æ•°</span>
&nbsp; &nbsp; map.put(SIDE_KEY, PROVIDER_SIDE); <span class="hljs-comment">// sideå‚æ•°</span>
&nbsp; &nbsp; <span class="hljs-comment">// æ·»åŠ URLå‚æ•°ï¼Œä¾‹å¦‚Dubboç‰ˆæœ¬ã€æ—¶é—´æˆ³ã€å½“å‰PIDç­‰</span>
&nbsp; &nbsp; ServiceConfig.appendRuntimeParameters(map);
&nbsp; &nbsp; <span class="hljs-comment">// ä¸‹é¢ä¼šä»å„ä¸ªConfigè·å–å‚æ•°ï¼Œä¾‹å¦‚ï¼Œapplicationã€interfaceå‚æ•°ç­‰</span>
&nbsp; &nbsp; AbstractConfig.appendParameters(map, getMetrics());
&nbsp; &nbsp; AbstractConfig.appendParameters(map, getApplication());
&nbsp; &nbsp; AbstractConfig.appendParameters(map, getModule());
&nbsp; &nbsp; AbstractConfig.appendParameters(map, provider);
&nbsp; &nbsp; AbstractConfig.appendParameters(map, protocolConfig);
&nbsp; &nbsp; AbstractConfig.appendParameters(map, <span class="hljs-keyword">this</span>);
&nbsp; &nbsp; MetadataReportConfig metadataReportConfig = getMetadataReportConfig();
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (metadataReportConfig != <span class="hljs-keyword">null</span> &amp;&amp; metadataReportConfig.isValid()) {
&nbsp; &nbsp; &nbsp; &nbsp; map.putIfAbsent(METADATA_KEY, REMOTE_METADATA_STORAGE_TYPE);
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (CollectionUtils.isNotEmpty(getMethods())) { <span class="hljs-comment">// ä»MethodConfigä¸­è·å–URLå‚æ•°</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">for</span> (MethodConfig method : getMethods()) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AbstractConfig.appendParameters(map, method, method.getName());
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String retryKey = method.getName() + <span class="hljs-string">".retry"</span>;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (map.containsKey(retryKey)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String retryValue = map.remove(retryKey);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (<span class="hljs-string">"false"</span>.equals(retryValue)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map.put(method.getName() + <span class="hljs-string">".retries"</span>, <span class="hljs-string">"0"</span>);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List&lt;ArgumentConfig&gt; arguments = method.getArguments();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (CollectionUtils.isNotEmpty(arguments)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">for</span> (ArgumentConfig argument : arguments) { <span class="hljs-comment">// ä»ArgumentConfigä¸­è·å–URLå‚æ•°</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ... ...
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; } 
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (ProtocolUtils.isGeneric(generic)) { <span class="hljs-comment">// æ ¹æ®genericæ˜¯å¦ä¸ºtrueï¼Œå‘mapä¸­æ·»åŠ ä¸åŒçš„ä¿¡æ¯</span>
&nbsp; &nbsp; &nbsp; &nbsp; map.put(GENERIC_KEY, generic);
&nbsp; &nbsp; &nbsp; &nbsp; map.put(METHODS_KEY, ANY_VALUE);
&nbsp; &nbsp; } <span class="hljs-keyword">else</span> {
&nbsp; &nbsp; &nbsp; &nbsp; String revision = Version.getVersion(interfaceClass, version);
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (revision != <span class="hljs-keyword">null</span> &amp;&amp; revision.length() &gt; <span class="hljs-number">0</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map.put(REVISION_KEY, revision);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; String[] methods = Wrapper.getWrapper(interfaceClass).getMethodNames();
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (methods.length == <span class="hljs-number">0</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map.put(METHODS_KEY, ANY_VALUE);
&nbsp; &nbsp; &nbsp; &nbsp; } <span class="hljs-keyword">else</span> {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// æ·»åŠ methodå‚æ•°</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map.put(METHODS_KEY, StringUtils.join(<span class="hljs-keyword">new</span> HashSet&lt;String&gt;(Arrays.asList(methods)), <span class="hljs-string">","</span>));
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-comment">// æ·»åŠ tokenåˆ°mapé›†åˆä¸­ï¼Œé»˜è®¤éšæœºç”ŸæˆUUID</span>
&nbsp; &nbsp; <span class="hljs-keyword">if</span>(ConfigUtils.isEmpty(token) &amp;&amp; provider != <span class="hljs-keyword">null</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; token = provider.getToken();
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (!ConfigUtils.isEmpty(token)) {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (ConfigUtils.isDefault(token)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map.put(TOKEN_KEY, UUID.randomUUID().toString());
&nbsp; &nbsp; &nbsp; &nbsp; } <span class="hljs-keyword">else</span> {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; map.put(TOKEN_KEY, token);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-comment">// å°†mapæ•°æ®æ”¾å…¥serviceMetadataä¸­ï¼Œè¿™ä¸å…ƒæ•°æ®ç›¸å…³ï¼Œåé¢å†è¯¦ç»†ä»‹ç»å…¶ä½œç”¨</span>
&nbsp; &nbsp; serviceMetadata.getAttachments().putAll(map);
&nbsp; &nbsp; <span class="hljs-comment">// è·å–hostã€portå€¼</span>
&nbsp; &nbsp; String host = findConfigedHosts(protocolConfig, registryURLs, map);
&nbsp; &nbsp; Integer port = findConfigedPorts(protocolConfig, name, map);
&nbsp; &nbsp; <span class="hljs-comment">// æ ¹æ®ä¸Šé¢è·å–çš„hostã€portä»¥åŠå‰æ–‡è·å–çš„mapé›†åˆç»„è£…URL</span>
&nbsp; &nbsp; URL url = <span class="hljs-keyword">new</span> URL(name, host, port, getContextPath(protocolConfig).map(p -&gt; p + <span class="hljs-string">"/"</span> + path).orElse(path), map);
&nbsp; &nbsp; <span class="hljs-comment">// é€šè¿‡Configuratorè¦†ç›–æˆ–æ·»åŠ æ–°çš„å‚æ•°</span>
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .hasExtension(url.getProtocol())) {
&nbsp; &nbsp; &nbsp; &nbsp; url = ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .getExtension(url.getProtocol()).getConfigurator(url).configure(url);
&nbsp; &nbsp; }
&nbsp; &nbsp; ... ...
}
</code></pre>
<p data-nodeid="184417">ç»è¿‡ä¸Šè¿°å‡†å¤‡æ“ä½œä¹‹åï¼Œå¾—åˆ°çš„æœåŠ¡ URL å¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œè¿™é‡Œå°†æ¯ä¸ª URL å‚æ•°å•ç‹¬æ”¾åœ¨ä¸€è¡Œä¸­å±•ç¤ºï¼‰ï¼š</p>
<pre class="lang-java" data-nodeid="184418"><code data-language="java">dubbo:<span class="hljs-comment">//172.17.108.185:20880/org.apache.dubbo.demo.DemoService?</span>
anyhost=<span class="hljs-keyword">true</span>
&amp;application=dubbo-demo-api-provider
&amp;bind.ip=<span class="hljs-number">172.17</span><span class="hljs-number">.108</span><span class="hljs-number">.185</span>
&amp;bind.port=<span class="hljs-number">20880</span>
&amp;<span class="hljs-keyword">default</span>=<span class="hljs-keyword">true</span>
&amp;deprecated=<span class="hljs-keyword">false</span>
&amp;dubbo=<span class="hljs-number">2.0</span><span class="hljs-number">.2</span>
&amp;dynamic=<span class="hljs-keyword">true</span>
&amp;generic=<span class="hljs-keyword">false</span>
&amp;<span class="hljs-class"><span class="hljs-keyword">interface</span></span>=org.apache.dubbo.demo.DemoService
&amp;methods=sayHello,sayHelloAsync
&amp;pid=<span class="hljs-number">3918</span>
&amp;release=
&amp;side=provider
&amp;timestamp=<span class="hljs-number">1600437404483</span>
</code></pre>
<h3 data-nodeid="184419">æœåŠ¡å‘å¸ƒå…¥å£</h3>
<p data-nodeid="184420">å®Œæˆäº†æœåŠ¡ URL çš„ç»„è£…ä¹‹åï¼ŒdoExportUrlsFor1Protocol() æ–¹æ³•å¼€å§‹æ‰§è¡ŒæœåŠ¡å‘å¸ƒã€‚æœåŠ¡å‘å¸ƒå¯ä»¥åˆ†ä¸º<strong data-nodeid="184533">è¿œç¨‹å‘å¸ƒ</strong>å’Œ<strong data-nodeid="184534">æœ¬åœ°å‘å¸ƒ</strong>ï¼Œå…·ä½“å‘å¸ƒæ–¹å¼ä¸æœåŠ¡ URL ä¸­çš„&nbsp;scope å‚æ•°æœ‰å…³ã€‚</p>
<p data-nodeid="184421">scope å‚æ•°æœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼Œåˆ†åˆ«æ˜¯ noneã€remote å’Œ localï¼Œåˆ†åˆ«ä»£è¡¨ä¸å‘å¸ƒã€å‘å¸ƒåˆ°æœ¬åœ°å’Œå‘å¸ƒåˆ°è¿œç«¯æ³¨å†Œä¸­å¿ƒï¼Œä»ä¸‹é¢ä»‹ç»çš„ doExportUrlsFor1Protocol() æ–¹æ³•ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul data-nodeid="184422">
<li data-nodeid="184423">
<p data-nodeid="184424">å‘å¸ƒåˆ°æœ¬åœ°çš„æ¡ä»¶æ˜¯ scope != remoteï¼›</p>
</li>
<li data-nodeid="184425">
<p data-nodeid="184426">å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒçš„æ¡ä»¶æ˜¯ scope != localã€‚</p>
</li>
</ul>
<p data-nodeid="184427"><strong data-nodeid="184546">scope å‚æ•°çš„é»˜è®¤å€¼ä¸º null</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤ä¼šåŒæ—¶åœ¨æœ¬åœ°å’Œæ³¨å†Œä¸­å¿ƒå‘å¸ƒè¯¥æœåŠ¡ã€‚ä¸‹é¢æ¥çœ‹ doExportUrlsFor1Protocol() æ–¹æ³•ä¸­å‘å¸ƒæœåŠ¡çš„å…·ä½“å®ç°ï¼š</p>
<pre class="lang-java" data-nodeid="184428"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doExportUrlsFor1Protocol</span><span class="hljs-params">(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs)</span> </span>{
&nbsp; &nbsp; ... ...<span class="hljs-comment">// çœç•¥ç»„è£…æœåŠ¡URLçš„è¿‡ç¨‹</span>
&nbsp; &nbsp; <span class="hljs-comment">// ä»URLä¸­è·å–scopeå‚æ•°ï¼Œå…¶ä¸­å¯é€‰å€¼æœ‰noneã€remoteã€localä¸‰ä¸ªï¼Œ</span>
&nbsp; &nbsp; <span class="hljs-comment">// åˆ†åˆ«ä»£è¡¨ä¸å‘å¸ƒã€å‘å¸ƒåˆ°æœ¬åœ°ä»¥åŠå‘å¸ƒåˆ°è¿œç«¯ï¼Œå…·ä½“å«ä¹‰åœ¨ä¸‹é¢ä¸€ä¸€ä»‹ç»</span>
&nbsp; &nbsp; String scope = url.getParameter(SCOPE_KEY);
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (!SCOPE_NONE.equalsIgnoreCase(scope)) { <span class="hljs-comment">//&nbsp; scopeä¸ä¸ºnoneï¼Œæ‰è¿›è¡Œå‘å¸ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (!SCOPE_REMOTE.equalsIgnoreCase(scope)) {<span class="hljs-comment">// å‘å¸ƒåˆ°æœ¬åœ°</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exportLocal(url);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (!SCOPE_LOCAL.equalsIgnoreCase(scope)) { <span class="hljs-comment">// å‘å¸ƒåˆ°è¿œç«¯çš„æ³¨å†Œä¸­å¿ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (CollectionUtils.isNotEmpty(registryURLs)) { <span class="hljs-comment">// å½“å‰é…ç½®äº†è‡³å°‘ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">for</span> (URL registryURL : registryURLs) { <span class="hljs-comment">// å‘æ¯ä¸ªæ³¨å†Œä¸­å¿ƒå‘å¸ƒæœåŠ¡</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// injvmåè®®åªåœ¨exportLocal()ä¸­æœ‰ç”¨ï¼Œä¸ä¼šå°†æœåŠ¡å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// æ‰€ä»¥è¿™é‡Œå¿½ç•¥injvmåè®®</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (LOCAL_PROTOCOL.equalsIgnoreCase(url.getProtocol())){
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">continue</span>;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// è®¾ç½®æœåŠ¡URLçš„dynamicå‚æ•°</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; url = url.addParameterIfAbsent(DYNAMIC_KEY, registryURL.getParameter(DYNAMIC_KEY));
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// åˆ›å»ºmonitorUrlï¼Œå¹¶ä½œä¸ºmonitorå‚æ•°æ·»åŠ åˆ°æœåŠ¡URLä¸­</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL monitorUrl = ConfigValidationUtils.loadMonitor(<span class="hljs-keyword">this</span>, registryURL);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (monitorUrl != <span class="hljs-keyword">null</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; url = url.addParameterAndEncoded(MONITOR_KEY, monitorUrl.toFullString());
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// è®¾ç½®æœåŠ¡URLçš„proxyå‚æ•°ï¼Œå³ç”ŸæˆåŠ¨æ€ä»£ç†æ–¹å¼(jdkæˆ–æ˜¯javassist)ï¼Œä½œä¸ºå‚æ•°æ·»åŠ åˆ°RegistryURLä¸­</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String proxy = url.getParameter(PROXY_KEY);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(proxy)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; registryURL = registryURL.addParameter(PROXY_KEY, proxy);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// ä¸ºæœåŠ¡å®ç°ç±»çš„å¯¹è±¡åˆ›å»ºç›¸åº”çš„Invokerï¼ŒgetInvoker()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­ï¼Œä¼šå°†æœåŠ¡URLä½œä¸ºexportå‚æ•°æ·»åŠ åˆ°RegistryURLä¸­</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// è¿™é‡Œçš„PROXY_FACTORYæ˜¯ProxyFactoryæ¥å£çš„é€‚é…å™¨</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Invoker&lt;?&gt; invoker = PROXY_FACTORY.getInvoker(ref, (Class) interfaceClass, registryURL.addParameterAndEncoded(EXPORT_KEY, url.toFullString()));
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// DelegateProviderMetaDataInvokeræ˜¯ä¸ªè£…é¥°ç±»ï¼Œå°†å½“å‰ServiceConfigå’ŒInvokerå…³è”èµ·æ¥è€Œå·²ï¼Œinvoke()æ–¹æ³•é€ä¼ ç»™åº•å±‚Invokerå¯¹è±¡</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DelegateProviderMetaDataInvoker wrapperInvoker = <span class="hljs-keyword">new</span> DelegateProviderMetaDataInvoker(invoker, <span class="hljs-keyword">this</span>);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// è°ƒç”¨Protocolå®ç°ï¼Œè¿›è¡Œå‘å¸ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// è¿™é‡Œçš„PROTOCOLæ˜¯Protocolæ¥å£çš„é€‚é…å™¨</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exporter&lt;?&gt; exporter = PROTOCOL.export(wrapperInvoker);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exporters.add(exporter);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="hljs-keyword">else</span> {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// ä¸å­˜åœ¨æ³¨å†Œä¸­å¿ƒï¼Œä»…å‘å¸ƒæœåŠ¡ï¼Œä¸ä¼šå°†æœåŠ¡ä¿¡æ¯å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒã€‚Consumeræ²¡æ³•åœ¨æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°è¯¥æœåŠ¡çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¯ä»¥ç›´è¿</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-comment">// å…·ä½“çš„å‘å¸ƒè¿‡ç¨‹ä¸ä¸Šé¢çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œåªä¸è¿‡ä¸ä¼šå‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Invoker&lt;?&gt; invoker = PROXY_FACTORY.getInvoker(ref, (Class) interfaceClass, url);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DelegateProviderMetaDataInvoker wrapperInvoker = <span class="hljs-keyword">new</span> DelegateProviderMetaDataInvoker(invoker, <span class="hljs-keyword">this</span>);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exporter&lt;?&gt; exporter = PROTOCOL.export(wrapperInvoker);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exporters.add(exporter);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span class="hljs-comment">// å…ƒæ•°æ®ç›¸å…³æ“ä½œ</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WritableMetadataService metadataService = WritableMetadataService.getExtension(url.getParameter(METADATA_KEY, DEFAULT_METADATA_STORAGE_TYPE));
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> (metadataService != <span class="hljs-keyword">null</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; metadataService.publishServiceDefinition(url);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-keyword">this</span>.urls.add(url);
}
</code></pre>
<h3 data-nodeid="184429">æœ¬åœ°å‘å¸ƒ</h3>
<p data-nodeid="184430">äº†è§£äº†æœ¬åœ°å‘å¸ƒã€è¿œç¨‹å‘å¸ƒçš„å…¥å£é€»è¾‘ä¹‹åï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹æ·±å…¥æœ¬åœ°å‘å¸ƒçš„é€»è¾‘ã€‚</p>
<p data-nodeid="184431">åœ¨ exportLocal() æ–¹æ³•ä¸­ï¼Œä¼šå°† Protocol æ›¿æ¢æˆ injvm åè®®ï¼Œå°† host è®¾ç½®æˆ 127.0.0.1ï¼Œå°† port è®¾ç½®ä¸º 0ï¼Œå¾—åˆ°æ–°çš„ LocalURLï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="184432"><code data-language="java">injvm:<span class="hljs-comment">//127.0.0.1/org.apache.dubbo.demo.DemoService?anyhost=true</span>
&amp;application=dubbo-demo-api-provider
&amp;bind.ip=<span class="hljs-number">172.17</span><span class="hljs-number">.108</span><span class="hljs-number">.185</span>
&amp;bind.port=<span class="hljs-number">20880</span>
&amp;<span class="hljs-keyword">default</span>=<span class="hljs-keyword">true</span>
&amp;deprecated=<span class="hljs-keyword">false</span>
&amp;dubbo=<span class="hljs-number">2.0</span><span class="hljs-number">.2</span>
&amp;dynamic=<span class="hljs-keyword">true</span>
&amp;generic=<span class="hljs-keyword">false</span>
&amp;<span class="hljs-class"><span class="hljs-keyword">interface</span></span>=org.apache.dubbo.demo.DemoService
&amp;methods=sayHello,sayHelloAsync
&amp;pid=<span class="hljs-number">4249</span>
&amp;release=
&amp;side=provider
&amp;timestamp=<span class="hljs-number">1600440074214</span>
</code></pre>
<p data-nodeid="184433">ä¹‹åï¼Œä¼šé€šè¿‡ ProxyFactory æ¥å£é€‚é…å™¨æ‰¾åˆ°å¯¹åº”çš„ ProxyFactory å®ç°ï¼ˆé»˜è®¤ä½¿ç”¨ JavassistProxyFactoryï¼‰ï¼Œå¹¶è°ƒç”¨ getInvoker() æ–¹æ³•åˆ›å»º Invoker å¯¹è±¡ï¼›æœ€åï¼Œé€šè¿‡ Protocol æ¥å£çš„é€‚é…å™¨æŸ¥æ‰¾åˆ° InjvmProtocol å®ç°ï¼Œå¹¶è°ƒç”¨ export() æ–¹æ³•è¿›è¡Œå‘å¸ƒã€‚ exportLocal() æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="184434"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exportLocal</span><span class="hljs-params">(URL url)</span> </span>{
&nbsp; &nbsp; URL local = URLBuilder.from(url) <span class="hljs-comment">// åˆ›å»ºæ–°URL</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setProtocol(LOCAL_PROTOCOL)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setHost(LOCALHOST_VALUE)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setPort(<span class="hljs-number">0</span>)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .build();
&nbsp; &nbsp;&nbsp;<span class="hljs-comment">// æœ¬åœ°å‘å¸ƒ</span>
&nbsp; &nbsp; Exporter&lt;?&gt; exporter = PROTOCOL.export(
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PROXY_FACTORY.getInvoker(ref, (Class) interfaceClass, local));
&nbsp; &nbsp; exporters.add(exporter);
}
</code></pre>
<p data-nodeid="184435">InjvmProtocol çš„ç›¸å…³å®ç°æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å†å±•ç¤ºï¼Œä½ è‹¥æ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒ<a href="https://github.com/xxxlxy2008/dubbo" data-nodeid="184554">æºç </a>è¿›è¡Œå­¦ä¹ ã€‚</p>
<h3 data-nodeid="184436">è¿œç¨‹å‘å¸ƒ</h3>
<p data-nodeid="184437">ä»‹ç»å®Œæœ¬åœ°å‘å¸ƒä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿œç¨‹å‘å¸ƒçš„æ ¸å¿ƒé€»è¾‘ï¼Œè¿œç¨‹æœåŠ¡å‘å¸ƒçš„æµç¨‹ç›¸è¾ƒæœ¬åœ°å‘å¸ƒæµç¨‹ï¼Œè¦å¤æ‚å¾—å¤šã€‚</p>
<p data-nodeid="184438">åœ¨ doExportUrlsFor1Protocol() æ–¹æ³•ä¸­ï¼Œè¿œç¨‹å‘å¸ƒæœåŠ¡æ—¶ï¼Œä¼šéå†å…¨éƒ¨ RegistryURLï¼Œå¹¶æ ¹æ® RegistryURL é€‰æ‹©å¯¹åº”çš„ Protocol æ‰©å±•å®ç°è¿›è¡Œå‘å¸ƒã€‚æˆ‘ä»¬çŸ¥é“ RegistryURL æ˜¯ "registry://" åè®®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„æ˜¯ RegistryProtocol å®ç°ã€‚</p>
<p data-nodeid="184439">ä¸‹é¢æ¥çœ‹ RegistryProtocol.export() æ–¹æ³•çš„æ ¸å¿ƒæµç¨‹ï¼š</p>
<pre class="lang-java" data-nodeid="184440"><code data-language="java"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Exporter&lt;T&gt; <span class="hljs-title">export</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Invoker&lt;T&gt; originInvoker)</span> <span class="hljs-keyword">throws</span> RpcException </span>{
&nbsp; &nbsp; <span class="hljs-comment">// å°†"registry://"åè®®è½¬æ¢æˆ"zookeeper://"åè®®</span>
&nbsp; &nbsp; URL registryUrl = getRegistryUrl(originInvoker);
&nbsp; &nbsp; <span class="hljs-comment">// è·å–exportå‚æ•°ï¼Œå…¶ä¸­å­˜å‚¨äº†ä¸€ä¸ª"dubbo://"åè®®çš„ProviderURL</span>
&nbsp; &nbsp; URL providerUrl = getProviderUrl(originInvoker);

    <span class="hljs-comment">// è·å–è¦ç›‘å¬çš„é…ç½®ç›®å½•ï¼Œè¿™é‡Œä¼šåœ¨ProviderURLçš„åŸºç¡€ä¸Šæ·»åŠ category=configuratorså‚æ•°ï¼Œå¹¶å°è£…æˆå¯¹OverrideListenerè®°å½•åˆ°overrideListenersé›†åˆä¸­</span>
&nbsp; &nbsp; <span class="hljs-keyword">final</span> URL overrideSubscribeUrl = getSubscribedOverrideUrl(providerUrl);
&nbsp; &nbsp; <span class="hljs-keyword">final</span> OverrideListener overrideSubscribeListener = <span class="hljs-keyword">new</span> OverrideListener(overrideSubscribeUrl, originInvoker);
&nbsp; &nbsp; overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener);
    <span class="hljs-comment">// åˆå§‹åŒ–æ—¶ä¼šæ£€æµ‹ä¸€æ¬¡Overrideé…ç½®ï¼Œé‡å†™ProviderURL</span>
&nbsp; &nbsp; providerUrl = overrideUrlWithConfig(providerUrl, overrideSubscribeListener);
&nbsp; &nbsp; <span class="hljs-comment">// å¯¼å‡ºæœåŠ¡ï¼Œåº•å±‚ä¼šé€šè¿‡æ‰§è¡ŒDubboProtocol.export()æ–¹æ³•ï¼Œå¯åŠ¨å¯¹åº”çš„Server</span>
&nbsp; &nbsp; <span class="hljs-keyword">final</span> ExporterChangeableWrapper&lt;T&gt; exporter = doLocalExport(originInvoker, providerUrl);
&nbsp; &nbsp; <span class="hljs-comment">// æ ¹æ®RegistryURLè·å–å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒRegistryå¯¹è±¡ï¼Œå…¶ä¸­ä¼šä¾èµ–ä¹‹å‰è¯¾æ—¶ä»‹ç»çš„RegistryFactory</span>
&nbsp; &nbsp; <span class="hljs-keyword">final</span> Registry registry = getRegistry(originInvoker);
&nbsp; &nbsp; <span class="hljs-comment">// è·å–å°†è¦å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒä¸Šçš„Provider URLï¼Œå…¶ä¸­ä¼šåˆ é™¤ä¸€äº›å¤šä½™çš„å‚æ•°ä¿¡æ¯</span>
&nbsp; &nbsp; <span class="hljs-keyword">final</span> URL registeredProviderUrl = getUrlToRegistry(providerUrl, registryUrl);
&nbsp; &nbsp; <span class="hljs-comment">// æ ¹æ®registerå‚æ•°å€¼å†³å®šæ˜¯å¦æ³¨å†ŒæœåŠ¡</span>
&nbsp; &nbsp; <span class="hljs-keyword">boolean</span> register = providerUrl.getParameter(REGISTER_KEY, <span class="hljs-keyword">true</span>);
&nbsp; &nbsp; <span class="hljs-keyword">if</span> (register) { <span class="hljs-comment">// è°ƒç”¨Registry.register()æ–¹æ³•å°†registeredProviderUrlå‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒ</span>
&nbsp; &nbsp; &nbsp; &nbsp; register(registryUrl, registeredProviderUrl);
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="hljs-comment">// å°†Providerç›¸å…³ä¿¡æ¯è®°å½•åˆ°çš„ProviderModelä¸­</span>
&nbsp; &nbsp; registerStatedUrl(registryUrl, registeredProviderUrl, register);
&nbsp; &nbsp; <span class="hljs-comment">// å‘æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¢é˜…overrideæ•°æ®ï¼Œä¸»è¦æ˜¯ç›‘å¬è¯¥æœåŠ¡çš„configuratorsèŠ‚ç‚¹</span>
&nbsp; &nbsp; registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener);
&nbsp; &nbsp; exporter.setRegisterUrl(registeredProviderUrl);
&nbsp; &nbsp; exporter.setSubscribeUrl(overrideSubscribeUrl);
    <span class="hljs-comment">// è§¦å‘RegistryProtocolListenerç›‘å¬å™¨</span>
&nbsp; &nbsp; notifyExport(exporter);
&nbsp; &nbsp; <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DestroyableExporter&lt;&gt;(exporter);
}
</code></pre>
<p data-nodeid="184441">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿œç¨‹å‘å¸ƒæµç¨‹å¤§è‡´å¯åˆ†ä¸ºä¸‹é¢ 5 ä¸ªæ­¥éª¤ã€‚</p>
<ol data-nodeid="184442">
<li data-nodeid="184443">
<p data-nodeid="184444">å‡†å¤‡ URLï¼Œæ¯”å¦‚ ProviderURLã€RegistryURL å’Œ OverrideSubscribeUrlã€‚</p>
</li>
<li data-nodeid="184445">
<p data-nodeid="184446">å‘å¸ƒ Dubbo æœåŠ¡ã€‚åœ¨ doLocalExport() æ–¹æ³•ä¸­è°ƒç”¨ DubboProtocol.export() æ–¹æ³•å¯åŠ¨ Provider ç«¯åº•å±‚ Serverã€‚</p>
</li>
<li data-nodeid="184447">
<p data-nodeid="184448">æ³¨å†Œ Dubbo æœåŠ¡ã€‚åœ¨ register() æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ ZookeeperRegistry.register() æ–¹æ³•å‘ Zookeeper æ³¨å†ŒæœåŠ¡ã€‚</p>
</li>
<li data-nodeid="184449">
<p data-nodeid="184450">è®¢é˜… Provider ç«¯çš„ Override é…ç½®ã€‚è°ƒç”¨ ZookeeperRegistry.subscribe() æ–¹æ³•è®¢é˜…æ³¨å†Œä¸­å¿ƒ configurators èŠ‚ç‚¹ä¸‹çš„é…ç½®å˜æ›´ã€‚</p>
</li>
<li data-nodeid="184451">
<p data-nodeid="184452">è§¦å‘ RegistryProtocolListener ç›‘å¬å™¨ã€‚</p>
</li>
</ol>
<p data-nodeid="184453">è¿œç¨‹å‘å¸ƒçš„è¯¦ç»†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p data-nodeid="184454"><img src="https://s0.lgstatic.com/i/image2/M01/01/2C/CgpVE1_YNDaATl3fAAFcJTJOw3M699.png" alt="Drawing 1.png" data-nodeid="184573"></p>
<div data-nodeid="184455"><p style="text-align:center">æœåŠ¡å‘å¸ƒè¯¦ç»†æµç¨‹å›¾</p></div>
<h3 data-nodeid="184456">æ€»ç»“</h3>
<p data-nodeid="184457">æœ¬è¯¾æ—¶æˆ‘ä»¬é‡ç‚¹ä»‹ç»äº† Dubbo æœåŠ¡å‘å¸ƒçš„æ ¸å¿ƒæµç¨‹ã€‚</p>
<p data-nodeid="184458">é¦–å…ˆæˆ‘ä»¬ä»‹ç»äº† DubboBootstrap è¿™ä¸ªå…¥å£é—¨é¢ç±»ä¸­ä¸æœåŠ¡å‘å¸ƒç›¸å…³çš„æ–¹æ³•ï¼Œé‡ç‚¹æ˜¯ start() å’Œ exportServices() ä¸¤ä¸ªæ–¹æ³•ï¼›ç„¶åè¯¦ç»†ä»‹ç»äº† ServiceConfig ç±»çš„ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼šæ£€æŸ¥å‚æ•°ã€ç«‹å³ï¼ˆæˆ–å»¶è¿Ÿï¼‰æ‰§è¡Œ doExport() æ–¹æ³•è¿›è¡Œå‘å¸ƒã€å›è°ƒæœåŠ¡å‘å¸ƒçš„ç›¸å…³ç›‘å¬å™¨ã€‚</p>
<p data-nodeid="184459">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†æäº†<strong data-nodeid="184582">doExportUrlsFor1Protocol() æ–¹æ³•ï¼Œå®ƒæ˜¯å‘å¸ƒä¸€ä¸ªæœåŠ¡çš„å…¥å£ï¼Œä¹Ÿæ˜¯è§„å®šæœåŠ¡å‘å¸ƒæµç¨‹çš„åœ°æ–¹</strong>ï¼Œå…¶ä¸­æ¶‰åŠ Provider URL çš„ç»„è£…ã€æœ¬åœ°æœåŠ¡å‘å¸ƒæµç¨‹ä»¥åŠè¿œç¨‹æœåŠ¡å‘å¸ƒæµç¨‹ï¼Œå¯¹äºè¿™äº›æ­¥éª¤ï¼Œæˆ‘ä»¬éƒ½è¿›è¡Œäº†è¯¦ç»†çš„åˆ†æã€‚</p>
<p data-nodeid="184460" class="">ä¸‹ä¸€è¯¾æ—¶ï¼Œæˆ‘ä»¬å°†ç»§ç»­åˆ†æ Dubbo æœåŠ¡å¼•ç”¨çš„å…¨æµç¨‹ï¼Œè®°å¾—æŒ‰æ—¶æ¥å¬è¯¾ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### *é•‡ï¼š
> è€å¸ˆå†™çš„å¤ªå¥½äº†ğŸ˜„

##### **å¤ï¼š
> è€å¸ˆå¥½ï¼Œæˆ‘ä¸å¤ªäº†è§£javaï¼Œè¯·é—®ç›´æ¥å­¦ä¹ å“ªäº›è¯¾ç¨‹å¯¹å­¦ä¹ dubbo goæœ‰å¸®åŠ©ï¼Ÿ


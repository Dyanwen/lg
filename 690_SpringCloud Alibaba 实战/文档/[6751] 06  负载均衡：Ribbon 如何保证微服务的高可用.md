<p data-nodeid="1341" class="">ä¸Šä¸€è®²æˆ‘ä»¬å¯¹ Nacos çš„é›†ç¾¤ç¯å¢ƒä¸å®ç°åŸç†è¿›è¡Œäº†è®²è§£ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è½»æ¾å°†å•ä¸ªå¾®æœåŠ¡æ¥å…¥åˆ° Nacos è¿›è¡Œæ³¨å†Œï¼Œä½†æ˜¯å¾®æœåŠ¡æœ¬ä¸æ˜¯å­¤å²›ï¼Œå¦‚ä½•å®ç°æœ‰æ•ˆçš„æœåŠ¡é—´ç¨³å®šé€šä¿¡æ˜¯æœ¬æ–‡å³å°†ä»‹ç»çš„ä¸»è¦å†…å®¹ï¼Œæœ¬æ¬¡æˆ‘ä»¬å°†ä¸»è¦å­¦ä¹ ä¸‰æ–¹é¢çŸ¥è¯†ï¼š</p>
<ol data-nodeid="1342">
<li data-nodeid="1343">
<p data-nodeid="1344">ä»‹ç» Ribbon è´Ÿè½½å‡è¡¡å™¨ï¼›</p>
</li>
<li data-nodeid="1345">
<p data-nodeid="1346">è®²è§£ Ribbon+RestTemplate ä¸¤ç§å®ç°æ–¹å¼ï¼›</p>
</li>
<li data-nodeid="1347">
<p data-nodeid="1348">è®²è§£ Ribbon çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</p>
</li>
</ol>
<h3 data-nodeid="1349">Ribbon è´Ÿè½½å‡è¡¡å™¨</h3>
<p data-nodeid="1350">åœ¨ä»‹ç» Ribbon ä¹‹å‰ï¼Œå’±ä»¬å…ˆæ¥è®¤è¯†ä¸‹è´Ÿè½½å‡è¡¡ä»¥åŠå®ƒçš„ä¸¤ç§å®ç°æ–¹å¼ã€‚</p>
<p data-nodeid="1351">è´Ÿè½½å‡è¡¡é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡é€šè¿‡è½¯ä»¶æˆ–è€…ç¡¬ä»¶æªæ–½ã€‚å®ƒå°†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æŒ‰ç…§æŸç§ç­–ç•¥å¹³å‡çš„åˆ†é…åˆ°é›†ç¾¤çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¿è¯è¿™äº›èŠ‚ç‚¹çš„ CPUã€å†…å­˜ç­‰è®¾å¤‡è´Ÿè½½æƒ…å†µå¤§è‡´åœ¨ä¸€æ¡æ°´å¹³çº¿ï¼Œé¿å…ç”±äºå±€éƒ¨èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜äº§ç”Ÿå®•æœºï¼Œå†å°†è¿™äº›å¤„ç†å‹åŠ›ä¼ é€’åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šäº§ç”Ÿç³»ç»Ÿæ€§å´©æºƒã€‚</p>
<p data-nodeid="1676" class=""><img src="https://s0.lgstatic.com/i/image6/M01/19/1E/CioPOWBJwsuATx9NAAG5-vZf3ac538.png" alt="å›¾ç‰‡1.png" data-nodeid="1679"></p>

<p data-nodeid="1353">è´Ÿè½½å‡è¡¡æŒ‰å®ç°æ–¹å¼åˆ†ç±»å¯åŒºåˆ†ä¸ºï¼š<strong data-nodeid="1514">æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</strong>ä¸<strong data-nodeid="1515">å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</strong>ã€‚</p>
<p data-nodeid="1354">æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡é¡¾åæ€ä¹‰ï¼Œåœ¨æ¶æ„ä¸­ä¼šæä¾›ä¸“ç”¨çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”±è´Ÿè½½å‡è¡¡å™¨æŒæœ‰åç«¯èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å‘æ¥çš„è¯·æ±‚ç»ç”±ä¸“ç”¨çš„è´Ÿè½½å‡è¡¡å™¨åˆ†å‘ç»™æœåŠ¡æä¾›è€…ï¼Œè¿›è€Œå®ç°è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚ç›®å‰å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡å™¨è½¯ç¡¬ä»¶æœ‰ï¼šF5ã€Nginxã€HaProxy ç­‰ã€‚</p>
<p data-nodeid="2350" class=""><img src="https://s0.lgstatic.com/i/image6/M01/19/21/Cgp9HWBJwtuAQzndAAESYZX7dBg295.png" alt="å›¾ç‰‡2.png" data-nodeid="2353"></p>

<p data-nodeid="1356" class="">å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ˜¯æŒ‡ï¼Œåœ¨æ¶æ„ä¸­ä¸å†éƒ¨ç½²é¢å¤–çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œåœ¨æ¯ä¸ªæœåŠ¡æ¶ˆè´¹è€…å†…éƒ¨æŒæœ‰å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œç”±å†…ç½®çš„è´Ÿè½½å‡è¡¡ç­–ç•¥å†³å®šå‘å“ªä¸ªæœåŠ¡æä¾›è€…å‘èµ·è¯·æ±‚ã€‚è¯´åˆ°è¿™ï¼Œæˆ‘ä»¬çš„ä¸»è§’ç™»åœºäº†ï¼ŒNetfilx Ribbon æ˜¯ Netflix å…¬å¸å¼€æºçš„ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç»„ä»¶ï¼Œæ˜¯å±äºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ã€‚ç›®å‰Ribbon å·²è¢« Spring Cloud å®˜æ–¹æŠ€æœ¯ç”Ÿæ€æ•´åˆï¼Œè¿è¡Œæ—¶ä»¥ SDK å½¢å¼å†…åµŒåˆ°æ¯ä¸€ä¸ªå¾®æœåŠ¡å®ä¾‹ä¸­ï¼Œä¸ºå¾®æœåŠ¡é—´é€šä¿¡æä¾›è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨æ”¯æŒã€‚ä¸ºäº†æ›´å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬é€šè¿‡åº”ç”¨åœºæ™¯è¯´æ˜ Ribbon çš„æ‰§è¡Œæµç¨‹ã€‚å‡è®¾è®¢å•æœåŠ¡åœ¨æŸ¥è¯¢è®¢å•æ—¶éœ€è¦é™„å¸¦å¯¹åº”å•†å“è¯¦æƒ…ï¼Œè¿™å°±æ„å‘³ç€è®¢å•æœåŠ¡ä¾èµ–äºå•†å“æœåŠ¡ï¼Œä¸¤è€…å¿…ç„¶äº§ç”ŸæœåŠ¡é—´é€šä¿¡ï¼Œæ­¤æ—¶ Ribbon çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p data-nodeid="3024" class=""><img src="https://s0.lgstatic.com/i/image6/M01/19/21/Cgp9HWBJwuWAHSngAAF5Aq9Kc40749.png" alt="å›¾ç‰‡3.png" data-nodeid="3027"></p>

<ol data-nodeid="1358">
<li data-nodeid="1359">
<p data-nodeid="1360">è®¢å•æœåŠ¡ï¼ˆorder-serviceï¼‰ä¸å•†å“æœåŠ¡ï¼ˆgoods-serviceï¼‰å®ä¾‹åœ¨å¯åŠ¨æ—¶å‘ Nacos æ³¨å†Œï¼›</p>
</li>
<li data-nodeid="1361">
<p data-nodeid="1362">è®¢å•æœåŠ¡å‘å•†å“æœåŠ¡å‘èµ·é€šä¿¡å‰ï¼ŒRibbon å‘ Nacos æŸ¥è¯¢å•†å“æœåŠ¡çš„å¯ç”¨å®ä¾‹åˆ—è¡¨ï¼›</p>
</li>
<li data-nodeid="1363">
<p data-nodeid="1364">Ribbon æ ¹æ®è®¾ç½®çš„è´Ÿè½½ç­–ç•¥ä»å•†å“æœåŠ¡å¯ç”¨å®ä¾‹åˆ—è¡¨ä¸­é€‰æ‹©å®ä¾‹ï¼›</p>
</li>
<li data-nodeid="1365">
<p data-nodeid="1366">è®¢å•æœåŠ¡å®ä¾‹å‘å•†å“æœåŠ¡å®ä¾‹å‘èµ·è¯·æ±‚ï¼Œå®Œæˆ RESTful é€šä¿¡ï¼›</p>
</li>
</ol>
<p data-nodeid="1367">äº†è§£äº† Ribbon æ‰§è¡Œæµç¨‹åï¼Œå’±ä»¬é€šè¿‡ä»£ç æ–¹å¼ä½“ç°è¿™ä¸ªå®Œæ•´æµç¨‹ã€‚</p>
<h3 data-nodeid="1368">Ribbon+RestTemplate å®ç°æœåŠ¡é—´é«˜å¯ç”¨é€šä¿¡</h3>
<p data-nodeid="1369">å¼€å§‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»ä¸‹ Spring Cloud è‡ªå¸¦çš„ RestTemplate å¯¹è±¡ï¼ŒRestTemplate å¯¹è±¡æ˜¯Spring Cloud å°è£…çš„ RESTful é€šä¿¡å¯¹è±¡ï¼Œå®ƒå°è£…äº†åŸºäº HTTP åè®®çš„æ“ä½œï¼Œé€šè¿‡ç®€å•çš„APIä¾¿å¯å‘èµ· HTTP è¯·æ±‚å¹¶è‡ªåŠ¨å¤„ç†å“åº”ã€‚RestTemplate å¤©ç„¶ä¸ Ribbon å…¼å®¹ï¼Œä¸¤è€…é…åˆå¯ä»¥æå¤§ç®€åŒ–æœåŠ¡é—´é€šä¿¡è¿‡ç¨‹ã€‚Ribbon + RestTemplate æä¾›äº†ä¸¤ç§å¼€å‘æ¨¡å¼ï¼šä»£ç æ¨¡å¼ï¼Œæ³¨è§£æ¨¡å¼ã€‚</p>
<h4 data-nodeid="1370">ä»£ç æ¨¡å¼</h4>
<p data-nodeid="1371">ç¬¬ä¸€ç§ä»£ç æ¨¡å¼æ˜¯æŒ‡é€šè¿‡çº¯ Java ä»£ç å®ç°å¾®æœåŠ¡é—´é€šä¿¡ï¼Œè™½ç„¶å·¥ä½œä¸­ä»£ç æ¨¡å¼å¾ˆå°‘ä½¿ç”¨ï¼Œä½†å®ƒå´æ˜¯ç†è§£ Ribbon+RestTemplate æœ€ç›´è§‚çš„é€”å¾„ï¼Œæ‰€ä»¥æˆ‘å¯¹å®ƒé¦–å…ˆè¿›è¡Œè®²è§£ã€‚è¯¥æ¨¡å¼ä½¿ç”¨ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<p data-nodeid="1372"><strong data-nodeid="1537">ç¬¬ä¸€é˜¶æ®µ</strong>ï¼Œåˆ›å»ºæœåŠ¡æä¾›è€…ï¼ŒæœåŠ¡æä¾›è€…æ˜¯è¯·æ±‚çš„å®é™…å¤„ç†è€…ï¼Œä¹Ÿæ˜¯æ ‡å‡†çš„ Spring Boot å·¥ç¨‹ï¼Œåˆ©ç”¨ Controller å¯¹å¤–æš´éœ² RESTful API ä¾›æœåŠ¡æ¶ˆè´¹è€…è°ƒç”¨ã€‚</p>
<p data-nodeid="1373">ç¬¬ä¸€æ­¥ï¼Œåˆ©ç”¨ Spring Initializr å‘å¯¼åˆ›å»º provider-service å¾®æœåŠ¡ã€‚</p>
<p data-nodeid="3698" class=""><img src="https://s0.lgstatic.com/i/image6/M01/19/1E/CioPOWBJwvSAG8EXAAF2iTbEk7Q110.png" alt="å›¾ç‰‡4.png" data-nodeid="3701"></p>

<p data-nodeid="1375">å…¶ä¸­ pom.xml è¦ç¡®ä¿å¼•å…¥ web ä¸ nacos-discovery ä¸¤ä¸ªä¾èµ–ã€‚</p>
<pre class="lang-xml" data-nodeid="1376"><code data-language="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p data-nodeid="1377">ç¬¬äºŒæ­¥ï¼Œåœ¨ application.yml ä¸­è°ƒæ•´å¾®æœåŠ¡ä¸ Nacos çš„é€šä¿¡é…ç½®ã€‚</p>
<pre class="lang-yaml" data-nodeid="1378"><code data-language="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">provider-service</span> <span class="hljs-comment">#åº”ç”¨/å¾®æœåŠ¡åå­—</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.102</span><span class="hljs-string">:8848</span> <span class="hljs-comment">#nacosæœåŠ¡å™¨åœ°å€</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span> <span class="hljs-comment">#ç”¨æˆ·åå¯†ç </span>
        <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
</code></pre>
<p data-nodeid="1379">ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»º ProviderControllerï¼Œé€šè¿‡ Controller æ§åˆ¶å™¨å¯¹å¤–æš´éœ²æ¥å£ã€‚</p>
<pre class="lang-java" data-nodeid="1380"><code data-language="java"><span class="hljs-keyword">package</span> com.lagou.providerservice.controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderController</span> </span>{
    <span class="hljs-meta">@GetMapping("/provider/msg")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">sendMessage</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"This is the message from provider service!"</span>;
    }
}
</code></pre>
<p data-nodeid="1381">åˆ°è¿™é‡ŒæœåŠ¡æä¾›è€… provider-service å·²ç»å¼€å‘å®Œæ¯•ï¼Œç»†å¿ƒçš„ä½ åº”è¯¥å·²æ³¨æ„åˆ°ï¼ŒæœåŠ¡æä¾›è€…å°±æ˜¯æ ‡å‡†çš„ Spring Cloud å¾®æœåŠ¡ï¼Œå‘ Nacos è¿›è¡Œæ³¨å†Œçš„åŒæ—¶å¯¹å¤–æš´éœ² msg æ¥å£å¹¶è¿”å›ä¸€æ®µé™æ€æ–‡æœ¬ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ä¸ Ribbon ç›¸å…³çš„å†…å®¹ã€‚ç¡®å®ï¼ŒRibbon ä¸ RestTemplate åº”å‡ºç°åœ¨æœåŠ¡æ¶ˆè´¹è€…ï¼Œè€Œéæä¾›è€…ä¸€ç«¯ã€‚</p>
<p data-nodeid="1382">ä¸‹é¢ä¸ºäº†æ¼”ç¤ºéœ€è¦ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡äº”å°è™šæ‹Ÿæœºï¼š</p>
<p data-nodeid="4372" class=""><img src="https://s0.lgstatic.com/i/image6/M01/19/21/Cgp9HWBJwwCAWQTEAAGYqp_ImI0708.png" alt="å›¾ç‰‡5.png" data-nodeid="4375"></p>

<p data-nodeid="1410">åœ¨ provider-service å·¥ç¨‹ä¸­åˆ©ç”¨ maven package å‘½ä»¤ç”Ÿæˆ provider-service-0.0.1-SNAPSHOT.jarã€‚</p>
<p data-nodeid="5891"><img src="https://s0.lgstatic.com/i/image6/M01/19/1E/CioPOWBJww2AQjzgAAPudFa5w-0816.png" alt="å›¾ç‰‡6.png" data-nodeid="5894"></p>



<p data-nodeid="1412">åˆ†åˆ«ä¸Šä¼ è‡³åˆ° 111 è‡³ 113 èŠ‚ç‚¹åæ‰§è¡Œ Java å‘½ä»¤å¯åŠ¨å¾®æœåŠ¡å®ä¾‹ã€‚</p>
<pre class="lang-java" data-nodeid="1413"><code data-language="java">java -jar provider-service-<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>-SNAPSHOT.jar
</code></pre>
<p data-nodeid="1414">ä¸‰ä¸ªèŠ‚ç‚¹å¯åŠ¨æˆåŠŸï¼Œåœ¨ Nacos æ§åˆ¶å°åº”è§åˆ°ä¸‰ä¸ªå¥åº·å®ä¾‹ã€‚</p>
<p data-nodeid="7410"><img src="https://s0.lgstatic.com/i/image6/M01/19/21/Cgp9HWBJwxuAcxOcAAH-s7vW8jY536.png" alt="å›¾ç‰‡7.png" data-nodeid="7413"></p>



<p data-nodeid="1416">å•ç‹¬è®¿é—®ä»»æ„èŠ‚ç‚¹ï¼Œéƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„è¿”å›æ–‡æœ¬ã€‚</p>
<pre class="lang-java" data-nodeid="1417"><code data-language="java">http:<span class="hljs-comment">//192.168.31.111/provider/msg</span>
http:<span class="hljs-comment">//192.168.31.112/provider/msg</span>
http:<span class="hljs-comment">//192.168.31.113/provider/msg</span>
</code></pre>
<p data-nodeid="11050" class=""><img src="https://s0.lgstatic.com/i/image6/M00/19/1E/CioPOWBJw2uAAYFIAAC7fTlBxfE550.png" alt="å›¾ç‰‡8.png" data-nodeid="11053"></p>

<p data-nodeid="1419">åˆ°è¿™é‡Œï¼Œç¬¬ä¸€é˜¶æ®µå¼€å‘æœåŠ¡æä¾›è€… provider-service å‘Šä¸€æ®µè½ã€‚</p>
<p data-nodeid="1420"><strong data-nodeid="1578">ç¬¬äºŒé˜¶æ®µ</strong>ï¼Œå¼€å‘æœåŠ¡æ¶ˆè´¹è€… consumer-serviceï¼ŒæœåŠ¡æ¶ˆè´¹è€…è¯´ç™½äº†å°±æ˜¯æœåŠ¡çš„ä½¿ç”¨æ–¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡æ¶ˆè´¹è€…å†…ç½® Ribbon+RestTemplate å®ç°æœåŠ¡é—´é«˜å¯ç”¨é€šä¿¡ã€‚</p>
<p data-nodeid="1421">ç¬¬ä¸€æ­¥ï¼Œåˆ©ç”¨ Spring Initializr åˆ›å»º consumer-serviceå¾®æœåŠ¡ã€‚</p>
<p data-nodeid="10448"><img src="https://s0.lgstatic.com/i/image6/M00/19/1E/CioPOWBJw12AWGgvAAPhdgyUzII247.png" alt="å›¾ç‰‡9.png" data-nodeid="10451"></p>






<p data-nodeid="1423">pom.xml ç¡®ä¿å¼•å…¥ä»¥ä¸‹ä¸‰ä¸ªä¾èµ–ã€‚</p>
<pre class="lang-xml" data-nodeid="1424"><code data-language="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-cloud-alibaba.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p data-nodeid="1425">è¿™é‡Œéœ€è¦é‡ç‚¹è¯´æ˜ï¼Œstarter-netflix-ribbon å°±æ˜¯é€šè¿‡ Spring Boot Starter å‘å½“å‰å¾®æœåŠ¡å·¥ç¨‹é›†æˆ Ribbonï¼Œæ— é¡»åšå…¶ä»–é¢å¤–é…ç½®ã€‚ä¸æ­¤åŒæ—¶ï¼Œç”¨äº RESTful é€šä¿¡çš„ RestTemplate å¯¹è±¡å·²è¢«é›†æˆåˆ° starter-web æ¨¡å—ï¼Œæ— é¡»é¢å¤–ä¾èµ–ã€‚</p>
<p data-nodeid="1426">ç¬¬äºŒæ­¥ï¼Œé…ç½® application.ymlï¼Œä¸ provider-service é™¤å¾®æœåŠ¡ id å¤–å¹¶æ— å…¶ä»–å˜åŒ–ã€‚</p>
<pre class="lang-yaml" data-nodeid="1427"><code data-language="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">customer-service</span> <span class="hljs-comment">#åº”ç”¨/å¾®æœåŠ¡åå­—</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.102</span><span class="hljs-string">:8848</span> <span class="hljs-comment">#nacosæœåŠ¡å™¨åœ°å€</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span> <span class="hljs-comment">#ç”¨æˆ·åå¯†ç </span>
        <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
</code></pre>
<p data-nodeid="1428">ç¬¬ä¸‰æ­¥ï¼Œåˆ©ç”¨ Spring Java Config æ–¹å¼å£°æ˜ RestTemplateã€‚åœ¨ ConsumerServiceApplication ç±»ä¸­æ–°å¢ä»¥ä¸‹å£°æ˜ä»£ç ã€‚</p>
<pre class="lang-java" data-nodeid="1429"><code data-language="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerServiceApplication</span> </span>{
    <span class="hljs-comment">//Java Configå£°æ˜RestTemplateå¯¹è±¡</span>
    <span class="hljs-comment">//åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡ŒrestTemplate()æ–¹æ³•åˆ›å»ºRestTemplateå¯¹è±¡ï¼Œå…¶BeanIdä¸ºrestTemplateã€‚</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(ConsumerServiceApplication.class, args);
    }
}
</code></pre>
<p data-nodeid="1430">ç¬¬å››æ­¥ï¼Œåˆ›å»º ConsumerControllerï¼Œé€šè¿‡ Ribbon+RestTemplate å®ç°è´Ÿè½½å‡è¡¡é€šä¿¡ï¼Œé‡è¦çš„ä»£ç æˆ‘é€šè¿‡æ³¨é‡Šè¿›è¡Œè¯´æ˜ã€‚</p>
<pre class="lang-java" data-nodeid="1431"><code data-language="java"><span class="hljs-keyword">package</span> com.lagou.consumerservice.controller;
...
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerController</span> </span>{
    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(ConsumerController.class);
    //æ³¨å…¥ Ribbon è´Ÿè½½å‡è¡¡å™¨å¯¹è±¡
    //åœ¨å¼•å…¥ starter-netflix-ribbo nååœ¨ SpringBoot å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å®ä¾‹åŒ– LoadBalancerClient å¯¹è±¡ã€‚
    //åœ¨ Controlle ä½¿ç”¨ <span class="hljs-meta">@Resource</span> æ³¨è§£è¿›è¡Œæ³¨å…¥å³å¯ã€‚
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> LoadBalancerClient loadBalancerClient;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-comment">//å°†åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºçš„ RestTemplate å¯¹è±¡æ³¨å…¥ ConsumerController</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;
    <span class="hljs-meta">@GetMapping("/consumer/msg")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getProviderMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//loadBalancerClient.choose()æ–¹æ³•ä¼šä» Nacos è·å– provider-service æ‰€æœ‰å¯ç”¨å®ä¾‹ï¼Œ</span>
        <span class="hljs-comment">//å¹¶æŒ‰è´Ÿè½½å‡è¡¡ç­–ç•¥ä»ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨å®ä¾‹ï¼Œå°è£…ä¸º ServiceInstanceï¼ˆæœåŠ¡å®ä¾‹ï¼‰å¯¹è±¡</span>
        <span class="hljs-comment">//ç»“åˆç°æœ‰ç¯å¢ƒæ—¢æ˜¯ä»192.168.31.111:80ã€192.168.31.112:80ã€192.168.31.113:80ä¸‰ä¸ªå®ä¾‹ä¸­é€‰æ‹©ä¸€ä¸ªåŒ…è£…ä¸ºServiceInstance</span>
        ServiceInstance serviceInstance = loadBalancerClient.choose(<span class="hljs-string">"provider-service"</span>);
        <span class="hljs-comment">//è·å–æœåŠ¡å®ä¾‹çš„ IP åœ°å€</span>
        String host = serviceInstance.getHost();
        <span class="hljs-comment">//è·å–æœåŠ¡å®ä¾‹çš„ç«¯å£</span>
        <span class="hljs-keyword">int</span> port = serviceInstance.getPort();
        <span class="hljs-comment">//åœ¨æ—¥å¿—ä¸­æ‰“å°æœåŠ¡å®ä¾‹ä¿¡æ¯</span>
        logger.info(<span class="hljs-string">"æœ¬æ¬¡è°ƒç”¨ç”±provider-serviceçš„"</span> + host + <span class="hljs-string">":"</span> + port + <span class="hljs-string">" å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†"</span> );
        <span class="hljs-comment">//é€šè¿‡ RestTemplate å¯¹è±¡çš„ getForObject() æ–¹æ³•å‘æŒ‡å®š URL å‘é€è¯·æ±‚ï¼Œå¹¶æ¥æ”¶å“åº”ã€‚</span>
        <span class="hljs-comment">//getForObject()æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</span>
        <span class="hljs-comment">//1. å…·ä½“å‘é€çš„ URLï¼Œç»“åˆå½“å‰ç¯å¢ƒå‘é€åœ°å€ä¸ºï¼šhttp://192.168.31.111:80/provider/msg</span>
        <span class="hljs-comment">//2. String.classè¯´æ˜ URL è¿”å›çš„æ˜¯çº¯å­—ç¬¦ä¸²ï¼Œå¦‚æœç¬¬äºŒå‚æ•°æ˜¯å®ä½“ç±»ï¼Œ RestTemplate ä¼šè‡ªåŠ¨è¿›è¡Œååºåˆ—åŒ–ï¼Œä¸ºå®ä½“å±æ€§èµ‹å€¼</span>
        String result = restTemplate.getForObject(<span class="hljs-string">"http://"</span> + host + <span class="hljs-string">":"</span> + port + <span class="hljs-string">"/provider/msg"</span>, String.class);
        //è¾“å‡ºå“åº”å†…å®¹
        logger.info("provider-service å“åº”æ•°æ®:" + result);
        //å‘æµè§ˆå™¨è¿”å›å“åº”
        <span class="hljs-keyword">return</span> <span class="hljs-string">"consumer-service å“åº”æ•°æ®:"</span> + result;
    }
}
</code></pre>
<p data-nodeid="1432">ç¬¬äº”æ­¥ï¼Œåˆ©ç”¨ Maven Package æ‰“åŒ…ç”Ÿæˆ Jarã€‚</p>
<p data-nodeid="12569"><img src="https://s0.lgstatic.com/i/image6/M00/19/22/Cgp9HWBJw32AP6Q-AAISw1hZuVw034.png" alt="å›¾ç‰‡10.png" data-nodeid="12572"></p>



<p data-nodeid="1434">éƒ¨ç½²è‡³ 120 è™šæ‹Ÿæœºï¼Œæ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼š</p>
<pre class="lang-java" data-nodeid="1435"><code data-language="java">java -jar consumer-service-<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>-SNAPSHOT.jar
</code></pre>
<p data-nodeid="1436">å¯åŠ¨æˆåŠŸåï¼Œåœ¨ Nacos ä¸­ç¡®è®¤ consumer-service å·²æ³¨å†Œã€‚<br>
åœ¨æµè§ˆå™¨è¾“å…¥<a href="http://192.168.31.120/consumer/msg" data-nodeid="1598">http://192.168.31.120/consumer/msg</a>ï¼ŒF5 å¤šæ¬¡åˆ·æ–°ï¼Œçœ‹æ—¥å¿—ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœã€‚</p>
<pre class="lang-java" data-nodeid="1437"><code data-language="java">æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.111</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.112</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.113</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.111</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.112</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
</code></pre>
<p data-nodeid="1438">ä¸éš¾çœ‹å‡ºï¼Œå› ä¸ºåœ¨ Nacos ä¸­å­˜åœ¨ 3 ä¸ª provider-service çš„å¯ç”¨å®ä¾‹ï¼Œé»˜è®¤ Ribbon æ˜¯ä»¥è½®è¯¢æ–¹å¼æŒ‰é¡ºåºé€æ¬¡å‘é€ã€‚å¦‚æœé‡åˆ°æŸä¸ª provider-service å®ä¾‹å®•æœºï¼ŒNacos å¿ƒè·³æœºåˆ¶ä¼šæ£€æµ‹åˆ°å¹¶å°†å…¶å‰”é™¤ï¼ŒåŒæ—¶é€šçŸ¥æ‰€æœ‰ consumer-service å®ä¾‹ï¼ŒæœåŠ¡æä¾›è€…èŠ‚ç‚¹çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä¹‹å consumer-service ä¾¿ä¸ä¼šå‘å®•æœºèŠ‚ç‚¹å‘å‡ºè¯·æ±‚ã€‚</p>
<p data-nodeid="1439">ä»¥ä¸Šä¾¿æ˜¯ä»£ç æ¨¡å¼çš„å¤„ç†è¿‡ç¨‹ã€‚å®ƒæ¸…æ™°çš„è¯´æ˜äº† Ribbon çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…ˆä» Nacos è·å–å¯ç”¨æœåŠ¡æä¾›è€…å®ä¾‹ä¿¡æ¯ï¼Œå†é€šè¿‡ RestTemplate.getForObject() å‘è¯¥å®ä¾‹å‘èµ· RESTful è¯·æ±‚å®Œæˆå¤„ç†ã€‚ä½†å¯èƒ½ä½ ä¹Ÿæ„Ÿè§‰åˆ°äº†ï¼Œä»£ç æ¨¡å¼ä½¿ç”¨å¤æ‚ï¼Œéœ€è¦è‡ªå·±è·å–å¯ç”¨å®ä¾‹ IPã€ç«¯å£ä¿¡æ¯ï¼Œå†æ‹¼æ¥ URL å®ç°æœåŠ¡é—´é€šä¿¡ï¼Œé‚£æœ‰æ²¡æœ‰æ›´ç®€å•çš„åŠæ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œåˆ©ç”¨ @LoadBalanced æ³¨è§£å¯è‡ªåŠ¨åŒ–å®ç°è¿™ä¸€è¿‡ç¨‹ã€‚</p>
<h4 data-nodeid="1440">æ³¨è§£æ¨¡å¼</h4>
<p data-nodeid="1441">æ³¨è§£æ¨¡å¼ä»ç„¶åˆ†ä¸ºä¸¤é˜¶æ®µï¼š</p>
<p data-nodeid="1442"><strong data-nodeid="1608">ç¬¬ä¸€é˜¶æ®µ</strong>ï¼Œåˆ›å»ºæœåŠ¡æä¾›è€… provider-serviceï¼Œå› æœåŠ¡æä¾›è€…å¹¶ä¸æ¶‰åŠ Ribbonï¼Œæ‰€ä»¥ä¸ä»£ç æ¨¡å¼ä¸€é˜¶æ®µä»£ç å®Œå…¨ç›¸åŒï¼Œè¿™é‡Œä¸å†å¤è¿°ã€‚</p>
<p data-nodeid="1443"><strong data-nodeid="1613">ç¬¬äºŒé˜¶æ®µ</strong>ï¼Œåˆ›å»ºæ–°çš„æœåŠ¡æ¶ˆè´¹è€… consumer-serviceã€‚</p>
<p data-nodeid="1444">ç¬¬ä¸€æ­¥ï¼Œåˆ©ç”¨ Spring Initializr åˆ›å»º consumer-service å¾®æœåŠ¡ã€‚</p>
<p data-nodeid="14088"><img src="https://s0.lgstatic.com/i/image6/M00/19/22/Cgp9HWBJw5GAfy0KAAF_d0YMb9M817.png" alt="å›¾ç‰‡11.png" data-nodeid="14091"></p>



<p data-nodeid="1446">åŒæ ·å¼•ç”¨ 3 ä¸ªä¾èµ–ã€‚</p>
<pre class="lang-xml" data-nodeid="1447"><code data-language="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-cloud-alibaba.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p data-nodeid="1448">ç¬¬äºŒæ­¥ï¼Œé…ç½® application.ymlã€‚åœ¨åŸæœ‰ä»£ç æ¨¡å¼åŸºç¡€ä¸Šï¼Œå°† Debug çº§åˆ«æ—¥å¿—è¾“å‡ºï¼Œè¿™æ ·ä¾¿å¯çœ‹åˆ°è´Ÿè½½å‡è¡¡å®ä¾‹ä¿¡æ¯ã€‚</p>
<pre class="lang-yaml" data-nodeid="1449"><code data-language="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">consumer-service</span> <span class="hljs-comment">#åº”ç”¨/å¾®æœåŠ¡åå­—</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <span class="hljs-comment">#nacosæœåŠ¡å™¨åœ°å€</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span> <span class="hljs-comment">#ç”¨æˆ·åå¯†ç </span>
        <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">debug</span>
</code></pre>
<p data-nodeid="1450">ç¬¬ä¸‰æ­¥ï¼Œå…³é”®ç‚¹æ¥äº†ï¼Œåœ¨ Spring åˆå§‹åŒ– RestTemplate å®ä¾‹æ—¶å¢åŠ  @LoadBalanced æ³¨è§£ï¼Œä½¿ RestTemplate è¿›è¡ŒæœåŠ¡é€šä¿¡æ—¶è‡ªåŠ¨ä¸ Ribbon æ•´åˆï¼Œè‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<pre class="lang-java" data-nodeid="1451"><code data-language="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerServiceApplication</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span> <span class="hljs-comment">//ä½¿RestTemplateå¯¹è±¡è‡ªåŠ¨æ”¯æŒRibbonè´Ÿè½½å‡è¡¡</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(ConsumerServiceApplication.class, args);
    }
}
</code></pre>
<p data-nodeid="1452">ç¬¬å››æ­¥ï¼Œåœ¨ Controller å‘èµ·é€šä¿¡æ—¶ï¼ŒåŸæœ‰ RestTemplate.getForObject() æ–¹æ³•ä¹¦å†™ URL æ—¶ï¼Œå°† IP ç«¯å£éƒ¨åˆ†è¦æ›¿æ¢ä¸ºæœåŠ¡åï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="lang-java" data-nodeid="1453"><code data-language="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerController</span> </span>{
    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(ConsumerController.class); 
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;
    <span class="hljs-meta">@GetMapping("/consumer/msg")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getProviderMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//å…³é”®ç‚¹ï¼šå°†åŸæœ‰IP:ç«¯å£æ›¿æ¢ä¸ºæœåŠ¡åï¼ŒRestTemplateä¾¿ä¼šåœ¨é€šä¿¡å‰è‡ªåŠ¨åˆ©ç”¨RibbonæŸ¥è¯¢å¯ç”¨provider-serviceå®ä¾‹åˆ—è¡¨</span>
        <span class="hljs-comment">//å†æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©èŠ‚ç‚¹å®ä¾‹</span>
        String result = restTemplate.getForObject(<span class="hljs-string">"http://provider-service/provider/msg"</span>, String.class);
        logger.info("consumer-serviceè·å¾—æ•°æ®:" + result);
        <span class="hljs-keyword">return</span>   <span class="hljs-string">"consumer-serviceè·å¾—æ•°æ®:"</span> + result;
    }
}
</code></pre>
<p data-nodeid="1454">åœ¨æ–°çš„ getProviderMessage ä»£ç ä¸­ï¼Œä¸å†å‡ºç° LoadBalancerClient ä¸ ServiceInstance å¯¹è±¡ï¼Œè¿™ä¸€åˆ‡éƒ½è¢« @LoadBalanced è¿›è¡Œå°è£…ï¼Œåœ¨ RestTemplate æŸ¥è¯¢å‰è‡ªåŠ¨å¤„ç†ã€‚</p>
<p data-nodeid="1455">ç¬¬äº”æ­¥ï¼Œé‡æ–°éƒ¨ç½² consumer-serviceï¼Œå¤šæ¬¡è®¿é—®åœ°å€<a href="http://192.168.31.120/consumer/msg" data-nodeid="1626">http://192.168.31.120/consumer/msg</a>ï¼Œåœ¨æ§åˆ¶å°ä¼šçœ‹åˆ° Debug çº§åˆ«æ—¥å¿—ï¼Œé€šè¿‡å®é™…IPåœ°å€ä¹ŸåŒæ ·å°è¯ Ribbon é»˜è®¤é‡‡ç”¨è½®è¯¢ç­–ç•¥è¿›è¡Œåˆ†é…ã€‚</p>
<pre class="lang-java" data-nodeid="1456"><code data-language="java">s.n.www.protocol.http.HttpURLConnection : {GET /provider/msg ...}{Accept: ...}{User-Agent: ...}{Host: <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.111</span>:<span class="hljs-number">80</span>}
...
s.n.www.protocol.http.HttpURLConnection : {GET /provider/msg ...}{Accept: ...}{User-Agent: ...}{Host: <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.112</span>:<span class="hljs-number">80</span>}
...
s.n.www.protocol.http.HttpURLConnection : {GET /provider/msg ...}{Accept: ...}{User-Agent: ...}{Host: <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.113</span>:<span class="hljs-number">80</span>}
</code></pre>
<p data-nodeid="1457">ä»¥ä¸Šä¾¿æ˜¯æ³¨è§£æ¨¡å¼çš„ä½¿ç”¨åŠæ³•ï¼Œç›¸æ¯”ä»£ç æ¨¡å¼æ˜¯ä¸æ˜¯ç®€å•å¾ˆå¤šå•Šã€‚å¯¹äº†ï¼Œä½ æ³¨æ„åˆ°äº†å—ï¼Ÿæ— è®ºæ³¨è§£æ¨¡å¼è¿˜æ˜¯ä»£ç æ¨¡å¼ï¼Œé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥éƒ½æ˜¯è½®è¯¢ï¼Œå³æŒ‰é¡ºåºä¾æ¬¡è®¿é—®ï¼Œä½œä¸º Ribbon è¿˜æ”¯æŒå“ªäº›å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥å‘¢?æˆ‘ä»¬åˆè¯¥å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿæœ¬æ¬¡æœ€åä¸€å°èŠ‚ï¼Œæˆ‘å°†å¸¦é¢†ä½ å­¦ä¹ è¿™å—çŸ¥è¯†ã€‚</p>
<h3 data-nodeid="1458">å¦‚ä½•é…ç½® Ribbon è´Ÿè½½å‡è¡¡ç­–ç•¥</h3>
<p data-nodeid="1459">Ribbon å†…ç½®å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¸¸ç”¨çš„åˆ†ä¸ºä»¥ä¸‹å‡ ç§ã€‚</p>
<ul data-nodeid="1460">
<li data-nodeid="1461">
<p data-nodeid="1462"><strong data-nodeid="1634">RoundRobinRuleï¼š</strong></p>
</li>
</ul>
<p data-nodeid="1463">è½®è¯¢ç­–ç•¥ï¼ŒRibbon é»˜è®¤ç­–ç•¥ã€‚é»˜è®¤è¶…è¿‡ 10 æ¬¡è·å–åˆ°çš„ server éƒ½ä¸å¯ç”¨ï¼Œä¼šè¿”å›â¼€ä¸ªç©ºçš„ serverã€‚</p>
<ul data-nodeid="1464">
<li data-nodeid="1465">
<p data-nodeid="1466"><strong data-nodeid="1639">RandomRuleï¼š</strong></p>
</li>
</ul>
<p data-nodeid="1467">éšæœºç­–ç•¥ï¼Œå¦‚æœéšæœºåˆ°çš„ server ä¸º null æˆ–è€…ä¸å¯ç”¨çš„è¯ã€‚ä¼šä¸åœåœ°å¾ªç¯é€‰å–ã€‚</p>
<ul data-nodeid="1468">
<li data-nodeid="1469">
<p data-nodeid="1470"><strong data-nodeid="1645">RetryRule</strong>ï¼š</p>
</li>
</ul>
<p data-nodeid="1471">é‡è¯•ç­–ç•¥ï¼Œâ¼€å®šæ—¶é™å†…å¾ªç¯é‡è¯•ã€‚é»˜è®¤ç»§æ‰¿ RoundRobinRuleï¼Œä¹Ÿâ½€æŒè‡ªå®šä¹‰æ³¨â¼Šï¼ŒRetryRule ä¼šåœ¨æ¯æ¬¡é€‰å–ä¹‹åï¼Œå¯¹é€‰ä¸¾çš„ server è¿›â¾åˆ¤æ–­ï¼Œæ˜¯å¦ä¸º nullï¼Œæ˜¯å¦ aliveï¼Œå¹¶ä¸”åœ¨ 500ms å†…ä¼šä¸åœåœ°é€‰å–åˆ¤æ–­ã€‚è€Œ RoundRobinRule å¤±æ•ˆçš„ç­–ç•¥æ˜¯è¶…è¿‡ 10 æ¬¡ï¼ŒRandomRule æ²¡æœ‰å¤±æ•ˆæ—¶é—´çš„æ¦‚å¿µï¼Œåªè¦ serverList æ²¡éƒ½æŒ‚ã€‚</p>
<ul data-nodeid="1472">
<li data-nodeid="1473">
<p data-nodeid="1474"><strong data-nodeid="1651">BestAvailableRule</strong>ï¼š</p>
</li>
</ul>
<p data-nodeid="1475">æœ€å°è¿æ¥æ•°ç­–ç•¥ï¼Œéå† serverListï¼Œé€‰å–å‡ºå¯â½¤çš„ä¸”è¿æ¥æ•°æœ€å°çš„â¼€ä¸ª serverã€‚é‚£ä¹ˆä¼šè°ƒç”¨ RoundRobinRule é‡æ–°é€‰å–ã€‚</p>
<ul data-nodeid="1476">
<li data-nodeid="1477">
<p data-nodeid="1478"><strong data-nodeid="1657">AvailabilityFilteringRule</strong>ï¼š</p>
</li>
</ul>
<p data-nodeid="1479">å¯ç”¨è¿‡æ»¤ç­–ç•¥ã€‚æ‰©å±•äº†è½®è¯¢ç­–ç•¥ï¼Œä¼šå…ˆé€šè¿‡é»˜è®¤çš„è½®è¯¢é€‰å–â¼€ä¸ª serverï¼Œå†å»åˆ¤æ–­è¯¥ server æ˜¯å¦è¶…æ—¶å¯ç”¨ã€å½“å‰è¿æ¥æ•°æ˜¯å¦è¶…é™ï¼Œéƒ½æˆåŠŸå†è¿”å›ã€‚</p>
<ul data-nodeid="1480">
<li data-nodeid="1481">
<p data-nodeid="1482"><strong data-nodeid="1663">ZoneAvoidanceRule</strong>ï¼š</p>
</li>
</ul>
<p data-nodeid="1483">åŒºåŸŸæƒè¡¡ç­–ç•¥ã€‚æ‰©å±•äº†è½®è¯¢ç­–ç•¥ï¼Œé™¤äº†è¿‡æ»¤è¶…æ—¶å’Œé“¾æ¥æ•°è¿‡å¤šçš„ serverï¼Œè¿˜ä¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆè¦æ±‚çš„ zone åŒºåŸŸâ¾¥â¾¯çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå§‹ç»ˆä¿è¯åœ¨â¼€ä¸ªåŒºåŸŸ/æœºæˆ¿å†…çš„æœåŠ¡å®ä¾‹è¿›è¡Œè½®è¯¢ã€‚</p>
<p data-nodeid="1484">è¿™é‡Œæ‰€æœ‰è´Ÿè½½å‡è¡¡ç­–ç•¥åæœ¬è´¨éƒ½æ˜¯ com.netflix.loadbalancer åŒ…ä¸‹çš„ç±»ï¼š</p>
<p data-nodeid="15607"><img src="https://s0.lgstatic.com/i/image6/M00/19/1E/CioPOWBJw6SAKOB6AAXujVzqsIs554.png" alt="å›¾ç‰‡12.png" data-nodeid="15610"></p>



<p data-nodeid="1486">è¦æ›´æ”¹å¾®æœåŠ¡é€šä¿¡æ—¶é‡‡ç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ application.yml ä¸­é‡‡ç”¨ä¸‹é¢æ ¼å¼ä¹¦å†™å³å¯ã€‚</p>
<pre class="lang-yaml" data-nodeid="1487"><code data-language="yaml"><span class="hljs-attr">provider-service:</span> <span class="hljs-comment">#æœåŠ¡æä¾›è€…çš„å¾®æœåŠ¡id</span>
  <span class="hljs-attr">ribbon:</span>
    <span class="hljs-attr">NFLoadBalancerRuleClassName:</span> <span class="hljs-string">com.netflix.loadbalancer.RandomRule</span> <span class="hljs-comment">#è®¾ç½®å¯¹åº”çš„è´Ÿè½½å‡è¡¡ç±»</span>
</code></pre>
<p data-nodeid="1488">å½“é‡‡ç”¨éšæœºç­–ç•¥ï¼Œè¿è¡Œæ—¶å¾—åˆ°å¦‚ä¸‹æ—¥å¿—ï¼Œæ‚ä¹±çš„é¡ºåºè¯´æ˜éšæœºç­–ç•¥å·²ç”Ÿæ•ˆã€‚</p>
<pre class="lang-java" data-nodeid="1489"><code data-language="java">æœ¬æ¬¡è°ƒç”¨ç”± provider-serviceçš„<span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.112</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.112</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.113</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.111</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
æœ¬æ¬¡è°ƒç”¨ç”± provider-service çš„ <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.113</span>:<span class="hljs-number">80</span> å®ä¾‹èŠ‚ç‚¹è´Ÿè´£å¤„ç†
consumer-service è·å¾—æ•°æ®:This is the message from provider service!
</code></pre>
<p data-nodeid="1490">è®²åˆ°è¿™é‡Œï¼Œæƒ³å¿…ä½ å¯¹ Ribbon å·²ç»æœ‰äº†ç›´è§‚çš„è®¤è¯†ï¼Œåœ¨é¡¹ç›®ä¸­åˆç†çš„ä½¿ç”¨ Ribbon è´Ÿè½½å‡è¡¡å¯ä»¥ä½¿ç³»ç»Ÿæ€§èƒ½æœ‰æ˜¾è‘—çš„æå‡ï¼Œæœ€åæˆ‘ä»¬æ¥åšä¸‹æ€»ç»“ã€‚</p>
<h3 data-nodeid="1491">å°ç»“ä¸é¢„å‘Š</h3>
<p data-nodeid="1492">æœ¬æ–‡æˆ‘ä»¬ä»‹ç»äº†ä¸‰æ–¹é¢çŸ¥è¯†ï¼Œå¼€å§‹ä»‹ç»äº† Ribbon è´Ÿè½½å‡è¡¡å™¨çš„ä½œç”¨ï¼Œä¹‹åè®²è§£äº† Ribbon çš„ä¸¤ç§å¼€å‘æ¨¡å¼ï¼Œæœ€åè®²è§£äº† Ribbon çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸è®¾ç½®åŠæ³•ã€‚</p>
<p data-nodeid="1493">è¿™é‡Œç»™ä½ ç•™ä¸€é“è¯¾å¤–é¢˜ï¼šå¦‚æœ Ribbon è‡ªå¸¦çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸èƒ½æ»¡è¶³å®é™…é¡¹ç›®çš„éœ€è¦ï¼Œæˆ‘ä»¬å¦‚ä½•è‡ªå®šä¹‰ Ribbon è´Ÿè½½å‡è¡¡ç­–ç•¥å‘¢ï¼Ÿä½ å¯ä»¥è‡ªè¡ŒæŸ¥é˜…èµ„æ–™ï¼Œå°†å­¦åˆ°çš„çŸ¥è¯†åˆ†äº«åœ¨è¯„è®ºåŒºä¸­ã€‚</p>
<p data-nodeid="1494" class="">ä¸‹ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†å­¦ä¹ é™¤ RestTemplate ä¹‹å¤–å¦ä¸€é¡¹é‡è¦çš„æœåŠ¡é—´é€šä¿¡æŠ€æœ¯ OpenFeignï¼Œçœ‹å®ƒåˆæä¾›äº†å“ªäº›é«˜çº§ç‰¹æ€§ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### **å›½ï¼š
> ä¹‹å‰æ˜¯ä¼¼æ‡‚éæ‡‚çš„ã€‚ è¿™ä¸ªè¯¾ç¨‹ç»§ç»­æ·±å…¥å­¦ä¹ ï¼Œè®²å¾—å¾ˆå¥½ï¼Œæ¯”å…¶ä»–åŒç±»çš„è´¨é‡é«˜ï¼

##### **ç§‘ï¼š
> è€å¸ˆæœ‰ä»£ç çš„githubå˜›

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; GITæºç æˆ‘æ•´ç†ä¸‹ä¼šä¸Šä¼ çš„

##### *æ¨ï¼š
> nacosä¸æ˜¯å¤©ç„¶è‡ªå¸¦çš„è´Ÿè½½å‡è¡¡å˜›

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„ï¼ŒNacosè‡ªå¸¦è´Ÿè½½å‡è¡¡ï¼Œä½†Spring Cloudä½“ç³»ä¸‹å¹¶ä¸æ˜¯åªæœ‰Nacosï¼Œè¿˜æœ‰Eurekaã€Consulï¼Œä»–ä»¬æ˜¯ä¸å…·å¤‡æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡çš„ã€‚å› æ­¤å¼•å…¥Ribbonåšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ˜¯ç”±å¿…è¦çš„ã€‚

##### *é¾™ï¼š
> nacosæ”¯æŒæœåŠ¡ç«¯åŸºäºæƒé‡çš„è´Ÿè½½å‡è¡¡ï¼Œå³ä½¿æ¶ˆè´¹ç«¯æ²¡æœ‰å¼€å¯loadbalanceï¼Œä»…é€‚ç”¨restTempleateè°ƒç”¨å¾®æœåŠ¡ï¼Œä¹Ÿä¼šä»è®¿é—®ä¸åŒå®ä¾‹

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„~~~è™½ç„¶Spring Cloudå®˜æ–¹æ˜¯Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œä½†æˆ‘å–œæ¬¢NacosæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡æ–¹æ¡ˆã€‚ä½†æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡å¹¶ä¸æ˜¯æ¯ä¸€æ¬¾æ³¨å†Œä¸­å¿ƒéƒ½æ”¯æŒçš„ã€‚

##### **ç”¨æˆ·0509ï¼š
> æ ¹æ®com.netflix.loadbalanceråŒ…ä¸‹çš„ç±»ç»“æ„ï¼Œå¤§èƒ†çš„çŒœä¸€ä¸‹ï¼Œåº”è¯¥å¯ä»¥é€šè¿‡ç»§æ‰¿AbstractBalanceRuleæ¥å®ç°è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå…¸å‹çš„ç­–ç•¥æ¨¡å¼çš„å¥—è·¯

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å“ˆå“ˆï¼Œå¿…é¡»çš„~å…„deiä¸€çœ‹å°±æ˜¯åŒé“ä¸­äºº

##### **å½ªï¼š
> å¥½æ–‡ï¼Œè¯»å®Œååˆ†é’Ÿï¼Œä½œè€…ç¼–å†™å‡ å¤©æˆ–å‡ å‘¨

##### **åï¼š
> 1.Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç”¨äºconsumer-serviceä¸provider-serviceä¹‹é—´è°ƒç”¨ï¼Œé‚£å¦‚æœå¤šä¸ª consumer-serviceï¼Œå®¢æˆ·åº”è¯¥æ€ä¹ˆè®¿é—®ï¼Ÿåœ¨å¤–é¢åŠ ä¸ªNginxè´Ÿè½½å‡è¡¡ï¼Ÿè¿˜æ˜¯è¯´ç›´æ¥è®¿é—®nacosæ³¨å†Œä¸­å¿ƒè®©nacosåšåˆ†å‘ï¼Ÿï¼Ÿ
2.nacosèƒ½ç›´æ¥è®¿é—®å—ï¼Ÿå®ƒèƒ½æ›¿ä»£Nginxå®Œæˆ ç”¨æˆ·è¯·æ±‚çš„åˆ†å‘å·¥ä½œä¹ˆï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; 1. consumer-serviceçš„æ¥å£è¦å¯¹ç”¨æˆ·æš´éœ²,åˆ™è¦é…ç½®Gateway ç½‘å…³,åœ¨åé¢é©¬ä¸Šå°±ä¼šè®²åˆ°è¿™ä¸ªç»„ä»¶. 
2. æœ€ç»ˆé¢å‘ç”¨æˆ·çš„Gatewayç»„ä»¶è¦æä¾›é«˜å¯ç”¨,éœ€è¦é¢å¤–é…ç½®Keepalived + VIP æ–¹æ¡ˆä¿è¯å¹³æ»‘æ•…éšœè¿ç§»
3. Nacosä¸èƒ½è¢«ç”¨æˆ·ç›´æ¥è®¿é—®,å®ƒåªè´Ÿè´£æ³¨å†Œä¸æœåŠ¡å‘ç°/é…ç½®ç®¡ç†,ä¸è´Ÿè´£è¯·æ±‚è½¬å‘.è¯·æ±‚è½¬å‘æ˜¯ç½‘å…³ä¸OpenFeignçš„äº‹æƒ….

##### **æ³¢ï¼š
> robbinå®¢æˆ·ç«¯è´Ÿè½½çš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±ä¸ä¼šèµ°ç»Ÿä¸€çš„ç½‘å…³æœåŠ¡äº†ï¼Ÿå°±ä¸èƒ½åœ¨ç½‘å…³æœåŠ¡ä¸Šåšè®¤è¯ï¼Œé™æµï¼Œç†”æ–­ï¼Œé™çº§ç­‰ä¸€ç³»åˆ—æ“ä½œäº†å§ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æœåŠ¡é—´é€šä¿¡æ˜¯å¾®æœåŠ¡æ¶æ„å†…éƒ¨çš„äº‹æƒ…ï¼Œç½‘å…³æ˜¯å’±ä»¬å¾®æœåŠ¡æ¶æ„çš„çœ‹é—¨è€å¤§çˆ·é¢å‘å¤–æ¥è€…çš„ã€‚å¦‚æœä¸å¤–æ¥è€…ç›¸å…³çš„ç»Ÿä¸€å¤„ç†ï¼Œå¦‚è®¤è¯ã€é‰´æƒå†™åœ¨ç½‘å…³ä¸Šå°±å¯ä»¥äº†ã€‚æœåŠ¡å†…éƒ¨æ¶ˆæ¯ä¼ é€’ä¸å¤„ç†ï¼Œé‚£å’Œç½‘å…³å°±æœ¨æœ‰å…³ç³»äº†

##### LeonardoEzioï¼š
> æ˜¯ä¸æ˜¯è¦é…hostï¼Ÿæˆ‘è°ƒç”¨çš„æ—¶å€™ï¼ŒæŠ¥hostæ— æ³•è§£æã€‚java.net.UnknownHostException: simple-server

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™ä¸ªéœ€è¦é…æœ¬åœ°Hosts,ä¸è¿‡æ²¡å…³ç³»,ä¹Ÿå¯ä»¥é€šè¿‡
spring.cloud.nacos.discovery.ip = 10.2.11.11 
è¿›è¡ŒIPè®¾ç½®

##### LeonardoEzioï¼š
> nacos æœåŠ¡ç«¯è‡ªå¸¦è´Ÿè½½å‡è¡¡ï¼Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯è°ƒç”¨çš„æ—¶å€™ä¸åŠ ä»»ä½•ç±»ä¼¼@LoadBalanceçš„å¤„ç†ï¼Œå®é™…è°ƒç”¨è¿˜æ˜¯å‡è¡¡çš„ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„,å¦‚æœä¸åŠ @LoadBalance,å…¶å®Nacosåœ¨æœåŠ¡ç«¯å°±å·²ç»åšäº†è´Ÿè½½å‡è¡¡

##### **å›½ï¼š
> ä½¿ç”¨ç¬¬äºŒç§æ³¨è§£æ–¹å¼ï¼Œå¯åŠ¨æŠ¥äº†é”™ï¼Œå¦‚ä¸‹ï¼Œè²Œä¼¼ä¸å½±å“ä½¿ç”¨ã€‚è¿™ä¸ªé”™è¯¯ä»€ä¹ˆåŸå› å‘¢2021-04-20 22:16:22.279 DEBUG 19364 --- [: Class not found so assuming code is running on a pre-Java 9 JVMjava.lang.ClassNotFoundException: java.lang.reflect.InaccessibleObjectException	at java.net.URLClassLoader.findClass(URLClassLoader.java:381) ~[na:1.8.0_171]	at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[na:1.8.0_171]	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349) ~[na:1.8.0_171]	at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[na:1.8.0_171]	at java.lang.Class.forName0(Native Method) ~[na:1.8.0_171]	at java.lang.Class.forName(Class.java:264) ~[na:1.8.0_171]	at org.apache.tomcat.util.compat.Jre9Compat.(Jre9Compat.java:83) ~[tomcat-embed-core-9.0.41.jar:9.0.41]	at org.apache.tomcat.util.compat.JreCompat.(JreCompat.java:55) [tomcat-embed-core-9.0.41.jar:9.0.41]	at org.apache.catalina.startup.Tomcat.(Tomcat.java:1303) [tomcat-embed-core-9.0.41.jar:9.0.41]

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å‡çº§JDKç‰ˆæœ¬ 9+æ­£å¼ç‰ˆåŠä»¥ä¸Šï¼ŒPreç‰ˆæœ€å¥½ä¸ç”¨

##### **ä¼Ÿï¼š
> å¦‚æœé‡åˆ°æŸä¸ª provider-service å®ä¾‹å®•æœºï¼ŒNacos å¿ƒè·³æœºåˆ¶ä¼šæ£€æµ‹åˆ°å¹¶å°†å…¶å‰”é™¤ï¼ŒåŒæ—¶é€šçŸ¥æ‰€æœ‰ consumer-service å®ä¾‹ï¼ŒæœåŠ¡æä¾›è€…èŠ‚ç‚¹çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä¹‹å consumer-service ä¾¿ä¸ä¼šå‘å®•æœºèŠ‚ç‚¹å‘å‡ºè¯·æ±‚ã€‚é‚£å¦‚æœå¿ƒè·³æœºåˆ¶è¿˜æ²¡æ£€æµ‹åˆ°æœåŠ¡å®•æœºäº†ï¼Œé‚£è¯·æ±‚å‘è¿‡å»äº†çš„è¯ï¼Œå²‚ä¸æ˜¯ä¼šå‡ºé—®é¢˜ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„ï¼Œåœ¨è¿™ä¸ªçª—å£æœŸå†…å°±ä¼šå‡ºé”™ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡Spring-Retryableé‡è¯•æœºåˆ¶é‡æ–°å‘èµ·è¯·æ±‚

##### **ä¼Ÿï¼š
> RestTemplate ä¸æ˜¯Spring cloudçš„å§ï¼Œå®ƒæ˜¯Spring webçš„

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; RestTemplateç¡®å®æ˜¯Starter-Webä¸‹çš„ï¼Œé¢å¤–å£°æ˜å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨æ„å»ºRestTemplateæ—¶æœªæ¥å¢åŠ æ›´å¤šå¯¹è±¡ç‰¹æ€§ï¼Œæ¯”å¦‚å¯ä»¥åœ¨å£°æ˜æ—¶åŠ å…¥@LoadBalancedæä¾›Ribbonè´Ÿè½½å‡è¡¡ã€‚

##### *æ¨ï¼š
> ä½ çš„æ„æ€æ˜¯å¦‚æœä¸èƒ½ä½¿ç”¨nacosä½œæ³¨å†Œä¸­å¿ƒçš„è¯ï¼Œæˆ–è€…æ¢æˆzkåšæ³¨å†Œä¸­å¿ƒï¼Œè¿™æ—¶å€™ribbonå°±å¯ä»¥åšä¸ºä¸€ä¸ªæ³¨å†Œä¸­å¿ƒçš„è´Ÿè½½å‡è¡¡ç»„ä»¶ä½¿ç”¨æ˜¯å§

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå¼•å…¥Ribbonåï¼Œå°±ä¸å†éœ€è¦æ³¨å†Œä¸­å¿ƒæ”¯æŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡äº†ã€‚

##### *é“ï¼š
> Nacos è‡ªèº«æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½å—ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æœ‰çš„ï¼ŒNacosè‡ªå¸¦æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡

##### **0152ï¼š
> è¯·é—®æºç ä¼ åˆ°å“ªå‘¢å•Šï¼Ÿæˆ‘æ²¡æœ‰æ‰¾åˆ°è¯¶

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å…„å¼Ÿï¼Œæˆ‘åœ¨æ•´ç†4æœˆ6æ—¥ç»Ÿä¸€ä¸Šä¼ åˆ°github

##### **ç§‹ï¼š
> ä¸»è¦å­¦åˆ°äº†æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„åŒºåˆ«ã€è´Ÿè½½å‡è¡¡ç­–ç•¥æ¨¡å¼ï¼Œæ”¶è·æ»¡æ»¡ï¼ğŸ˜€

##### **é£ï¼š
> è€å¸ˆï¼Œè¯·é—®ä¸‹ä¸ºä»€ä¹ˆè¦å£°æ˜RestTemplateä¸ºBeanï¼Ÿä¸æ˜¯ä¾èµ–äº†starter-webäº†å°±è¡Œäº†å—ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; RestTemplateç¡®å®æ˜¯Starter-Webä¸‹çš„ï¼Œé¢å¤–å£°æ˜å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨æ„å»ºRestTemplateæ—¶æœªæ¥å¢åŠ æ›´å¤šå¯¹è±¡ç‰¹æ€§ï¼Œæ¯”å¦‚å¯ä»¥åœ¨å£°æ˜æ—¶åŠ å…¥@LoadBalancedæä¾›Ribbonè´Ÿè½½å‡è¡¡ã€‚

##### **å¿—ï¼š
> åœ¨ä¸»å¯åŠ¨ç±»é‡Œé‚£æ®µåˆå§‹åŒ–RestTempleteå¯¹è±¡çš„ä»£ç æ„Ÿè§‰æ˜¯å¤šä½™çš„ï¼Œå¯ä»¥åœ¨controllerä¸­ç›´æ¥æ³¨å…¥å°±å¯ä»¥äº†å§

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ä¸æ˜¯çš„ï¼Œåˆ©ç”¨Java Configè¿›è¡Œ@Beanæ³¨å…¥ï¼Œå¯ä»¥ä¸ºRestTemplateåœ¨æ„é€ é˜¶æ®µèµ‹äºˆæ›´å¤šç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç æ–¹å¼ä¸ºRestTemplateè®¾ç½®æ›´å¤šçš„ç»†èŠ‚ã€‚

##### **ç²ï¼š
> ğŸ˜‚

##### **ç²ï¼š
> æœ‰æºç å—ï¼Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬ä¸å¯¹ï¼Œæˆ‘è‡ªå·±è”ç³»çš„æ—¶å€™ï¼Œæ²¡æœ‰EnableDiscoveryClientå’ŒLoadBalancedæ³¨è§£ ä¹Ÿæ²¡æœ‰LoadBalancerClientè¿™ä¸ªå¯¹è±¡

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æºç æˆ‘ä¼šè¿‡ä¸€æ®µæ—¶é—´ç»Ÿä¸€ä¸Šä¼ ï¼Œä½ è¿™ä¸ªé—®é¢˜å¯èƒ½æ˜¯Mavenä¾èµ–æ²¡æœ‰ä¸‹è½½å¥½å¯¼è‡´çš„ã€‚åŠ å…¥Aliyunçš„Mavenä»“åº“åº”è¯¥å°±èƒ½è§£å†³ã€‚

##### **1001ï¼š
> å¸Œæœ›ä¸‹èŠ‚æœ‰resttemplateå’Œopenfeignå¯¹æ¯”ä»‹ç»ï¼Œå¦‚æ€§èƒ½ï¼Œä½¿ç”¨åœºæ™¯ç­‰

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; OpenFeignå±è”½äº†å¤šä¸ªHttpåº•å±‚ç»†èŠ‚ã€‚è®©å¼€å‘è€…åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚å¼€å‘ä¸­ç”¨OpenFeignå°±å¥½å•¦


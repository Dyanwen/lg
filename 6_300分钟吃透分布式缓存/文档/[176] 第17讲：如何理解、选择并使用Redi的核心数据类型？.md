<p style="text-align: justify; line-height: 1.75em;"><span style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">你好，我是你的缓存课老师陈波，欢迎进入第 17 课时“Redis&nbsp;数据类型”的学习。</span></p>
<p style="margin-bottom: 0pt; margin-top: 0pt; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 11pt;"></span></p>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 18px;">Redis 数据类型</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">首先，来看一下&nbsp;Redis&nbsp;的核心数据类型。Redis&nbsp;有&nbsp;8&nbsp;种核心数据类型，分别是&nbsp;：</span></p>
<ul style=" white-space: normal; text-align: justify;">
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">string&nbsp;字符串类型；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">list&nbsp;列表类型；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">set&nbsp;集合类型；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">sorted set&nbsp;有序集合类型；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">hash&nbsp;类型；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">bitmap&nbsp;位图类型；&nbsp;</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">geo&nbsp;地理位置类型；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">HyperLogLog 基数统计类型。</span></p></li>
</ul>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">string 字符串</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">string&nbsp;是&nbsp;Redis&nbsp;的最基本数据类型。可以把它理解为&nbsp;Mc&nbsp;中&nbsp;key&nbsp;对应的&nbsp;value&nbsp;类型。string&nbsp;类型是二进制安全的，即&nbsp;string&nbsp;中可以包含任何数据。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;中的普通&nbsp;string 采用&nbsp;raw encoding&nbsp;即原始编码方式，该编码方式会动态扩容，并通过提前预分配冗余空间，来减少内存频繁分配的开销。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">在字符串长度小于&nbsp;1MB&nbsp;时，按所需长度的&nbsp;2&nbsp;倍来分配，超过&nbsp;1MB，则按照每次额外增加&nbsp;1MB&nbsp;的容量来预分配。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;中的数字也存为&nbsp;string&nbsp;类型，但编码方式跟普通&nbsp;string&nbsp;不同，数字采用整型编码，字符串内容直接设为整数值的二进制字节序列。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">在存储普通字符串，序列化对象，以及计数器等场景时，都可以使用&nbsp;Redis&nbsp;的字符串类型，字符串数据类型对应使用的指令包括&nbsp;set、get、mset、incr、decr&nbsp;等。</span></p>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">list 列表</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;的&nbsp;list&nbsp;列表，是一个快速双向链表，存储了一系列的&nbsp;string&nbsp;类型的字串值。list&nbsp;中的元素按照插入顺序排列。插入元素的方式，可以通过&nbsp;lpush&nbsp;将一个或多个元素插入到列表的头部，也可以通过&nbsp;rpush&nbsp;将一个或多个元素插入到队列尾部，还可以通过&nbsp;lset、linsert&nbsp;将元素插入到指定位置或指定元素的前后。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);"><br></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);"></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">list&nbsp;列表的获取，可以通过&nbsp;lpop、rpop&nbsp;从对头或队尾弹出元素，如果队列为空，则返回&nbsp;nil。还可以通过&nbsp;Blpop、Brpop&nbsp;从队头/队尾阻塞式弹出元素，如果&nbsp;list&nbsp;列表为空，没有元素可供弹出，则持续阻塞，直到有其他&nbsp;client&nbsp;插入新的元素。这里阻塞弹出元素，可以设置过期时间，避免无限期等待。最后，list&nbsp;列表还可以通过&nbsp;LrangeR&nbsp;获取队列内指定范围内的所有元素。Redis&nbsp;中，list&nbsp;列表的偏移位置都是基于&nbsp;0&nbsp;的下标，即列表第一个元素的下标是&nbsp;0，第二个是&nbsp;1。偏移量也可以是负数，倒数第一个是&nbsp;-1，倒数第二个是&nbsp;-2，依次类推。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: center; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 16px;"><img src="http://s0.lgstatic.com/i/image2/M01/99/CE/CgoB5l2lPU6AXXYxAAA5cAa-A6U949.png" style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-align: center; white-space: normal;"></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 16px;">list&nbsp;列表，对于常规的&nbsp;pop、push&nbsp;元素，性能很高，时间复杂度为&nbsp;O(1)，因为是列表直接追加或弹出。但对于通过随机插入、随机删除，以及随机范围获取，需要轮询列表确定位置，性能就比较低下了。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">feed timeline&nbsp;存储时，由于&nbsp;feed id&nbsp;一般是递增的，可以直接存为&nbsp;list，用户发表新&nbsp;feed，就直接追加到队尾。另外消息队列、热门&nbsp;feed&nbsp;等业务场景，都可以使用&nbsp;list&nbsp;数据结构。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">操作&nbsp;list&nbsp;列表时，可以用&nbsp;lpush、lpop、rpush、rpop、lrange&nbsp;来进行常规的队列进出及范围获取操作，在某些特殊场景下，也可以用&nbsp;lset、linsert&nbsp;进行随机插入操作，用&nbsp;lrem&nbsp;进行指定元素删除操作；最后，在消息列表的消费时，还可以用&nbsp;Blpop、Brpop&nbsp;进行阻塞式获取，从而在列表暂时没有元素时，可以安静的等待新元素的插入，而不需要额外持续的查询。</span></p>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">set 集合</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">set&nbsp;是&nbsp;string&nbsp;类型的无序集合，set&nbsp;中的元素是唯一的，即&nbsp;set&nbsp;中不会出现重复的元素。Redis&nbsp;中的集合一般是通过&nbsp;dict&nbsp;哈希表实现的，所以插入、删除，以及查询元素，可以根据元素&nbsp;hash&nbsp;值直接定位，时间复杂度为&nbsp;O(1)。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);"></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">对&nbsp;set&nbsp;类型数据的操作，除了常规的添加、删除、查找元素外，还可以用以下指令对 set 进行操作。</span></p>
<ul style=" white-space: normal; text-align: justify;">
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">sismember&nbsp;指令判断该&nbsp;key&nbsp;对应的&nbsp;set&nbsp;数据结构中，是否存在某个元素，如果存在返回&nbsp;1，否则返回&nbsp;0；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">sdiff&nbsp;指令来对多个&nbsp;set&nbsp;集合执行差集；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">sinter&nbsp;指令对多个集合执行交集；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">sunion&nbsp;指令对多个集合执行并集；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">spop&nbsp;指令弹出一个随机元素；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">srandmember&nbsp;指令返回一个或多个随机元素。</span></p></li>
</ul>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);"><br></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">set&nbsp;集合的特点是查找、插入、删除特别高效，时间复杂度为&nbsp;O(1)，所以在社交系统中，可以用于存储关注的好友列表，用来判断是否关注，还可以用来做好友推荐使用。另外，还可以利用&nbsp;set&nbsp;的唯一性，来对服务的来源业务、来源&nbsp;IP&nbsp;进行精确统计。</span></p>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">sorted set 有序集合</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;中的&nbsp;sorted set&nbsp;有序集合也称为&nbsp;zset，有序集合同&nbsp;set&nbsp;集合类似，也是&nbsp;string&nbsp;类型元素的集合，且所有元素不允许重复。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">但有序集合中，每个元素都会关联一个&nbsp;double&nbsp;类型的&nbsp;score&nbsp;分数值。有序集合通过这个&nbsp;score&nbsp;值进行由小到大的排序。有序集合中，元素不允许重复，但&nbsp;score&nbsp;分数值却允许重复。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">有序集合除了常规的添加、删除、查找元素外，还可以通过以下指令对 sorted set 进行操作。</span></p>
<ul style=" white-space: normal; text-align: justify;">
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">zscan&nbsp;指令：按顺序获取有序集合中的元素；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">zscore&nbsp;指令：获取元素的&nbsp;score&nbsp;值；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">zrange指令：通过指定&nbsp;score&nbsp;</span>返回指定 score 范围内的元素；</p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">在某个元素的&nbsp;score&nbsp;值发生变更时，还可以通过&nbsp;zincrby&nbsp;指令对该元素的&nbsp;score&nbsp;值进行加减。</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">通过&nbsp;zinterstore、zunionstore&nbsp;指令对多个有序集合进行取交集和并集，然后将新的有序集合存到一个新的&nbsp;key&nbsp;中，如果有重复元素，重复元素的&nbsp;score&nbsp;进行相加，然后作为新集合中该元素的&nbsp;score&nbsp;值。</span></p></li>
</ul>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">sorted set&nbsp;有序集合的特点是：</span></p>
<ul style=" white-space: normal; text-align: justify;">
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">所有元素按&nbsp;score&nbsp;排序，而且不重复；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">查找、插入、删除非常高效，时间复杂度为&nbsp;O(1)。</span></p></li>
</ul>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">因此，可以用有序集合来统计排行榜，实时刷新榜单，还可以用来记录学生成绩，从而轻松获取某个成绩范围内的学生名单，还可以用来对系统统计增加权重值，从而在&nbsp;dashboard&nbsp;实时展示。</span></p>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">hash 哈希</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;中的哈希实际是&nbsp;field&nbsp;和&nbsp;value&nbsp;的一个映射表。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);"></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">hash&nbsp;数据结构的特点是在单个&nbsp;key&nbsp;对应的哈希结构内部，可以记录多个键值对，即&nbsp;field&nbsp;和&nbsp;value&nbsp;对，value&nbsp;可以是任何字符串。而且这些键值对查询和修改很高效。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">所以可以用&nbsp;hash&nbsp;来存储具有多个元素的复杂对象，然后分别修改或获取这些元素。hash&nbsp;结构中的一些重要指令，包括：hmset、hmget、hexists、hgetall、hincrby&nbsp;等。</span></p>
<ul style=" white-space: normal; text-align: justify;">
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">hmset 指令批量插入多个 field、value 映射；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">hmget 指令获取多个 field 对应的 value 值；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">hexists 指令判断某个 field 是否存在；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">如果 field 对应的 value 是整数，还可以用 hincrby 来对该 value 进行修改。</span></p></li>
</ul>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">bitmap 位图</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;中的&nbsp;bitmap&nbsp;位图是一串连续的二进制数字，底层实际是基于&nbsp;string&nbsp;进行封装存储的，按&nbsp;bit&nbsp;位进行指令操作的。bitmap&nbsp;中每一&nbsp;bit&nbsp;位所在的位置就是&nbsp;offset&nbsp;偏移，可以用&nbsp;setbit、bitfield 对&nbsp;bitmap&nbsp;中每个&nbsp;bit&nbsp;进行置&nbsp;0&nbsp;或置&nbsp;1&nbsp;操作，也可以用&nbsp;bitcount&nbsp;来统计&nbsp;bitmap&nbsp;中的被置&nbsp;1&nbsp;的&nbsp;bit&nbsp;数，还可以用&nbsp;bitop 来对多个&nbsp;bitmap&nbsp;进行求与、或、异或等操作。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: center; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 16px;"><img src="http://s0.lgstatic.com/i/image2/M01/99/ED/CgotOV2lPU6ALJouAAAM9y2LlI0761.png" style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-align: center; white-space: normal;"></span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="color: rgb(63, 63, 63); font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 16px;">bitmap&nbsp;位图的特点是按位设置、求与、求或等操作很高效，而且存储成本非常低，用来存对象标签属性的话，一个&nbsp;bit&nbsp;即可存一个标签。可以用&nbsp;bitmap，存用户最近&nbsp;N&nbsp;天的登录情况，每天用&nbsp;1&nbsp;bit，登录则置&nbsp;1。个性推荐在社交应用中非常重要，可以对新闻、feed&nbsp;设置一系列标签，如军事、娱乐、视频、图片、文字等，用&nbsp;bitmap&nbsp;来存储这些标签，在对应标签&nbsp;bit&nbsp;位上置&nbsp;1。对用户，也可以采用类似方式，记录用户的多种属性，并可以很方便的根据标签来进行多维度统计。bitmap&nbsp;位图的重要指令包括：setbit、&nbsp;getbit、bitcount、bitfield、&nbsp;bitop、bitpos&nbsp;等。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">在移动社交时代，LBS&nbsp;应用越来越多，比如微信、陌陌中附近的人，美团、大众点评中附近的美食、电影院，滴滴、优步中附近的专车等。要实现这些功能，就得使用地理位置信息进行搜索。地球的地理位置是使用二维的经纬度进行表示的，我们只要确定一个点的经纬度，就可以确认它在地球的位置。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;在&nbsp;3.2 版本之后增加了对 GEO&nbsp;地理位置的处理功能。Redis&nbsp;的&nbsp;GEO&nbsp;地理位置本质上是基于&nbsp;sorted set&nbsp;封装实现的。在存储分类&nbsp;key&nbsp;下的地理位置信息时，需要对该分类&nbsp;key&nbsp;构建一个&nbsp;sorted set&nbsp;作为内部存储结构，用于存储一系列位置点。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">在存储某个位置点时，首先利用&nbsp;Geohash&nbsp;算法，将该位置二维的经纬度，映射编码成一维的&nbsp;52&nbsp;位整数值，将位置名称、经纬度编码&nbsp;score&nbsp;作为键值对，存储到分类&nbsp;key&nbsp;对应的&nbsp;sorted set&nbsp;中。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">需要计算某个位置点&nbsp;A&nbsp;附近的人时，首先以指定位置&nbsp;A&nbsp;为中心点，以距离作为半径，算出&nbsp;GEO&nbsp;哈希&nbsp;8&nbsp;个方位的范围，&nbsp;然后依次轮询方位范围内的所有位置点，只要这些位置点到中心位置&nbsp;A&nbsp;的距离在要求距离范围内，就是目标位置点。轮询完所有范围内的位置点后，重新排序即得到位置点&nbsp;A&nbsp;附近的所有目标。</span></p>
<ul style=" white-space: normal; text-align: justify;">
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">使用&nbsp;geoadd，将位置名称（如人、车辆、店名）与对应的地理位置信息添加到指定的位置分类&nbsp;key&nbsp;中；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">使用&nbsp;geopos&nbsp;方便地查询某个名称所在的位置信息；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">使用&nbsp;georadius&nbsp;获取指定位置附近，不超过指定距离的所有元素；</span></p></li>
 <li><p style="line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">使用&nbsp;geodist&nbsp;来获取指定的两个位置之间的距离。</span></p></li>
</ul>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">这样，是不是就可以实现，找到附近的餐厅，算出当前位置到对应餐厅的距离，这样的功能了？</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;GEO&nbsp;地理位置，利用 Geohash 将大量的二维经纬度转一维的整数值，这样可以方便的对地理位置进行查询、距离测量、范围搜索。但由于地理位置点非常多，一个地理分类&nbsp;key&nbsp;下可能会有大量元素，在&nbsp;GEO&nbsp;设计时，需要提前进行规划，避免单&nbsp;key&nbsp;过度膨胀。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;的&nbsp;GEO&nbsp;地理位置数据结构，应用场景很多，比如查询某个地方的具体位置，查当前位置到目的地的距离，查附近的人、餐厅、电影院等。GEO&nbsp;地理位置数据结构中，重要指令包括&nbsp;geoadd、geopos、geodist、georadius、georadiusbymember&nbsp;等。</span></p>
<h2 style="white-space: normal; text-align: justify;"></h2>
<h6 style="white-space: normal; line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">hyperLogLog 基数统计</span></h6>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;的&nbsp;hyperLogLog&nbsp;是用来做基数统计的数据类型，当输入巨大数量的元素做统计时，只需要很小的内存即可完成。HyperLogLog 不保存元数据，只记录待统计元素的估算数量，这个估算数量是一个带有&nbsp;0.81%&nbsp;标准差的近似值，在大多数业务场景，对海量数据，不足&nbsp;1%&nbsp;的误差是可以接受的。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">Redis&nbsp;的&nbsp;HyperLogLog&nbsp;在统计时，如果计数数量不大，采用稀疏矩阵存储，随着计数的增加，稀疏矩阵占用的空间也会逐渐增加，当超过阀值后，则改为稠密矩阵，稠密矩阵占用的空间是固定的，约为12KB字节。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">通过&nbsp;hyperLoglog&nbsp;数据类型，你可以利用&nbsp;pfadd&nbsp;向基数统计中增加新的元素，可以用&nbsp;pfcount&nbsp;获得&nbsp;hyperLogLog&nbsp;结构中存储的近似基数数量，还可以用&nbsp;hypermerge&nbsp;将多个&nbsp;hyperLogLog&nbsp;合并为一个&nbsp;hyperLogLog&nbsp;结构，从而可以方便的获取合并后的基数数量。</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">&nbsp;</span></p>
<p style="margin-top: 0pt; margin-bottom: 0pt; white-space: normal; text-align: justify; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; color: rgb(63, 63, 63);">hyperLogLog&nbsp;的特点是统计过程不记录独立元素，占用内存非常少，非常适合统计海量数据。在大中型系统中，统计每日、每月的&nbsp;UV&nbsp;即独立访客数，或者统计海量用户搜索的独立词条数，都可以用&nbsp;hyperLogLog&nbsp;数据类型来进行处理。</span></p>
<p style="margin-bottom: 0pt; margin-top: 0pt; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><br></p>
<p style="margin-bottom: 0pt; margin-top: 0pt; font-size: 11pt; color: rgb(73, 73, 73); line-height: 1.75em;"><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; font-size: 16px; color: rgb(63, 63, 63);">OK，这节课就讲到这里啦，下一课时我将分享“<span style="font-size: 16px; font-family: 微软雅黑, &quot;Microsoft YaHei&quot;;">Redis 协议分析</span>”，记得按时来听课哈。好，下节课见，拜拜！</span></p>
<p><br></p>

---

### 精选评论

##### **春：
> redis各个数据结构的使用场景:1、string 字符串: 在存储普通字符串,序列化对象,以及计数器等场景时,都可以使用 Redis 的字符串类型。2、list 列表: feed timeline 存储时,由于 feed id 一般是递增的,可以直接存为 list,用户发表新 feed,就直接追加到队尾。另外消息队列、热门 feed 等业务场景,都可以使用 list 数据结构。3、set 集合: 在社交系统中,可以用于存储关注的好友列表,用来判断是否关注,还可以用来做好友推荐使用。另外,还可以利用 set 的唯一性,来对服务的来源业务、来源 IP进行精确统计。4、sorted set 有序集合: 统计排行榜,实时刷新榜单,还可以用来记录学生成绩,从而轻松获取某个成绩范围内的学生名单,还可以用来对系统统计增加权重值,从而在 dashboard 实时展示。5、hash 哈希: 可以用 hash 来存储具有多个元素的复杂对象,然后分别修改或获取这些元素6、bitmap 位图: 用来存对象标签属性的话,一个 bit即可存一个标签。可以用 bitmap,存用户最近 N 天的登录情况,每天用 1 bit,登录则置 1。个性推荐在社交应用中非常重要,可以对新闻、feed 设置一系列标签,如军事、娱乐、视频、图片、文字等,用 bitmap 来存储这些标签,在对应标签 bit 位上置 1。对用户,也可以采用类似方式,记录用户的多种属性,并可以很方便的根据标签来进行多维度统计。7、geo 地理位置类型: 查询某个地方的具体位置,查当前位置到目的地的距离,查附近的人、餐厅、电影院等。8、hyperLogLog 基数统计: 适合统计海量数据。在大中型系统中,统计每日、每月的 UV 即独立访客数,或者统计海量用户搜索的独立词条数,都可以用 hyperLogLog 数据类型来进行处理.

##### **生：
> 老师好，想请教一个问题，我现在有一个列表的需求，我用zset有序集合存储和获取到列表的ID，当分布查询时，根据PageIndex和PageSize获取到zset里面的id集合，然后根据这一批id集合，再获取数据内容的集合，但现在发现用mget命令获取的id集合的数据内容时，如果id集合的内容恰好被分在多个不同集群中，那么tp99的耗时会非常高，然后我就分2步走，先拿到zset中的id集合后，再在java程序中起多线程，每个线程单独根据id去redis中用get命令取其对应的数据内容，我查了单个get命令的性能确实比mget要高，但如果pageSize比较大，例如是20的情况下，则需要起20个线程去取数据，导致tomcat服务器cpu非常高，而且访问量一大，20个线程会出现在线程池队列中排队的情况，最终总体程序的耗时也不是特别快，想请教老师要怎么解决比较好，谢谢！


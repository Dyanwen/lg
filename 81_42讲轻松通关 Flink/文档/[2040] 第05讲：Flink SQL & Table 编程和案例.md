<p data-nodeid="2417" class="">æˆ‘ä»¬åœ¨ç¬¬ 02 è¯¾æ—¶ä¸­ä½¿ç”¨ Flink Table &amp; SQL çš„ API å®ç°äº†æœ€ç®€å•çš„ WordCount ç¨‹åºã€‚åœ¨è¿™ä¸€è¯¾æ—¶ä¸­ï¼Œå°†åˆ†åˆ«ä» Flink Table &amp; SQL çš„èƒŒæ™¯å’Œç¼–ç¨‹æ¨¡å‹ã€å¸¸è§çš„ APIã€ç®—å­å’Œå†…ç½®å‡½æ•°ç­‰å¯¹ Flink Table &amp; SQL åšä¸€ä¸ªè¯¦ç»†çš„è®²è§£å’Œæ¦‚æ‹¬ï¼Œæœ€åæ¨¡æ‹Ÿäº†ä¸€ä¸ªå®é™…ä¸šåŠ¡åœºæ™¯ä½¿ç”¨ Flink Table &amp; SQL å¼€å‘ã€‚</p>
<h3 data-nodeid="2418">Flink Table &amp; SQL æ¦‚è¿°</h3>
<h4 data-nodeid="2419">èƒŒæ™¯</h4>
<p data-nodeid="2420">æˆ‘ä»¬åœ¨å‰é¢çš„è¯¾æ—¶ä¸­è®²è¿‡ Flink çš„åˆ†å±‚æ¨¡å‹ï¼ŒFlink è‡ªèº«æä¾›äº†ä¸åŒçº§åˆ«çš„æŠ½è±¡æ¥æ”¯æŒæˆ‘ä»¬å¼€å‘æµå¼æˆ–è€…æ‰¹é‡å¤„ç†ç¨‹åºï¼Œä¸‹å›¾æè¿°äº† Flink æ”¯æŒçš„ 4 ç§ä¸åŒçº§åˆ«çš„æŠ½è±¡ã€‚</p>
<p data-nodeid="2421"><img src="https://s0.lgstatic.com/i/image3/M01/16/F1/Ciqah16mnASAOZj0AACsqOUWhS0726.png" alt="image.png" data-nodeid="2542"></p>
<p data-nodeid="2422"><strong data-nodeid="2551">Table API</strong> å’Œ <strong data-nodeid="2552">SQL</strong> å¤„äºæœ€é¡¶ç«¯ï¼Œæ˜¯ Flink æä¾›çš„é«˜çº§ API æ“ä½œã€‚Flink SQL æ˜¯ Flink å®æ—¶è®¡ç®—ä¸ºç®€åŒ–è®¡ç®—æ¨¡å‹ï¼Œé™ä½ç”¨æˆ·ä½¿ç”¨å®æ—¶è®¡ç®—é—¨æ§›è€Œè®¾è®¡çš„ä¸€å¥—ç¬¦åˆæ ‡å‡† SQL è¯­ä¹‰çš„å¼€å‘è¯­è¨€ã€‚</p>
<p data-nodeid="2423">æˆ‘ä»¬åœ¨ç¬¬ 04 è¯¾æ—¶ä¸­æåˆ°è¿‡ï¼ŒFlink åœ¨ç¼–ç¨‹æ¨¡å‹ä¸Šæä¾›äº† DataStream å’Œ DataSet ä¸¤å¥— APIï¼Œå¹¶æ²¡æœ‰åšåˆ°äº‹å®ä¸Šçš„æ‰¹æµç»Ÿä¸€ï¼Œå› ä¸ºç”¨æˆ·å’Œå¼€å‘è€…è¿˜æ˜¯å¼€å‘äº†ä¸¤å¥—ä»£ç ã€‚æ­£æ˜¯å› ä¸º Flink Table &amp; SQL çš„åŠ å…¥ï¼Œå¯ä»¥è¯´ Flink åœ¨æŸç§ç¨‹åº¦ä¸Šåšåˆ°äº†äº‹å®ä¸Šçš„æ‰¹æµä¸€ä½“ã€‚</p>
<h4 data-nodeid="2424">åŸç†</h4>
<p data-nodeid="2425">ä½ ä¹‹å‰å¯èƒ½éƒ½äº†è§£è¿‡ Hiveï¼Œåœ¨ç¦»çº¿è®¡ç®—åœºæ™¯ä¸‹ Hive å‡ ä¹æ‰›èµ·äº†ç¦»çº¿æ•°æ®å¤„ç†çš„åŠå£æ±Ÿå±±ã€‚å®ƒçš„åº•å±‚å¯¹ SQL çš„è§£æç”¨åˆ°äº† Apache Calciteï¼ŒFlink åŒæ ·æŠŠ SQL çš„è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œæ•™ç»™äº† Calciteã€‚</p>
<p data-nodeid="2426">ä¸‹å›¾æ˜¯ä¸€å¼ ç»å…¸çš„ Flink Table &amp; SQL å®ç°åŸç†å›¾ï¼Œå¯ä»¥çœ‹åˆ° Calcite åœ¨æ•´ä¸ªæ¶æ„ä¸­å¤„äºç»å¯¹æ ¸å¿ƒåœ°ä½ã€‚</p>
<p data-nodeid="2427"><img src="https://s0.lgstatic.com/i/image3/M01/16/F1/Ciqah16mnGWASOD-AAJ7jTakc-4812.png" alt="image (1).png" data-nodeid="2563"><br>
ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯æ‰¹æŸ¥è¯¢ SQL è¿˜æ˜¯æµå¼æŸ¥è¯¢ SQLï¼Œéƒ½ä¼šç»è¿‡å¯¹åº”çš„è½¬æ¢å™¨ Parser è½¬æ¢æˆä¸ºèŠ‚ç‚¹æ ‘ SQLNode treeï¼Œç„¶åç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’ Logical Planï¼Œé€»è¾‘æ‰§è¡Œè®¡åˆ’åœ¨ç»è¿‡ä¼˜åŒ–åç”ŸæˆçœŸæ­£å¯ä»¥æ‰§è¡Œçš„ç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼Œäº¤ç»™ DataSet æˆ–è€… DataStream çš„ API å»æ‰§è¡Œã€‚</p>
<p data-nodeid="2428">åœ¨è¿™é‡Œæˆ‘ä»¬ä¸å¯¹ Calcite çš„åŸç†è¿‡åº¦å±•å¼€ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç›´æ¥åœ¨å®˜ç½‘ä¸Šå­¦ä¹ ã€‚</p>
<p data-nodeid="2429">ä¸€ä¸ªå®Œæ•´çš„ Flink Table &amp; SQL Job ä¹Ÿæ˜¯ç”± Sourceã€Transformationã€Sink æ„æˆï¼š</p>
<p data-nodeid="2430"><img src="https://s0.lgstatic.com/i/image3/M01/16/F1/Ciqah16mnHiAa99JAAFeAnFYzIE146.png" alt="image (2).png" data-nodeid="2572"></p>
<ul data-nodeid="2431">
<li data-nodeid="2432">
<p data-nodeid="2433"><strong data-nodeid="2577">Source éƒ¨åˆ†</strong>æ¥æºäºå¤–éƒ¨æ•°æ®æºï¼Œæˆ‘ä»¬ç»å¸¸ç”¨çš„æœ‰ Kafkaã€MySQL ç­‰ï¼›</p>
</li>
<li data-nodeid="2434">
<p data-nodeid="2435"><strong data-nodeid="2584">Transformation éƒ¨åˆ†</strong>åˆ™æ˜¯ Flink Table &amp; SQL æ”¯æŒçš„å¸¸ç”¨ SQL ç®—å­ï¼Œæ¯”å¦‚ç®€å•çš„ Selectã€Groupby ç­‰ï¼Œå½“ç„¶åœ¨è¿™é‡Œä¹Ÿæœ‰æ›´ä¸ºå¤æ‚çš„å¤šæµ Joinã€æµä¸ç»´è¡¨çš„ Join ç­‰ï¼›</p>
</li>
<li data-nodeid="2436">
<p data-nodeid="2437"><strong data-nodeid="2589">Sink éƒ¨åˆ†</strong>æ˜¯æŒ‡çš„ç»“æœå­˜å‚¨æ¯”å¦‚ MySQLã€HBase æˆ– Kakfa ç­‰ã€‚</p>
</li>
</ul>
<h4 data-nodeid="2438">åŠ¨æ€è¡¨</h4>
<p data-nodeid="2439">ä¸ä¼ ç»Ÿçš„è¡¨ SQL æŸ¥è¯¢ç›¸æ¯”ï¼ŒFlink Table &amp; SQL åœ¨å¤„ç†æµæ•°æ®æ—¶ä¼šæ—¶æ—¶åˆ»åˆ»å¤„äºåŠ¨æ€çš„æ•°æ®å˜åŒ–ä¸­ï¼Œæ‰€ä»¥ä¾¿æœ‰äº†ä¸€ä¸ª<strong data-nodeid="2598">åŠ¨æ€è¡¨</strong>çš„æ¦‚å¿µã€‚</p>
<p data-nodeid="2440">åŠ¨æ€è¡¨çš„æŸ¥è¯¢ä¸é™æ€è¡¨ä¸€æ ·ï¼Œä½†æ˜¯ï¼Œåœ¨æŸ¥è¯¢åŠ¨æ€è¡¨çš„æ—¶å€™ï¼ŒSQL ä¼šåšè¿ç»­æŸ¥è¯¢ï¼Œä¸ä¼šç»ˆæ­¢ã€‚</p>
<p data-nodeid="2441">æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼ŒFlink ç¨‹åºæ¥å—ä¸€ä¸ª Kafka æµä½œä¸ºè¾“å…¥ï¼ŒKafka ä¸­ä¸ºç”¨æˆ·çš„è´­ä¹°è®°å½•ï¼š</p>
<p data-nodeid="2442"><img src="https://s0.lgstatic.com/i/image3/M01/16/F2/Ciqah16mnKaASUgqAAHL5tHLarA558.png" alt="image (3).png" data-nodeid="2603"></p>
<p data-nodeid="2443">é¦–å…ˆï¼ŒKafka çš„æ¶ˆæ¯ä¼šè¢«æºæºä¸æ–­çš„è§£ææˆä¸€å¼ ä¸æ–­å¢é•¿çš„åŠ¨æ€è¡¨ï¼Œæˆ‘ä»¬åœ¨åŠ¨æ€è¡¨ä¸Šæ‰§è¡Œçš„ SQL ä¼šä¸æ–­ç”Ÿæˆæ–°çš„åŠ¨æ€è¡¨ä½œä¸ºç»“æœè¡¨ã€‚</p>
<h3 data-nodeid="2444">Flink Table &amp; SQL ç®—å­å’Œå†…ç½®å‡½æ•°</h3>
<p data-nodeid="2445">æˆ‘ä»¬åœ¨è®²è§£ Flink Table &amp; SQL æ‰€æ”¯æŒçš„å¸¸ç”¨ç®—å­å‰ï¼Œéœ€è¦è¯´æ˜ä¸€ç‚¹ï¼ŒFlink è‡ªä» 0.9 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Table &amp; SQL åŠŸèƒ½ä¸€ç›´å¤„äºå®Œå–„å¼€å‘ä¸­ï¼Œä¸”åœ¨ä¸æ–­è¿›è¡Œè¿­ä»£ã€‚</p>
<p data-nodeid="2446">æˆ‘ä»¬åœ¨å®˜ç½‘ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™æ ·çš„æç¤ºï¼š</p>
<blockquote data-nodeid="2447">
<p data-nodeid="2448">Please note that the Table API and SQL are not yet feature complete and are being actively developed. Not all operations are supported by every combination of [Table API, SQL] and [stream, batch] input.</p>
</blockquote>
<p data-nodeid="2449">Flink Table &amp; SQL çš„å¼€å‘ä¸€ç›´åœ¨è¿›è¡Œä¸­ï¼Œå¹¶æ²¡æœ‰æ”¯æŒæ‰€æœ‰åœºæ™¯ä¸‹çš„è®¡ç®—é€»è¾‘ã€‚ä»æˆ‘ä¸ªäººå®è·µè§’åº¦æ¥è®²ï¼Œåœ¨ä½¿ç”¨åŸç”Ÿçš„ Flink Table &amp; SQL æ—¶ï¼ŒåŠ¡å¿…æŸ¥è¯¢å®˜ç½‘å½“å‰ç‰ˆæœ¬å¯¹ Table &amp; SQL çš„æ”¯æŒç¨‹åº¦ï¼Œå°½é‡é€‰æ‹©åœºæ™¯æ˜ç¡®ï¼Œé€»è¾‘ä¸æ˜¯æå…¶å¤æ‚çš„åœºæ™¯ã€‚</p>
<h4 data-nodeid="2450">å¸¸ç”¨ç®—å­</h4>
<p data-nodeid="2451">ç›®å‰ Flink SQL æ”¯æŒçš„è¯­æ³•ä¸»è¦å¦‚ä¸‹ï¼š</p>
<pre class="lang-SQL" data-nodeid="2452"><code data-language="SQL">query:
  <span class="hljs-keyword">values</span>
  | {
      <span class="hljs-keyword">select</span>
      | selectWithoutFrom
      | <span class="hljs-keyword">query</span> <span class="hljs-keyword">UNION</span> [ <span class="hljs-keyword">ALL</span> ] <span class="hljs-keyword">query</span>
      | <span class="hljs-keyword">query</span> <span class="hljs-keyword">EXCEPT</span> <span class="hljs-keyword">query</span>
      | <span class="hljs-keyword">query</span> <span class="hljs-keyword">INTERSECT</span> <span class="hljs-keyword">query</span>
    }
    [ <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> orderItem [, orderItem ]* ]
    [ <span class="hljs-keyword">LIMIT</span> { <span class="hljs-keyword">count</span> | <span class="hljs-keyword">ALL</span> } ]
    [ <span class="hljs-keyword">OFFSET</span> <span class="hljs-keyword">start</span> { <span class="hljs-keyword">ROW</span> | <span class="hljs-keyword">ROWS</span> } ]
    [ <span class="hljs-keyword">FETCH</span> { <span class="hljs-keyword">FIRST</span> | <span class="hljs-keyword">NEXT</span> } [ <span class="hljs-keyword">count</span> ] { <span class="hljs-keyword">ROW</span> | <span class="hljs-keyword">ROWS</span> } <span class="hljs-keyword">ONLY</span>]

orderItem:
  expression [ <span class="hljs-keyword">ASC</span> | <span class="hljs-keyword">DESC</span> ]

<span class="hljs-keyword">select</span>:
  <span class="hljs-keyword">SELECT</span> [ <span class="hljs-keyword">ALL</span> | <span class="hljs-keyword">DISTINCT</span> ]
  { * | projectItem [, projectItem ]* }
  <span class="hljs-keyword">FROM</span> tableExpression
  [ <span class="hljs-keyword">WHERE</span> booleanExpression ]
  [ <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> { groupItem [, groupItem ]* } ]
  [ <span class="hljs-keyword">HAVING</span> booleanExpression ]
  [ <span class="hljs-keyword">WINDOW</span> windowName <span class="hljs-keyword">AS</span> windowSpec [, windowName <span class="hljs-keyword">AS</span> windowSpec ]* ]

selectWithoutFrom:
  <span class="hljs-keyword">SELECT</span> [ <span class="hljs-keyword">ALL</span> | <span class="hljs-keyword">DISTINCT</span> ]
  { * | projectItem [, projectItem ]* }

projectItem:
  expression [ [ <span class="hljs-keyword">AS</span> ] columnAlias ]
  | tableAlias . *

tableExpression:
  tableReference [, tableReference ]*
  | tableExpression [ <span class="hljs-keyword">NATURAL</span> ] [ <span class="hljs-keyword">LEFT</span> | <span class="hljs-keyword">RIGHT</span> | <span class="hljs-keyword">FULL</span> ] <span class="hljs-keyword">JOIN</span> tableExpression [ joinCondition ]

joinCondition:
  <span class="hljs-keyword">ON</span> booleanExpression
  | <span class="hljs-keyword">USING</span> <span class="hljs-string">'('</span> <span class="hljs-keyword">column</span> [, <span class="hljs-keyword">column</span> ]* <span class="hljs-string">')'</span>

tableReference:
  tablePrimary
  [ matchRecognize ]
  [ [ <span class="hljs-keyword">AS</span> ] <span class="hljs-keyword">alias</span> [ <span class="hljs-string">'('</span> columnAlias [, columnAlias ]* <span class="hljs-string">')'</span> ] ]

tablePrimary:
  [ <span class="hljs-keyword">TABLE</span> ] [ [ catalogName . ] schemaName . ] tableName
  | <span class="hljs-keyword">LATERAL</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">'('</span> functionName <span class="hljs-string">'('</span> expression [, expression ]* <span class="hljs-string">')'</span> <span class="hljs-string">')'</span>
  | <span class="hljs-keyword">UNNEST</span> <span class="hljs-string">'('</span> expression <span class="hljs-string">')'</span>

<span class="hljs-keyword">values</span>:
  <span class="hljs-keyword">VALUES</span> expression [, expression ]*

groupItem:
  expression
  | <span class="hljs-string">'('</span> <span class="hljs-string">')'</span>
  | <span class="hljs-string">'('</span> expression [, expression ]* <span class="hljs-string">')'</span>
  | <span class="hljs-keyword">CUBE</span> <span class="hljs-string">'('</span> expression [, expression ]* <span class="hljs-string">')'</span>
  | <span class="hljs-keyword">ROLLUP</span> <span class="hljs-string">'('</span> expression [, expression ]* <span class="hljs-string">')'</span>
  | <span class="hljs-keyword">GROUPING</span> <span class="hljs-keyword">SETS</span> <span class="hljs-string">'('</span> groupItem [, groupItem ]* <span class="hljs-string">')'</span>

windowRef:
    windowName
  | windowSpec

windowSpec:
    [ windowName ]
    <span class="hljs-string">'('</span>
    [ <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> orderItem [, orderItem ]* ]
    [ <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> expression [, expression ]* ]
    [
        <span class="hljs-keyword">RANGE</span> numericOrIntervalExpression {<span class="hljs-keyword">PRECEDING</span>}
      | <span class="hljs-keyword">ROWS</span> numericExpression {<span class="hljs-keyword">PRECEDING</span>}
    ]
    <span class="hljs-string">')'</span>
...
</code></pre>
<p data-nodeid="2453">å¯ä»¥çœ‹åˆ° Flink SQL å’Œä¼ ç»Ÿçš„ SQL ä¸€æ ·ï¼Œæ”¯æŒäº†åŒ…å«æŸ¥è¯¢ã€è¿æ¥ã€èšåˆç­‰åœºæ™¯ï¼Œå¦å¤–è¿˜æ”¯æŒäº†åŒ…æ‹¬çª—å£ã€æ’åºç­‰åœºæ™¯ã€‚ä¸‹é¢æˆ‘å°±ä»¥æœ€å¸¸ç”¨çš„ç®—å­æ¥åšè¯¦ç»†çš„è®²è§£ã€‚</p>
<p data-nodeid="2454"><strong data-nodeid="2636">SELECT/AS/WHERE</strong></p>
<p data-nodeid="2455">SELECTã€WHERE å’Œä¼ ç»Ÿ SQL ç”¨æ³•ä¸€æ ·ï¼Œç”¨äºç­›é€‰å’Œè¿‡æ»¤æ•°æ®ï¼ŒåŒæ—¶é€‚ç”¨äº DataStream å’Œ DataSetã€‚</p>
<pre class="lang-SQL" data-nodeid="2456"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>ï¼Œage <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span>;
</code></pre>
<p data-nodeid="2457">å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ WHERE æ¡ä»¶ä¸­ä½¿ç”¨ =ã€&lt;ã€&gt;ã€&lt;&gt;ã€&gt;=ã€&lt;=ï¼Œä»¥åŠ ANDã€OR ç­‰è¡¨è¾¾å¼çš„ç»„åˆï¼š</p>
<pre class="lang-SQL" data-nodeid="2458"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>ï¼Œage <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%å°æ˜%'</span>;
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span> <span class="hljs-keyword">WHERE</span> age = <span class="hljs-number">20</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>, age
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> Table2)
</code></pre>
<p data-nodeid="2459"><strong data-nodeid="2648">GROUP BY / DISTINCT/HAVING</strong></p>
<p data-nodeid="2460">GROUP BY ç”¨äºè¿›è¡Œåˆ†ç»„æ“ä½œï¼ŒDISTINCT ç”¨äºç»“æœå»é‡ã€‚<br>
HAVING å’Œä¼ ç»Ÿ SQL ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥åœ¨èšåˆå‡½æ•°ä¹‹åè¿›è¡Œç­›é€‰ã€‚</p>
<pre class="lang-SQL" data-nodeid="2461"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>, <span class="hljs-keyword">SUM</span>(score) <span class="hljs-keyword">as</span> TotalScore <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>, <span class="hljs-keyword">SUM</span>(score) <span class="hljs-keyword">as</span> TotalScore <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Table</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">HAVING</span>
<span class="hljs-keyword">SUM</span>(score) &gt; <span class="hljs-number">300</span>;
</code></pre>
<p data-nodeid="2462"><strong data-nodeid="2655">JOIN</strong></p>
<p data-nodeid="2463">JOIN å¯ä»¥ç”¨äºæŠŠæ¥è‡ªä¸¤ä¸ªè¡¨çš„æ•°æ®è”åˆèµ·æ¥å½¢æˆç»“æœè¡¨ï¼Œç›®å‰ Flink çš„ Join åªæ”¯æŒç­‰å€¼è¿æ¥ã€‚Flink æ”¯æŒçš„ JOIN ç±»å‹åŒ…æ‹¬ï¼š</p>
<pre class="lang-SQL" data-nodeid="2464"><code data-language="SQL">JOIN - INNER JOIN
LEFT JOIN - LEFT OUTER JOIN
RIGHT JOIN - RIGHT OUTER JOIN
FULL JOIN - FULL OUTER JOIN
</code></pre>
<p data-nodeid="2465">ä¾‹å¦‚ï¼Œç”¨ç”¨æˆ·è¡¨å’Œå•†å“è¡¨è¿›è¡Œå…³è”ï¼š</p>
<pre class="lang-SQL" data-nodeid="2466"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">User</span> <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Product <span class="hljs-keyword">ON</span> User.name = Product.buyer

<span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">User</span> <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> Product <span class="hljs-keyword">ON</span> User.name = Product.buyer

<span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">User</span> <span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> Product <span class="hljs-keyword">ON</span> User.name = Product.buyer
</code></pre>
<p data-nodeid="2467">LEFT JOINã€RIGHT JOIN ã€FULL JOIN ç›¸ä¸æˆ‘ä»¬ä¼ ç»Ÿ SQL ä¸­å«ä¹‰ä¸€æ ·ã€‚</p>
<p data-nodeid="2468"><strong data-nodeid="2662">WINDOW</strong></p>
<p data-nodeid="2469">æ ¹æ®çª—å£æ•°æ®åˆ’åˆ†çš„ä¸åŒï¼Œç›®å‰ Apache Flink æœ‰å¦‚ä¸‹ 3 ç§ï¼š</p>
<ul data-nodeid="2470">
<li data-nodeid="2471">
<p data-nodeid="2472"><strong data-nodeid="2668">æ»šåŠ¨çª—å£</strong>ï¼Œçª—å£æ•°æ®æœ‰å›ºå®šçš„å¤§å°ï¼Œçª—å£ä¸­çš„æ•°æ®ä¸ä¼šå åŠ ï¼›</p>
</li>
<li data-nodeid="2473">
<p data-nodeid="2474"><strong data-nodeid="2673">æ»‘åŠ¨çª—å£</strong>ï¼Œçª—å£æ•°æ®æœ‰å›ºå®šå¤§å°ï¼Œå¹¶ä¸”æœ‰ç”Ÿæˆé—´éš”ï¼›</p>
</li>
<li data-nodeid="2475">
<p data-nodeid="2476"><strong data-nodeid="2678">ä¼šè¯çª—å£</strong>ï¼Œçª—å£æ•°æ®æ²¡æœ‰å›ºå®šçš„å¤§å°ï¼Œæ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°è¿›è¡Œåˆ’åˆ†ï¼Œçª—å£æ•°æ®æ— å åŠ ï¼›</p>
</li>
</ul>
<p data-nodeid="2477"><strong data-nodeid="2682">æ»šåŠ¨çª—å£</strong></p>
<p data-nodeid="2478">æ»šåŠ¨çª—å£çš„ç‰¹ç‚¹æ˜¯ï¼šæœ‰å›ºå®šå¤§å°ã€çª—å£ä¸­çš„æ•°æ®ä¸ä¼šé‡å ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://s0.lgstatic.com/i/image3/M01/16/F3/Ciqah16mnZSAP4G5AAEyag8FwPM908.png" alt="image (4).png" data-nodeid="2687"></p>
<p data-nodeid="2479">æ»šåŠ¨çª—å£çš„è¯­æ³•ï¼š</p>
<pre class="lang-SQL" data-nodeid="2480"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> 
    [gk],
    [TUMBLE_START(timeCol, <span class="hljs-keyword">size</span>)], 
    [TUMBLE_END(timeCol, <span class="hljs-keyword">size</span>)], 
    agg1(col1), 
    ... 
    aggn(colN)
<span class="hljs-keyword">FROM</span> Tab1
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> [gk], TUMBLE(timeCol, <span class="hljs-keyword">size</span>)
</code></pre>
<p data-nodeid="2481">ä¸¾ä¾‹è¯´æ˜ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªç”¨æˆ·æ¯å¤©çš„è®¢å•æ•°é‡ï¼š</p>
<pre class="lang-SQL" data-nodeid="2482"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, TUMBLE_START(timeLine, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">DAY</span>) <span class="hljs-keyword">as</span> winStart, <span class="hljs-keyword">SUM</span>(amount) <span class="hljs-keyword">FROM</span> Orders <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> TUMBLE(timeLine, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">DAY</span>), <span class="hljs-keyword">user</span>;
</code></pre>
<p data-nodeid="2483">å…¶ä¸­ï¼ŒTUMBLE_START å’Œ TUMBLE_END ä»£è¡¨çª—å£çš„å¼€å§‹æ—¶é—´å’Œçª—å£çš„ç»“æŸæ—¶é—´ï¼ŒTUMBLE (timeLine, INTERVAL '1' DAY) ä¸­çš„ timeLine ä»£è¡¨æ—¶é—´å­—æ®µæ‰€åœ¨çš„åˆ—ï¼ŒINTERVAL '1' DAY è¡¨ç¤ºæ—¶é—´é—´éš”ä¸ºä¸€å¤©ã€‚</p>
<p data-nodeid="2484"><strong data-nodeid="2706">æ»‘åŠ¨çª—å£</strong></p>
<p data-nodeid="2485">æ»‘åŠ¨çª—å£æœ‰å›ºå®šçš„å¤§å°ï¼Œä¸æ»šåŠ¨çª—å£ä¸åŒçš„æ˜¯æ»‘åŠ¨çª—å£å¯ä»¥é€šè¿‡ slide å‚æ•°æ§åˆ¶æ»‘åŠ¨çª—å£çš„åˆ›å»ºé¢‘ç‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šä¸ªæ»‘åŠ¨çª—å£å¯èƒ½ä¼šå‘ç”Ÿæ•°æ®é‡å ï¼Œå…·ä½“è¯­ä¹‰å¦‚ä¸‹ï¼š</p>
<p data-nodeid="2486"><img src="https://s0.lgstatic.com/i/image3/M01/09/C4/CgoCgV6mnceAEzZNAAEs6POgpPQ859.png" alt="image (5).png" data-nodeid="2710"></p>
<p data-nodeid="2487">æ»‘åŠ¨çª—å£çš„è¯­æ³•ä¸æ»šåŠ¨çª—å£ç›¸æ¯”ï¼Œåªå¤šäº†ä¸€ä¸ª slide å‚æ•°ï¼š</p>
<pre class="lang-SQL" data-nodeid="2488"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> 
    [gk], 
    [HOP_START(timeCol, slide, <span class="hljs-keyword">size</span>)] ,
    [HOP_END(timeCol, slide, <span class="hljs-keyword">size</span>)],
    agg1(col1), 
    ... 
    aggN(colN) 
<span class="hljs-keyword">FROM</span> Tab1
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> [gk], HOP(timeCol, slide, <span class="hljs-keyword">size</span>)
</code></pre>
<p data-nodeid="2489">ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ¯é—´éš”ä¸€å°æ—¶è®¡ç®—ä¸€æ¬¡è¿‡å» 24 å°æ—¶å†…æ¯ä¸ªå•†å“çš„é”€é‡ï¼š</p>
<pre class="lang-SQL" data-nodeid="2490"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> product, <span class="hljs-keyword">SUM</span>(amount) <span class="hljs-keyword">FROM</span> Orders <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> HOP(rowtime, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">HOUR</span>, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">DAY</span>), product
</code></pre>
<p data-nodeid="2491">ä¸Šè¿°æ¡ˆä¾‹ä¸­çš„ INTERVAL '1' HOUR ä»£è¡¨æ»‘åŠ¨çª—å£ç”Ÿæˆçš„æ—¶é—´é—´éš”ã€‚</p>
<p data-nodeid="2492"><strong data-nodeid="2721">ä¼šè¯çª—å£</strong></p>
<p data-nodeid="2493">ä¼šè¯çª—å£å®šä¹‰äº†ä¸€ä¸ªéæ´»åŠ¨æ—¶é—´ï¼Œå‡å¦‚åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…æ²¡æœ‰å‡ºç°äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™ä¼šè¯çª—å£å…³é—­ã€‚</p>
<p data-nodeid="2494"><img src="https://s0.lgstatic.com/i/image3/M01/09/C4/CgoCgV6mngCAVToGAAEyMz6pyiE117.png" alt="image (6).png" data-nodeid="2725"><br>
ä¼šè¯çª—å£çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre class="lang-SQL" data-nodeid="2495"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> 
    [gk], 
    SESSION_START(timeCol, gap) <span class="hljs-keyword">AS</span> winStart,
    SESSION_END(timeCol, gap) <span class="hljs-keyword">AS</span> winEnd,
    agg1(col1),
     ... 
    aggn(colN)
<span class="hljs-keyword">FROM</span> Tab1
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> [gk], <span class="hljs-keyword">SESSION</span>(timeCol, gap)
</code></pre>
<p data-nodeid="2496">ä¸¾ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªç”¨æˆ·è¿‡å» 1 å°æ—¶å†…çš„è®¢å•é‡ï¼š</p>
<pre class="lang-SQL" data-nodeid="2497"><code data-language="SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, SESSION_START(rowtime, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">HOUR</span>) <span class="hljs-keyword">AS</span> sStart, SESSION_ROWTIME(rowtime, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">HOUR</span>) <span class="hljs-keyword">AS</span> sEnd, <span class="hljs-keyword">SUM</span>(amount) <span class="hljs-keyword">FROM</span> Orders <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">SESSION</span>(rowtime, <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">HOUR</span>), <span class="hljs-keyword">user</span>
</code></pre>
<h4 data-nodeid="2498">å†…ç½®å‡½æ•°</h4>
<p data-nodeid="2499">Flink ä¸­è¿˜æœ‰å¤§é‡çš„å†…ç½®å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå°†å†…ç½®å‡½æ•°åˆ†ç±»å¦‚ä¸‹ï¼š</p>
<ul data-nodeid="2500">
<li data-nodeid="2501">
<p data-nodeid="2502">æ¯”è¾ƒå‡½æ•°</p>
</li>
<li data-nodeid="2503">
<p data-nodeid="2504">é€»è¾‘å‡½æ•°</p>
</li>
<li data-nodeid="2505">
<p data-nodeid="2506">ç®—æœ¯å‡½æ•°</p>
</li>
<li data-nodeid="2507">
<p data-nodeid="2508">å­—ç¬¦ä¸²å¤„ç†å‡½æ•°</p>
</li>
<li data-nodeid="2509">
<p data-nodeid="2510">æ—¶é—´å‡½æ•°</p>
</li>
</ul>
<p data-nodeid="2511"><strong data-nodeid="2743">æ¯”è¾ƒå‡½æ•°</strong><br>
<img src="https://s0.lgstatic.com/i/image3/M01/09/D0/CgoCgV6mqKWAfZRoAAEspJ_3kgs250.png" alt="æ¯”è¾ƒå‡½æ•°.png" data-nodeid="2742"></p>
<p data-nodeid="2512"><strong data-nodeid="2751">é€»è¾‘å‡½æ•°</strong><br>
<img src="https://s0.lgstatic.com/i/image3/M01/09/D0/CgoCgV6mqNCAODW7AAB_4lfsI5k037.png" alt="é€»è¾‘å‡½æ•°.png" data-nodeid="2750"></p>
<p data-nodeid="2513"><strong data-nodeid="2759">ç®—æœ¯å‡½æ•°</strong><br>
<img src="https://s0.lgstatic.com/i/image3/M01/09/D1/CgoCgV6mqNeALwSaAABekYvTZkw048.png" alt="ç®—æœ¯å‡½æ•°.png" data-nodeid="2758"></p>
<p data-nodeid="2514"><strong data-nodeid="2767">å­—ç¬¦ä¸²å¤„ç†å‡½æ•°</strong><br>
<img src="https://s0.lgstatic.com/i/image3/M01/09/D1/CgoCgV6mqN2AEnGrAABlm2eH_OY974.png" alt="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°.png" data-nodeid="2766"></p>
<p data-nodeid="2515"><strong data-nodeid="2775">æ—¶é—´å‡½æ•°</strong><br>
<img src="https://s0.lgstatic.com/i/image3/M01/09/D1/CgoCgV6mqOOAcYBFAACiFeqRUIM306.png" alt="æ—¶é—´å‡½æ•°.png" data-nodeid="2774"></p>
<h3 data-nodeid="2516">Flink Table &amp; SQL æ¡ˆä¾‹</h3>
<p data-nodeid="2517">ä¸Šé¢åˆ†åˆ«ä»‹ç»äº† Flink Table &amp; SQL çš„åŸç†å’Œæ”¯æŒçš„ç®—å­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå®æ—¶çš„æ•°æ®æµï¼Œç„¶åè®²è§£ SQL JOIN çš„ç”¨æ³•ã€‚</p>
<p data-nodeid="2518">åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ Flink æä¾›çš„è‡ªå®šä¹‰ Source åŠŸèƒ½æ¥å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„å®æ—¶æ•°æ®æºï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="lang-JAVA" data-nodeid="2519"><code data-language="JAVA"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyStreamingSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SourceFunction</span>&lt;<span class="hljs-title">Item</span>&gt; </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isRunning = <span class="hljs-keyword">true</span>;

    <span class="hljs-comment">/**
     * é‡å†™runæ–¹æ³•äº§ç”Ÿä¸€ä¸ªæºæºä¸æ–­çš„æ•°æ®å‘é€æº
     * <span class="hljs-doctag">@param</span> ctx
     * <span class="hljs-doctag">@throws</span> Exception
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(SourceContext&lt;Item&gt; ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">while</span>(isRunning){
            Item item = generateItem();
            ctx.collect(item);

            <span class="hljs-comment">//æ¯ç§’äº§ç”Ÿä¸€æ¡æ•°æ®</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
        }
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cancel</span><span class="hljs-params">()</span> </span>{
        isRunning = <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-comment">//éšæœºäº§ç”Ÿä¸€æ¡å•†å“æ•°æ®</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> Item <span class="hljs-title">generateItem</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">int</span> i = <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">100</span>);
        ArrayList&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList();
        list.add(<span class="hljs-string">"HAT"</span>);
        list.add(<span class="hljs-string">"TIE"</span>);
        list.add(<span class="hljs-string">"SHOE"</span>);
        Item item = <span class="hljs-keyword">new</span> Item();
        item.setName(list.get(<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">3</span>)));
        item.setId(i);
        <span class="hljs-keyword">return</span> item;
    }
}
</code></pre>
<p data-nodeid="2520">æˆ‘ä»¬æŠŠå®æ—¶çš„å•†å“æ•°æ®æµè¿›è¡Œåˆ†æµï¼Œåˆ†æˆ even å’Œ odd ä¸¤ä¸ªæµè¿›è¡Œ JOINï¼Œæ¡ä»¶æ˜¯åç§°ç›¸åŒï¼Œæœ€åï¼ŒæŠŠä¸¤ä¸ªæµçš„ JOIN ç»“æœè¾“å‡ºã€‚</p>
<pre class="lang-JAVA" data-nodeid="2521"><code data-language="JAVA"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamingDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{

        EnvironmentSettings bsSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build();
        StreamExecutionEnvironment bsEnv = StreamExecutionEnvironment.getExecutionEnvironment();
        StreamTableEnvironment bsTableEnv = StreamTableEnvironment.create(bsEnv, bsSettings);

        SingleOutputStreamOperator&lt;Item&gt; source = bsEnv.addSource(<span class="hljs-keyword">new</span> MyStreamingSource()).map(<span class="hljs-keyword">new</span> MapFunction&lt;Item, Item&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">map</span><span class="hljs-params">(Item item)</span> <span class="hljs-keyword">throws</span> Exception </span>{
                <span class="hljs-keyword">return</span> item;
            }
        });

        DataStream&lt;Item&gt; evenSelect = source.split(<span class="hljs-keyword">new</span> OutputSelector&lt;Item&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> Iterable&lt;String&gt; <span class="hljs-title">select</span><span class="hljs-params">(Item value)</span> </span>{
                List&lt;String&gt; output = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
                <span class="hljs-keyword">if</span> (value.getId() % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
                    output.add(<span class="hljs-string">"even"</span>);
                } <span class="hljs-keyword">else</span> {
                    output.add(<span class="hljs-string">"odd"</span>);
                }
                <span class="hljs-keyword">return</span> output;
            }
        }).select(<span class="hljs-string">"even"</span>);

        DataStream&lt;Item&gt; oddSelect = source.split(<span class="hljs-keyword">new</span> OutputSelector&lt;Item&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> Iterable&lt;String&gt; <span class="hljs-title">select</span><span class="hljs-params">(Item value)</span> </span>{
                List&lt;String&gt; output = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
                <span class="hljs-keyword">if</span> (value.getId() % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
                    output.add(<span class="hljs-string">"even"</span>);
                } <span class="hljs-keyword">else</span> {
                    output.add(<span class="hljs-string">"odd"</span>);
                }
                <span class="hljs-keyword">return</span> output;
            }
        }).select(<span class="hljs-string">"odd"</span>);


        bsTableEnv.createTemporaryView(<span class="hljs-string">"evenTable"</span>, evenSelect, <span class="hljs-string">"name,id"</span>);
        bsTableEnv.createTemporaryView(<span class="hljs-string">"oddTable"</span>, oddSelect, <span class="hljs-string">"name,id"</span>);

        Table queryTable = bsTableEnv.sqlQuery(<span class="hljs-string">"select a.id,a.name,b.id,b.name from evenTable as a join oddTable as b on a.name = b.name"</span>);

        queryTable.printSchema();

        bsTableEnv.toRetractStream(queryTable, TypeInformation.of(<span class="hljs-keyword">new</span> TypeHint&lt;Tuple4&lt;Integer,String,Integer,String&gt;&gt;(){})).print();

        bsEnv.execute(<span class="hljs-string">"streaming sql job"</span>);
    }

}
</code></pre>
<p data-nodeid="2522">ç›´æ¥å³é”®è¿è¡Œï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š</p>
<p data-nodeid="4691"><img src="https://s0.lgstatic.com/i/image3/M01/09/C6/CgoCgV6mnuqAa8d3AAINXpfEq-8636.png" alt="image (7).png" data-nodeid="4695"></p>
<p data-nodeid="9294" class="te-preview-highlight"><a href="https://github.com/wangzhiwubigdata/quickstart" data-nodeid="9297">ç‚¹å‡»è¿™é‡Œä¸‹è½½æœ¬è¯¾ç¨‹æºç </a></p>







<h3 data-nodeid="4309">æ€»ç»“</h3>




<p data-nodeid="2525">æˆ‘ä»¬åœ¨è¿™ä¸€è¯¾æ—¶ä¸­è®²è§£äº† Flink Table &amp; SQL çš„èƒŒæ™¯å’ŒåŸç†ï¼Œå¹¶ä¸”è®²è§£äº†åŠ¨æ€è¡¨çš„æ¦‚å¿µï¼›åŒæ—¶å¯¹ Flink æ”¯æŒçš„å¸¸ç”¨ SQL å’Œå†…ç½®å‡½æ•°è¿›è¡Œäº†è®²è§£ï¼›æœ€åç”¨ä¸€ä¸ªæ¡ˆä¾‹ï¼Œè®²è§£äº†æ•´ä¸ª Flink Table &amp; SQL çš„ä½¿ç”¨ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### *ç£Šï¼š
> çœ‹äº†å¥½å¤šä¸ªæ‹‰å‹¾ä¸“æ äº†ï¼Œflinkè¿™ä¸ªä¸“æ ç®—æ˜¯æœ€è‰¯å¿ƒçš„ã€‚ä»å¾ªåºæ¸è¿›çš„è¯¾ç¨‹å®‰æ’ï¼Œåˆ°ç»†è‡´æ˜“æ‡‚çš„å†…å®¹ï¼Œåˆ°è€å¸ˆçƒ­å¿ƒå›å¤ éƒ½å¾ˆå¥½ï¼æ„Ÿè°¢è¿™ä¸ªè€å¸ˆï¼Œå¸Œæœ›æ‹‰å‹¾åˆ«çš„ä¸“æ å‘è¿™ä¸ªçœ‹é½ã€‚

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ä¹Ÿç¥ä½ å­¦ä¹ æ„‰å¿«

##### *é“ï¼š
> æˆ‘æœ¬åœ°æ­å»ºçš„ç¯å¢ƒæ˜¯flink-1.11ï¼Œæˆ‘çœ‹æ–‡æ¡£createTemporaryViewè¿™ä¸ªæ–¹æ³•åœ¨1.11æ›´æ–°äº†ï¼Œæ‰€ä»¥å°±æ”¹äº†ä¸€ä¸‹ç¤ºä¾‹bsTableEnv.createTemporaryView("evenTable", evenSelect, $("id"), $("name")); ä¸è¿‡è¿è¡Œåˆ°è¿™é‡Œå°±æŠ¥é”™å°±æŠ¥é”™ï¼šToo many fields referenced from an atomic type. æ±‚æŒ‡æ•™ï¼

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¦‚æœä½ ä½¿ç”¨äº†Tupleç±»ï¼Œè®°å¾—ç”¨flinkçš„tupleã€‚å¦å¤–ä½ éœ€è¦ä½¿ç”¨TypeInformationæ¥æŒ‡å®šåˆ—çš„ç±»å‹ã€‚

##### 123ï¼š
> å¾ˆèµ

##### *ç†™ï¼š
> <div>æ‚¨å¥½ï¼Œè¯»å®Œæ–‡ç« ï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼Œè¿˜æœ›è§£ç­”ä¸‹ï¼Œæ„Ÿè°¢~~~</div><div><span style="font-size: 16.0125px;">1. æ„æ€æ˜¯sql å’Œ table apiéƒ½ä¼šç»è¿‡è½¬æ¢å™¨è½¬æ¢æˆdatasetæˆ–datastream apiæ˜¯ä¹ˆï¼Ÿ</span></div><div><span style="font-size: 16.0125px;">2. å¦‚æœ1æˆç«‹çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯åªè¦æŒæ¡datasetæˆ–è€…datastreamåŸç†çš„è¯ï¼Œå…¶å®å°±æ˜¯æŒæ¡äº†sqlï¼Œtable apiæ˜¯ä¹ˆï¼Ÿ</span></div>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; 1.æ˜¯çš„ 2.sqlçš„å¼€å‘æ•ˆç‡è¿œå¤§äºåŸç”Ÿapi

##### **-4å¹´-å¤§æ•°æ®å¼€å‘ï¼š
> è®²å¸ˆå›å¤ï¼š å®é™…ç”Ÿäº§ä¸­åŒæµjoinå¹¶ä¸æå€¡ï¼Œä¼šé‡åˆ°å¾ˆå¤šçŠ¶æ€é—®é¢˜ã€‚ä¸€èˆ¬ä¼šæŠŠå…¶ä¸­ä¸€ä¸ªæµæ”¾å…¥Hbaseè¿™æ ·çš„å­˜å‚¨ä¸­å†å»å…³è”ã€‚æ–‡ä¸­çš„oddå’Œevenä¸¤ä¸ªæµæ˜¯ä¸ºäº†æ¨¡æ‹Ÿjoinæ‰€éœ€çš„è¾“å…¥ã€‚æˆ‘ç°åœ¨ç”Ÿäº§æœ‰ä¸€å¼ ç”¨æˆ·è¡¨ï¼ŒåŒ…å«ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€ï¼›å¤§æ¦‚4äº¿æ•°æ®å­˜å‚¨åœ¨hbaseï¼›å¦‚æœæŠŠhbaseå½“æˆç»´è¡¨å…³è”æ€§èƒ½æ€ä¹ˆæ ·ï¼›

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; äº‹å®ä¸Šæ˜¯å¯ä»¥çš„ï¼ŒHBase çš„æŸ¥è¯¢ qps éå¸¸é«˜ï¼Œå¦‚æœæ˜¯ç»´è¡¨çš„è¯ï¼Œå…¶å®æ•ˆç‡æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æˆ‘ä»¬åœ¨å®é™…ç”Ÿäº§ä¸­ HBase ä¸­çš„æ•°æ®å¤§æ¦‚å­˜åŠå¹´ï¼Œè¶…è¿‡å‡ åTçš„æ•°æ®ã€‚

##### **ç”Ÿï¼š
> è¿™ä¸ªSQLï¼Œè½åœ°åœ¨å“ªé‡Œï¼Œå¦‚æœæˆ‘è¦åšå±•ç¤ºï¼Œæˆ‘åº”è¯¥æï¼Ÿæ¯”å¦‚è¯´ï¼Œæˆ‘æƒ³ç”¨å±•ç¤ºå·¥å…·grafanaæ˜¾ç¤ºç»“æœã€‚åº”è¯¥è½åœ°åœ¨å“ªé‡Œå‘¢ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; grafnaæ”¯æŒçš„æ•°æ®æºéƒ½å¯ä»¥çš„ï¼Œä¾‹å¦‚MySql

##### *å®ï¼š
> å†™çš„å¾ˆç”¨å¿ƒï¼Œç»§ç»­å­¦ä¹ ing

##### Johngoï¼š
> è¿™ä¸ªä½¿ç”¨çš„æ•°æ®Flinkå“ªä¸ªç‰ˆæœ¬ï¼Œæˆ‘ç”¨1.10.0å°è¯•å®ç°sqlç›¸å…³ï¼Œæ€»æ˜¯æ²¡åŠæ³•è·‘é€šğŸ˜”

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¼€æºçš„Flinkçš„sqlæ˜¯éå¸¸ä¸ç¨³å®šçš„åŠŸèƒ½ï¼Œå¦‚æœä½ ç”¨äº†é˜¿é‡Œäº‘çš„Blinkå°±ä¼šå¥½äº›ã€‚

##### **èœ—ç‰›ï¼š
> æˆ‘æœ‰ä¸€å¥ä¸ç†è§£ï¼šâ€œFlink è‡ªä» 0.9 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Table &amp; SQL åŠŸèƒ½ä¸€ç›´å¤„äºå®Œå–„å¼€å‘ä¸­ï¼Œä¸”åœ¨ä¸æ–­è¿›è¡Œè¿­ä»£ã€‚â€ï¼Œæ˜¯ 1.9 è¿˜æ˜¯ 0.9 ç‰ˆæœ¬ï¼Ÿï¼Ÿï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; 0.9å°±æ”¯æŒäº†ï¼Œä½†æ˜¯ä¸€ç›´åœ¨æ›´æ–°

##### **å§ï¼š
> bsTableEnv.createTemporaryView("evenTable", evenSelect, "name,id");è¿™è¡ŒæŠ¥Too many fields referenced from an atomic type.çš„é”™è¯¯ï¼ŒItemå·²ç»æœ‰æ— å‚æ„é€ å™¨ã€getterå’Œsetteräº†ã€‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¥½å¥½æ£€æŸ¥ä¸€ä¸‹ä½ çš„ç±»ï¼Œéœ€è¦æ»¡è¶³ï¼š
1.ç±»å¿…é¡»æ˜¯å…¬æœ‰çš„ã€‚
2.å®ƒå¿…é¡»æœ‰ä¸€ä¸ªå…¬æœ‰çš„æ— å‚æ„é€ å™¨ï¼ˆé»˜è®¤æ„é€ å™¨ï¼‰ã€‚
3.æ‰€æœ‰çš„å­—æ®µè¦ä¹ˆæ˜¯å…¬æœ‰çš„è¦ä¹ˆå¿…é¡»å¯ä»¥é€šè¿‡ getter å’Œ setter å‡½æ•°è®¿é—®ã€‚ä¾‹å¦‚ä¸€ä¸ªåä¸º foo çš„å­—æ®µï¼Œå®ƒçš„ getter å’Œ setter æ–¹æ³•å¿…é¡»å‘½åä¸º getFoo() å’Œ setFoo()ã€‚
4.å­—æ®µçš„ç±»å‹å¿…é¡»è¢«å·²æ³¨å†Œçš„åºåˆ—åŒ–ç¨‹åºæ‰€æ”¯æŒã€‚

##### *èˆªï¼š
> count windowæœ‰ç±»ä¼¼time windowè¿™ç§SQLé‡Œé¢çš„TUMBLEå†™æ³•å—

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ç›®å‰åªæ”¯æŒ TimeWindowï¼Œç›¸åº”çš„è¡¨è¾¾è¯­å¥ TUMBLEã€HOPã€SESSIONï¼ŒCountWindow ä¸æ”¯æŒã€‚

##### **9524ï¼š
> ä¸´æ—¶è¡¨æœ‰100ä¸‡è¡Œ 10ä¸ªå­—æ®µ å ç”¨å¤šå°‘å†…å­˜

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™ä¸ªè·Ÿæ¯ä¸ªå­—æ®µçš„é•¿åº¦ã€ç±»å‹éƒ½æœ‰å…³ç³»å§ã€‚ä¿å®ˆä¼°è®¡åº”è¯¥æ˜¯å‡ ç™¾Mã€‚

##### **å‘ï¼š
> åœ¨">bsTableEnv.createTemporaryView("evenTable", evenSelect, "id,name"); å¤„æŠ¥é”™ï¼šException in thread "main" org.apache.flink.table.api.ValidationException: Too many fields referenced from an atomic type.å¼€å§‹æ˜¯Tuple4 ç±»å¼•å…¥é”™äº†ï¼Œåé¢çº æ­£ä¸ºFlinkçš„äº†ä¹Ÿä¸è¡Œ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; éœ€è¦ç»™ä½ çš„Javaå¯¹è±¡ä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•ï¼Œæœ€å¥½åŠ ä¸Šgetterå’Œsetter

##### **ç”¨æˆ·4300ï¼š
> Kafka çš„æ¶ˆæ¯ä¼šè¢«æºæºä¸æ–­çš„è§£ææˆä¸€å¼ ä¸æ–­å¢é•¿çš„åŠ¨æ€è¡¨ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹è€å¸ˆï¼Œè¿™åŠ¨æ€è¡¨çš„å¤§å°æ•°é‡çš„é™åˆ¶å—ï¼Ÿå¦‚æœæºæºä¸æ–­çš„æ•°æ®ï¼Œæ˜¯æ€ä¹ˆå­˜å‚¨è¿™äº›çŠ¶æ€çš„ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ä¼šæ ¹æ®é…ç½®ï¼Œå­˜å‚¨åœ¨å†…å­˜æˆ–è€…ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“ä¸­

##### *å°‘ï¼š
> è€å¸ˆï¼Œæˆ‘å¯¹æœ€åä¸€ä¸ªä¾‹å­çš„æ‰§è¡Œç»“æœä¸æ˜¯å¾ˆç†è§£ã€‚å¸¸è§„sqlè¿›è¡Œjoinæ˜¯ä¸€ä¸ªé›†åˆï¼Œè§‚å¯Ÿäº†ä¾‹å­çš„æ‰§è¡Œç»“æœæ˜¯æ²¡æœ‰é‡å¤æ•°æ®çš„ï¼Œè¿™æ˜¯evenå’Œoddä¸¤ä¸ªæµå¢é‡å…ƒç´ çš„joinç»“æœå—ï¼Ÿæœ€åè¿™ä¸ªä¾‹å­å¥—ç”¨åˆ°å…·ä½“ä¸šåŠ¡ä¸Šæ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„åœºæ™¯å‘¢ï¼Ÿè¯·è€å¸ˆè®²è§£ä¸€ä¸‹ã€‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å®é™…ç”Ÿäº§ä¸­åŒæµjoinå¹¶ä¸æå€¡ï¼Œä¼šé‡åˆ°å¾ˆå¤šçŠ¶æ€é—®é¢˜ã€‚ä¸€èˆ¬ä¼šæŠŠå…¶ä¸­ä¸€ä¸ªæµæ”¾å…¥Hbaseè¿™æ ·çš„å­˜å‚¨ä¸­å†å»å…³è”ã€‚æ–‡ä¸­çš„oddå’Œevenä¸¤ä¸ªæµæ˜¯ä¸ºäº†æ¨¡æ‹Ÿjoinæ‰€éœ€çš„è¾“å…¥ã€‚

##### **5317ï¼š
> ä¼šè¯çª—å£é‚£ä¸ªä¾‹å­ï¼Œå®é™…çš„å«ä¹‰æ˜¯åœ¨1å°æ—¶æ²¡æœ‰ç”¨æˆ·ä¸‹å•çš„æ—¶å€™ï¼Œå°±è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„è®¢å•é‡å§

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯å½“å‰æ—¶é—´çš„è¿‡å»ä¸€å°æ—¶

##### *å†›ï¼š
> createTemporaryView() æ–¹æ³•çš„ä½¿ç”¨ç¼–è¯‘ä¸é€šè¿‡ï¼Œæ¢æˆäº†<span style="background-color: transparent;"><font color="#008080" face="Menlo, Lucida Console, monospace"><span style="white-space: pre-wrap;">registerDataStream()å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç¤ºä¾‹è¿è¡ŒæŠ¥é”™ 'Exception in thread "main" java.lang.NoSuchMethodError: org.apache.flink.table.catalog.FunctionCatalog.&lt;init&gt;(Lorg/apache/flink/table/catalog/CatalogManager;)V'</span></font></span><div><span style="background-color: transparent;"><font color="#008080" face="Menlo, Lucida Console, monospace"><span style="white-space: pre-wrap;"><br></span></font></span></div><div><font color="#008080" face="Menlo, Lucida Console, monospace"><span style="white-space: pre-wrap;">æ˜¯ä¸ºå•¥</span></font></div>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; é‡æ–°æäº¤äº†POMä¾èµ–ï¼Œå†è¯•è¯•

##### **7651ï¼š
> ä¼šè¯çª—å£æ¡ˆä¾‹ï¼Œè¿‡å»ä¸€å°æ—¶çš„è®¢å•é‡ï¼Œè¿™ä¸ªä¸å¤ªèƒ½ç†è§£

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å°±æ˜¯åœ¨ä¸€ä¸ªçª—å£å†…ï¼Œè®¡ç®—è¿‡å»ä¸€ä¸ªå°æ—¶æœ‰å¤šå°‘è®¢å•

##### *æ›™ï¼š
> logic planä¹‹åæ˜¯StreamGraph ,ä¸æ˜¯ç”Ÿæˆç‰©ç†æ‰§è¡Œè®¡åˆ’å§

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„

##### *å¸…ï¼š
> æœ€åä¸€ä¸ªä¾‹å­è¾“å‡ºç”¨äº†toRetractStreamï¼Œè¯·é—®è¿™é‡Œç”¨toAppendStream/toUpsertStreamæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯çš„


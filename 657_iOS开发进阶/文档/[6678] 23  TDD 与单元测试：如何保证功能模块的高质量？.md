<p data-nodeid="86083">å¦‚æœä¸€ä¸ª App æœ‰å¾ˆå¤šçš„ Bug æˆ–è€…å´©æºƒç‡éå¸¸é«˜ï¼Œæˆ‘ä»¬å¾€å¾€å°±éœ€è¦èŠ±å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›å»ä¸æ–­æŸ¥é”™å’Œâ€œæ•‘ç«â€ã€‚é‚£æ€æ ·æ‰èƒ½æé«˜ä»£ç çš„è´¨é‡ï¼Œè®©æˆ‘ä»¬å¯ä»¥æŠŠæœ‰æ•ˆçš„æ—¶é—´ä¸“æ³¨äºäº§å“åŠŸèƒ½çš„è¿­ä»£ä¸Šå‘¢ï¼Ÿç»è¿‡å¤šå¹´å®è·µç»éªŒçš„æ€»ç»“ï¼Œæˆ‘ä»¬å‘ç°<strong data-nodeid="86089">æµ‹è¯•é©±åŠ¨å¼€å‘</strong>ï¼Œä¹Ÿå«ä½œ TDDï¼ˆTest-Driven Developmentï¼‰ï¼Œæ˜¯ä¸€ç§è¡Œè€Œæœ‰æ•ˆçš„æ–¹æ³•å®è·µã€‚</p>


<p data-nodeid="84435"><strong data-nodeid="84542">TDD çš„æ ¸å¿ƒæ˜¯ç¼–å†™å•å…ƒæµ‹è¯•</strong>ã€‚å•å…ƒæµ‹è¯•èƒ½æ–¹ä¾¿æˆ‘ä»¬æ¨¡æ‹Ÿä¸åŒçš„æµ‹è¯•åœºæ™¯ï¼Œè¦†ç›–ä¸åŒçš„è¾¹ç•Œæ¡ä»¶ï¼Œä»è€Œæé«˜ä»£ç çš„è´¨é‡å¹¶å‡å°‘ Bug çš„æ•°é‡ã€‚åŒæ—¶ï¼Œä½¿ç”¨ TDD æ‰€å¼€å‘çš„ä»£ç èƒ½é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p data-nodeid="84436">ä¸‹é¢æˆ‘ä»¬ä»¥ Moments App ä½œä¸ºä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡ç¼–å†™å•å…ƒæµ‹è¯•æ¥è¿›è¡Œ TDDã€‚è¿™é‡Œä¸»è¦è®²è¿°æµ‹è¯•ä»£ç çš„æ­¥éª¤ä¸ç»“æ„ï¼Œä»¥åŠå¦‚ä½•ä¸ºç½‘ç»œå±‚ã€Repository å±‚å’Œ ViewModel å±‚ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p>
<h3 data-nodeid="84437">æµ‹è¯•ä»£ç çš„æ­¥éª¤ä¸ç»“æ„</h3>
<p data-nodeid="84438">åœ¨ç¼–å†™æµ‹è¯•ä»£ç æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éµå®ˆ AAA æ­¥éª¤ï¼Œæ‰€è°“<strong data-nodeid="84550">AAA å°±æ˜¯ Arrangeã€Act å’Œ Assert</strong>ã€‚</p>
<ul data-nodeid="84439">
<li data-nodeid="84440">
<p data-nodeid="84441">Arrangeï¼šç”¨äºæ­å»ºæµ‹è¯•æ¡ˆä¾‹ï¼Œä¾‹å¦‚ï¼Œåˆå§‹åŒ–æµ‹è¯•å¯¹è±¡åŠå…¶ä¾èµ–ã€‚</p>
</li>
<li data-nodeid="84442">
<p data-nodeid="84443">Actï¼šè¡¨ç¤ºæ‰§è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚ï¼Œè°ƒç”¨æµ‹è¯•å¯¹è±¡çš„æ–¹æ³•ã€‚</p>
</li>
<li data-nodeid="84444">
<p data-nodeid="84445">Assertï¼šç”¨äºæ£€éªŒæµ‹è¯•çš„ç»“æœã€‚</p>
</li>
</ul>
<p data-nodeid="84446">é‚£æ€æ ·æ‰èƒ½æŒ‰ç…§ AAA æ­¥éª¤æ¥ç¼–å†™æµ‹è¯•ä»£ç å‘¢ï¼Ÿä¸ºäº†ç®€åŒ–ç¼–å†™æµ‹è¯•çš„å·¥ä½œï¼Œå¹¶æé«˜ä»£ç çš„ç»“æ„æ€§ä¸å¯è¯»æ€§ï¼Œæˆ‘ä»¬åœ¨ Moments App ä¸­ä½¿ç”¨äº† Quick å’Œ Nimble åº“ã€‚ä¸‹é¢æˆ‘ä»¥<code data-backticks="1" data-nodeid="84555">MomentsTimelineViewModelTests</code>ä¸ºä¾‹å­ç»™ä½ è®²è¿°ä¸€ç§å®ç”¨çš„æµ‹è¯•ä»£ç ç»“æ„ï¼š</p>
<pre class="lang-swift" data-nodeid="84447"><code data-language="swift"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MomentsTimelineViewModelTests</span>: <span class="hljs-title">QuickSpec</span> </span>{
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">spec</span><span class="hljs-params">()</span></span> {
        describe(<span class="hljs-string">"MomentsTimelineViewModel"</span>) {
            <span class="hljs-keyword">var</span> testSubject: <span class="hljs-type">MomentsTimelineViewModel!</span>
            beforeEach {
                testSubject = <span class="hljs-type">MomentsTimelineViewModel</span>() <span class="hljs-comment">// Arrange</span>
            }
            context(<span class="hljs-string">"loadItems()"</span>) {
                beforeEach {
                    testSubject.loadItems() <span class="hljs-comment">// Act</span>
                }
                it(<span class="hljs-string">"call `momentsRepo.getMoments` with the correct parameters"</span>) {
                    expect(mockMomentsRepo.getMomentsHasBeenCalled).to(beTrue()) <span class="hljs-comment">// Assert</span>
                }
                it(<span class="hljs-string">"check another assertion"</span>) { }
            }
            context(<span class="hljs-string">"anotherMethod()"</span>) { }
        }
    }
}
</code></pre>
<p data-nodeid="84448"><strong data-nodeid="84579">é¦–å…ˆæ˜¯æµ‹è¯•ç±»çš„å®šä¹‰</strong>ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿äº<code data-backticks="1" data-nodeid="84561">QuickSpec</code>çš„æµ‹è¯•ç±»ï¼Œæµ‹è¯•ç±»é€šå¸¸ä»¥<code data-backticks="1" data-nodeid="84563">&lt;éœ€è¦æµ‹è¯•çš„ç±»å‹&gt;Tests</code>çš„è§„èŒƒæ¥å‘½åã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•<code data-backticks="1" data-nodeid="84565">MomentsTimelineViewModel</code>ï¼Œå› æ­¤æŠŠæµ‹è¯•ç±»å®šä¹‰ä¸º<code data-backticks="1" data-nodeid="84567">MomentsTimelineViewModelTests</code>ã€‚ç„¶ååœ¨ç±»é‡Œé¢é‡å†™<code data-backticks="1" data-nodeid="84569">spec()</code>æ–¹æ³•æ¥å°è£…æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹ã€‚æ¥ç€åœ¨<code data-backticks="1" data-nodeid="84571">spec()</code>æ–¹æ³•é‡Œé¢é€šè¿‡<code data-backticks="1" data-nodeid="84573">describe()</code>æ–¹æ³•æ¥è¿›è¡Œåˆ†ç»„ï¼Œæˆ‘çš„åšæ³•æ˜¯ä¸€ä¸ªæµ‹è¯•ç±»å‹åªæœ‰ä¸€ä¸ª<code data-backticks="1" data-nodeid="84575">describe()</code>æ–¹æ³•ï¼Œå¹¶æŠŠè¦æµ‹è¯•ç±»å‹çš„åç§°ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œåœ¨ä¾‹å­ä¸­å°±å†™æˆ<code data-backticks="1" data-nodeid="84577">describe("MomentsTimelineViewModel")</code>ï¼Œè¿™æ ·èƒ½ä¿è¯åœ¨æ‰¹é‡æ‰§è¡Œæµ‹è¯•æ¡ˆä¾‹æ—¶å¯ä»¥å¿«é€Ÿå®šä½å‡ºé”™çš„æµ‹è¯•ç±»ã€‚</p>
<p data-nodeid="84449"><strong data-nodeid="84612">æ¥ä¸‹æ¥æ˜¯æ‰§è¡Œ AAA ä¸­çš„ Arrange æ­¥éª¤æ¥æ­å»ºæµ‹è¯•æ¡ˆä¾‹æ‰€éœ€çš„å¯¹è±¡</strong>ã€‚åœ¨<code data-backticks="1" data-nodeid="84584">describe()</code>æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªåå«<code data-backticks="1" data-nodeid="84586">testSubject</code>çš„æµ‹è¯•å¯¹è±¡ï¼Œå®ƒçš„ç±»å‹ä¸ºéœ€è¦æµ‹è¯•çš„ç±»å‹ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ<code data-backticks="1" data-nodeid="84588">testSubject</code>çš„ç±»å‹æ˜¯<code data-backticks="1" data-nodeid="84590">MomentsTimelineViewModel!</code>ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å®šä¹‰<code data-backticks="1" data-nodeid="84592">testSubject</code>æ—¶ä½¿ç”¨äº†<code data-backticks="1" data-nodeid="84594">!</code>æ¥è¡¨ç¤ºè¯¥å¯¹è±¡ä¸ä¼šä¸º<code data-backticks="1" data-nodeid="84596">nil</code>ã€‚ä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦æé†’ä¸€ä¸‹ï¼Œåœ¨ç”Ÿäº§ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç»å¯¹ä¸ä½¿ç”¨<code data-backticks="1" data-nodeid="84598">!</code>æ¥å®šä¹‰å±æ€§ï¼Œå› ä¸ºä¸€æ—¦è¯¥å±æ€§ä¸º<code data-backticks="1" data-nodeid="84600">nil</code>æ—¶ï¼Œè°ƒç”¨è¯¥å±æ€§çš„æ–¹æ³•å°±ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚é‚£ä¸ºä»€ä¹ˆåœ¨æµ‹è¯•ä»£ç ä¸­åè€Œä½¿ç”¨<code data-backticks="1" data-nodeid="84602">!</code>å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨æ‰§è¡Œæ¯ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ä¹‹å‰éƒ½é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„<code data-backticks="1" data-nodeid="84604">testSubject</code>å¯¹è±¡æ¥ä¿è¯æ¯ä¸ªæ¡ˆä¾‹éƒ½æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠåˆå§‹åŒ–æ“ä½œæ”¾åˆ°<code data-backticks="1" data-nodeid="84606">beforeEach()</code>æ–¹æ³•é‡Œé¢ï¼Œå¦‚æœ<code data-backticks="1" data-nodeid="84608">testSubject</code>ä¸æ˜¯å®šä¹‰ä¸º<code data-backticks="1" data-nodeid="84610">!</code>ï¼Œå°±ä¼šæœ‰ç¼–è¯‘é”™è¯¯ã€‚</p>
<p data-nodeid="84450"><strong data-nodeid="84629">ç„¶åæ˜¯æ‰§è¡Œ AAA é‡Œé¢çš„ Act æ­¥éª¤</strong>ã€‚æµ‹è¯•ç±»å‹ä¸­çš„æ¯ä¸€ä¸ªå…¬å…±çš„æ–¹æ³•å’Œå±æ€§éƒ½éœ€è¦æµ‹è¯•ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬çš„æµ‹è¯•æ¡ˆä¾‹è¿›è¡Œåˆ†ç»„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä¼šä½¿ç”¨åˆ°<code data-backticks="1" data-nodeid="84617">context()</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è¦æµ‹è¯•<code data-backticks="1" data-nodeid="84619">loadItems()</code>æ–¹æ³•æ—¶ï¼Œå°±æŠŠæ–¹æ³•åå­—ä¼ é€’ç»™<code data-backticks="1" data-nodeid="84621">context()</code>æ–¹æ³•ï¼Œå†™æˆ<code data-backticks="1" data-nodeid="84623">context("loadItems()")</code>ï¼Œå¹¶åœ¨è¯¥ context ä¸‹çš„<code data-backticks="1" data-nodeid="84625">beforeEach()</code>æ–¹æ³•é‡Œè°ƒç”¨æµ‹è¯•æ–¹æ³•<code data-backticks="1" data-nodeid="84627">loadItems()</code>ï¼Œè¿™æ ·å°±æ‰§è¡Œ Act æ­¥éª¤äº†ã€‚</p>
<p data-nodeid="84451"><strong data-nodeid="84646">æœ€åçœ‹ä¸€ä¸‹å¦‚ä½•æ‰§è¡Œ AAA é‡Œé¢çš„ Assert æ­¥éª¤</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code data-backticks="1" data-nodeid="84634">it()</code>æ–¹æ³•æ¥æ£€éªŒæ¯ä¸ªæµ‹è¯•æ¡ˆä¾‹çš„æ‰§è¡Œç»“æœã€‚ä¸ºäº†ä½¿å¾—æµ‹è¯•æ›´åŠ å®¹æ˜“è¯»ï¼Œæˆ‘é€šå¸¸æŠŠæµ‹è¯•çš„é¢„æœŸè¡Œä¸ºéƒ½å†™åœ¨<code data-backticks="1" data-nodeid="84636">it()</code>æ–¹æ³•é‡Œé¢ï¼Œç¤ºä¾‹ä¸­çš„<code data-backticks="1" data-nodeid="84638">it("call momentsRepo.getMoments()with the correct parameters")</code>è¡¨ç¤ºå½“æˆ‘ä»¬è°ƒç”¨<code data-backticks="1" data-nodeid="84640">loadItems()</code>æ–¹æ³•æ—¶å°±å¿…é¡»è°ƒç”¨<code data-backticks="1" data-nodeid="84642">momentsRepo</code>å±æ€§çš„<code data-backticks="1" data-nodeid="84644">getMoments()</code>å‡½æ•°ã€‚</p>
<p data-nodeid="84452">è‡³æ­¤ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ä»£ç çš„æ­¥éª¤ä¸æ¡†æ¶å°±è®²å®Œäº†ã€‚ä¸‹é¢æˆ‘ä»¬å†ç»“åˆçœŸå®çš„ä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•ä¸ºç½‘ç»œå±‚ã€Repository å±‚å’Œ ViewModel å±‚ç¼–å†™æµ‹è¯•ä»£ç ã€‚</p>
<h3 data-nodeid="84453">ç½‘ç»œå±‚çš„æµ‹è¯•</h3>
<p data-nodeid="84454">æˆ‘ä»¬ä»¥<code data-backticks="1" data-nodeid="84650">GetMomentsByUserIDSessionTests</code>ä¸ºä¾‹å­çœ‹çœ‹å¦‚ä½•ä¸ºç½‘ç»œå±‚ç¼–å†™å•å…ƒæµ‹è¯•çš„ä»£ç ã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† RxSwiftï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™å¯ä»¥å¼•ç”¨<strong data-nodeid="84656">RxTest åº“</strong>æ¥ç®€åŒ–æµ‹è¯•çš„æµç¨‹ã€‚</p>
<p data-nodeid="84455">é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨<code data-backticks="1" data-nodeid="84658">describe("GetMomentsByUserIDSession")</code>å‡½æ•°é‡Œå®šä¹‰éœ€è¦åˆå§‹åŒ–çš„å˜é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84456"><code data-language="swift"><span class="hljs-keyword">var</span> testSubject: <span class="hljs-type">GetMomentsByUserIDSession!</span>
<span class="hljs-keyword">var</span> testScheduler: <span class="hljs-type">TestScheduler!</span>
<span class="hljs-keyword">var</span> testObserver: <span class="hljs-type">TestableObserver</span>&lt;<span class="hljs-type">MomentsDetails</span>&gt;!
<span class="hljs-keyword">var</span> mockResponseEvent: <span class="hljs-type">Recorded</span>&lt;<span class="hljs-type">Event</span>&lt;<span class="hljs-type">GetMomentsByUserIDSession</span>.<span class="hljs-type">Response</span>&gt;&gt;!
</code></pre>
<ul data-nodeid="84457">
<li data-nodeid="84458">
<p data-nodeid="84459"><code data-backticks="1" data-nodeid="84660">testSubject</code>æ˜¯æµ‹è¯•çš„å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯æˆ‘ä»¬éœ€è¦æµ‹è¯•çš„<code data-backticks="1" data-nodeid="84662">GetMomentsByUserIDSession</code>ã€‚</p>
</li>
<li data-nodeid="84460">
<p data-nodeid="84461"><code data-backticks="1" data-nodeid="84664">testScheduler</code>çš„ç±»å‹æ˜¯æ¥è‡ª RxTest çš„<code data-backticks="1" data-nodeid="84666">TestScheduler</code>ï¼Œæ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•çš„æ’ç¨‹å™¨ã€‚</p>
</li>
<li data-nodeid="84462">
<p data-nodeid="84463"><code data-backticks="1" data-nodeid="84668">testObserver</code>çš„ç±»å‹æ˜¯ RxTest çš„<code data-backticks="1" data-nodeid="84670">TestableObserver</code>ï¼Œç”¨æ¥è®¢é˜… Observable åºåˆ—é‡Œçš„äº‹ä»¶ï¼Œå¹¶é€šè¿‡æ¥æ”¶åˆ°çš„äº‹ä»¶æ¥æ£€æŸ¥æµ‹è¯•çš„ç»“æœã€‚</p>
</li>
<li data-nodeid="84464">
<p data-nodeid="84465"><code data-backticks="1" data-nodeid="84672">mockResponseEvent</code>æ˜¯<code data-backticks="1" data-nodeid="84674">Recorded</code>ç±»å‹ï¼Œä¹Ÿæ˜¯æ¥è‡ª RxTestï¼Œç”¨äºæ¨¡æ‹Ÿäº‹ä»¶çš„å‘é€ï¼Œä¾‹å¦‚æ¨¡æ‹ŸæˆåŠŸæ¥æ”¶åˆ°ç½‘ç»œæ•°æ®äº‹ä»¶æˆ–è€…é”™è¯¯äº‹ä»¶ã€‚</p>
</li>
</ul>
<p data-nodeid="84466">æ‰€éœ€çš„å˜é‡å®šä¹‰å®Œæ¯•ä»¥åï¼Œå¯ä»¥åœ¨<code data-backticks="1" data-nodeid="84677">beforeEach()</code>æ–¹æ³•é‡Œé¢åˆå§‹åŒ–<code data-backticks="1" data-nodeid="84679">testScheduler</code>å’Œ<code data-backticks="1" data-nodeid="84681">testObserver</code>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84467"><code data-language="swift">beforeEach {
    testScheduler = <span class="hljs-type">TestScheduler</span>(initialClock: <span class="hljs-number">0</span>)
    testObserver = testScheduler.createObserver(<span class="hljs-type">MomentsDetails</span>.<span class="hljs-keyword">self</span>)
}
</code></pre>
<p data-nodeid="87186">å› ä¸ºåˆå§‹åŒ–æ“ä½œéƒ½åœ¨<code data-backticks="1" data-nodeid="87189">beforeEach()</code>æ–¹æ³•é‡Œé¢ï¼Œæ‰€ä»¥æ¯ä¸ªæµ‹è¯•æ¡ˆä¾‹æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°åˆå§‹åŒ–è¿™ä¸¤ä¸ªå˜é‡ã€‚</p>
<p data-nodeid="87187">åˆå§‹åŒ–å®Œæ¯•åï¼Œæˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•<code data-backticks="1" data-nodeid="87192">GetMomentsByUserIDSession</code>çš„<code data-backticks="1" data-nodeid="87194">getMoments()</code>æ–¹æ³•äº†ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>

<pre class="lang-swift" data-nodeid="84469"><code data-language="swift">context(<span class="hljs-string">"getMoments(userID:)"</span>) {
    context(<span class="hljs-string">"when response status code 200 with valid response"</span>) {
        beforeEach {
            mockResponseEvent = .next(<span class="hljs-number">100</span>, <span class="hljs-type">TestData</span>.successResponse)
            getMoments(mockEvent: mockResponseEvent)
        }
    }
}
</code></pre>
<p data-nodeid="84470">æˆ‘ä»¬ä½¿ç”¨<code data-backticks="1" data-nodeid="84693">context("getMoments(userID:)")</code>æŠŠ<code data-backticks="1" data-nodeid="84695">getMoments(userID:)</code>æ‰€æœ‰çš„æµ‹è¯•æ¡ˆä¾‹éƒ½ç»„ç»‡åœ¨ä¸€èµ·ã€‚å…ˆçœ‹æˆåŠŸçš„æµ‹è¯•æ¡ˆä¾‹ï¼Œè¯¥æ¡ˆä¾‹å°è£…åœ¨<code data-backticks="1" data-nodeid="84697">context("when response status code 200 with valid response")</code>å‡½æ•°é‡Œé¢ï¼Œè¡¨ç¤ºç½‘ç»œæˆåŠŸè¿”å›æœ‰æ•ˆæ•°æ®æ—¶çš„æƒ…å†µã€‚åœ¨<code data-backticks="1" data-nodeid="84699">beforeEach()</code>æ–¹æ³•é‡Œåšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œç¬¬ä¸€ä»¶æ‰§è¡Œ Arrange æ­¥éª¤ï¼Œè®©<code data-backticks="1" data-nodeid="84701">mockResponseEvent</code>å‘å‡ºä¸€ä¸ª<code data-backticks="1" data-nodeid="84703">.next</code>äº‹ä»¶ï¼Œè¯¥äº‹ä»¶é‡Œé¢åŒ…å«äº†ç±»å‹ä¸º<code data-backticks="1" data-nodeid="84705">GetMomentsByUserIDSession.Response</code>çš„æ•°æ®å¯¹è±¡<code data-backticks="1" data-nodeid="84707">successResponse</code>ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªæ•°æ®å¯¹è±¡çš„å®šä¹‰ï¼š</p>
<pre class="lang-swift" data-nodeid="84471"><code data-language="swift"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TestData</span> </span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> successResponse: <span class="hljs-type">GetMomentsByUserIDSession</span>.<span class="hljs-type">Response</span> = {
        <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">try</span>! <span class="hljs-type">JSONDecoder</span>().decode(<span class="hljs-type">GetMomentsByUserIDSession</span>.<span class="hljs-type">Response</span>.<span class="hljs-keyword">self</span>,
                                               from: <span class="hljs-type">TestData</span>.successjson.data(using: .utf8)!)
        <span class="hljs-keyword">return</span> response
    }()
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> successjson = <span class="hljs-string">"""
    {
      "data": { ... } // JSON æ•°æ®
    }
    """</span>
}
</code></pre>
<p data-nodeid="84472">ä»£ç ä¸­çš„ç§æœ‰ç»“æ„ä½“<code data-backticks="1" data-nodeid="84710">TestData</code>ç”¨äºé…ç½®æµ‹è¯•æ•°æ®ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåå«<code data-backticks="1" data-nodeid="84712">successResponse</code>çš„é™æ€å±æ€§æ¥è¿”å›ç±»å‹ä¸º<code data-backticks="1" data-nodeid="84714">GetMomentsByUserIDSession.Response</code>çš„æµ‹è¯•æ•°æ®ã€‚åœ¨è¿™ä¸ªå±æ€§é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code data-backticks="1" data-nodeid="84716">JSONDecoder().decode()</code>æ–¹æ³•æ¥è§£ç  JSON å­—ç¬¦ä¸²ã€‚åœ¨å¼€å‘çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä» BFF çš„è¿”å›å€¼ä¸­æ‹·è´è¯¥ JSON å­—ç¬¦ä¸²ã€‚é€šè¿‡è¿™ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°æµ‹è¯•<code data-backticks="1" data-nodeid="84718">GetMomentsByUserIDSession</code>ç»“æ„ä½“çš„æ˜ å°„æ˜¯å¦æ­£ç¡®ã€‚è¿™ç§åšæ³•æ¯”é€šè¿‡ä¿®æ”¹åå°æ¥è¿”å›æµ‹è¯•æ•°æ®è¦æ–¹ä¾¿å¾ˆå¤šã€‚</p>
<p data-nodeid="84473"><code data-backticks="1" data-nodeid="84720">beforeEach()</code>æ–¹æ³•é‡Œç¬¬äºŒä»¶äº‹æƒ…æ˜¯æ‰§è¡Œ Act æ­¥éª¤ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨<code data-backticks="1" data-nodeid="84722">getMoments(mockEvent: mockResponseEvent)</code>æ–¹æ³•æ¥å®Œæˆè¿™ä¸€ä»»åŠ¡ã€‚è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84474"><code data-language="swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getMoments</span><span class="hljs-params">(mockEvent: Recorded&lt;Event&lt;GetMomentsByUserIDSession.Response&gt;&gt;)</span></span> {
    <span class="hljs-keyword">let</span> testableObservable = testScheduler.createHotObservable([mockEvent])
    testSubject = <span class="hljs-type">GetMomentsByUserIDSession</span> { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> testableObservable.asObservable() }
    testSubject.getMoments(userID: <span class="hljs-string">"0"</span>).subscribe(testObserver).disposed(by: disposeBag)
    testScheduler.start()
}
</code></pre>
<p data-nodeid="84475">é¦–å…ˆæˆ‘ä»¬æŠŠæ¨¡æ‹Ÿæ•°æ®ä¼ é€’ç»™<code data-backticks="1" data-nodeid="84725">testScheduler.createHotObservable()</code>æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„<code data-backticks="1" data-nodeid="84727">testableObservable</code>å¯¹è±¡ï¼Œç„¶åæŠŠè¯¥å¯¹è±¡æ³¨å…¥<code data-backticks="1" data-nodeid="84729">GetMomentsByUserIDSession</code>çš„åˆå§‹åŒ–æ–¹æ³•é‡Œå¹¶ç”Ÿæˆæ–°çš„æµ‹è¯•å¯¹è±¡<code data-backticks="1" data-nodeid="84731">testSubject</code>ï¼Œæ¥ç€è°ƒç”¨æµ‹è¯•å¯¹è±¡çš„<code data-backticks="1" data-nodeid="84733">getMoments(userID:)</code>æ–¹æ³•ï¼Œæœ€åé€šè¿‡è°ƒç”¨<code data-backticks="1" data-nodeid="84735">testScheduler.start()</code>æ–¹æ³•æ¥å¯åŠ¨æ’ç¨‹å™¨ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹ã€‚</p>
<p data-nodeid="84476">æ‰§è¡Œå®Œ Act æ­¥éª¤ä»¥åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰§è¡Œ Assert æ­¥éª¤æ¥æ£€éªŒæµ‹è¯•çš„ç»“æœï¼ŒéªŒè¯çš„ä»£ç éƒ½æ”¾åœ¨<code data-backticks="1" data-nodeid="84738">it("should complete and map the response correctly")</code>æ–¹æ³•é‡Œé¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="lang-swift" data-nodeid="84477"><code data-language="swift">it(<span class="hljs-string">"should complete and map the response correctly"</span>) {
    <span class="hljs-keyword">let</span> expectedMomentsDetails = <span class="hljs-type">TestFixture</span>.momentsDetails
    <span class="hljs-keyword">let</span> actualMomentsDetails = testObserver.events.first!.value.element!
    expect(actualMomentsDetails).toEventually(<span class="hljs-built_in">equal</span>(expectedMomentsDetails))
}
</code></pre>
<p data-nodeid="84478">æˆ‘ä»¬ä»<code data-backticks="1" data-nodeid="84741">testObserver</code>é‡Œå–å‡ºå®ƒæ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åè°ƒç”¨<code data-backticks="1" data-nodeid="84743">expect()</code>æ–¹æ³•æ¥æ¯”è¾ƒå®é™…æ•°æ®å’Œé¢„æœŸæ•°æ®ã€‚å› ä¸ºç½‘ç»œçš„æ•°æ®æ˜¯å¼‚æ­¥è¿”å›çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ¯”è¾ƒè¿‡ç¨‹æ—¶ä½¿ç”¨äº†<code data-backticks="1" data-nodeid="84745">toEventually()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šç­‰å¾…ç»“æœè¿”å›ä»¥åæ‰è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p data-nodeid="84479">æˆåŠŸæ¡ˆä¾‹å·²ç»æµ‹è¯•å®Œæ¯•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸ªå¤±è´¥çš„æ¡ˆä¾‹ã€‚ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿäº†ç½‘ç»œè®¿é—®å¤±è´¥çš„æƒ…å†µï¼š</p>
<pre class="lang-swift" data-nodeid="84480"><code data-language="swift">context(<span class="hljs-string">"when response status code non-200"</span>) {
    <span class="hljs-keyword">let</span> networkError: <span class="hljs-type">APISessionError</span> = .networkError(error: <span class="hljs-type">MockError</span>(), statusCode: <span class="hljs-number">500</span>)
    beforeEach {
        mockResponseEvent = .error(<span class="hljs-number">100</span>, networkError, <span class="hljs-type">GetMomentsByUserIDSession</span>.<span class="hljs-type">Response</span>.<span class="hljs-keyword">self</span>)
        getMoments(mockEvent: mockResponseEvent)
    }
    it(<span class="hljs-string">"should throw a network error"</span>) {
        <span class="hljs-keyword">let</span> actualError = testObserver.events.first!.value.error <span class="hljs-keyword">as</span>! <span class="hljs-type">APISessionError</span>
        expect(actualError).toEventually(<span class="hljs-built_in">equal</span>(networkError))
    }
}
</code></pre>
<p data-nodeid="84481">ä½ å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•ä»£ç çš„ç»“æ„å’ŒæˆåŠŸæ¡ˆä¾‹æ˜¯ä¸€è‡´çš„ï¼Œä¸åŒçš„åœ°æ–¹æ˜¯æˆ‘ä»¬è®©<code data-backticks="1" data-nodeid="84749">mockResponseEvent</code>è¿”å›ä¸€ä¸ªé”™è¯¯çš„äº‹ä»¶ï¼Œåœ¨æ£€éªŒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»<code data-backticks="1" data-nodeid="84751">testObserver</code>å–å‡º<code data-backticks="1" data-nodeid="84753">error</code>æ¥è¿›è¡Œå¯¹æ¯”ï¼Œè€Œä¸æ˜¯<code data-backticks="1" data-nodeid="84755">element</code>ã€‚</p>
<p data-nodeid="84482">ç½‘ç»œæµ‹è¯•çš„ä»£ç å°±è®²åˆ°è¿™é‡Œï¼Œä½ å¯ä»¥æ‰“å¼€æ‹‰å‹¾æ•™è‚²ç½‘çš„ä»£ç ä»“åº“æ¥æŸ¥çœ‹æ›´å¤šç½‘ç»œå±‚çš„æµ‹è¯•æ¡ˆä¾‹ã€‚</p>
<h3 data-nodeid="84483">Repository å±‚çš„æµ‹è¯•</h3>
<p data-nodeid="84484">ä¸‹é¢æˆ‘ä»¬ä»¥<code data-backticks="1" data-nodeid="84760">MomentsRepoTests</code>ä¸ºä¾‹å­çœ‹ä¸€ä¸‹å¦‚ä½•æµ‹è¯• Repository å±‚ã€‚</p>
<p data-nodeid="84485"><code data-backticks="1" data-nodeid="84762">MomentsRepoTests</code>ç”¨äºæµ‹è¯•<code data-backticks="1" data-nodeid="84764">MomentsRepo</code>ã€‚æˆ‘ä»¬åœ¨ã€Š19 | æ•°æ®å±‚æ¶æ„ï¼šå¦‚ä½•ä½¿ç”¨ä»“åº“æ¨¡å¼è®¾è®¡æ•°æ®å­˜å‚¨å±‚ï¼Ÿã€‹ä¸­æè¿°è¿‡ï¼Œ<code data-backticks="1" data-nodeid="84766">MomentsRepo</code>ä¾èµ–äº†<code data-backticks="1" data-nodeid="84768">PersistentDataStoreType</code>æ¥è¯»å–æœ¬åœ°æ•°æ®ï¼Œå¹¶ä¸”ä¾èµ–äº†<code data-backticks="1" data-nodeid="84770">GetMomentsByUserIDSessionType</code>ä» BFF è¯»å–æœ‹å‹åœˆä¿¡æ¯ã€‚é‚£æˆ‘ä»¬æµ‹è¯•<code data-backticks="1" data-nodeid="84772">MomentsRepo</code>çš„æ—¶å€™æ˜¯ä¸æ˜¯ä¹Ÿä¸€åŒæµ‹è¯•ä¸¤ä¸ªç±»å‹çš„å®ç°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸º<strong data-nodeid="84788">æ‰€è°“å•å…ƒæµ‹è¯•å°±æ˜¯åªå•ç‹¬æµ‹è¯•æŸä¸ªç±»å‹çš„å…·ä½“å®ç°ï¼Œè€Œä¸æµ‹è¯•å®ƒçš„ä¾èµ–ç±»å‹</strong>ã€‚å›åˆ°<code data-backticks="1" data-nodeid="84778">MomentsRepoTests</code>çš„ä¾‹å­ï¼Œå®ƒä»…ä»…æµ‹è¯•<code data-backticks="1" data-nodeid="84780">MomentsRepo</code>çš„å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªæ€•æˆ‘ä»¬æ›¿æ¢äº†<code data-backticks="1" data-nodeid="84782">PersistentDataStoreType</code>å’Œ<code data-backticks="1" data-nodeid="84784">GetMomentsByUserIDSessionType</code>çš„å®ç°ï¼Œåœ¨ä¸ä¿®æ”¹<code data-backticks="1" data-nodeid="84786">MomentsRepoTests</code>çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹éƒ½å¿…é¡»é€šè¿‡éªŒè¯ã€‚</p>
<p data-nodeid="84486">é‚£æ€æ ·æ‰èƒ½ä½¿å¾—<code data-backticks="1" data-nodeid="84790">MomentsRepoTests</code>åªæµ‹è¯•<code data-backticks="1" data-nodeid="84792">MomentsRepo</code>çš„å®ç°ï¼Œè€Œä¸æµ‹è¯•å…¶ä»–ä»»ä½•çš„ä¾èµ–ç±»å‹å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ Mock ç±»å‹æ¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚ä¸‹é¢æ˜¯ Mock ç±»å‹çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre class="lang-swift" data-nodeid="84487"><code data-language="swift"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MockUserDefaultsPersistentDataStore</span>: <span class="hljs-title">PersistentDataStoreType</span> </span>{
    <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> momentsDetails: <span class="hljs-type">ReplaySubject</span>&lt;<span class="hljs-type">MomentsDetails</span>&gt; = .create(bufferSize: <span class="hljs-number">1</span>)
    <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> savedMomentsDetails: <span class="hljs-type">MomentsDetails?</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">save</span><span class="hljs-params">(momentsDetails: MomentsDetails)</span></span> {
        savedMomentsDetails = momentsDetails
    }
}
<span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MockGetMomentsByUserIDSession</span>: <span class="hljs-title">GetMomentsByUserIDSessionType</span> </span>{
    <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> getMomentsHasbeenCalled = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> passedUserID: <span class="hljs-type">String</span> = <span class="hljs-string">""</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getMoments</span><span class="hljs-params">(userID: String)</span></span> -&gt; <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">MomentsDetails</span>&gt; {
        passedUserID = userID
        getMomentsHasbeenCalled = <span class="hljs-literal">true</span>
        <span class="hljs-keyword">return</span> <span class="hljs-type">Observable</span>.just(<span class="hljs-type">TestFixture</span>.momentsDetails)
    }
}
</code></pre>
<p data-nodeid="84488">æˆ‘ä»¬åˆ†åˆ«å®šä¹‰äº†ä¸¤ä¸ª Mock ç±»å‹æ¥éµå¾ª<code data-backticks="1" data-nodeid="84795">PersistentDataStoreType</code>å’Œ<code data-backticks="1" data-nodeid="84797">GetMomentsByUserIDSessionType</code>åè®®ï¼Œè¿™äº› Mock ç±»å‹åªæ˜¯æŠŠä¼ é€’çš„å‚æ•°ä¿å­˜åœ¨å±æ€§ä¸­ï¼Œå¹¶ä¸è¿›è¡Œå…·ä½“çš„æ“ä½œï¼Œä¾‹å¦‚ä¸ä¼šè¯»å†™æœ¬åœ°æ•°æ®åº“å’Œè®¿é—®ç½‘ç»œã€‚</p>
<p data-nodeid="84489">æœ‰äº†è¿™äº› Mock ç±»å‹ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒä»¬æ³¨å…¥æµ‹è¯•å¯¹è±¡<code data-backticks="1" data-nodeid="84800">testSubject</code>ä¸­ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84490"><code data-language="swift">beforeEach {
    mockUserDefaultsPersistentDataStore = <span class="hljs-type">MockUserDefaultsPersistentDataStore</span>()
    mockGetMomentsByUserIDSession = <span class="hljs-type">MockGetMomentsByUserIDSession</span>()
    testSubject = <span class="hljs-type">MomentsRepo</span>(persistentDataStore: mockUserDefaultsPersistentDataStore, getMomentsByUserIDSession: mockGetMomentsByUserIDSession)
}
</code></pre>
<p data-nodeid="84491">åœ¨ä¸Šä¸€è®²çš„æ€è€ƒé¢˜ä¸­æˆ‘æé—®è¿‡ï¼šä¸ºä»€ä¹ˆä¿å­˜ä¾èµ–çš„å±æ€§éƒ½æ˜¯é€šè¿‡<code data-backticks="1" data-nodeid="84803">init()</code>æ–¹æ³•æ¥æ³¨å…¥ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨è¿›è¡Œåˆå§‹åŒ–ï¼Ÿ<strong data-nodeid="84817">ä¸€ä¸ªé‡è¦çš„åŸå› æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œå•å…ƒæµ‹è¯•æ—¶æŠŠ Mock ç±»å‹æ³¨å…¥è¿›æ¥</strong>ã€‚ä¾‹å¦‚åœ¨ç”Ÿäº§ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸º<code data-backticks="1" data-nodeid="84809">MomentsRepo</code>çš„<code data-backticks="1" data-nodeid="84811">persistentDataStore</code>å±æ€§æ³¨å…¥<code data-backticks="1" data-nodeid="84813">UserDefaultsPersistentDataStore.shared</code>æ¥è®¿é—® iOS ç³»ç»Ÿçš„ UserDefaultsã€‚UserDefaults ä¸Šçš„æ•°æ®åœ¨ç¨‹åºé€€å‡ºä»¥åè¿˜ä¼šä¿ç•™ï¼Œè€Œå•å…ƒæµ‹è¯•çš„æ¡ˆä¾‹æ˜¯æ— çŠ¶æ€çš„ï¼Œå› æ­¤æ‰€æœ‰æµ‹è¯•éƒ½ä¸åº”è¯¥è¯»å†™ UserDefaults ä¸Šçš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œé€šè¿‡æ³¨å…¥<code data-backticks="1" data-nodeid="84815">MockUserDefaultsPersistentDataStore</code>çš„å¯¹è±¡æ¥é¿å…è®¿é—® UserDefaultsã€‚</p>
<p data-nodeid="84492">ä¾èµ–æ³¨å…¥æ˜¯é¢å‘æŠ½è±¡ç¼–ç¨‹ä¸­ä¸€ç§æœ‰æ•ˆçš„å®è·µæ–¹å¼ï¼Œä¸ä½†æ–¹ä¾¿æˆ‘ä»¬ç¼–å†™æµ‹è¯•ä»£ç ï¼Œä½¿å¾—æµ‹è¯•ä¸ä¾èµ–äºä»»ä½•çš„å…·ä½“ç¯å¢ƒï¼ŒåŒæ—¶è¿˜èƒ½å¸®æˆ‘ä»¬å¾ˆå®¹æ˜“åœ°æ›¿æ¢æŸä¸ªæ¨¡å—çš„å…·ä½“å®ç°ï¼Œä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å†³å®šä½¿ç”¨ CoreData æ¥æ›¿æ¢ UserDefaults ä½œä¸ºæœ¬åœ°æ•°æ®å­˜å‚¨æ—¶ï¼Œåªéœ€åœ¨ç”Ÿäº§ä»£ç ä¸­æ³¨å…¥<code data-backticks="1" data-nodeid="84819">CoreDataPersistentDataStore.shared</code>å³å¯ã€‚</p>
<p data-nodeid="84493">æœ‰äº† Mock ç±»å‹ä»¥åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•æµ‹è¯•<code data-backticks="1" data-nodeid="84822">MomentsRepo</code>çš„<code data-backticks="1" data-nodeid="84824">momentsDetails</code>å±æ€§ï¼Œå…¶ä¸­ Arrange å’Œ Act æ­¥éª¤çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84494"><code data-language="swift">context(<span class="hljs-string">"momentsDetails"</span>) {
    <span class="hljs-keyword">var</span> testObserver: <span class="hljs-type">TestObserver</span>&lt;<span class="hljs-type">MomentsDetails</span>&gt;!
    beforeEach {
        testObserver = <span class="hljs-type">TestObserver</span>&lt;<span class="hljs-type">MomentsDetails</span>&gt;() <span class="hljs-comment">// Arrange</span>
        testSubject.momentsDetails.subscribe(testObserver).disposed(by: disposeBag) <span class="hljs-comment">// Act</span>
    }
}
</code></pre>
<p data-nodeid="84495">é¦–å…ˆï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ª<code data-backticks="1" data-nodeid="84827">TestObserver</code>å¯¹è±¡æ¥å¸®åŠ©æµ‹è¯• RxSwift çš„ä»£ç ã€‚<code data-backticks="1" data-nodeid="84829">TestObserver</code>æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªç±»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84496"><code data-language="swift"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObserver</span>&lt;<span class="hljs-title">ElementType</span>&gt;: <span class="hljs-title">ObserverType</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastEvent: <span class="hljs-type">Event</span>&lt;<span class="hljs-type">ElementType</span>&gt;?
    <span class="hljs-keyword">var</span> lastElement: <span class="hljs-type">ElementType?</span> {
        <span class="hljs-keyword">return</span> lastEvent?.element
    }
    <span class="hljs-keyword">var</span> lastError: <span class="hljs-type">Error?</span> {
        <span class="hljs-keyword">return</span> lastEvent?.error
    }
    <span class="hljs-keyword">var</span> isCompleted: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> lastEvent?.isCompleted ?? <span class="hljs-literal">false</span>
    }
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">on</span><span class="hljs-params">(<span class="hljs-number">_</span> event: Event&lt;ElementType&gt;)</span></span> {
        lastEvent = event
    }
}
</code></pre>
<p data-nodeid="84497"><code data-backticks="1" data-nodeid="84831">TestObserver</code>å®šä¹‰äº†<code data-backticks="1" data-nodeid="84833">on(_ event: Event&lt;ElementType&gt;)</code>æ–¹æ³•æ¥æ¥æ”¶äº‹ä»¶ï¼Œå¹¶æä¾›äº†<code data-backticks="1" data-nodeid="84835">lastElement</code>ã€<code data-backticks="1" data-nodeid="84837">lastError</code>å’Œ<code data-backticks="1" data-nodeid="84839">isCompleted</code>å±æ€§æ¥æ£€æŸ¥æœ€åä¸€æ¡äº‹ä»¶çš„ç±»å‹ã€‚æœ‰äº†<code data-backticks="1" data-nodeid="84841">testObserver</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä¼ é€’ç»™<code data-backticks="1" data-nodeid="84843">subscribe()</code>æ–¹æ³•æ¥è®¢é˜…<code data-backticks="1" data-nodeid="84845">momentsDetails</code>å±æ€§çš„äº‹ä»¶ï¼Œç„¶åé€šè¿‡å®ƒæ¥éªŒè¯ RxSwift ä»£ç çš„æµ‹è¯•ç»“æœï¼Œä¸‹é¢æ˜¯ Assert æ­¥éª¤çš„ä»£ç ï¼š</p>
<pre class="lang-swift" data-nodeid="84498"><code data-language="swift">it(<span class="hljs-string">"should be `nil` by default"</span>) {
    expect(testObserver.lastElement).to(beNil()) <span class="hljs-comment">// Assert</span>
}
context(<span class="hljs-string">"when persistentDataStore has new data"</span>) {
    beforeEach {
        mockUserDefaultsPersistentDataStore.momentsDetails.onNext(<span class="hljs-type">TestFixture</span>.momentsDetails)
    }
    it(<span class="hljs-string">"should notify a next event with the new data"</span>) {
        expect(testObserver.lastElement).toEventually(<span class="hljs-built_in">equal</span>(<span class="hljs-type">TestFixture</span>.momentsDetails)) <span class="hljs-comment">// Assert</span>
    }
}
</code></pre>
<p data-nodeid="84499">åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œ<code data-backticks="1" data-nodeid="84848">testObserver</code>ä¸åº”è¯¥æ¥æ”¶åˆ°ä»»ä½•äº‹ä»¶ï¼Œæ‰€ä»¥å®ƒçš„<code data-backticks="1" data-nodeid="84850">lastElement</code>å±æ€§è¿”å›<code data-backticks="1" data-nodeid="84852">nil</code>ã€‚å½“æˆ‘ä»¬å¾€ Mock ç±»å‹<code data-backticks="1" data-nodeid="84854">mockUserDefaultsPersistentDataStore</code>çš„<code data-backticks="1" data-nodeid="84856">momentsDetails</code>å±æ€§å‘å‡ºä¸€ä¸ª<code data-backticks="1" data-nodeid="84858">next</code>äº‹ä»¶åï¼Œ<code data-backticks="1" data-nodeid="84860">testObserver</code>ä¼šæ¥æ”¶åˆ°è¯¥äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨<code data-backticks="1" data-nodeid="84862">toEventually()</code>æ–¹æ³•æ¥è¿›è¡Œæ£€æŸ¥ã€‚</p>
<p data-nodeid="84500">ä¸‹é¢æˆ‘ä»¬å†çœ‹çœ‹<code data-backticks="1" data-nodeid="84865">getMoments(userID:)</code>æ–¹æ³•çš„æµ‹è¯•ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84501"><code data-language="swift">context(<span class="hljs-string">"getMoments(userID:)"</span>) {
    beforeEach {
        testSubject.getMoments(userID: <span class="hljs-string">"1"</span>).subscribe().disposed(by: disposeBag)
    }
    it(<span class="hljs-string">"should call `GetMomentsByUserIDSessionType.getMoments`"</span>) {
        expect(mockGetMomentsByUserIDSession.getMomentsHasbeenCalled).to(beTrue())
        expect(mockGetMomentsByUserIDSession.passedUserID).to(be(<span class="hljs-string">"1"</span>))
    }
    it(<span class="hljs-string">"should save a `MomentsDetails` object"</span>) {
        expect(mockUserDefaultsPersistentDataStore.savedMomentsDetails).to(<span class="hljs-built_in">equal</span>(<span class="hljs-type">TestFixture</span>.momentsDetails))
    }
}
</code></pre>
<p data-nodeid="84502">æˆ‘ä»¬åœ¨<code data-backticks="1" data-nodeid="84868">beforeEach()</code>æ–¹æ³•ä¸­æ‰§è¡Œäº† Act æ­¥éª¤æ¥è°ƒç”¨<code data-backticks="1" data-nodeid="84870">getMoments(userID:)</code>æ–¹æ³•ï¼Œè¿™é‡Œé¦–å…ˆå¤ä¹ ä¸€ä¸‹ã€Šç¬¬ 19 è®²| æ•°æ®å±‚æ¶æ„ï¼šå¦‚ä½•ä½¿ç”¨ä»“åº“æ¨¡å¼è®¾è®¡æ•°æ®å­˜å‚¨å±‚ï¼Ÿã€‹é‡Œè®²è¿‡çš„<code data-backticks="1" data-nodeid="84872">MomentsRepo</code>æ–¹æ³•çš„å®ç°ã€‚</p>
<pre class="lang-swift" data-nodeid="84503"><code data-language="swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getMoments</span><span class="hljs-params">(userID: String)</span></span> -&gt; <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Void</span>&gt; {
    <span class="hljs-keyword">return</span> getMomentsByUserIDSession
        .getMoments(userID: userID)
        .<span class="hljs-keyword">do</span>(onNext: { persistentDataStore.save(momentsDetails: $<span class="hljs-number">0</span>) })
        .<span class="hljs-built_in">map</span> { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> () }
        .catchErrorJustReturn(())
}
</code></pre>
<p data-nodeid="84504">åœ¨è¯¥æ–¹æ³•å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨<code data-backticks="1" data-nodeid="84875">getMomentsByUserIDSession</code>çš„<code data-backticks="1" data-nodeid="84877">getMoments(userID:)</code>æ¥è¯»å–ç½‘ç»œæ•°æ®ï¼Œå¹¶è°ƒç”¨<code data-backticks="1" data-nodeid="84879">persistentDataStore</code>çš„<code data-backticks="1" data-nodeid="84881">save(momentsDetails:)</code>æ–¹æ³•æŠŠç½‘ç»œè¿”å›ç»“æœä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“ä¸­ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä¸ºè¿™ä¸¤ä¸ªä¾èµ–é¡¹åˆ†åˆ«æ³¨å…¥äº†ä¸åŒçš„ Mock å¯¹è±¡ï¼Œå› æ­¤åœ¨æ£€éªŒç»“æœçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯”è¾ƒ Mock å¯¹è±¡çš„å±æ€§å°±èƒ½éªŒè¯æµ‹è¯•æ˜¯å¦æ­£ç¡®æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ£€æŸ¥<code data-backticks="1" data-nodeid="84883">mockGetMomentsByUserIDSession.passedUserID</code>æ¥éªŒè¯<code data-backticks="1" data-nodeid="84885">getMomentsByUserIDSession</code>çš„æ‰§è¡Œç»“æœï¼Œç„¶åæ£€æŸ¥<code data-backticks="1" data-nodeid="84887">mockUserDefaultsPersistentDataStore.savedMomentsDetails</code>æ¥éªŒè¯<code data-backticks="1" data-nodeid="84889">persistentDataStore</code>çš„æ‰§è¡Œç»“æœã€‚</p>
<h3 data-nodeid="84505">ViewModel å±‚çš„æµ‹è¯•</h3>
<p data-nodeid="84506">å®Œæˆ Repository å±‚çš„æµ‹è¯•ä»¥åï¼Œæˆ‘ä»¬å†ä¸€èµ·çœ‹çœ‹å¦‚ä½•æµ‹è¯• ViewModel å±‚çš„ä»£ç ã€‚</p>
<p data-nodeid="84507">æœ‹å‹åœˆåŠŸèƒ½çš„ ViewModel å±‚ç”±ä¸‰ä¸ª ViewModel ç±»å‹æ‰€ç»„æˆï¼Œå…¶ä¸­<code data-backticks="1" data-nodeid="84894">MomentsTimelineViewModel</code>ç±»å‹çš„æµ‹è¯•æ–¹å¼ä¸<code data-backticks="1" data-nodeid="84896">MomentsRepo</code>æ˜¯ä¸€æ ·çš„ï¼Œ<strong data-nodeid="84902">éƒ½æ˜¯é€šè¿‡æ³¨å…¥ Mock ç±»å‹ç±»æ¥æµ‹è¯• RxSwift è¿”å›çš„ç»“æœ</strong>ã€‚ä½ å¯ä»¥åœ¨æ‹‰å‹¾æ•™è‚²ç½‘çš„ä»£ç ä»“åº“æŸ¥çœ‹è¯¦ç»†çš„ä»£ç å®ç°ã€‚</p>
<p data-nodeid="84508">å› ä¸º<code data-backticks="1" data-nodeid="84904">UserProfileListItemViewModel</code>çš„è´£ä»»æ˜¯æŠŠ Model ç±»å‹çš„æ•°æ®è½¬æ¢æˆ UI å‘ˆç°æ‰€éœ€çš„ ViewModel ç±»å‹ï¼Œé‚£ä¹ˆä½œä¸ºå…¶æµ‹è¯•ç±»å‹ï¼Œ<code data-backticks="1" data-nodeid="84906">UserProfileListItemViewModelTests</code>çš„å·¥ä½œå°±æ˜¯éªŒè¯è¿™äº›æ•°æ®è½¬æ¢çš„é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹<code data-backticks="1" data-nodeid="84908">UserProfileListItemViewModelTests</code>çš„å®ç°ä»£ç ï¼Œé¦–å…ˆæ˜¯æˆåŠŸçš„æµ‹è¯•æ¡ˆä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="lang-swift" data-nodeid="84509"><code data-language="swift">context(<span class="hljs-string">"init(userDetails:)"</span>) {
    context(<span class="hljs-string">"when all data provided"</span>) {
        beforeEach {
            testSubject = <span class="hljs-type">UserProfileListItemViewModel</span>(userDetails: <span class="hljs-type">TestFixture</span>.userDetails)
        }
        it(<span class="hljs-string">"should initialize the properties correctly"</span>) {
            expect(testSubject.name).to(<span class="hljs-built_in">equal</span>(<span class="hljs-string">"Jake Lin"</span>))
            expect(testSubject.avatarURL).to(<span class="hljs-built_in">equal</span>(<span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://avatars-url.com"</span>)))
            expect(testSubject.backgroundImageURL).to(<span class="hljs-built_in">equal</span>(<span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://background-image-url.com"</span>)))
        }
    }
}
</code></pre>
<p data-nodeid="84510">å› ä¸ºæ‰€æœ‰çš„è½¬æ¢é€»è¾‘éƒ½å°è£…åœ¨<code data-backticks="1" data-nodeid="84911">UserProfileListItemViewModel</code>çš„<code data-backticks="1" data-nodeid="84913">init(userDetails:)</code>æ–¹æ³•é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æµ‹è¯•è¯¥<code data-backticks="1" data-nodeid="84915">init()</code>æ–¹æ³•æ¥éªŒè¯æ•°æ®è½¬æ¢çš„é€»è¾‘ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠé¢„å…ˆå‡†å¤‡å¥½çš„ Model æ•°æ®<code data-backticks="1" data-nodeid="84917">TestFixture.userDetails</code>ä¼ é€’ç»™<code data-backticks="1" data-nodeid="84919">UserProfileListItemViewModel</code>æ¥åˆå§‹åŒ–<code data-backticks="1" data-nodeid="84921">testSubject</code>ï¼Œç„¶ååœ¨<code data-backticks="1" data-nodeid="84923">it("should initialize the properties correctly")</code>æ–¹æ³•é‡Œæ£€éªŒå„ä¸ªå±æ€§çš„è½¬æ¢ç»“æœï¼Œä¾‹å¦‚<code data-backticks="1" data-nodeid="84925">name</code>ç­‰äº â€œJake Linâ€ï¼Œè€Œ<code data-backticks="1" data-nodeid="84927">avatarURL</code>å’Œ<code data-backticks="1" data-nodeid="84929">backgroundImageURL</code>éƒ½æ­£ç¡®åœ°ä»å­—ç¬¦ä¸²è½¬æ¢æˆ URL ç±»å‹ã€‚</p>
<p data-nodeid="84511">ä¸‹é¢æ˜¯è½¬æ¢é”™è¯¯æ—¶çš„æƒ…å†µï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-swift" data-nodeid="84512"><code data-language="swift">context(<span class="hljs-string">"when `userDetails.avatar` is not a valid URL"</span>) {
    beforeEach {
        testSubject = <span class="hljs-type">UserProfileListItemViewModel</span>(userDetails: <span class="hljs-type">MomentsDetails</span>.<span class="hljs-type">UserDetails</span>(id: <span class="hljs-string">"1"</span>, name: <span class="hljs-string">"name"</span>, avatar: <span class="hljs-string">"this is not a valid URL"</span>, backgroundImage: <span class="hljs-string">"https://background-image-url.com"</span>))
    }
    it(<span class="hljs-string">"`avatarURL` should be nil"</span>) {
        expect(testSubject.avatarURL).to(beNil())
    }
}
</code></pre>
<p data-nodeid="84513">å½“æˆ‘ä»¬æŠŠæ— æ•ˆçš„ URL å­—ç¬¦ä¸²ä¼ é€’ç»™<code data-backticks="1" data-nodeid="84933">avatar</code>å±æ€§æ—¶ï¼Œè½¬æ¢åçš„<code data-backticks="1" data-nodeid="84935">testSubject.avatarURL</code>å°±ä¼šå˜æˆ<code data-backticks="1" data-nodeid="84937">nil</code>ã€‚</p>
<p data-nodeid="84514">å…¶ä»–è½¬æ¢é”™è¯¯çš„æ¡ˆä¾‹ä¸ä¸Šé¢çš„ä¾‹å­ç±»ä¼¼ï¼Œä½ å¯ä»¥åœ¨æ‹‰å‹¾æ•™è‚²çš„ä»£ç ä»“åº“é‡Œè¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<p data-nodeid="84515">åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è®²å®Œå¦‚ä½•ä¸º MVVM æ¶æ„å¼€å‘å•å…ƒæµ‹è¯•äº†ã€‚</p>
<h3 data-nodeid="84516">æ€»ç»“</h3>
<p data-nodeid="84517">åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»¥æœ‹å‹åœˆåŠŸèƒ½ä½œä¸ºä¾‹å­ï¼Œè®²è¿°å¦‚ä½•é€šè¿‡ AAA æ–¹æ³•ä¸€æ­¥æ­¥åœ°ä¸ºç½‘ç»œå±‚ã€Repository å±‚å’Œ ViewModel å±‚ç¼–å†™å•å…ƒæµ‹è¯•ã€‚<strong data-nodeid="84947">é€šè¿‡ TDD æ–¹å¼æ‰€å¼€å‘çš„ä»£ç ä¼šè¿«ä½¿æˆ‘ä»¬å®šä¹‰è‰¯å¥½çš„æ¥å£ï¼Œå¹¶ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ¥ç®¡ç†æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› æ­¤ï¼Œé€šè¿‡ TDD æ–¹æ³•æ‰€å¼€å‘çš„æ¨¡å—éƒ½å…·å¤‡å¼ºå†…èšã€å¼±è€¦åˆã€å¯æ‰©å±•ç­‰ç‰¹æ€§</strong>ã€‚åŒæ—¶ï¼Œå•å…ƒæµ‹è¯•èƒ½å¸®åŠ©æˆ‘ä»¬ä¾¿æ·åœ°æ¨¡æ‹Ÿä¸åŒçš„æµ‹è¯•æ¡ˆä¾‹ï¼Œä»è€Œæé«˜ä»£ç çš„è´¨é‡ï¼Œå‡å°‘ Bug å’Œ App çš„å´©æºƒç‡ã€‚å¸Œæœ›ä½ åœ¨å·¥ä½œä¸­ä¹Ÿå¯ä»¥æ¨åŠ¨ TDDï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ‰€èŠ±è´¹çš„æ—¶é—´è¿œæ¯”ä»¥åä¿®æ”¹ Bug æ‰€éœ€æ—¶é—´è¦å°‘å¾ˆå¤šã€‚</p>
<p data-nodeid="84518">ç°åœ¨ï¼Œâ€œæ¶æ„ä¸å®ç°â€æ¨¡å—æˆ‘ä»¬å·²ç»è®²è¿°å®Œæ¯•äº†ã€‚åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬è®²è¿°äº†å¦‚ä½•ä½¿ç”¨ BFF è®¾è®¡è·¨å¹³å°çš„ç³»ç»Ÿæ¶æ„ï¼Œç„¶ååˆ†æäº†å¦‚ä½•ä½¿ç”¨ RxSwift æ¥è®¾è®¡ä¸€å¥—æ ¹æ®æ•°æ®æµè‡ªåŠ¨æ›´æ–°çš„ MVVM æ¡†æ¶ï¼Œå¹¶è¯¦ç»†ä»‹ç»äº† MVVM æ¯ä¸€å±‚çš„å…·ä½“å®ç°ã€‚</p>
<p data-nodeid="84519">åœ¨ç»“æŸè¿™ä¸€æ¨¡å—å‰ï¼Œæˆ‘è¿˜æƒ³å†åˆ†äº«ä¸€ä¸‹æˆ‘ä¸ªäººå¯¹ App æ¶æ„ä¸å®ç°çš„ç†è§£ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>
<p data-nodeid="84520">è‹¹æœå…¬å¸æ‰€æä¾›çš„ MVC æ¨¡å¼å¹¶æ²¡æœ‰å¾ˆå¥½åœ°è§£å†³ App æ¶æ„çš„é—®é¢˜ï¼ŒiOS å¼€å‘ç¤¾åŒºåœ¨æ¢ç´¢çš„è¿‡ç¨‹ä¸­å½¢æˆäº†å¤šç§æ¶æ„ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ MVC åŠ ä¸Š Coordinator çš„ MVCC æ¨¡å¼ï¼Œè¿˜æœ‰ MVPã€VIPER ä»¥åŠæ–‡ç« ä¸­è®²è¿°çš„ MVVM æ¶æ„ç­‰ã€‚å°½ç®¡å®ƒä»¬çš„æ¶æ„ä¸å®ç°å¯èƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯å®ƒä»¬çš„ç›®çš„éƒ½æ˜¯è§£å†³è‡ƒè‚¿çš„ MVC é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬åœ¨è®¾è®¡è¿‡ç¨‹ä¸­éƒ½éµå¾ªä¸€äº›é€šç”¨çš„åŸåˆ™ï¼Œä¾‹å¦‚å•ä¸€è´£ä»»åŸåˆ™ï¼ˆæ¯ä¸€ä¸ªç»„ä»¶åªå®Œæˆå•ç‹¬çš„ä¸€ä¸ªåŠŸèƒ½ï¼‰å’Œå¼€é—­åŸåˆ™ï¼ˆé€šè¿‡æŠ½è±¡çš„åè®®æ¥å°é—­å…·ä½“çš„å®ç°ï¼Œä½†åŒæ—¶å¼€æ”¾å¯¹ç±»å‹çš„æ‰©å±•ï¼‰ï¼Œç­‰ç­‰ã€‚</p>
<p data-nodeid="84521">åŸºäºè¿™äº›é€šç”¨çš„è®¾è®¡åŸåˆ™ï¼Œå¹¶ç»“åˆå¤šå¹´çš„ç»éªŒä¸æ•™è®­ï¼Œ<strong data-nodeid="84960">æˆ‘ä¸º Moments App é‡æ–°æ¶æ„å’Œå®ç°äº†ä¸€å¥—åŸºäº RxSwift çš„ MVVM æ¶æ„</strong>ã€‚é€šè¿‡è¿™ä¸€æ¨¡å—çš„å­¦ä¹ ï¼Œæƒ³å¿…ä½ å·²ç»è§è¯†åˆ°è¿™å¥—æ¡†æ¶çš„å¨åŠ›äº†ï¼Œä½†å¹¶ä¸ä»£è¡¨è¿™å°±æ˜¯é»˜è®¤çš„æˆ–è€…æ ‡å‡†çš„ MVVM å®ç°æ–¹å¼ï¼Œç”šè‡³å¯ä»¥è¯´åœ¨è½¯ä»¶æ¶æ„é¢†åŸŸæ ¹æœ¬å°±æ²¡æœ‰ä»€ä¹ˆä¸€æˆä¸å˜çš„æ ‡å‡†æ–¹æ¡ˆï¼Œ<strong data-nodeid="84961">ä¸€å¥—å¥½çš„æ–¹æ¡ˆåº”è¯¥å¯ä»¥æ ¹æ®éœ€æ±‚çš„å˜åŒ–è€Œä¸æ–­åœ°è¿­ä»£ä¸æ”¹è¿›</strong>ã€‚</p>
<p data-nodeid="84522">å½“ä½ æƒ³ä½¿ç”¨è¿™å¥—æ¡†æ¶çš„æ—¶å€™ï¼Œå¯ä»¥ç»“åˆè‡ªå·±çš„é¡¹ç›®ï¼Œéµå¾ªé€šç”¨çš„è®¾è®¡åŸåˆ™æ¥æ…¢æ…¢æ”¹è¿›ï¼Œä¾‹å¦‚ï¼ŒæŠŠæ‰€æœ‰çš„ç½‘ç»œå±‚é€»è¾‘éƒ½å°è£…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œå…¶ä»–æ¨¡å—å¿…é¡»é€šè¿‡ç½‘ç»œå±‚æ¨¡å—æ¥è®¿é—®ç½‘ç»œï¼Œæˆ–è€…æŠŠæ‰€æœ‰æ•°æ®è®¿é—®éƒ½æ”¾åˆ° Repository æ¨¡å—ä¸­ï¼ŒUI éœ€è¦è®¿é—®æ•°æ®æ—¶éƒ½é€šè¿‡ Repository æ¥å­˜å–ã€‚åˆä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ¨¡å—éœ€è¦ä¾èµ–äºå…¶ä»–æ¨¡å—æ—¶ï¼Œéƒ½åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œè¿™æ ·èƒ½æ–¹ä¾¿æˆ‘ä»¬ä»¥åæ›¿æ¢å…·ä½“å®ç°ï¼Œæé«˜æ¶æ„çš„å¯æ‰©å±•æ€§ã€‚</p>
<p data-nodeid="88292" class="te-preview-highlight">è¿˜æœ‰ä¸€ç‚¹æˆ‘æƒ³å¼ºè°ƒä¸€ä¸‹ï¼Œå†™ä»£ç æ˜¯ä¸€é—¨æ‰‹è‰ºæ´»ã€‚è¿™ä¸ªæ¨¡å—çš„ä»£ç å®ç°æ¯”è¾ƒå¤šï¼Œæˆ‘å»ºè®®ä½ ä» GitHub ä¸ŠæŠŠä»£ç ä¸‹è½½ä¸‹æ¥ï¼Œå¹¶å¯¹ç…§æ–‡ç« çš„å†…å®¹ä¸€åŒå­¦ä¹ ï¼Œç„¶åé€šè¿‡å®ç°æ–°åŠŸèƒ½æ¥åŠ æ·±ç†è§£ã€‚<strong data-nodeid="88298">ä»»ä½•æ¶æ„èƒ½åŠ›éƒ½æ˜¯å»ºç«‹åœ¨ä»£ç èƒ½åŠ›ä¹‹ä¸Šçš„ï¼Œè¦æé«˜æ¶æ„èƒ½åŠ›é¦–å…ˆéœ€è¦ä¸æ–­æé«˜ç¼–å†™é«˜è´¨é‡ä»£ç çš„èƒ½åŠ›ã€‚</strong> ç¼–å†™é«˜è´¨é‡ä»£ç é€šå¸¸éœ€è¦çµæ´»è¿ç”¨å„ç§è½¯ä»¶è®¾è®¡çš„åŸåˆ™ï¼Œå½“èƒ½ç†Ÿç»ƒä½¿ç”¨è¿™äº›åŸåˆ™æ—¶ï¼Œæ¶æ„ App ä¹Ÿå°±å˜æˆæ°´åˆ°æ¸ æˆçš„äº‹æƒ…äº†ã€‚</p>

<p data-nodeid="84524"><strong data-nodeid="84971">æ€è€ƒé¢˜</strong></p>
<blockquote data-nodeid="84525">
<p data-nodeid="84526">è¿™æ˜¯æ¶æ„ä¸å®ç°æ¨¡å—çš„æœ€åä¸€ç¯‡ï¼Œæˆ‘å»ºè®®ä½ åœ¨æœ‹å‹åœˆæ—¶é—´è½´é¡µé¢é‡Œæ·»åŠ åˆ†äº«æ–‡ç« çš„åŠŸèƒ½ï¼Œå¹¶ç¼–å†™ç›¸å…³çš„å•å…ƒæµ‹è¯•ã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½çš„å¼€å‘ï¼Œèƒ½è®©ä½ ä»å¤´åˆ°å°¾ç†è§£æ•´ä¸ª MVVM æ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³ã€‚</p>
</blockquote>
<p data-nodeid="84527">å¦‚æœä½ å®Œæˆè¯¥åŠŸèƒ½ï¼Œè¯·æäº¤ä¸€ä¸ª PR å“¦ã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Œä¹Ÿå¯ä»¥å†™åˆ°ç•™è¨€åŒºã€‚ä¸‹ä¸€è®²æˆ‘ä»¬ä¼šè®²è¿°â€œå¦‚ä½•ç»Ÿä¸€ç®¡ç† Certificates å’Œ Profilesâ€ï¼Œè¿™å°±è¿›å…¥ä¸‹ä¸€ä¸ªæ¨¡å—â€”â€”ä¸Šæ¶ä¸ä¼˜åŒ–ã€‚</p>
<p data-nodeid="84528"><strong data-nodeid="84977">æºç åœ°å€</strong></p>
<blockquote data-nodeid="84529">
<p data-nodeid="84530">å•å…ƒæµ‹è¯•çš„æºç åœ°å€ï¼š<br>
<a href="https://github.com/lagoueduCol/iOS-linyongjian/tree/main/Moments/MomentsTests?fileGuid=xxQTRXtVcqtHK6j8" data-nodeid="84982">https://github.com/lagoueduCol/iOS-linyongjian/tree/main/Moments/MomentsTests</a></p>
</blockquote>

---

### ç²¾é€‰è¯„è®º

##### **é¸¿ï¼š
> æ¨¡å—ä¸‰æ‰“å¡ã€‚

##### *é™ï¼š
> è€å¸ˆï¼Œå¯ä»¥å†ä¸“é—¨å¼€ä¸ªè¯¾è®²å•å…ƒæµ‹è¯•å—ğŸ˜


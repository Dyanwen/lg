<p>æœ¬è¯¾æ—¶æˆ‘ä»¬è®²è§£ GC å›æ”¶æœºåˆ¶ä¸åˆ†ä»£å›æ”¶ç­–ç•¥ã€‚</p>
<p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼Œç®€å†™ä¸º GCï¼‰å¯èƒ½æ˜¯è™šæ‹Ÿæœºä¼—å¤šçŸ¥è¯†ç‚¹ä¸­æœ€ä¸ºå¤§ä¼—æ‰€ç†ŸçŸ¥çš„ä¸€ä¸ªäº†ï¼Œä¹Ÿæ˜¯Javaå¼€å‘è€…æœ€å…³æ³¨çš„ä¸€å—çŸ¥è¯†ç‚¹ã€‚Java è¯­è¨€å¼€å‘è€…æ¯” C è¯­è¨€å¼€å‘è€…å¹¸ç¦çš„åœ°æ–¹å°±åœ¨äºï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å¯¹è±¡çš„å†…å­˜ï¼ŒJVM ä¸­çš„åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨å›æ”¶ã€‚ä½†æ˜¯è¿™ç§å¹¸ç¦æ˜¯æœ‰ä»£ä»·çš„ï¼šä¸€æ—¦è¿™ç§è‡ªåŠ¨åŒ–æœºåˆ¶å‡ºé”™ï¼Œæˆ‘ä»¬åˆä¸å¾—ä¸å»æ·±å…¥ç†è§£ GC å›æ”¶æœºåˆ¶ï¼Œç”šè‡³éœ€è¦å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚ã€‚</p>
<p>ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»‹ç»äº† Java å†…å­˜è¿è¡Œæ—¶åŒºåŸŸçš„å„ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ 3 ä¸ªåŒºåŸŸéšçº¿ç¨‹è€Œç”Ÿï¼Œéšçº¿ç¨‹è€Œç­ï¼›æ ˆä¸­çš„æ ˆå¸§éšç€æ–¹æ³•çš„è¿›å…¥å’Œé€€å‡ºè€Œæœ‰æ¡ä¸ç´Šåœ°æ‰§è¡Œç€å‡ºæ ˆå’Œå…¥æ ˆæ“ä½œï¼Œè¿™å‡ ä¸ªåŒºåŸŸå†…ä¸éœ€è¦è¿‡å¤šè€ƒè™‘å›æ”¶çš„é—®é¢˜ã€‚</p>
<p>è€Œå †å’Œæ–¹æ³•åŒºåˆ™ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ¥å£ä¸­çš„å¤šä¸ªå®ç°ç±»éœ€è¦çš„å†…å­˜å¯èƒ½ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ–¹æ³•ä¸­çš„å¤šä¸ªåˆ†æ”¯éœ€è¦çš„å†…å­˜ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åªæœ‰åœ¨ç¨‹åºå¤„äºè¿è¡ŒæœŸé—´æ—¶æ‰èƒ½çŸ¥é“ä¼šåˆ›å»ºå“ªäº›å¯¹è±¡ï¼Œè¿™éƒ¨åˆ†å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€çš„ï¼Œåƒåœ¾æ”¶é›†å™¨æ‰€å…³æ³¨çš„å°±æ˜¯è¿™éƒ¨åˆ†å†…å­˜ã€‚</p>
<h3>ä»€ä¹ˆæ˜¯åƒåœ¾</h3>
<p>æ‰€è°“åƒåœ¾å°±æ˜¯å†…å­˜ä¸­å·²ç»æ²¡æœ‰ç”¨çš„å¯¹è±¡ã€‚ æ—¢ç„¶æ˜¯â€åƒåœ¾å›æ”¶"ï¼Œé‚£å°±å¿…é¡»çŸ¥é“å“ªäº›å¯¹è±¡æ˜¯åƒåœ¾ã€‚Java è™šæ‹Ÿæœºä¸­ä½¿ç”¨ä¸€ç§å«ä½œ"**å¯è¾¾æ€§åˆ†æâ€**çš„ç®—æ³•æ¥å†³å®šå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ã€‚</p>
<h4>å¯è¾¾æ€§åˆ†æ</h4>
<p>å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»ç¦»æ•£æ•°å­¦ä¸­çš„å›¾è®ºå¼•å…¥çš„ï¼ŒJVM æŠŠå†…å­˜ä¸­æ‰€æœ‰çš„å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»çœ‹ä½œä¸€å¼ å›¾ï¼Œé€šè¿‡ä¸€ç»„åä¸ºâ€GC Root"çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œæœ€åé€šè¿‡åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾æ¥å†³å®šå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/9B/Cgq2xl58leGAIoKxAAEZWYE_v08477.png" alt=""></p>
<p>æ¯”å¦‚ä¸Šå›¾ä¸­ï¼Œå¯¹è±¡A/B/C/D/E ä¸ GC Root ä¹‹é—´éƒ½å­˜åœ¨ä¸€æ¡ç›´æ¥æˆ–è€…é—´æ¥çš„å¼•ç”¨é“¾ï¼Œè¿™ä¹Ÿä»£è¡¨å®ƒä»¬ä¸ GC Root ä¹‹é—´æ˜¯å¯è¾¾çš„ï¼Œå› æ­¤å®ƒä»¬æ˜¯ä¸èƒ½è¢« GC å›æ”¶æ‰çš„ã€‚è€Œå¯¹è±¡Må’ŒKè™½ç„¶è¢«å¯¹J å¼•ç”¨åˆ°ï¼Œä½†æ˜¯å¹¶ä¸å­˜åœ¨ä¸€æ¡å¼•ç”¨é“¾è¿æ¥å®ƒä»¬ä¸ GC Rootï¼Œæ‰€ä»¥å½“ GC è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œåªè¦éå†åˆ° J/K/M è¿™ 3 ä¸ªå¯¹è±¡ï¼Œå°±ä¼šå°†å®ƒä»¬å›æ”¶ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¸Šå›¾ä¸­åœ†å½¢å›¾æ ‡è™½ç„¶æ ‡è®°çš„æ˜¯å¯¹è±¡ï¼Œä½†å®é™…ä¸Šä»£è¡¨çš„æ˜¯æ­¤å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¼•ç”¨ã€‚åŒ…æ‹¬ GC Root ä¹Ÿæ˜¯ä¸€ç»„å¼•ç”¨è€Œå¹¶éå¯¹è±¡ã€‚</p>
</blockquote>
<h4>GC Root å¯¹è±¡</h4>
<p>åœ¨ Java ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯¹è±¡å¯ä»¥ä½œä¸º GC Rootï¼š</p>
<ol>
<li>Java è™šæ‹Ÿæœºæ ˆï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰ä¸­çš„å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
<li>æ–¹æ³•åŒºä¸­é™æ€å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚</li>
<li>ä»å¤„äºå­˜æ´»çŠ¶æ€ä¸­çš„çº¿ç¨‹å¯¹è±¡ã€‚</li>
<li>Native æ–¹æ³•ä¸­ JNI å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
</ol>
<h3>ä»€ä¹ˆæ—¶å€™å›æ”¶</h3>
<p>ä¸åŒçš„è™šæ‹Ÿæœºå®ç°æœ‰ç€ä¸åŒçš„ GC å®ç°æœºåˆ¶ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ç§ GC å®ç°éƒ½ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹è§¦å‘åƒåœ¾å›æ”¶ã€‚</p>
<ol>
<li><strong>Allocation Failure</strong>ï¼šåœ¨å †å†…å­˜ä¸­åˆ†é…æ—¶ï¼Œå¦‚æœå› ä¸ºå¯ç”¨å‰©ä½™ç©ºé—´ä¸è¶³å¯¼è‡´å¯¹è±¡å†…å­˜åˆ†é…å¤±è´¥ï¼Œè¿™æ—¶ç³»ç»Ÿä¼šè§¦å‘ä¸€æ¬¡ GCã€‚</li>
<li><strong>System.gc()</strong>ï¼šåœ¨åº”ç”¨å±‚ï¼ŒJava å¼€å‘å·¥ç¨‹å¸ˆå¯ä»¥ä¸»åŠ¨è°ƒç”¨æ­¤ API æ¥è¯·æ±‚ä¸€æ¬¡ GCã€‚</li>
</ol>
<h3>ä»£ç éªŒè¯ GC Root çš„å‡ ç§æƒ…å†µ</h3>
<p>ç°åœ¨æˆ‘ä»¬äº†è§£äº† Java ä¸­çš„ GC Rootï¼Œä»¥åŠä½•æ—¶è§¦å‘ GCï¼Œæ¥ä¸‹æ¥å°±é€šè¿‡å‡ ä¸ªæ¡ˆä¾‹æ¥éªŒè¯ GC Root çš„æƒ…å†µã€‚åœ¨çœ‹å…·ä½“ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªæ‰§è¡Œ Java å‘½ä»¤æ—¶çš„å‚æ•°ã€‚</p>
<blockquote>
<p>-Xms åˆå§‹åˆ†é… JVM è¿è¡Œæ—¶çš„å†…å­˜å¤§å°ï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ã€‚</p>
</blockquote>
<p>æ¯”å¦‚æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹å‘½ä»¤æ‰§è¡Œ HelloWorld ç¨‹åºï¼Œä»ç‰©ç†å†…å­˜ä¸­åˆ†é…å‡º 200M ç©ºé—´åˆ†é…ç»™ JVM å†…å­˜ã€‚</p>
<pre><code data-language="c" class="lang-c">java&nbsp;-Xms200m&nbsp;HelloWorld
</code></pre>
<h4>éªŒè¯è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ä½œä¸º GC Root</h4>
<p>æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code data-language="java" class="lang-java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">GCRootLocalVariable</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">int</span>&nbsp;_10MB&nbsp;=&nbsp;<span class="hljs-number">10</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">byte</span>[]&nbsp;memory&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[<span class="hljs-number">8</span>&nbsp;*&nbsp;_10MB];

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"å¼€å§‹æ—¶:"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.gc();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"ç¬¬äºŒæ¬¡GCå®Œæˆ"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">method</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GCRootLocalVariable&nbsp;g&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;GCRootLocalVariable();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.gc();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"ç¬¬ä¸€æ¬¡GCå®Œæˆ"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ‰“å°å‡ºå½“å‰JVMå‰©ä½™ç©ºé—´å’Œæ€»çš„ç©ºé—´å¤§å°
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">printMemory</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="hljs-string">"free&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().freeMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"total&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().totalMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p>æ‰“å°æ—¥å¿—ï¼š</p>
<pre><code data-language="java" class="lang-java">å¼€å§‹æ—¶:
free&nbsp;is&nbsp;<span class="hljs-number">242</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
ç¬¬ä¸€æ¬¡GCå®Œæˆ
free&nbsp;is&nbsp;<span class="hljs-number">163</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
ç¬¬äºŒæ¬¡GCå®Œæˆ
free&nbsp;is&nbsp;<span class="hljs-number">243</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li>å½“ç¬¬ä¸€æ¬¡ GC æ—¶ï¼Œg ä½œä¸ºå±€éƒ¨å˜é‡ï¼Œå¼•ç”¨äº† new å‡ºçš„å¯¹è±¡ï¼ˆ80Mï¼‰ï¼Œå¹¶ä¸”å®ƒä½œä¸º GC Rootsï¼Œåœ¨ GC åå¹¶ä¸ä¼šè¢« GC å›æ”¶ã€‚</li>
<li>å½“ç¬¬äºŒæ¬¡ GCï¼šmethod() æ–¹æ³•æ‰§è¡Œå®Œåï¼Œå±€éƒ¨å˜é‡ g è·Ÿéšæ–¹æ³•æ¶ˆå¤±ï¼Œä¸å†æœ‰å¼•ç”¨ç±»å‹æŒ‡å‘è¯¥ 80M å¯¹è±¡ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡ GC åæ­¤ 80M ä¹Ÿä¼šè¢«å›æ”¶ã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¸Šé¢æ—¥å¿—åŒ…æ‹¬åé¢çš„å®ä¾‹ä¸­ï¼Œå› ä¸ºæœ‰ä¸­é—´å˜é‡ï¼Œæ‰€ä»¥ä¼šæœ‰ 1M å·¦å³çš„è¯¯å·®ï¼Œä½†ä¸å½±å“æˆ‘ä»¬åˆ†æ GC è¿‡ç¨‹ã€‚</p>
</blockquote>
<h4>éªŒè¯æ–¹æ³•åŒºä¸­çš„é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡ä½œä¸º GC Root</h4>
<p>æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code data-language="java" class="lang-java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">GCRootStaticVariable</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">int</span>&nbsp;_10MB&nbsp;=&nbsp;<span class="hljs-number">10</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">byte</span>[]&nbsp;memory;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;GCRootStaticVariable&nbsp;staticVariable;

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-title">GCRootStaticVariable</span><span class="hljs-params">(<span class="hljs-keyword">int</span>&nbsp;size)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[size];
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"ç¨‹åºå¼€å§‹:"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GCRootStaticVariable&nbsp;g&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;GCRootStaticVariable(<span class="hljs-number">4</span>&nbsp;*&nbsp;_10MB);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.staticVariable&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;GCRootStaticVariable(<span class="hljs-number">8</span>&nbsp;*&nbsp;_10MB);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;å°†gç½®ä¸ºnull,&nbsp;è°ƒç”¨GCæ—¶å¯ä»¥å›æ”¶æ­¤å¯¹è±¡å†…å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;=&nbsp;<span class="hljs-keyword">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.gc();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"GCå®Œæˆ"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ‰“å°å‡ºå½“å‰JVMå‰©ä½™ç©ºé—´å’Œæ€»çš„ç©ºé—´å¤§å°
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">printMemory</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="hljs-string">"free&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().freeMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"total&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().totalMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p>æ‰“å°æ—¥å¿—ï¼š</p>
<pre><code data-language="java" class="lang-java">ç¨‹åºå¼€å§‹:
free&nbsp;is&nbsp;<span class="hljs-number">242</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
GCå®Œæˆ
free&nbsp;is&nbsp;<span class="hljs-number">163</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼š</p>
<p>ç¨‹åºåˆšå¼€å§‹è¿è¡Œæ—¶å†…å­˜ä¸º 242Mï¼Œå¹¶åˆ†åˆ«åˆ›å»ºäº† g å¯¹è±¡ï¼ˆ40Mï¼‰ï¼ŒåŒæ—¶ä¹Ÿåˆå§‹åŒ– g å¯¹è±¡å†…éƒ¨çš„é™æ€å˜é‡ staticVariable å¯¹è±¡ï¼ˆ80Mï¼‰ã€‚å½“è°ƒç”¨ GC æ—¶ï¼Œåªæœ‰ g å¯¹è±¡çš„ 40M è¢« GC å›æ”¶æ‰ï¼Œè€Œé™æ€å˜é‡ staticVariable ä½œä¸º GC Rootï¼Œå®ƒå¼•ç”¨çš„ 80M å¹¶ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h4>éªŒè¯æ´»è·ƒçº¿ç¨‹ä½œä¸º GC Root</h4>
<p>æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code data-language="java" class="lang-java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">GCRootThread</span></span>{

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">int</span>&nbsp;_10MB&nbsp;=&nbsp;<span class="hljs-number">10</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">byte</span>[]&nbsp;memory&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[<span class="hljs-number">8</span>&nbsp;*&nbsp;_10MB];

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;<span class="hljs-keyword">throws</span>&nbsp;Exception&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"å¼€å§‹å‰å†…å­˜æƒ…å†µ:"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AsyncTask&nbsp;at&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AsyncTask(<span class="hljs-keyword">new</span>&nbsp;GCRootThread());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;thread&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;Thread(at);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread.start();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.gc();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"mainæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå®ŒæˆGC"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread.join();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;=&nbsp;<span class="hljs-keyword">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.gc();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå®ŒæˆGC"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ‰“å°å‡ºå½“å‰JVMå‰©ä½™ç©ºé—´å’Œæ€»çš„ç©ºé—´å¤§å°
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">printMemory</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="hljs-string">"free&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().freeMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"total&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().totalMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">AsyncTask</span>&nbsp;<span class="hljs-keyword">implements</span>&nbsp;<span class="hljs-title">Runnable</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;GCRootThread&nbsp;gcRootThread;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-title">AsyncTask</span><span class="hljs-params">(GCRootThread&nbsp;gcRootThread)</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.gcRootThread&nbsp;=&nbsp;gcRootThread;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">run</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(<span class="hljs-number">500</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">catch</span>(Exception&nbsp;e){}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p>æ‰“å°æ—¥å¿—ï¼š</p>
<pre><code data-language="java" class="lang-java">å¼€å§‹å‰å†…å­˜æƒ…å†µ:
free&nbsp;is&nbsp;<span class="hljs-number">242</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
mainæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå®ŒæˆGC
free&nbsp;is&nbsp;<span class="hljs-number">163</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå®ŒæˆGC
free&nbsp;is&nbsp;<span class="hljs-number">243</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼š</p>
<p>ç¨‹åºåˆšå¼€å§‹æ—¶æ˜¯ 242M å†…å­˜ï¼Œå½“è°ƒç”¨ç¬¬ä¸€æ¬¡ GC æ—¶çº¿ç¨‹å¹¶æ²¡æœ‰æ‰§è¡Œç»“æŸï¼Œå¹¶ä¸”å®ƒä½œä¸º GC Rootï¼Œæ‰€ä»¥å®ƒæ‰€å¼•ç”¨çš„ 80M å†…å­˜å¹¶ä¸ä¼šè¢« GC å›æ”¶æ‰ã€‚ thread.join() ä¿è¯çº¿ç¨‹ç»“æŸå†è°ƒç”¨åç»­ä»£ç ï¼Œæ‰€ä»¥å½“è°ƒç”¨ç¬¬äºŒæ¬¡ GC æ—¶ï¼Œçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•å¹¶è¢«ç½®ä¸º nullï¼Œè¿™æ—¶çº¿ç¨‹å·²ç»è¢«é”€æ¯ï¼Œæ‰€ä»¥ä¹‹å‰å®ƒæ‰€å¼•ç”¨çš„ 80M æ­¤æ—¶ä¼šè¢« GC å›æ”¶æ‰ã€‚</p>
<h4>æµ‹è¯•æˆå‘˜å˜é‡æ˜¯å¦å¯ä½œä¸º GC Root</h4>
<p>æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code data-language="java" class="lang-java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">GCRootClassVariable</span></span>{

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">int</span>&nbsp;_10MB&nbsp;=&nbsp;<span class="hljs-number">10</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">byte</span>[]&nbsp;memory;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;GCRootClassVariable&nbsp;classVariable;

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-title">GCRootClassVariable</span><span class="hljs-params">(<span class="hljs-keyword">int</span>&nbsp;size)</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[size];
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"ç¨‹åºå¼€å§‹:"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GCRootClassVariable&nbsp;g&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;GCRootClassVariable(<span class="hljs-number">4</span>&nbsp;*&nbsp;_10MB);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.classVariable&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;GCRootClassVariable(<span class="hljs-number">8</span>&nbsp;*&nbsp;_10MB);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;=&nbsp;<span class="hljs-keyword">null</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.gc();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"GCå®Œæˆ"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printMemory();
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ‰“å°å‡ºå½“å‰JVMå‰©ä½™ç©ºé—´å’Œæ€»çš„ç©ºé—´å¤§å°
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">printMemory</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="hljs-string">"free&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().freeMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"total&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;Runtime.getRuntime().totalMemory()/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;M,&nbsp;"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p>æ‰“å°æ—¥å¿—ï¼š</p>
<pre><code data-language="java" class="lang-java">ç¨‹åºå¼€å§‹:
free&nbsp;is&nbsp;<span class="hljs-number">242</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
GCå®Œæˆ
free&nbsp;is&nbsp;<span class="hljs-number">243</span>&nbsp;M,&nbsp;total&nbsp;is&nbsp;<span class="hljs-number">245</span>&nbsp;M,
</code></pre>
<p>ä»ä¸Šé¢æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºå½“è°ƒç”¨ GC æ—¶ï¼Œå› ä¸º g å·²ç»ç½®ä¸º nullï¼Œå› æ­¤ g ä¸­çš„å…¨å±€å˜é‡ classVariable æ­¤æ—¶ä¹Ÿä¸å†è¢« GC Root æ‰€å¼•ç”¨ã€‚æ‰€ä»¥æœ€å g(40M) å’Œ classVariable(80M) éƒ½ä¼šè¢«å›æ”¶æ‰ã€‚<strong>è¿™ä¹Ÿè¡¨æ˜å…¨å±€å˜é‡åŒé™æ€å˜é‡ä¸åŒï¼Œå®ƒä¸ä¼šè¢«å½“ä½œ GC Root</strong>ã€‚</p>
<blockquote>
<p>ä¸Šé¢æ¼”ç¤ºçš„è¿™å‡ ç§æƒ…å†µå¾€å¾€ä¹Ÿæ˜¯å†…å­˜æ³„æ¼å‘ç”Ÿçš„åœºæ™¯ï¼Œè®¾æƒ³ä¸€ä¸‹æˆ‘ä»¬å°†å„ä¸ª Test ç±»æ¢æˆ Android ä¸­çš„ Activity çš„è¯å°†å¯¼è‡´ Activity æ— æ³•è¢«ç³»ç»Ÿå›æ”¶ï¼Œè€Œä¸€ä¸ª Activity ä¸­çš„æ•°æ®å¾€å¾€æ˜¯è¾ƒå¤§çš„ï¼Œå› æ­¤å†…å­˜æ³„æ¼å¯¼è‡´ Activity æ— æ³•å›æ”¶è¿˜æ˜¯æ¯”è¾ƒè‡´å‘½çš„ã€‚</p>
</blockquote>
<h3>å¦‚ä½•å›æ”¶åƒåœ¾</h3>
<p>ç”±äºåƒåœ¾æ”¶é›†ç®—æ³•çš„å®ç°æ¶‰åŠå¤§é‡çš„ç¨‹åºç»†èŠ‚ï¼Œå„å®¶è™šæ‹Ÿæœºå‚å•†å¯¹å…¶å®ç°ç»†èŠ‚å„ä¸ç›¸åŒï¼Œå› æ­¤æœ¬è¯¾æ—¶å¹¶ä¸ä¼šè¿‡å¤šçš„è®¨è®ºç®—æ³•çš„å®ç°ï¼Œåªæ˜¯ä»‹ç»å‡ ç§ç®—æ³•çš„æ€æƒ³ä»¥åŠä¼˜ç¼ºç‚¹ã€‚</p>
<h4>æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆMark and Sweep GCï¼‰</h4>
<p>ä»â€GC Rootsâ€é›†åˆå¼€å§‹ï¼Œå°†å†…å­˜æ•´ä¸ªéå†ä¸€æ¬¡ï¼Œä¿ç•™æ‰€æœ‰å¯ä»¥è¢« GC Roots ç›´æ¥æˆ–é—´æ¥å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼Œè€Œå‰©ä¸‹çš„å¯¹è±¡éƒ½å½“ä½œåƒåœ¾å¯¹å¾…å¹¶å›æ”¶ï¼Œè¿‡ç¨‹åˆ†ä¸¤æ­¥ã€‚</p>
<ol>
<li><strong>Mark æ ‡è®°é˜¶æ®µ</strong>ï¼šæ‰¾åˆ°å†…å­˜ä¸­çš„æ‰€æœ‰ GC Root å¯¹è±¡ï¼Œåªè¦æ˜¯å’Œ GC Root å¯¹è±¡ç›´æ¥æˆ–è€…é—´æ¥ç›¸è¿åˆ™æ ‡è®°ä¸ºç°è‰²ï¼ˆä¹Ÿå°±æ˜¯å­˜æ´»å¯¹è±¡ï¼‰ï¼Œå¦åˆ™æ ‡è®°ä¸ºé»‘è‰²ï¼ˆä¹Ÿå°±æ˜¯åƒåœ¾å¯¹è±¡ï¼‰ã€‚</li>
<li><strong>Sweep æ¸…é™¤é˜¶æ®µ</strong>ï¼šå½“éå†å®Œæ‰€æœ‰çš„ GC Root ä¹‹åï¼Œåˆ™å°†æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ç›´æ¥æ¸…é™¤ã€‚</li>
</ol>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/81/Ciqah158kR-AFqC0AACRJFj-tqc381.png" alt=""></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œä¸éœ€è¦å°†å¯¹è±¡è¿›è¡Œç§»åŠ¨ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šè¿™ä¸ªç®—æ³•éœ€è¦ä¸­æ–­è¿›ç¨‹å†…å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼ˆstop the worldï¼‰ï¼Œå¹¶ä¸”å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæé«˜äº†åƒåœ¾å›æ”¶çš„é¢‘ç‡ã€‚</li>
</ul>
<h4>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</h4>
<p>å°†ç°æœ‰çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤å¿«ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶å°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ã€‚ä¹‹åï¼Œæ¸…é™¤æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å—ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œå®Œæˆåƒåœ¾å›æ”¶ã€‚</p>
<ol>
<li>å¤åˆ¶ç®—æ³•ä¹‹å‰ï¼Œå†…å­˜åˆ†ä¸º A/B ä¸¤å—ï¼Œå¹¶ä¸”å½“å‰åªä½¿ç”¨å†…å­˜ Aï¼Œå†…å­˜çš„çŠ¶å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ol>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kR-AfKs5AABx53v9UCk063.png" alt=""></p>
<ol start="2">
<li>æ ‡è®°å®Œä¹‹åï¼Œæ‰€æœ‰å¯è¾¾å¯¹è±¡éƒ½è¢«æŒ‰æ¬¡åºå¤åˆ¶åˆ°å†…å­˜ B ä¸­ï¼Œå¹¶è®¾ç½® B ä¸ºå½“å‰ä½¿ç”¨ä¸­çš„å†…å­˜ã€‚å†…å­˜çŠ¶å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ol>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/81/Ciqah158kR-AQa1cAABq_Yx6zyw527.png" alt=""></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®ç°ç®€å•ã€è¿è¡Œé«˜æ•ˆï¼Œä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯ç”¨çš„å†…å­˜å¤§å°ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠï¼Œå¯¹è±¡å­˜æ´»ç‡é«˜æ—¶ä¼šé¢‘ç¹è¿›è¡Œå¤åˆ¶ã€‚</li>
</ul>
<h4>æ ‡è®°-å‹ç¼©ç®—æ³• (Mark-Compact)</h4>
<p>éœ€è¦å…ˆä»æ ¹èŠ‚ç‚¹å¼€å§‹å¯¹æ‰€æœ‰å¯è¾¾å¯¹è±¡åšä¸€æ¬¡æ ‡è®°ï¼Œä¹‹åï¼Œå®ƒå¹¶ä¸ç®€å•åœ°æ¸…ç†æœªæ ‡è®°çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ã€‚æœ€åï¼Œæ¸…ç†è¾¹ç•Œå¤–æ‰€æœ‰çš„ç©ºé—´ã€‚å› æ­¤æ ‡è®°å‹ç¼©ä¹Ÿåˆ†ä¸¤æ­¥å®Œæˆï¼š</p>
<ol>
<li><strong>Mark æ ‡è®°é˜¶æ®µ</strong>ï¼šæ‰¾åˆ°å†…å­˜ä¸­çš„æ‰€æœ‰ GC Root å¯¹è±¡ï¼Œåªè¦æ˜¯å’Œ GC Root å¯¹è±¡ç›´æ¥æˆ–è€…é—´æ¥ç›¸è¿åˆ™æ ‡è®°ä¸ºç°è‰²ï¼ˆä¹Ÿå°±æ˜¯å­˜æ´»å¯¹è±¡ï¼‰ï¼Œå¦åˆ™æ ‡è®°ä¸ºé»‘è‰²ï¼ˆä¹Ÿå°±æ˜¯åƒåœ¾å¯¹è±¡ï¼‰ã€‚</li>
<li><strong>Compact å‹ç¼©é˜¶æ®µ</strong>ï¼šå°†å‰©ä½™å­˜æ´»å¯¹è±¡æŒ‰é¡ºåºå‹ç¼©åˆ°å†…å­˜çš„æŸä¸€ç«¯ã€‚<br>
<img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kR-AQb0SAAAl99yZMSc183.png" alt=""></li>
</ol>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè¿™ç§æ–¹æ³•æ—¢é¿å…äº†ç¢ç‰‡çš„äº§ç”Ÿï¼Œåˆä¸éœ€è¦ä¸¤å—ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ï¼Œå…¶æ€§ä»·æ¯”æ¯”è¾ƒé«˜ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ‰€è°“å‹ç¼©æ“ä½œï¼Œä»éœ€è¦è¿›è¡Œå±€éƒ¨å¯¹è±¡ç§»åŠ¨ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šè¿˜æ˜¯é™ä½äº†æ•ˆç‡ã€‚</li>
</ul>
<h3>JVMåˆ†ä»£å›æ”¶ç­–ç•¥</h3>
<p>Java è™šæ‹Ÿæœºæ ¹æ®å¯¹è±¡å­˜æ´»çš„å‘¨æœŸä¸åŒï¼ŒæŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬åˆ†ä¸º<strong>æ–°ç”Ÿä»£</strong>ã€<strong>è€å¹´ä»£</strong>ï¼Œè¿™å°±æ˜¯ JVM çš„å†…å­˜åˆ†ä»£ç­–ç•¥ã€‚<strong>æ³¨æ„: åœ¨ HotSpot ä¸­é™¤äº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿˜æœ‰æ°¸ä¹…ä»£</strong></p>
<p>åˆ†ä»£å›æ”¶çš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯ï¼šå¯¹äºæ–°åˆ›å»ºçš„å¯¹è±¡ä¼šåœ¨æ–°ç”Ÿä»£ä¸­åˆ†é…å†…å­˜ï¼Œæ­¤åŒºåŸŸçš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬è¾ƒçŸ­ã€‚å¦‚æœç»è¿‡å¤šæ¬¡å›æ”¶ä»ç„¶å­˜æ´»ä¸‹æ¥ï¼Œåˆ™å°†å®ƒä»¬è½¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚</p>
<h4>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰</h4>
<p>æ–°ç”Ÿæˆçš„å¯¹è±¡ä¼˜å…ˆå­˜æ”¾åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ–°ç”Ÿä»£å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œå­˜æ´»ç‡å¾ˆä½ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå¸¸è§„åº”ç”¨è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†ä¸€èˆ¬å¯ä»¥å›æ”¶ 70%~95% çš„ç©ºé—´ï¼Œå›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚æ–°ç”Ÿä»£ä¸­å› ä¸ºè¦è¿›è¡Œä¸€äº›å¤åˆ¶æ“ä½œï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨çš„ GC å›æ”¶ç®—æ³•æ˜¯å¤åˆ¶ç®—æ³•ã€‚</p>
<p>æ–°ç”Ÿä»£åˆå¯ä»¥ç»§ç»­ç»†åˆ†ä¸º 3 éƒ¨åˆ†ï¼šEdenã€Survivor0ï¼ˆç®€ç§° S0ï¼‰ã€Survivor1ï¼ˆç®€ç§°S1ï¼‰ã€‚è¿™ 3 éƒ¨åˆ†æŒ‰ç…§ 8:1:1 çš„æ¯”ä¾‹æ¥åˆ’åˆ†æ–°ç”Ÿä»£ã€‚è¿™ 3 å—åŒºåŸŸçš„å†…å­˜åˆ†é…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>ç»å¤§å¤šæ•°åˆšåˆšè¢«åˆ›å»ºçš„å¯¹è±¡ä¼šå­˜æ”¾åœ¨&nbsp;<strong>Eden</strong> åŒºã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/81/Ciqah158kSCACECoAABYMXWFYtY758.png" alt=""></p>
<p>å½“&nbsp;<strong>Eden</strong>&nbsp;åŒºç¬¬ä¸€æ¬¡æ»¡çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œåƒåœ¾å›æ”¶ã€‚é¦–å…ˆå°† <strong>Eden</strong>åŒºçš„åƒåœ¾å¯¹è±¡å›æ”¶æ¸…é™¤ï¼Œå¹¶å°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ° <strong>S0</strong>ï¼Œæ­¤æ—¶ <strong>S1</strong>æ˜¯ç©ºçš„ã€‚å¦‚å›¾æ‰€ç¤ºï¼š<br>
<img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kSGACeimAABTArM3xYk676.png" alt=""></p>
<p>ä¸‹ä¸€æ¬¡&nbsp;<strong>Eden</strong>&nbsp;åŒºæ»¡æ—¶ï¼Œå†æ‰§è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚æ­¤æ¬¡ä¼šå°†&nbsp;<strong>Eden</strong>å’Œ <strong>S0</strong>åŒºä¸­æ‰€æœ‰åƒåœ¾å¯¹è±¡æ¸…é™¤ï¼Œå¹¶å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° <strong>S1</strong>ï¼Œæ­¤æ—¶ <strong>S0</strong>å˜ä¸ºç©ºã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/81/Ciqah158kSGAXW6uAABTZbbBBQU172.png" alt=""></p>
<p>å¦‚æ­¤åå¤åœ¨ <strong>S0</strong> å’Œ <strong>S1</strong>ä¹‹é—´åˆ‡æ¢å‡ æ¬¡ï¼ˆé»˜è®¤ 15 æ¬¡ï¼‰ä¹‹åï¼Œå¦‚æœè¿˜æœ‰å­˜æ´»å¯¹è±¡ã€‚è¯´æ˜è¿™äº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œåˆ™å°†å®ƒä»¬è½¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kSGAIFsJAABiXFUZ3JU251.png" alt=""></p>
<h4>å¹´è€ä»£ï¼ˆOld Generationï¼‰</h4>
<p>ä¸€ä¸ªå¯¹è±¡å¦‚æœåœ¨æ–°ç”Ÿä»£å­˜æ´»äº†è¶³å¤Ÿé•¿çš„æ—¶é—´è€Œæ²¡æœ‰è¢«æ¸…ç†æ‰ï¼Œåˆ™ä¼šè¢«å¤åˆ¶åˆ°è€å¹´ä»£ã€‚è€å¹´ä»£çš„å†…å­˜å¤§å°ä¸€èˆ¬æ¯”æ–°ç”Ÿä»£å¤§ï¼Œèƒ½å­˜æ”¾æ›´å¤šçš„å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ¯”è¾ƒå¤§ï¼ˆæ¯”å¦‚é•¿å­—ç¬¦ä¸²æˆ–è€…å¤§æ•°ç»„ï¼‰ï¼Œå¹¶ä¸”æ–°ç”Ÿä»£çš„å‰©ä½™ç©ºé—´ä¸è¶³ï¼Œåˆ™è¿™ä¸ªå¤§å¯¹è±¡ä¼šç›´æ¥è¢«åˆ†é…åˆ°è€å¹´ä»£ä¸Šã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&nbsp;-XX:PretenureSizeThreshold&nbsp;æ¥æ§åˆ¶ç›´æ¥å‡å…¥è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼çš„å¯¹è±¡ä¼šç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸Šã€‚è€å¹´ä»£å› ä¸ºå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œä¸éœ€è¦è¿‡å¤šçš„å¤åˆ¶æ“ä½œï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨æ ‡è®°å‹ç¼©çš„å›æ”¶ç®—æ³•ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¯¹äºè€å¹´ä»£å¯èƒ½å­˜åœ¨è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œè€å¹´ä»£ä¸­çš„å¯¹è±¡æœ‰æ—¶å€™ä¼šå¼•ç”¨åˆ°æ–°ç”Ÿä»£å¯¹è±¡ã€‚è¿™æ—¶å¦‚æœè¦æ‰§è¡Œæ–°ç”Ÿä»£ GCï¼Œåˆ™å¯èƒ½éœ€è¦æŸ¥è¯¢æ•´ä¸ªè€å¹´ä»£ä¸Šå¯èƒ½å­˜åœ¨å¼•ç”¨æ–°ç”Ÿä»£çš„æƒ…å†µï¼Œè¿™æ˜¾ç„¶æ˜¯ä½æ•ˆçš„ã€‚æ‰€ä»¥ï¼Œè€å¹´ä»£ä¸­ç»´æŠ¤äº†ä¸€ä¸ª 512 byte çš„ card tableï¼Œæ‰€æœ‰è€å¹´ä»£å¯¹è±¡å¼•ç”¨æ–°ç”Ÿä»£å¯¹è±¡çš„ä¿¡æ¯éƒ½è®°å½•åœ¨è¿™é‡Œã€‚æ¯å½“æ–°ç”Ÿä»£å‘ç”Ÿ GC æ—¶ï¼Œåªéœ€è¦æ£€æŸ¥è¿™ä¸ª card table å³å¯ï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½ã€‚</p>
</blockquote>
<h3>GC Log åˆ†æ</h3>
<p>ä¸ºäº†è®©ä¸Šå±‚åº”ç”¨å¼€å‘äººå‘˜æ›´åŠ æ–¹ä¾¿çš„è°ƒè¯• Java ç¨‹åºï¼ŒJVM æä¾›äº†ç›¸åº”çš„ GC æ—¥å¿—ã€‚åœ¨ GC æ‰§è¡Œåƒåœ¾å›æ”¶äº‹ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å„ç§ç›¸åº”çš„ log è¢«æ‰“å°å‡ºæ¥ã€‚å…¶ä¸­æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ‰€æ‰“å°çš„æ—¥å¿—æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<ul>
<li>æ–°ç”Ÿä»£ GCï¼šè¿™ä¸€åŒºåŸŸçš„ GC å«ä½œ Minor GCã€‚å› ä¸º Java å¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ Minor GC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚</li>
<li>è€å¹´ä»£ GCï¼šå‘ç”Ÿåœ¨è¿™ä¸€åŒºåŸŸçš„ GC ä¹Ÿå«ä½œ Major GC æˆ–è€… Full GCã€‚å½“å‡ºç°äº† Major GCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ Minor GCã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨æœ‰äº›è™šæ‹Ÿæœºå®ç°ä¸­ï¼ŒMajor GC å’Œ Full GC è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ã€‚Major GC åªæ˜¯ä»£è¡¨å›æ”¶è€å¹´ä»£çš„å†…å­˜ï¼Œè€Œ Full GC åˆ™ä»£è¡¨å›æ”¶æ•´ä¸ªå †ä¸­çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯æ–°ç”Ÿä»£ + è€å¹´ä»£ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥å°±é€šè¿‡å‡ ä¸ªæ¡ˆä¾‹æ¥åˆ†æå¦‚ä½•æŸ¥çœ‹ GC Logï¼Œåˆ†æè¿™äº› GC Log çš„è¿‡ç¨‹ä¸­ä¹Ÿèƒ½å†åŠ æ·±å¯¹ JVM åˆ†ä»£ç­–ç•¥çš„ç†è§£ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ª Java å‘½ä»¤çš„å‚æ•°ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/9B/Cgq2xl58lmeAAsp5AABwifdCuEw841.png" alt=""></p>
<p>æˆ‘ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼Œåœ¨å†…å­˜ä¸­åˆ›å»º 4 ä¸ª byte ç±»å‹æ•°ç»„æ¥æ¼”ç¤ºå†…å­˜åˆ†é…ä¸ GC çš„è¯¦ç»†è¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code data-language="java" class="lang-java"><span class="hljs-comment">/**
*&nbsp;VM&nbsp;agrs:&nbsp;-Xms20M&nbsp;-Xmx20M&nbsp;-Xmn10M&nbsp;-XX:+PrintGCDetails
*&nbsp;-XX:SurvivorRatio=8
*/</span>
<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">MinorGCTest</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">final</span>&nbsp;<span class="hljs-keyword">int</span>&nbsp;_1MB&nbsp;=&nbsp;<span class="hljs-number">1024</span>&nbsp;*&nbsp;<span class="hljs-number">1024</span>;

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">testAllocation</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">byte</span>[]&nbsp;a1,&nbsp;a2,&nbsp;a3,&nbsp;z4;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a1&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[<span class="hljs-number">2</span>&nbsp;*&nbsp;_1MB];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a2&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[<span class="hljs-number">2</span>&nbsp;*&nbsp;_1MB];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a3&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[<span class="hljs-number">2</span>&nbsp;*&nbsp;_1MB];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a4&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-keyword">byte</span>[<span class="hljs-number">1</span>&nbsp;*&nbsp;_1MB];
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;agrs)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testAllocation();
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p>é€šè¿‡ä¸Šé¢çš„å‚æ•°ï¼Œå¯ä»¥çœ‹å‡ºå †å†…å­˜æ€»å¤§å°ä¸º 20Mï¼Œå…¶ä¸­æ–°ç”Ÿä»£å  10Mï¼Œå‰©ä¸‹çš„ 10M ä¼šè‡ªåŠ¨åˆ†é…ç»™è€å¹´ä»£ã€‚æ‰§è¡Œä¸Šè¿°ä»£ç æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<pre><code data-language="java" class="lang-java">Heap
PSYoungGen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;<span class="hljs-number">9216</span>K,&nbsp;used&nbsp;<span class="hljs-number">8003</span>K&nbsp;[<span class="hljs-number">0x00000007bf600000</span>,&nbsp;<span class="hljs-number">0x00000007c0000000</span>,&nbsp;<span class="hljs-number">0x00000007c0000000</span>)
&nbsp;&nbsp;eden&nbsp;space&nbsp;<span class="hljs-number">8192</span>K,&nbsp;<span class="hljs-number">97</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bf600000</span>,<span class="hljs-number">0x00000007bfdd0ed8</span>,<span class="hljs-number">0x00000007bfe00000</span>)
&nbsp;&nbsp;from&nbsp;space&nbsp;<span class="hljs-number">1024</span>K,&nbsp;<span class="hljs-number">0</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bff00000</span>,<span class="hljs-number">0x00000007bff00000</span>,<span class="hljs-number">0x00000007c0000000</span>)
&nbsp;&nbsp;to&nbsp;&nbsp;&nbsp;space&nbsp;<span class="hljs-number">1024</span>K,&nbsp;<span class="hljs-number">0</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bfe00000</span>,<span class="hljs-number">0x00000007bfe00000</span>,<span class="hljs-number">0x00000007bff00000</span>)
ParOldGen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;<span class="hljs-number">10240</span>K,&nbsp;used&nbsp;<span class="hljs-number">0</span>K&nbsp;[<span class="hljs-number">0x00000007bec00000</span>,&nbsp;<span class="hljs-number">0x00000007bf600000</span>,&nbsp;<span class="hljs-number">0x00000007bf600000</span>)
&nbsp;&nbsp;object&nbsp;space&nbsp;<span class="hljs-number">10240</span>K,&nbsp;<span class="hljs-number">0</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bec00000</span>,<span class="hljs-number">0x00000007bec00000</span>,<span class="hljs-number">0x00000007bf600000</span>)
Metaspace&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used&nbsp;<span class="hljs-number">2631</span>K,&nbsp;capacity&nbsp;<span class="hljs-number">4486</span>K,&nbsp;committed&nbsp;<span class="hljs-number">4864</span>K,&nbsp;reserved&nbsp;<span class="hljs-number">1056768</span>K
&nbsp;&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">space</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title">used</span>&nbsp;286<span class="hljs-title">K</span>,&nbsp;<span class="hljs-title">capacity</span>&nbsp;386<span class="hljs-title">K</span>,&nbsp;<span class="hljs-title">committed</span>&nbsp;512<span class="hljs-title">K</span>,&nbsp;<span class="hljs-title">reserved</span>&nbsp;1048576<span class="hljs-title">K</span>
</span></code></pre>
<p>æ—¥å¿—ä¸­çš„å„å­—æ®µä»£è¡¨æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/85/Ciqah158lqGAOkbpAAAvHYLJUt0639.png" alt=""></p>
<p>ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºï¼šç¨‹åºæ‰§è¡Œå®Œä¹‹åï¼Œa1ã€a2ã€a3ã€a4 å››ä¸ªå¯¹è±¡éƒ½è¢«åˆ†é…åœ¨äº†æ–°ç”Ÿä»£çš„ Eden åŒºã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†æµ‹è¯•ä»£ç ä¸­çš„ a4 åˆå§‹åŒ–æ”¹ä¸º a4 = new byte[2 * _1MB]&nbsp;åˆ™æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<pre><code data-language="java" class="lang-java">[GC&nbsp;(Allocation&nbsp;Failure)&nbsp;[PSYoungGen:&nbsp;<span class="hljs-number">6815</span>K-&gt;<span class="hljs-number">480</span>K(<span class="hljs-number">9216</span>K)]&nbsp;<span class="hljs-number">6815</span>K-&gt;<span class="hljs-number">6632</span>K(<span class="hljs-number">19456</span>K),&nbsp;<span class="hljs-number">0.0067344</span>&nbsp;secs]&nbsp;[Times:&nbsp;user=<span class="hljs-number">0.04</span>&nbsp;sys=<span class="hljs-number">0.00</span>,&nbsp;real=<span class="hljs-number">0.01</span>&nbsp;secs]
Heap
PSYoungGen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;<span class="hljs-number">9216</span>K,&nbsp;used&nbsp;<span class="hljs-number">2130</span>K&nbsp;[<span class="hljs-number">0x00000007bf600000</span>,&nbsp;<span class="hljs-number">0x00000007c0000000</span>,&nbsp;<span class="hljs-number">0x00000007c0000000</span>)
&nbsp;&nbsp;eden&nbsp;space&nbsp;<span class="hljs-number">8192</span>K,&nbsp;<span class="hljs-number">26</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bf600000</span>,<span class="hljs-number">0x00000007bf814930</span>,<span class="hljs-number">0x00000007bfe00000</span>)
&nbsp;&nbsp;from&nbsp;space&nbsp;<span class="hljs-number">1024</span>K,&nbsp;<span class="hljs-number">0</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bfe00000</span>,<span class="hljs-number">0x00000007bfe00000</span>,<span class="hljs-number">0x00000007bff00000</span>)
&nbsp;&nbsp;to&nbsp;&nbsp;&nbsp;space&nbsp;<span class="hljs-number">1024</span>K,&nbsp;<span class="hljs-number">0</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bff00000</span>,<span class="hljs-number">0x00000007bff00000</span>,<span class="hljs-number">0x00000007c0000000</span>)
ParOldGen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;<span class="hljs-number">10240</span>K,&nbsp;used&nbsp;<span class="hljs-number">6420</span>K&nbsp;[<span class="hljs-number">0x00000007bec00000</span>,&nbsp;<span class="hljs-number">0x00000007bf600000</span>,&nbsp;<span class="hljs-number">0x00000007bf600000</span>)
&nbsp;&nbsp;object&nbsp;space&nbsp;<span class="hljs-number">10240</span>K,&nbsp;<span class="hljs-number">62</span>%&nbsp;used&nbsp;[<span class="hljs-number">0x00000007bec00000</span>,<span class="hljs-number">0x00000007bf2450d0</span>,<span class="hljs-number">0x00000007bf600000</span>)
Metaspace&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used&nbsp;<span class="hljs-number">2632</span>K,&nbsp;capacity&nbsp;<span class="hljs-number">4486</span>K,&nbsp;committed&nbsp;<span class="hljs-number">4864</span>K,&nbsp;reserved&nbsp;<span class="hljs-number">1056768</span>K
&nbsp;&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">space</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title">used</span>&nbsp;286<span class="hljs-title">K</span>,&nbsp;<span class="hljs-title">capacity</span>&nbsp;386<span class="hljs-title">K</span>,&nbsp;<span class="hljs-title">committed</span>&nbsp;512<span class="hljs-title">K</span>,&nbsp;<span class="hljs-title">reserved</span>&nbsp;1048576<span class="hljs-title">K</span>
</span></code></pre>
<p>è¿™æ˜¯å› ä¸ºåœ¨ç»™ a4 åˆ†é…å†…å­˜ä¹‹å‰ï¼ŒEden åŒºå·²ç»è¢«å ç”¨ 6Mã€‚å·²ç»æ— æ³•å†åˆ†é…å‡º 2M æ¥å­˜å‚¨ a4 å¯¹è±¡ã€‚å› æ­¤ä¼šæ‰§è¡Œä¸€æ¬¡ Minor GCã€‚å¹¶å°è¯•å°†å­˜æ´»çš„ a1ã€a2ã€a3 å¤åˆ¶åˆ° S1 åŒºã€‚ä½†æ˜¯ S1 åŒºåªæœ‰ 1M ç©ºé—´ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•å­˜å‚¨ a1ã€a2ã€a3 ä»»æ„ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ a1ã€a2ã€a3 å°†è¢«è½¬ç§»åˆ°è€å¹´ä»£ï¼Œæœ€åå°† a4 ä¿å­˜åœ¨ Eden åŒºã€‚<strong>æ‰€ä»¥æœ€ç»ˆç»“æœå°±æ˜¯ï¼šEden åŒºå ç”¨ 2Mï¼ˆa4ï¼‰ï¼Œè€å¹´ä»£å ç”¨ 6Mï¼ˆa1ã€a2ã€a3ï¼‰ã€‚</strong></p>
<blockquote>
<p>é€šè¿‡è¿™ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¹Ÿé—´æ¥éªŒè¯äº† JVM çš„å†…å­˜åˆ†é…å’Œåˆ†ä»£å›æ”¶ç­–ç•¥ã€‚å¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥åœ¨è¯¾ä¸‹å°è¯•ä½¿ç”¨å„ç§å‘½ä»¤å‚æ•°ï¼Œç»™å †çš„æ–°ç”Ÿä»£å’Œè€å¹´ä»£è®¾ç½®ä¸åŒçš„å¤§å°æ¥éªŒè¯ä¸åŒçš„ç»“æœã€‚</p>
</blockquote>
<h4>å†è°ˆå¼•ç”¨</h4>
<p>ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»æˆ‘ä»¬æ˜¯é€šè¿‡GC Rootsçš„å¼•ç”¨å¯è¾¾æ€§æ¥åˆ¤æ–­çš„ã€‚ä½†æ˜¯JVMä¸­çš„å¼•ç”¨å…³ç³»å¹¶ä¸æ­¢ä¸€ç§ï¼Œè€Œæ˜¯æœ‰å››ç§ï¼Œæ ¹æ®å¼•ç”¨å¼ºåº¦çš„ç”±å¼ºåˆ°å¼±ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯:<strong>å¼ºå¼•ç”¨</strong>(Strong Reference)ã€<strong>è½¯å¼•ç”¨</strong>(Soft Reference)ã€<strong>å¼±å¼•ç”¨</strong>(Weak Reference)ã€<strong>è™šå¼•ç”¨</strong>(Phantom Reference)ã€‚</p>
<p>ä»»ä½•ä¸€æœ¬Javaé¢è¯•ä¹¦ç±éƒ½ä¼šå¯¹è¿™å››ç§å¼•ç”¨åšç®€å•å¯¹æ¯”ï¼Œæˆ‘ç”¨ä¸€å¼ è¡¨æ ¼æ¥è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/85/Ciqah158ltqAHyEHAACoLz2II_g092.png" alt=""></p>
<p>å¹³æ—¶é¡¹ç›®ä¸­ï¼Œå°¤å…¶æ˜¯Androidé¡¹ç›®ï¼Œå› ä¸ºæœ‰å¤§é‡çš„å›¾åƒ(Bitmap)å¯¹è±¡ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„åœºæ™¯è¾ƒå¤šã€‚æ‰€ä»¥é‡ç‚¹çœ‹ä¸‹è½¯å¼•ç”¨SoftReferenceçš„ä½¿ç”¨ï¼Œä¸å½“çš„ä½¿ç”¨è½¯å¼•ç”¨æœ‰æ—¶ä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿå¼‚å¸¸ã€‚</p>
<h4>è½¯å¼•ç”¨å¸¸è§„ä½¿ç”¨</h4>
<p>å¸¸è§„ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/05/F7/Ciqah16B6smATzkwAAL0Suw9ZmQ406.png" alt=""></p>
<p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œæ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kSGAFUHRAACFBaOn7hI672.png" alt=""></p>
<p>é¦–å…ˆé€šè¿‡-Xmxå°†å †æœ€å¤§å†…å­˜è®¾ç½®ä¸º200Mã€‚ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ç¬¬ä¸€æ¬¡GCæ—¶ï¼Œå†…å­˜ä¸­è¿˜æœ‰å‰©ä½™å¯ç”¨å†…å­˜ï¼Œæ‰€ä»¥è½¯å¼•ç”¨å¹¶ä¸ä¼šè¢«GCå›æ”¶ã€‚ä½†æ˜¯å½“æˆ‘ä»¬å†æ¬¡åˆ›å»ºä¸€ä¸ª120Mçš„å¼ºå¼•ç”¨æ—¶ï¼ŒJVMå¯ç”¨å†…å­˜å·²ç»ä¸å¤Ÿï¼Œæ‰€ä»¥ä¼šå°è¯•å°†è½¯å¼•ç”¨ç»™å›æ”¶æ‰ã€‚</p>
<h4>è½¯å¼•ç”¨éšè—é—®é¢˜</h4>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¢«è½¯å¼•ç”¨å¯¹è±¡å…³è”çš„å¯¹è±¡ä¼šè‡ªåŠ¨è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œä½†æ˜¯è½¯å¼•ç”¨å¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™äº›åˆ›å»ºçš„è½¯å¼•ç”¨å¹¶ä¸ä¼šè‡ªåŠ¨è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ‰ã€‚æ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/81/Ciqah158kSKACYQrAAHi5SOybBQ812.png" alt=""></p>
<p>ä¸Šè¿°ä»£ç ï¼Œè™½ç„¶æ¯ä¸€ä¸ªSoftObjectéƒ½è¢«ä¸€ä¸ªè½¯å¼•ç”¨æ‰€å¼•ç”¨ï¼Œåœ¨å†…å­˜ç´§å¼ æ—¶ï¼ŒGCä¼šå°†SoftObjectæ‰€å ç”¨çš„1KBå›æ”¶ã€‚ä½†æ˜¯æ¯ä¸€ä¸ªSoftReferenceåˆéƒ½è¢«Setæ‰€å¼•ç”¨(å¼ºå¼•ç”¨)ã€‚æ‰§è¡Œä¸Šè¿°ä»£ç ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kSKANSWJAADApye5msQ014.png" alt=""></p>
<p>é™åˆ¶å †å†…å­˜å¤§å°ä¸º4Mï¼Œæœ€ç»ˆç¨‹åºå´©æºƒï¼Œä½†æ˜¯å¼‚å¸¸çš„åŸå› å¹¶ä¸æ˜¯æ™®é€šçš„å †å†…å­˜æº¢å‡ºï¼Œè€Œæ˜¯"GC overhead"ã€‚ä¹‹æ‰€ä»¥ä¼šæŠ›å‡ºè¿™ä¸ªé”™è¯¯ï¼Œæ˜¯ç”±äºè™šæ‹Ÿæœºä¸€ç›´åœ¨ä¸æ–­å›æ”¶è½¯å¼•ç”¨ï¼Œå›æ”¶è¿›è¡Œçš„é€Ÿåº¦è¿‡å¿«ï¼Œå ç”¨çš„cpuè¿‡å¤§(è¶…è¿‡98%)ï¼Œå¹¶ä¸”æ¯æ¬¡å›æ”¶æ‰çš„å†…å­˜è¿‡å°(å°äº2%)ï¼Œå¯¼è‡´æœ€ç»ˆæŠ›å‡ºäº†è¿™ä¸ªé”™è¯¯ã€‚</p>
<p>è¿™é‡Œéœ€è¦åšä¼˜åŒ–ï¼Œåˆé€‚çš„å¤„ç†æ–¹å¼æ˜¯æ³¨å†Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œæ¯æ¬¡å¾ªç¯ä¹‹åå°†å¼•ç”¨é˜Ÿåˆ—ä¸­å‡ºç°çš„è½¯å¼•ç”¨å¯¹è±¡ä»cacheä¸­ç§»é™¤ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/03/81/Ciqah158kSOAcJtVAAMtvCkCXt0643.png" alt=""></p>
<p>å†æ¬¡è¿è¡Œä¿®æ”¹åçš„ä»£ç ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7C/97/Cgq2xl58kSOAMcDMAADVGDMKO7w664.png" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºä¼˜åŒ–åï¼Œç¨‹åºå¯ä»¥æ­£å¸¸æ‰§è¡Œå®Œã€‚å¹¶ä¸”åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šåŠ¨æ€çš„å°†é›†åˆä¸­çš„è½¯å¼•ç”¨åˆ é™¤ã€‚</p>
<p>æ›´å¤šè¯¦ç»† SoftReference çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ&nbsp;ã€<a href="https://mp.weixin.qq.com/s/XRCq3IDdGJt3Nq9Mu23U5g">Javaè™šæ‹Ÿæœºç©¶ç«Ÿæ˜¯å¦‚ä½•å¤„ç†SoftReferenceçš„</a>&nbsp;ã€‚</p>
<h3>æ€»ç»“ï¼š</h3>
<p>æœ¬è¯¾æ—¶ç€é‡è®²è§£äº† JVM ä¸­æœ‰å…³åƒåœ¾å›æ”¶çš„ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå…¶ä¸­é‡ç‚¹ä»‹ç»äº†ä½¿ç”¨å¯è¾¾æ€§åˆ†ææ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Œä»¥åŠ 3 ç§åƒåœ¾å›æ”¶ç®—æ³•ã€‚æœ€åé€šè¿‡åˆ†æ GC Log éªŒè¯äº† Java è™šæ‹Ÿæœºä¸­å†…å­˜åˆ†é…åŠåˆ†ä»£ç­–ç•¥çš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<p>è™šæ‹Ÿæœºåƒåœ¾å›æ”¶æœºåˆ¶å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å½±å“ç³»ç»Ÿæ€§èƒ½ã€å¹¶å‘èƒ½åŠ›çš„ä¸»è¦å› ç´ ä¹‹ä¸€ã€‚å°¤å…¶æ˜¯å¯¹äºä»äº‹ Android å¼€å‘çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œæœ‰æ—¶å€™åƒåœ¾å›æ”¶ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“ UI çº¿ç¨‹ï¼Œå¹¶é€ æˆç•Œé¢å¡é¡¿ç°è±¡ã€‚å› æ­¤ç†è§£åƒåœ¾å›æ”¶æœºåˆ¶å¹¶å­¦ä¼šåˆ†æ GC Log ä¹Ÿæ˜¯ä¸€é¡¹å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚åç»­æˆ‘ä¼šåœ¨ DVM è¯¾æ—¶ä¸­ï¼Œè¯¦ç»†ä»‹ç» Android è™šæ‹Ÿæœºä¸­å¯¹åƒåœ¾å›æ”¶æ‰€åšçš„ä¼˜åŒ–ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### **è´ºï¼š
> è®²å¾—ä¸é”™ï¼Œæ›´æ–°å¿«ä¸€ç‚¹å°±æ›´å¥½äº†

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ„Ÿè°¢è®¤å¯ï¼Œæˆ‘ä»¬å·²ç»åé¦ˆç»™è®²å¸ˆï¼ŒåæœŸä¼šåŠ å¿«æ›´æ–°èŠ‚å‡‘

##### **æŸï¼š
> ç½‘ä¸Šæ•™ç¨‹éƒ½æ˜¯ä¸€å¤§å †ç†è®º çœ‹å¾—äº‘é‡Œé›¾é‡Œ&nbsp; è¿™é‡Œè€å¸ˆè¿ç”¨å¤§é‡ç¨‹åºå®ä¾‹è®²è§£&nbsp; å¸æ”¶å¾ˆå¥½

##### **è¶…ï¼š
> æœ‰ä¸€ç‚¹è¿˜ä¸æ˜¯å¤ªç†è§£ï¼Œç”±äºEdenåŒºçš„ç©ºé—´æ¯”survivoråŒºå¤§ï¼Œå½“å¤åˆ¶çš„è¯å“ªäº›å­˜æ´»å¯¹è±¡å¤åˆ¶è¿‡å»ï¼Œå“ªäº›ä¸å¤åˆ¶è¿‡å»ï¼Œ3ä¸ªå­˜æ´»å¯¹è±¡a1,a2,a3ï¼Œs0åŒºç©ºé—´<span style="font-size: 0.427rem;">åªèƒ½å¤åˆ¶2ä¸ªè¿‡å»ï¼Œæ˜¯æŒ‰ç…§å…ˆè¿›å…¥edenåŒºçš„çš„å¯¹è±¡é¡ºåºè¿›è¡Œå¤åˆ¶ä¹ˆï¼Œa1,a2å¤åˆ¶è¿‡å»ï¼Œa3ç•™åœ¨edenåŒºï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„è¯ï¼Œè¿˜æ˜¯è¿™3ä¸ªä¸èƒ½å›æ”¶ï¼ŒåˆåŠ äº†ä¸€ä¸ªå­˜æ´»å¯¹è±¡a4çš„è¯ï¼Œæ˜¯a1,a2å¤åˆ¶åˆ°s1åŒºçš„ç©ºé—´ï¼Œç©ºå‡ºs0ï¼Œa3å’Œa4éƒ½ç•™åœ¨edenåŒºä¹ˆï¼Œç„¶åa5è¿›æ¥ï¼ŒedenåŒºç©ºé—´ä¸è¶³ï¼Œæ˜¯æŠŠa3,a4å¤åˆ¶åˆ°è€å¹´ä»£ï¼Œa5ç•™åœ¨edenåŒºä¹ˆï¼Œa1,a2åˆå¦‚ä½•å¤„ç†ï¼Œå§‹ç»ˆåœ¨s0å’Œs1ä¹‹é—´è¿›è¡Œäº¤æ¢ç›´åˆ°15æ¬¡åæ‰å¤åˆ¶åˆ°è€å¹´ä»£é‡Œä¹ˆï¼Œæˆ‘ç›®å‰çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹</span>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ¯æ¬¡s0å’Œs1ä¹‹é—´äº¤æ¢è§’è‰²æ—¶ï¼Œéƒ½ä¼šä¿è¯ä¸€æ–¹ä¸­æ²¡æœ‰ä»»ä½•å‰©ä½™å¯¹è±¡ï¼Œæ¯”å¦‚ä»s0è½¬ç§»åˆ°s1æ—¶ï¼Œå¦‚æœs1çš„ç©ºé—´ä¸è¶³ä»¥è£…ä¸‹æ‰€æœ‰æ­¤æ—¶s0ä¸­çš„å¯¹è±¡ï¼Œåˆ™ç›´æ¥è½¬ç§»åˆ°è€å¹´ä»£

##### **ç”¨æˆ·5176ï¼š
> æˆ‘æ˜¯ 79 å—é’±ä¹°çš„ï¼Œçœ‹åˆ°è¯¾ç¨‹çš„é€‚åˆ å·²ç»ä¸æ˜¯ä¸€å—é’±äº† ã€‚ã€‚ï¼Œä¸æ¯«ä¸äº

##### **å¯ï¼š
> å‰å®³äº†ï¼Œå³ä½¿åŸä»·è´­ä¹°ï¼Œä¹Ÿæ˜¯è¶…å€¼äº†ï¼é’±ä¸é’±ï¼Œä¸»è¦è®²çš„å¥½å•Šï¼Œæœ‰çš„æ—¶å€™ï¼Œäº”èŠ±å…«é—¨çš„å­¦ä¹ ç½‘ç«™ï¼Œèµ„æºå¤ªå¤šäº†ï¼Œå³ä½¿èŠ±äº†é’±ä¹°çš„è¯¾ç¨‹ï¼Œä¹Ÿä¸ä¸€å®šèƒ½å­¦åˆ°ä¸œè¥¿ã€‚<div>è¿™ä¸ªè¯¾ç¨‹çœŸä¸é”™ï¼Œå¾ˆæ˜¯è¯¦ç»†ï¼Œå—ç”¨ï¼å°±æ˜¯å¸Œæœ›æ›´æ–°å¿«ä¸€ç‚¹ï¼</div><br>

##### **å‡€ï¼š
> æ£’æäº†ğŸ‘

##### **1138ï¼š
> ä½ å¥½ï¼Œè½¯å¼•ç”¨éšè—é—®é¢˜ä¸­ï¼Œç¬¬ä¸€å¼ å›¾ç‰‡ä»£ç ä¸­<span style="font-family: Consolas; font-size: 12pt; color: rgb(237, 148, 255); font-style: italic;">cache</span><span style="background-color: rgb(19, 19, 20); color: rgb(235, 235, 235); font-family: Consolas; font-size: 12pt;">.add(</span><span style="font-family: Consolas; font-size: 12pt; color: rgb(237, 134, 74);">new </span><span style="background-color: rgb(19, 19, 20); color: rgb(235, 235, 235); font-family: Consolas; font-size: 12pt;">SoftReference&lt;&gt;(</span><span style="font-family: Consolas; font-size: 12pt; color: rgb(255, 255, 255);">obj</span><span style="font-family: Consolas; font-size: 12pt; color: rgb(237, 134, 74); font-weight: bold;">,</span><span style="background-color: rgb(19, 19, 20); color: rgb(235, 235, 235); font-family: Consolas; font-size: 12pt;">referenceQueue))</span><span style="font-family: Consolas; font-size: 12pt; color: rgb(237, 134, 74); font-weight: bold;">;referenceQueueè¿™ä¸ªå˜é‡ä½ æ²¡æœ‰å®šä¹‰ã€‚</span>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ç¬¬ä¸€å¼ å›¾ä¸­çš„referenceQueueæ˜¯ä¸éœ€è¦çš„

##### **7343ï¼š
> ä¸ºä»€ä¹ˆreferenceQueneè¦poll2æ¬¡å‘¢ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¹¶ä¸æ˜¯poll2æ¬¡ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªwhileå¾ªç¯ä¸­é‡æ–°ç»™refèµ‹å€¼

##### **6871ï¼š
> æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œé™æ€å˜é‡å’Œå¸¸é‡è¿˜åœ¨æ–¹æ³•åŒºä¸­å—

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ä¸èƒ½å®Œå…¨è¯´å¸¸é‡æ± å°±æ˜¯åœ¨æ–¹æ³•åŒºä¸­ï¼Œå„ä¸ªè™šæ‹Ÿæœºå‚å•†çš„å®ç°ä¸åŒï¼›åœ¨JDK1.6ä¸­å¸¸é‡æ± æ˜¯è¢«æ”¾åœ¨æ–¹æ³•åŒºä¸­ï¼Œä½†æ˜¯åœ¨1.7ç‰ˆæœ¬ä¸­è¢«ç§»åˆ°äº†å †ä¸­

##### **1657ï¼š
> è¿‡æ¥å¤ä¹ ï¼Œè®²å¾—å¾ˆå¥½

##### **èªï¼š
> å¤§ä½¬ æ±‚JVMå’ŒDVM å†…å­˜å›æ”¶åŒºåˆ« è¿™ä¸ªé—®é¢˜å›°æ‰°æˆ‘å¥½ä¹…<br>DVMæ˜¯ä¸æ˜¯æ²¡æœ‰åˆ†ä»£è¿™ä¸ªè¿™ä¸ªç­–ç•¥å‘€ åªæœ‰æ ‡è®°æ¸…é™¤å‘€

##### **æ°‘ï¼š
> ä¸é”™ æœ‰äº†æ–°çš„è®¤è¯†~

##### **å‡ï¼š
> å¯¹åƒåœ¾å›æ”¶æœ‰æ·±ä¸€æ­¥è®¤è¯†ï¼Œåç»­è¿˜éœ€è¦æ·±å…¥äº†è§£ç±»çš„åŠ è½½å’Œå›æ”¶ï¼Œéœ€è¦å†å¯¹æ¯”ç€å­¦ä¹ ä¸€ä¸‹

##### **å³°ï¼š
> è®²å¾—ä¸é”™ã€å­¦ä¹ äº†å¾ˆå¤šä¸œè¥¿&nbsp;

##### *å‡†ï¼š
> è®²çš„çœŸçš„éå¸¸å¥½ã€‚å¡«è¡¥äº†å¾ˆå¤šçŸ¥è¯†ç›²åŒº

##### **yyan 117ï¼š
> æ˜Ÿå“¥è®²çš„å¾ˆä¸é”™ï¼Œå—ç›Šå¾ˆå¤§

##### **æºï¼š
> <div>å¦‚æ­¤åå¤åœ¨ S0 å’Œ S1ä¹‹é—´åˆ‡æ¢å‡ æ¬¡ï¼ˆé»˜è®¤ 15 æ¬¡ï¼‰ä¹‹åï¼Œå¦‚æœè¿˜æœ‰å­˜æ´»å¯¹è±¡ã€‚è¯´æ˜è¿™äº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œåˆ™å°†å®ƒä»¬è½¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚</div><div><br></div><div>å¤§ä½¬ï¼Œè¯·é—®ä¸€ä¸‹ï¼šå¯¹äºä¸Šä¸€æ®µè¯çš„ç†è§£ï¼Œå‡è®¾æ–°ç”Ÿä»£ç©ºé—´éƒ½è¶³å¤Ÿï¼Œæ¯æ¬¡s0å’Œs1åˆ‡æ¢å‰ï¼Œedenæœ‰å¯èƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡aï¼Œå½“åˆ‡æ¢æ¬¡æ•°è¾¾åˆ°æœ€å¤§ï¼Œè¿™ä¸ªå­˜æ´»å¯¹è±¡aå¯èƒ½è¿˜åªgcä¸€æ¬¡ï¼Œè¿™ä¸ªaä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­å—ï¼Ÿè¿˜æ˜¯ä¼šåˆ¤æ–­å¯¹è±¡çš„gcé¢‘æ¬¡æ¥å†³å®šæ˜¯å¦è½¬ç§»ï¼Ÿ</div>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ¯æ¬¡s0å’Œs1ä¹‹é—´äº¤æ¢è§’è‰²æ—¶ï¼Œéƒ½ä¼šä¿è¯ä¸€æ–¹ä¸­æ²¡æœ‰ä»»ä½•å‰©ä½™å¯¹è±¡ï¼Œæ¯”å¦‚ä»s0è½¬ç§»åˆ°s1æ—¶ï¼Œå¦‚æœs1çš„ç©ºé—´ä¸è¶³ä»¥è£…ä¸‹æ‰€æœ‰æ­¤æ—¶s0ä¸­çš„å¯¹è±¡ï¼Œåˆ™ç›´æ¥è½¬ç§»åˆ°è€å¹´ä»£

##### é›„ï¼š
> å¦‚æœæŠŠJVMè™šæ‹Ÿæœºé‚£æœ¬ä¹¦è¯»è¿‡ä¸¤éï¼Œå†æ¥å­¦è¿™ä¸ªï¼Œä¼šå¾ˆè½»æ¾ï¼Œå’Œå¤ä¹ ä¸€æ ·

##### **åŠ›ä¹˜#ï¼š
> æ‰¾ä¸åˆ°æœ¬è®²ä»£ç 

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æºç åœ°å€ï¼šhttps://github.com/McoyJiang/LagouAndroidShare

##### **æµ·ï¼š
> å±…ç„¶æœ‰ç‚¹çœ‹å°è¯´çš„å‘³é“~~æ±‚ç»§ç»­ç»™åŠ›ã€‚â€œä¹Œæ‹‰~â€

##### **7869ï¼š
> å¯¹äºå¼•ç”¨é˜Ÿåˆ— ReferenceQueue, è¿˜æ˜¯è›®å¥½å¥‡çš„ï¼Œå¯ä»¥å€Ÿç€ Google å­¦ä¹ ä¸€æ³¢å–½

##### **å†Œï¼š
> å‰å®³,è¯¾ç¨‹å®Œçš„æ—¶å€™è€å¸ˆèƒ½è®²ä¸€è®²è‡ªå·±çš„å­¦ä¹ æ–¹æ³•å—

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å·²ç»åé¦ˆç»™è®²å¸ˆå“ˆ

##### **2691ï¼š
> æ„Ÿè§‰è‡ªå·±è¿™ä¹ˆå¤šå¹´androidçœŸæ˜¯ç™½åšäº†

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ²¡æœ‰ä»€ä¹ˆäº‹æƒ…æ˜¯ç™½åšçš„,ç°åœ¨çœ‹ä¼¼æ— æ„ä¹‰çš„äº‹æƒ…,å…¶å®éƒ½æ˜¯æˆé•¿çš„åŸºçŸ³ã€‚

##### **ä¼Ÿï¼š
> è†œæ‹œå¤§ä½¬ï¼Œä¼šè®¤çœŸè¯»å‡ éçš„

##### **æ˜¥ï¼š
> <div><span style="font-size: 16.0125px;">è½¯å¼•ç”¨éšè—é—®é¢˜é‚£ä¸ªä¾‹å­ä¸æ˜¯å¤ªæ‡‚&nbsp;</span></div>ğŸ˜‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è½¯å¼•ç”¨è‡ªèº«æ˜¯å¼ºå¼•ç”¨ï¼Œä½†æ˜¯å…¶å…³è”çš„å¯¹è±¡æ˜¯è½¯å¼•ç”¨

##### **è€€ï¼š
> å¤§ä½¬ï¼Œæˆ‘æƒ³é—®ä¸ªé—®é¢˜ï¼Œæ–‡ç« ä¸­æ‰€è¯´çš„JVMåˆ†ä»£å›æ”¶ç­–ç•¥å’Œä¹‹å‰æåˆ°çš„æ ‡è®°æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ä»¥åŠæ ‡è®°-å‹ç¼©ç®—æ³• è¿™å‡ ä¸ªæ¦‚å¿µæ˜¯ä¸€ä¸ªçº§åˆ«çš„å•Šï¼Œè¿˜æ˜¯è¯´ JVMåˆ†ä»£å›æ”¶æ˜¯ç­–ç•¥ï¼Œè€Œå¦å¤–å‡ ç§åªæ˜¯æ‰§è¡Œè¿™ä¸ªç­–ç•¥æ—¶æ‰€ç”¨çš„å…·ä½“çš„ç®—æ³•å‘¢ï¼Ÿæ±‚å¤§ä½¬è§£æƒ‘ï½ğŸ™

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; åˆ†ä»£å›æ”¶åªæ˜¯ç­–ç•¥ï¼Œä¸åŒçš„å¹´ä»£åŒºä¸­ä¼šä½¿ç”¨ä¸åŒçš„å›æ”¶å™¨(ä¸åŒçš„å›æ”¶å™¨ä»£è¡¨ä¸åŒçš„å›æ”¶ç®—æ³•)

##### **å½¬ï¼š
> æ„Ÿè°¢åˆ†äº«ï¼Œå€¼å¾—å­¦ä¹ 

##### **æ¾ï¼š
> åˆ†æå¾—å¾ˆç²¾è¾Ÿï¼Œå¤šä»æ¡ˆä¾‹å‡ºå‘åˆ†æï¼Œæ•ˆç›Šå¾ˆå¥½

##### **æ•ï¼š
> å­¦ä¹ äº†ğŸ™Œ

##### **è€€ï¼š
> å‰å®³äº†ï¼Œå­¦ä¹ äº†ã€‚ğŸ˜€

##### *é¹ï¼š
> å†™çš„ä¸é”™ï¼Œé€šä¿—æ˜“æ‡‚

##### **æ¾ï¼š
> å­¦ä¹ äº†


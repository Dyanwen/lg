<p data-nodeid="337" class="">é€šè¿‡ä¸Šä¸€è®²çš„å­¦ä¹ ï¼Œç›¸ä¿¡ä½ å·²ç»æŒæ¡äº†å“åº”å¼ç¼–ç¨‹ä¸­çš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå³å“åº”å¼æµã€èƒŒå‹æœºåˆ¶ä»¥åŠå“åº”å¼æµè§„èŒƒï¼Œè¿™äº›æ¦‚å¿µæ˜¯ç†è§£åç»­è¯¾ç¨‹å†…å®¹çš„åŸºç¡€ã€‚</p>
<p data-nodeid="338">è€Œåœ¨ä»‹ç»åŸºäº Spring æ¡†æ¶çš„å“åº”å¼ç¼–ç¨‹æŠ€æœ¯ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šå“åº”å¼ç¼–ç¨‹èƒ½å¤Ÿåº”ç”¨åˆ°é‚£äº›å…·ä½“çš„åœºæ™¯å‘¢ï¼Ÿç›®å‰æœ‰å“ªäº›æ¡†æ¶ä¸­ä½¿ç”¨åˆ°äº†è¿™ä¸€æ–°å‹çš„æŠ€æœ¯ä½“ç³»å‘¢ï¼Ÿè¿™ä¸€è®²æˆ‘å°†ä¸ºä½ è§£ç­”è¿™äº›ç–‘é—®ã€‚</p>
<h3 data-nodeid="339">å“åº”å¼ç¼–ç¨‹çš„åº”ç”¨åœºæ™¯åˆ†æ</h3>
<p data-nodeid="340">æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå“åº”å¼ç¼–ç¨‹å¹¶ä¸ä»…ä»…æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€æœ¯ï¼Œè€Œæ›´æ˜¯ä¸€ç§æ¶æ„è®¾è®¡çš„ç³»ç»Ÿæ–¹æ³•ï¼Œå› æ­¤å¯ä»¥åº”ç”¨äºä»»ä½•åœ°æ–¹ã€‚å®ƒæ—¢å¯ä»¥ç”¨äºç®€å•çš„ Web åº”ç”¨ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ç”¨äºå¤§å‹ä¼ä¸šè§£å†³æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œå¯¹äºå“åº”å¼æ•°æ®æµï¼Œæˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥åŸºäºå®ƒæ¥æ„å»ºæµå¼ç³»ç»Ÿæˆ–å¤§æ•°æ®ç³»ç»Ÿã€‚</p>
<p data-nodeid="341">æ•°æ®æµå¤„ç†æ˜¯å“åº”å¼ç¼–ç¨‹çš„ä¸€å¤§åº”ç”¨åœºæ™¯ã€‚æµå¼ç³»ç»Ÿçš„ä¸»è¦ç‰¹ç‚¹æ˜¯ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚å¯¹äºè¿™ç±»ç³»ç»Ÿï¼Œå¤§å¤šæ•°æ•°æ®æ˜¯ä»æœåŠ¡å™¨ç«¯ä¼ å‡ºçš„ï¼Œå› æ­¤å®¢æˆ·ç«¯æ‰®æ¼”æ¶ˆè´¹è€…çš„è§’è‰²ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé€šè¿‡ä½¿ç”¨éé˜»å¡å¼é€šä¿¡å¯ä»¥ç¡®ä¿èµ„æºå¾—åˆ°é«˜æ•ˆçš„åˆ©ç”¨ï¼Œä»è€Œå®ç°ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚æµå¼ç³»ç»Ÿçš„è¡¨ç°å½¢å¼ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šï¼Œæ—¥å¸¸çš„æ—¥å¿—åŸ‹ç‚¹å’Œåˆ†æã€æœåŠ¡è¿è¡Œæ—¶çš„çŠ¶æ€é‡‡é›†ç­‰éƒ½å±äºè¿™ç§ç±»å‹ã€‚</p>
<p data-nodeid="342">é’ˆå¯¹é«˜å¹¶å‘æµé‡ï¼Œé€šå¸¸æ¶‰åŠå¤§é‡çš„ I/O æ“ä½œã€‚ç›¸è¾ƒäºä¼ ç»Ÿçš„åŒæ­¥é˜»å¡å¼ I/O æ¨¡å‹ï¼Œå“åº”å¼ç¼–ç¨‹æ‰€å…·å¤‡çš„å¼‚æ­¥éé˜»å¡å¼ I/O æ¨¡å‹éå¸¸é€‚åˆåº”å¯¹å¤„ç†é«˜å¹¶å‘æµé‡çš„ä¸šåŠ¡åœºæ™¯ã€‚è¿™ç±»åœºæ™¯ä¸­æ¯”è¾ƒå…¸å‹çš„ä¸€ç§è¡¨ç°å½¢å¼å°±æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„ API ç½‘å…³ï¼Œå› ä¸ºç½‘å…³çš„ä½œç”¨å°±æ˜¯ç”¨æ¥å“åº”æ¥è‡ªå‰ç«¯ç³»ç»Ÿçš„æµé‡å¹¶å°†å…¶è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚</p>
<p data-nodeid="343">è®²åˆ°å¾®æœåŠ¡æ¶æ„ï¼Œå¦‚ä½•æ„å»ºä¸€ä¸ªå…·æœ‰å¼‚æ­¥éé˜»å¡å¼çš„è¯·æ±‚å¤„ç†æµç¨‹çš„ Web æœåŠ¡ä¹Ÿæ˜¯æ ¸å¿ƒè¯‰æ±‚ï¼Œæˆ‘ä»¬éœ€è¦é«˜æ•ˆå¤„ç†è·¨æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè¯·æ±‚ã€‚é’ˆå¯¹è¿™ç§åœºæ™¯ï¼Œå“åº”å¼ç¼–ç¨‹åŠå…¶ç›¸å…³æŠ€æœ¯ä½“ç³»åŒæ ·ä¹Ÿæ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 data-nodeid="344">å“åº”å¼ç¼–ç¨‹åœ¨ä¸»æµå¼€æºæ¡†æ¶ä¸­çš„åº”ç”¨</h3>
<p data-nodeid="345">å“åº”å¼ç¼–ç¨‹åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­æ—¥ç›Šå¾—åˆ°å¹¿æ³›çš„åº”ç”¨ï¼Œç»“åˆä¸Šæ–‡æ‰€åˆ†æçš„ä¸‰ç§å…¸å‹åº”ç”¨åœºæ™¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥å¯¹åº”çš„ Netflix Hystrixã€Spring Cloud Gateway ä»¥åŠ Spring WebFlux è¿™ä¸‰æ¬¾ä¸»æµçš„å¼€æºæ¡†æ¶ä¸ºä¾‹ï¼Œè§£æè¿™äº›æ¡†æ¶èƒŒåæ‰€åº”ç”¨çš„å“åº”å¼ç¼–ç¨‹æŠ€æœ¯ã€‚</p>
<h4 data-nodeid="346">Netflix Hystrix ä¸­çš„æ»‘åŠ¨çª—å£</h4>
<p data-nodeid="347">åœ¨ Spring Cloud å¾®æœåŠ¡å¼€å‘æ¡†æ¶ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ª Spring Cloud Netflix Hystrix ç»„ä»¶ï¼Œè¯¥ç»„ä»¶åŸºäº Netflix Hystrix å®ç°äº†æœåŠ¡ç†”æ–­åŠŸèƒ½ã€‚Netflix Hystrix æ˜¯ Netflix å¼€æºçš„ä¸€æ¬¾å®¹é”™åº“ï¼Œä½¿ç”¨äº† HystrixCircuitBreaker ç±»æ¥å®ç°ç†”æ–­å™¨ã€‚è¯¥ç±»é€šè¿‡ä¸€ä¸ª circuitOpen çŠ¶æ€ä½æ§åˆ¶ç€æ•´ä¸ªç†”æ–­åˆ¤æ–­æµç¨‹ï¼Œè€Œè¿™ä¸ªçŠ¶æ€ä½æœ¬èº«çš„çŠ¶æ€å€¼åˆ™å–å†³äºç³»ç»Ÿç›®å‰çš„æ‰§è¡Œæ•°æ®å’Œå¥åº·æŒ‡æ ‡ã€‚</p>
<p data-nodeid="348">é‚£ä¹ˆï¼ŒHystrixCircuitBreaker å¦‚ä½•åŠ¨æ€è·å–ç³»ç»Ÿè¿è¡Œæ—¶çš„å„é¡¹æ•°æ®å‘¢ï¼Ÿè¿™é‡Œå°±ä½¿ç”¨åˆ°äº†ä¸€ä¸ª HealthCountsStream ç±»ï¼Œä»å‘½åä¸Šä¸éš¾çœ‹å‡ºï¼Œè¿™å°±æ˜¯ä¸€ç§æ•°æ®æµã€‚HealthCountsStream åœ¨è®¾è®¡ä¸Šé‡‡ç”¨äº†ä¸€ç§ç‰¹å®šçš„æœºåˆ¶ï¼Œå³æ»‘åŠ¨çª—å£ï¼ˆRolling Windowï¼‰æœºåˆ¶ï¼Œè€Œ Hystrix åœ¨å®ç°è¿™ä¸€æœºåˆ¶æ—¶å¤§é‡é‡‡ç”¨äº†æ•°æ®æµå¤„ç†æ–¹é¢çš„æŠ€æœ¯ä»¥åŠ RxJava è¿™ä¸ªå“åº”å¼ç¼–ç¨‹æ¡†æ¶ã€‚</p>
<p data-nodeid="349">Hystrix ä»¥ç§’ä¸ºå•ä½æ¥ç»Ÿè®¡ç³»ç»Ÿä¸­æ‰€æœ‰è¯·æ±‚çš„å¤„ç†æƒ…å†µï¼Œç„¶åæ¯æ¬¡å–æœ€è¿‘ 10 ç§’çš„æ•°æ®æ¥è¿›è¡Œè®¡ç®—ã€‚å¦‚æœå¤±è´¥ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œå°±è¿›è¡Œç†”æ–­ã€‚è¿™é‡Œçš„ 10 ç§’å°±æ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œå‚è€ƒå…¶å®˜ç½‘çš„ä¸€å¹…å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p data-nodeid="350"><img src="https://s0.lgstatic.com/i/image6/M00/24/07/Cgp9HWBYDkqAfjLrAAImzCk-l7s672.png" alt="å›¾ç‰‡0.png" data-nodeid="403"></p>
<div data-nodeid="351"><p style="text-align:center">å›¾ 1  Hystrix æ»‘åŠ¨çª—å£æ•ˆæœå›¾ï¼ˆæ¥è‡ª Hystrix å®˜ç½‘ï¼‰</p></div>
<p data-nodeid="352">ä¸Šå›¾æ¼”ç¤ºäº† Hystrix æ»‘åŠ¨çª—å£ç­–ç•¥ï¼ŒæŠŠ 10 ç§’æ—¶é—´æ‹†åˆ†æˆäº† 10 ä¸ªæ ¼å­ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ ¼å­ç§°ä¸ºæ¡¶ Bucketã€‚æ¯ä¸ªæ¡¶ä¸­çš„æ•°æ®å°±æ˜¯è¿™ä¸€ç§’ä¸­æ‰€å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œå¹¶é’ˆå¯¹å¤„ç†ç»“æœçš„çŠ¶æ€åšäº†åˆ†ç±»ã€‚ç„¶åæ¯å½“æ”¶é›†å¥½ä¸€ä¸ªæ–°çš„æ¡¶åï¼Œå°±ä¼šä¸¢å¼ƒæ‰æœ€æ—§çš„ä¸€ä¸ªæ¡¶ï¼Œæ‰€ä»¥çª—å£æ˜¯æ»‘åŠ¨çš„ã€‚</p>
<p data-nodeid="353">é‚£ä¹ˆå¦‚ä½•æ¥å®ç°è¿™ä¸ªæ»‘åŠ¨çª—å£å‘¢ï¼Ÿæˆ‘ä»¬è½¬æ¢ä¸€ä¸‹æ€è·¯ï¼Œå¯ä»¥æŠŠç³»ç»Ÿè¿è¡Œæ—¶æ‰€äº§ç”Ÿçš„æ‰€æœ‰æ•°æ®éƒ½è§†ä¸ºä¸€ä¸ªä¸ªçš„äº‹ä»¶ï¼Œè¿™æ ·æ»‘åŠ¨çª—å£ä¸­æ¯ä¸ªæ¡¶çš„æ•°æ®éƒ½æ¥è‡ªæºæºä¸æ–­çš„äº‹ä»¶ã€‚åŒæ—¶ï¼Œå¯¹äºè¿™äº›ç”Ÿæˆçš„äº‹ä»¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹å…¶è¿›è¡Œè½¬æ¢ä»¥ä¾¿è¿›è¡Œåç»­çš„æ“ä½œã€‚è¿™ä¸¤ç‚¹æ„æˆäº†å®ç°æ»‘åŠ¨çª—å£çš„è®¾è®¡ç›®æ ‡å’Œæ–¹æ³•ã€‚</p>
<p data-nodeid="354">åœ¨æŠ€æœ¯å®ç°çš„é€‰å‹ä¸Šï¼ŒHystrix é‡‡ç”¨äº†åŸºäºå“åº”å¼ç¼–ç¨‹æ€æƒ³çš„ RxJavaã€‚ä¸å…¶ä»–å“åº”å¼ç¼–ç¨‹æ¡†æ¶ä¸€æ ·ï¼ŒRxJava åŒæ ·å®ç°äº†ä¸Šä¸€è®²ä¸­ä»‹ç»çš„å“åº”å¼æµè§„èŒƒã€‚ä½¿ç”¨ RxJava çš„ä¸€å¤§å¥½å¤„æ˜¯å¯ä»¥é€šè¿‡ RxJava çš„ä¸€ç³»åˆ—æ“ä½œç¬¦æ¥å®ç°æ»‘åŠ¨çª—å£ï¼ŒåŒ…æ‹¬ windowã€flatMap å’Œ reduce ç­‰ã€‚å…¶ä¸­ window æ“ä½œç¬¦æ˜¯æŠŠå½“å‰æµä¸­çš„å…ƒç´ æ”¶é›†åˆ°å¦å¤–çš„æµåºåˆ—ï¼›flatMap æ“ä½œç¬¦æŠŠæµä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢æˆä¸€ä¸ªæµï¼Œå†æŠŠè½¬æ¢ä¹‹åå¾—åˆ°çš„æ‰€æœ‰æµä¸­çš„å…ƒç´ è¿›è¡Œåˆå¹¶ã€‚è€Œå reduce æ“ä½œç¬¦å¯¹æµä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œç´¯ç§¯æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªåŒ…å«è®¡ç®—ç»“æœçš„æµã€‚è¿™äº›æ“ä½œç¬¦æˆ‘ä¼šåœ¨â€œ07 | Reactor æ“ä½œç¬¦ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å¿«é€Ÿè½¬æ¢å“åº”å¼æµâ€ä¸­è¯¦ç»†ä¸ºä½ ä»‹ç»ã€‚</p>
<p data-nodeid="355">åœ¨ Hystrix ä¸­ï¼ŒHealthCountsStream çš„å­ç±» BucketedCounterStream å°†åŸºç¡€æ•°æ®äº‹ä»¶æµæ±‡æ€»æˆ Bucketï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre class="lang-java" data-nodeid="356"><code data-language="java"><span class="hljs-keyword">this</span>.bucketedStream = Observable.defer(<span class="hljs-keyword">new</span> Func0&lt;Observable&lt;Bucket&gt;&gt;() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> Observable&lt;Bucket&gt; <span class="hljs-title">call</span><span class="hljs-params">()</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> inputEventStream
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .observe()
	<span class="hljs-comment">// ä½¿ç”¨windowæ“ä½œç¬¦æ”¶é›†ä¸€ä¸ªBucketæ—¶é—´å†…çš„æ•°æ®</span>
.window(bucketSizeInMs, TimeUnit.MILLISECONDS) 
<span class="hljs-comment">// å°†æ¯ä¸ªwindowå†…èšé›†èµ·æ¥çš„äº‹ä»¶é›†åˆæ±‡æ€»æˆBucket</span>
.flatMap(reduceBucketToSummary).startWith(emptyEventCountsToStart);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });
</code></pre>
<p data-nodeid="357">å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåˆ†åˆ«ä½¿ç”¨äº†å‰é¢ä»‹ç»çš„ window å’Œ flatMap æ“ä½œç¬¦æ¥å®Œæˆ Bucket çš„æ„å»ºã€‚è¯·æ³¨æ„ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª Observable<code data-backticks="1" data-nodeid="411">&lt;Bucket&gt;</code> å¯¹è±¡ã€‚åœ¨ RxJava ä¸­ï¼ŒObservable ä»£è¡¨çš„å°±æ˜¯ä¸€ä¸ªæ— é™æµå¯¹è±¡ã€‚</p>
<p data-nodeid="358">æˆ‘ä»¬å†æ¥çœ‹ BucketedCounterStream çš„å­ç±» BucketedRollingCounterStream ç±»ï¼Œè¯¥ç±»çš„æ„é€ å‡½æ•°ä¸­åŒæ ·å­˜åœ¨ä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºäº†é¿å…è¿‡äºå¤æ‚ï¼Œè£å‰ªäº†éƒ¨åˆ†ä»£ç ï¼‰ã€‚</p>
<pre class="lang-java" data-nodeid="359"><code data-language="java"><span class="hljs-keyword">this</span>.sourceStream = bucketedStream
	 <span class="hljs-comment">//å°†Nä¸ªBucketè¿›è¡Œæ±‡æ€»</span>
	.window(numBuckets, <span class="hljs-number">1</span>)
	<span class="hljs-comment">//æ±‡æ€»æˆä¸€ä¸ªçª—å£</span>
	.flatMap(reduceWindowToSummary) 
&nbsp;&nbsp;&nbsp;&nbsp; â€¦
&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//æ·»åŠ èƒŒå‹æ§åˆ¶</span>
	.onBackpressureDrop();
</code></pre>
<p data-nodeid="360">ä¸Šè¿°æ–¹æ³•ä¸­åŸºäºçˆ¶ç±» BucketedCounterStream å·²ç»æ±‡æ€»çš„ bucketedStream è¿›è¡Œå¼€çª—å¤„ç†ï¼Œä»è€Œè·å–ä¸€ä¸ª sourceStreamï¼Œè¿™ä¸ª sourceStream å°±æ˜¯æ»‘åŠ¨çª—å£çš„æœ€ç»ˆå½¢æ€ã€‚æœ€åçš„ onBackpressureDrop() è¯­å¥æ˜¯ RxJava ä¸­æä¾›çš„ä¸€ç§èƒŒå‹æœºåˆ¶ã€‚æˆ‘ä»¬åœ¨ä¸Šä¸€è®²ä¸­è®¨è®ºäº†èƒŒå‹æœºåˆ¶çš„æ¦‚å¿µå’Œä½œç”¨ï¼Œè€Œåœ¨è¿™é‡Œå°±çœ‹åˆ°äº†è¿™ä¸€æœºåˆ¶çš„å…·ä½“åº”ç”¨ã€‚</p>
<p data-nodeid="361">ä½œä¸ºæ€»ç»“ï¼ŒHystrix å·§å¦™åœ°è¿ç”¨äº† RxJava ä¸­çš„ windowã€flatMap ç­‰æ“ä½œç¬¦æ¥å°†å•ä½çª—å£æ—¶é—´å†…çš„äº‹ä»¶ï¼Œä»¥åŠå°†ä¸€ä¸ªçª—å£å¤§å°å†…çš„ Bucket èšé›†åˆ°ä¸€èµ·å½¢æˆæ»‘åŠ¨çª—å£ï¼Œå¹¶åŸºäºæ»‘åŠ¨çª—å£é›†æˆæŒ‡æ ‡æ•°æ®ã€‚è¿™ä¸ªè®¾è®¡æ€æƒ³éå¸¸å·§å¦™ï¼Œå€¼å¾—æˆ‘ä»¬æ·±å…¥ç ”ç©¶å¹¶å¯¹åŸºäºæµçš„å¤„ç†è¿‡ç¨‹åŠ ä»¥å°è¯•å’Œåº”ç”¨ã€‚</p>
<h4 data-nodeid="362">Spring Cloud Gateway ä¸­çš„è¿‡æ»¤å™¨</h4>
<p data-nodeid="363">Spring Cloud Gateway æ˜¯ Spring Cloud å¾®æœåŠ¡å¼€å‘æ¡†æ¶ä¸­çš„å¦ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œæ˜¯ Spring å®˜æ–¹è‡ªå·±å¼€å‘çš„ä¸€æ¬¾ API ç½‘å…³ã€‚åœ¨æŠ€æœ¯ä½“ç³»ä¸Šï¼ŒSpring Cloud Gateway åŸºäºæœ€æ–°çš„ Spring 5 å’Œ Spring Boot 2ï¼Œä»¥åŠç”¨äºå“åº”å¼ç¼–ç¨‹çš„ Project Reactor æ¡†æ¶ï¼Œæä¾›çš„æ˜¯å“åº”å¼ã€éé˜»å¡å¼ I/O æ¨¡å‹ã€‚æ‰€ä»¥æ€§èƒ½ä¸Šæ¯” Netflix ä¸­çš„ Zuul ç½‘å…³è¦æ›´èƒœä¸€ç­¹ã€‚</p>
<p data-nodeid="364">Spring Cloud Gateway ä¸­çš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Œå›´ç»•è¿‡æ»¤å™¨çš„è¯·æ±‚å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p data-nodeid="365"><img src="https://s0.lgstatic.com/i/image6/M00/24/07/Cgp9HWBYDj6AFo0eAACtCU1brX4578.png" alt="å›¾ç‰‡1.png" data-nodeid="421"></p>
<div data-nodeid="366"><p style="text-align:center">å›¾ 2  Spring Cloud Gateway ä¸­çš„è¿‡æ»¤å™¨æ¶æ„</p></div>
<p data-nodeid="367">è¿‡æ»¤å™¨ç”¨äºåœ¨å“åº” HTTP è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚æœ¬èº«åŠå¯¹åº”çš„å“åº”ç»“æœã€‚Spring Cloud Gateway ä¸­æä¾›äº†ä¸€ä¸ªå…¨å±€è¿‡æ»¤å™¨ï¼ˆGlobalFilterï¼‰çš„æ¦‚å¿µï¼Œå¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆã€‚æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å…¨å±€è¿‡æ»¤å™¨æ¥å¯¹æ‰€æœ‰ HTTP è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå…·ä½“åšæ³•æ˜¯å®ç° GlobalFilter æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre class="lang-java te-preview-highlight" data-nodeid="2417"><code data-language="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JWTAuthFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GlobalFilter</span> </span>{
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ServerHttpRequest.Builder builder = exchange.getRequest().mutate();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; builder.header(<span class="hljs-string">"Authorization"</span>,<span class="hljs-string">"Token"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> chain.filter(exchange.mutate().request(builder.build()).build());
&nbsp;&nbsp;&nbsp; }
}
</code></pre>










<p data-nodeid="369">ä»¥ä¸Šä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å…¨å±€è¿‡æ»¤å™¨åœ¨æ‰€æœ‰çš„è¯·æ±‚ä¸­æ·»åŠ  Header çš„å®ç°æ–¹æ³•ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰ç»è¿‡ API ç½‘å…³çš„ HTTP è¯·æ±‚æ·»åŠ äº†ä¸€ä¸ªæ¶ˆæ¯å¤´ï¼Œç”¨æ¥è®¾ç½®ä¸è®¿é—® Token ç›¸å…³çš„å®‰å…¨è®¤è¯ä¿¡æ¯ã€‚</p>
<p data-nodeid="370">è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„ filter æ–¹æ³•è¿”å›äº†ä¸€ä¸ª Mono å¯¹è±¡ï¼Œä½ å¯èƒ½ä¼šé—®è¿™ä¸ª Mono å¯¹è±¡ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿäº‹å®ä¸Šï¼Œè¿™æ˜¯åœ¨å“åº”å¼ç¼–ç¨‹æ¡†æ¶ Project Reactor ä¸­ä»£è¡¨å•ä¸ªè¿”å›å€¼çš„æµå¼å¯¹è±¡ã€‚æˆ‘ä»¬å°†åœ¨â€œ05 | é¡¶çº§æ¡†æ¶ï¼šSpring ä¸ºä»€ä¹ˆé€‰æ‹© Reactor ä½œä¸ºå“åº”å¼ç¼–ç¨‹æ¡†æ¶â€å¯¹ Mono å¯¹è±¡è¿›è¡Œè¯¦ç»†çš„æ¢è®¨ã€‚</p>
<p data-nodeid="371">æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä½¿ç”¨è¿‡æ»¤å™¨çš„åœºæ™¯ã€‚ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç”¨äºå¤„ç†å“åº”çš„ PostGatewayFilter çš„å®ç°æ–¹å¼ï¼Œå…¶ä¸­é¦–å…ˆç»§æ‰¿ä¸€ä¸ª AbstractGatewayFilterFactory ç±»ï¼Œç„¶åå¯ä»¥é€šè¿‡è¦†å†™ apply æ–¹æ³•æ¥æä¾›é’ˆå¯¹ ServerHttpResponse å¯¹è±¡çš„ä»»ä½•æ“ä½œã€‚</p>
<pre class="lang-java" data-nodeid="372"><code data-language="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostGatewayFilterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGatewayFilterFactory</span> </span>{
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PostGatewayFilterFactory</span><span class="hljs-params">()</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">super</span>(Config.class);
&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> GatewayFilter <span class="hljs-title">apply</span><span class="hljs-params">()</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> apply(o -&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });
&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp; <span class="hljs-function"><span class="hljs-keyword">public</span> GatewayFilter <span class="hljs-title">apply</span><span class="hljs-params">(Config config)</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> (exchange, chain) -&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> chain.filter(exchange).then(Mono.fromRunnable(() -&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ServerHttpResponse response = exchange.getResponse();

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//é’ˆå¯¹Responseçš„å„ç§å¤„ç†</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };
&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
&nbsp;&nbsp;&nbsp; }
}
</code></pre>
<p data-nodeid="373">åŒæ ·ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨äº† Reactor æ¡†æ¶ä¸­çš„ then æ“ä½œç¬¦ï¼Œè¯¥æ“ä½œç¬¦çš„å«ä¹‰æ˜¯ç­‰åˆ°ä¸Šä¸€ä¸ªæ“ä½œå®Œæˆå†åšä¸‹ä¸€ä¸ªã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨è¿‡æ»¤å™¨é“¾æ‰§è¡Œå®Œå¯¹ exchange å¯¹è±¡çš„è¿‡æ»¤ä¹‹åï¼Œå†é€šè¿‡ Mono.fromRunnable æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å„ç§é’ˆå¯¹ Response å¯¹è±¡çš„å¤„ç†è¿‡ç¨‹ã€‚</p>
<h4 data-nodeid="374">Spring WebFlux ä¸­çš„è¯·æ±‚å¤„ç†æµç¨‹</h4>
<p data-nodeid="375">Spring WebFlux æ˜¯ Spring 5 ä¸­å¼•å…¥çš„å…¨æ–°çš„å“åº”å¼ Web æœåŠ¡å¼€å‘æ¡†æ¶ã€‚é’ˆå¯¹æ¶‰åŠå¤§é‡ I/O æ“ä½œçš„æœåŠ¡åŒ–æ¶æ„ï¼ŒWebFlux ä¹Ÿæ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿåœ¨å¤æ‚çš„æµç¨‹ä¸­é›†æˆéé˜»å¡ã€å¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œä»è€Œå®ç°é«˜æ•ˆå¤„ç†è·¨æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<p data-nodeid="376">åœ¨ WebFlux ä¸­ï¼Œå¯¹ HTTP è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹æ¶‰åŠäº† HandlerMappingã€HandlerAdapterã€HandlerResultHandler ç±»ä¹‹é—´çš„äº¤äº’ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p data-nodeid="377"><img src="https://s0.lgstatic.com/i/image6/M00/24/04/CioPOWBYDjGAP5oHAADrAy1HQHE514.png" alt="å›¾ç‰‡3.png" data-nodeid="434"></p>
<div data-nodeid="378"><p style="text-align:center">å›¾ 3  WebFlux å¤„ç† HTTP è¯·æ±‚çš„æµç¨‹å›¾</p></div>
<p data-nodeid="379">æˆ‘ä»¬ç›´æ¥æ¥çœ‹ç”¨äºå®Œæˆä¸Šå›¾æµç¨‹çš„ Handle æ–¹æ³•å®šä¹‰ï¼Œè¯¥æ–¹æ³•å®ç°äº†æµå¼å¤„ç†è¯·æ±‚æœºåˆ¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre class="lang-java" data-nodeid="380"><code data-language="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">handle</span><span class="hljs-params">(ServerWebExchange exchange)</span> </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.handlerMappings == <span class="hljs-keyword">null</span>) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> createNotFoundError();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-keyword">return</span> Flux.fromIterable(<span class="hljs-keyword">this</span>.handlerMappings)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//ä»handlerMappingè¿™ä¸ªmapä¸­è·å–HandlerMapping</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .concatMap(mapping -&gt; mapping.getHandler(exchange))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .next()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°HandlerMappingï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .switchIfEmpty(createNotFoundError())
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//è§¦å‘HandlerAdapterçš„handleæ–¹æ³•</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .flatMap(handler -&gt; invokeHandler(exchange, handler))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="hljs-comment">//è§¦å‘HandlerResultHandler çš„handleResultæ–¹æ³•</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .flatMap(result -&gt; handleResult(exchange, result));
}
</code></pre>
<p data-nodeid="381">åœ¨è¿™ä¸ªæ ¸å¿ƒæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† concatMapã€switchIfEmpty å’Œ flatMap ç­‰å“åº”å¼æ“ä½œç¬¦ã€‚å…¶ä¸­çš„ flatMap æ“ä½œç¬¦æˆ‘ä»¬åœ¨å‰é¢å·²ç»è®¨è®ºè¿‡ã€‚å…³äºè¿™äº›æ“ä½œç¬¦çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘åŒæ ·ä¼šåœ¨ç¬¬ 7 è®²ä¸ºä½ è¯¦ç»†ä»‹ç»ã€‚</p>
<h3 data-nodeid="382">å°ç»“ä¸é¢„å‘Š</h3>
<p data-nodeid="383">é‚£ä¹ˆä»Šå¤©å°±å…ˆèŠåˆ°è¿™é‡Œäº†ã€‚åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç†è®ºè”ç³»å®é™…ï¼Œè®¨è®ºäº†å“åº”å¼ç¼–ç¨‹çš„å…·ä½“åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä»Šå¤©å†…å®¹çš„ä»‹ç»ï¼Œä½ ä¸éš¾å‘ç°å“åº”å¼ç¼–ç¨‹æŠ€æœ¯å·²ç»åº”ç”¨åˆ°äº†æ—¥å¸¸å¼€å‘çš„å¾ˆå¤šå¼€æºæ¡†æ¶ä¸­ï¼ŒåŒ…æ‹¬ Netflix Hystrixã€Spring Cloud Gateway ä»¥åŠ Spring WebFlux ç­‰ã€‚è¿™äº›æ¡†æ¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œè€Œå“åº”å¼ç¼–ç¨‹åœ¨è¿™äº›æ¡†æ¶ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚</p>
<p data-nodeid="384">è¿™é‡ŒåŒæ ·ç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šä½ èƒ½ç®€è¦é˜è¿°ä¸€ä¸‹ Netflix Hystrix ä¸­åŸºäºå“åº”å¼æµçš„æ»‘åŠ¨çª—å£å®ç°æœºåˆ¶å—ï¼Ÿ</p>
<p data-nodeid="385">åœ¨äº†è§£äº†å“åº”å¼ç¼–ç¨‹çš„åº”ç”¨åœºæ™¯ä¹‹åï¼Œä¸‹ä¸€è®²è®©æˆ‘ä»¬å›åˆ° Spring æ¡†æ¶ï¼Œè®¨è®º Spring æ¡†æ¶ä¸­çš„å“åº”å¼ç¼–ç¨‹æŠ€æœ¯ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡æ¡ˆä¾‹æ¥å­¦ä¹ å“åº”å¼ Springã€‚åˆ°æ—¶è§ã€‚</p>
<blockquote data-nodeid="386">
<p data-nodeid="387" class="">ç‚¹å‡»é“¾æ¥ï¼Œè·å–è¯¾ç¨‹ç›¸å…³ä»£ç â†“â†“â†“<br>
<a href="https://github.com/lagoueduCol/ReactiveProgramming-jianxiang.git?fileGuid=xxQTRXtVcqtHK6j8" data-nodeid="445">https://github.com/lagoueduCol/ReactiveProgramming-jianxiang.git</a></p>
</blockquote>

---

### ç²¾é€‰è¯„è®º

##### **ä¹‰ï¼š
> æœŸå¾…åé¢çš„ç»„ä»¶è®²è§£

##### **äº®ï¼š
> è¿è¡Œæ—¶äº§ç”Ÿçš„æ•°æ®çœ‹æˆäº‹ä»¶æœºåˆ¶ï¼Œæ”¾è¿›çª—å£çš„bucketã€‚çª—å£æ—¶é—´å†…çš„bucketèšåˆï¼Œå½¢æˆæ»‘åŠ¨çª—å£ï¼Œå®ç°åŠ¨æ€æ•°æ®æ”¶é›†ã€‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯¹çš„

##### *ç‘¾ï¼š
> è€å¸ˆï¼Œå“åº”å¼ç¼–ç¨‹ï¼Œè™½ç„¶webfluxä½¿ç”¨äº†reactor coreï¼Œåº•å±‚è¿˜æ˜¯åŸºäºnettyï¼Œä½†æ˜¯åœ¨linuxä¸‹è¿˜æ˜¯åŒæ­¥éé˜»å¡çš„å§ï¼Œä»–è¿˜è¾¾ä¸åˆ°å…¨å¼‚æ­¥çš„æ–¹å¼

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å“åº”å¼ç¼–ç¨‹ä¸æ˜¯å¼‚æ­¥ï¼Œè€Œæ˜¯éé˜»å¡ï¼Œè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ

##### **é£ï¼š
> å®ç°æœºåˆ¶ï¼šè®¾è®¡ç›®æ ‡ï¼šæŠŠç³»ç»Ÿè¿è¡Œæ—¶äº§ç”Ÿçš„æ‰€æœ‰æ•°æ®éƒ½çœ‹æˆä¸€ä¸ªä¸ªçš„äº‹ä»¶æ”¾åˆ°çª—å£çš„æ¡¶é‡Œã€‚æ–¹æ³•ï¼šå¯¹äºè¿™äº›ç”Ÿæˆçš„äº‹ä»¶ï¼Œå¯¹å…¶è¿›è¡Œè½¬æ¢ç„¶åè¿›è¡Œåç»­çš„æ“ä½œã€‚å®ç°æŠ€æœ¯ï¼šHystrixè¿ç”¨äº† RxJava ä¸­çš„ windowã€flatMap ç­‰æ“ä½œç¬¦å°†å•ä½çª—å£æ—¶é—´å†…çš„äº‹ä»¶å’Œä¸€ä¸ªçª—å£å¤§å°å†…çš„ Bucket èšé›†åˆ°ä¸€èµ·å½¢æˆæ»‘åŠ¨çª—å£ï¼Œå¹¶åŸºäºæ»‘åŠ¨çª—å£é›†æˆæŒ‡æ ‡æ•°æ®ã€‚

##### *ç‘¾ï¼š
> è€å¸ˆæˆ‘æ„æ€æ˜¯reactoræ˜¯åŸºäºå“åº”å¼éé˜»å¡ï¼Œä½†æ˜¯å¼‚æ­¥çš„æ“ä½œæˆ‘ä»¬æ˜¯è¾¾ä¸åˆ°çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¾ç„¶éœ€è¦ä»ç”¨æˆ·æ€åˆ‡å†…æ ¸æ€å»è¯»å–æ•°æ®.

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™é‡Œçš„æ ¸å¿ƒæ„æ€å°±æ˜¯éé˜»å¡å’Œå¼‚æ­¥æ˜¯ä¸¤ä¸ªæ¦‚å¿µ

##### *æµ·ï¼š
> è€å¸ˆå¥½ã€‚chain.filter(exchange.mutate().request(builder.build()).build()); }è¿™å—ä»£ç æ˜¯ä¸æ˜¯é‡å¤äº†

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯¹çš„ï¼Œå¤šå†™äº†ä¸€é

##### **æ ‹ï¼š
> è€å¸ˆè®²çš„å¾ˆå¥½ï¼ŒæœŸå¾…èµ¶å¿«æ›´æ–°ğŸ˜†

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æœ¬ä¸“æ ä¸€å‘¨ä¸‰æ›´å“¦ï¼Œå¾ˆå¿«çš„~


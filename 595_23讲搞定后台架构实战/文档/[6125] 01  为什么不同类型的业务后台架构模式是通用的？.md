<p data-nodeid="11435" class="">从本讲开始，咱们将一起开启本专栏的学习之旅。</p>
<p data-nodeid="11436">国内的各大互联网公司业务模式非常丰富，所提供的业务服务也是形态各异，比如：</p>
<ul data-nodeid="11437">
<li data-nodeid="11438">
<p data-nodeid="11439">腾讯主要提供即时通信、游戏等服务</p>
</li>
<li data-nodeid="11440">
<p data-nodeid="11441">京东、阿里等电商提供商品购买、快递寄收件、金融投资等服务</p>
</li>
<li data-nodeid="11442">
<p data-nodeid="11443">滴滴提供打车服务</p>
</li>
<li data-nodeid="11444">
<p data-nodeid="11445">今日头条、新浪微博提供短视频、新闻资讯类阅读服务</p>
</li>
<li data-nodeid="11446">
<p data-nodeid="11447">美团提供商品购买、外卖订购服务</p>
</li>
<li data-nodeid="11448">
<p data-nodeid="11449">百度提供搜索查询服务</p>
</li>
</ul>
<p data-nodeid="11450">虽然上述列举的公司业务类型不同，但对后台开发岗位的招聘要求却很相似。在拉勾网上可以看到，除了要求你掌握某种开发语言和相关框架外，还要掌握分布式、多线程、缓存、数据库等。</p>
<p data-nodeid="11451"><img src="https://s0.lgstatic.com/i/image/M00/8C/98/Ciqc1F_yfhiARw14AANC63flFVE918.png" alt="Drawing 0.png" data-nodeid="11544"></p>
<div data-nodeid="11452"><p style="text-align:center">（以上信息来源拉勾网）</p></div>
<p data-nodeid="11453">那么，产生这个现象的根本原因是什么呢？</p>
<p data-nodeid="11454">简单来说，是因为这些业务在技术实现上存在共性，比如技术点或者架构模式。在本讲我将和你一起探寻问题背后的原因，并向你提供一个分析业务架构共性的标准。学完本讲，<strong data-nodeid="11551">希望你在面对层出不穷的新业务、新模式时，能够洞穿出背后的架构本质，套用通用架构模式，轻松应对各项技术指标，真正做到大道归宗</strong>。</p>
<h3 data-nodeid="11455">什么是业务后台系统</h3>
<p data-nodeid="11456">在讨论一个议题之前，最重要的是确定它的定义和边界，这样才不至于在实施时出现偏差，导致事倍功半。因此，在开始本讲前，咱们先聊聊业务后台系统的定义。</p>
<p data-nodeid="11457">乍一听“<strong data-nodeid="11563">业务后台系统</strong>”这个称呼，你可能有点摸不着头脑，不知道它是什么。其实，业务后台系统和你在拉勾网上看到的“<strong data-nodeid="11564">后台开发</strong>”大体上是一个意思。我将以外卖订购服务为例，帮助你理解和明确它的定义和边界。</p>
<p data-nodeid="11458"><img src="https://s0.lgstatic.com/i/image2/M01/04/82/CgpVE1_ysR2Ad08jAAQ-ahJctiE044.png" alt="1.png" data-nodeid="11567"></p>
<div data-nodeid="11459"><p style="text-align:center">图 1：外卖系统全局架构</p></div>
<p data-nodeid="11460">图 1 展示的是一个外卖系统全局架构，如果某公司要进军外卖业务，就需要开发一套外卖系统，其中包含用户可直接使用的各个终端，如 iOS 端、Android 端、M 页及 PC 站点。提供内容展示和系统交互，称为<strong data-nodeid="11573">业务前台系统</strong>。</p>
<p data-nodeid="11461">业务前台系统中展示的内容，比如外卖商品种类、商品图片等信息，其实是由业务后台系统提供的，业务前台并没有这些数据，它只负责展示。当用户在前台选择商品点外卖后，实际接受并存储订单及调度配送的系统称为<strong data-nodeid="11579">业务后台系统</strong>。</p>
<p data-nodeid="11462">总的来看，业务后台系统是指直接接受前台的请求，同时给前台返回数据或者保存前台数据的系统。“业务”这个词只是个代称，代指各类业务系统。</p>
<p data-nodeid="11463">很多公司有一些大数据、BI、数据挖掘等相关的系统，它们并不属于业务后台系统，可以称为业务大数据系统，现在时髦的叫法是：<strong data-nodeid="11586">数据中台</strong>。数据中台有一个特点，不直接接受业务前台系统的请求也不直接生产数据，而是直接对业务后台系统产生的数据进行分析、再加工等。</p>
<p data-nodeid="11464">还有一些算法研究的岗位，他们主要对算法进行研究和调优，并将这些成熟的、可用于生产环境的算法提供给业务后台开发工程师。再由他们集成进业务后台系统里，提升业务的体验，比如推荐算法、语音识别算法等。</p>
<p data-nodeid="11465">至此，你应该对业务后台系统的边界有一个比较清晰的了解。<strong data-nodeid="11593">通过上述案例，我们还可以举一反三，比如</strong>：</p>
<ul data-nodeid="11466">
<li data-nodeid="11467">
<p data-nodeid="11468">在短视频和资讯类（微博、新闻）业务里，提供查询视频基本信息和资讯的系统、能够保存短视频的系统，都属于后台系统。</p>
</li>
<li data-nodeid="11469">
<p data-nodeid="11470">在电商业务里，提供查询商品信息的系统、保存订单的系统，都属于后台系统。</p>
</li>
</ul>
<p data-nodeid="11471">其他互联网公司提供的系统，你可以按此思路来判断它们的业务后台系统类别。</p>
<h3 data-nodeid="11472">后台系统的共性探究与归类</h3>
<p data-nodeid="11473"><strong data-nodeid="11602">在探讨不同业务后台系统的共性前，需要明确一个非常重要的概念，即目的性</strong>。如果不明确此概念，你会发现不同的业务后台系统的所有技术实现都是 CRUD（增、查、改、删），按此归类后，很难看出各类业务后台系统之间的区别，更别说从中提炼共性技术和通用架构模式了。</p>
<p data-nodeid="11474">因此，<strong data-nodeid="11612">我们首先要确定归类的维度</strong>。<strong data-nodeid="11613">具体来说，就是需要寻找一个新的维度来对业务后台系统进行归类，并基于此归类提炼技术共性</strong>。在我看来，这个维度就是目的性。在确定归类的维度后，就可以对各类业务后台进行分类了。</p>
<p data-nodeid="11475">接下来，我会以资讯、发布及购买、库存及支付这三类业务为案例，讲解如何基于目的性进行归类。</p>
<h4 data-nodeid="11476">资讯类业务</h4>
<p data-nodeid="11477">下面请你思考一个问题：对于微博、知乎等类资讯业务系统，它们的目的性是什么？</p>
<p data-nodeid="11478">你可以从日常使用的角度来思考，显而易见，这类 App 主要为用户提供阅读和浏览信息的业务，这就是资讯业务系统的目的性。</p>
<p data-nodeid="11479">比如你平时上微博和知乎的目的是娱乐或者学习，我们总结为阅读“新鲜事”。当然，你偶尔也会发布几条动态。想象一下，如果系统出现 Bug，导致你曾经发布的某条消息丢失，当下你可能感知不到，除非某一天你去查看历史动态。但如果系统异常导致不能阅读“新鲜事”，用户当下即可感知到系统出现故障。而互联网时代舆论传播非常快，这会给公司带来很大的负面影响。因此这类事故产生的影响更大。</p>
<p data-nodeid="11480">我们总结一下，资讯类业务系统的主要目的性是尽最大的可能性保证读的可用性和优化用户体验。根据最终目标，我们称它为读类型的业务后台系统，或者叫读业务。</p>
<p data-nodeid="11481">到这里，你可能会有疑问，读业务和 CRUD 里的 R 不是一个意思吗？答案是：完全不同。它们主要有 2 点区别：</p>
<ol data-nodeid="11482">
<li data-nodeid="11483">
<p data-nodeid="11484">这里的“读”是从目的性推导而来，是有限定要求的，它要求的“读”是能够满足用户体验的高性能及高可用；</p>
</li>
<li data-nodeid="11485">
<p data-nodeid="11486">定义的面不同，读业务最重要的是保证系统可读，但此系统仍然会提供写删修的功能，但对这些功能的关注度和要求指标均较低。</p>
</li>
</ol>
<p data-nodeid="11487">和上述读业务类似的场景有：</p>
<ul data-nodeid="11488">
<li data-nodeid="11489">
<p data-nodeid="11490"><strong data-nodeid="11628">短视频业务</strong>，在系统出现故障的极端情况下，可以不能发送新的短视频，但需要能够浏览历史视频；</p>
</li>
<li data-nodeid="11491">
<p data-nodeid="11492"><strong data-nodeid="11633">电商或者外卖业务里的商品系统</strong>，在系统出现故障的极端情况下，商家可以不能创建新的商品，但历史商品需要能够被客户浏览并下单。</p>
</li>
</ul>
<p data-nodeid="11493">可以看到，上述第二个场景是某个业务中的一个系统，而第一个场景短视频则是一个大的业务。从这两个差异的场景案例可以看出，<strong data-nodeid="11639">目的性这个衡量指标可以是某一个大的业务，也可以是某一个业务中的一个具体细小场景</strong>。</p>
<p data-nodeid="11494">除了读业务之外，还有另外两个场景，分别是<strong data-nodeid="11645">数据写场景和扣减场景</strong>。</p>
<h4 data-nodeid="11495">发布及购买类业务</h4>
<p data-nodeid="11496">这里请你思考一个问题：对于电商、外卖和打车等交易类的业务场景，它们最重要的目的性是什么？</p>
<p data-nodeid="11497">不管这些业务里有多少形形色色的系统，当出现一些难以恢复的故障时，比如钻石会员不能使用优先打车通道、不能显示此次打的是出租车还是快车等，但只要用户能够提交订单打车即可。因为如果不能提交订单，将直接减少企业真金白银的收入，在商业上是不允许的。<strong data-nodeid="11657">因此提单的写入是此类业务场景中的重中之重，也是提供电商、外卖和打车服务的企业的最终目的</strong>。<strong data-nodeid="11658">所以提供一个高可用的写入服务十分重要</strong>。</p>
<h4 data-nodeid="11498">库存及支付类业务</h4>
<p data-nodeid="11499">最后，我们再来聊聊库存及支付类业务的目的性。</p>
<p data-nodeid="11500"><img src="https://s0.lgstatic.com/i/image/M00/8C/9E/Ciqc1F_yspeATqsrAAFtPSI0aRs198.png" alt="2.png" data-nodeid="11663"></p>
<div data-nodeid="11501"><p style="text-align:center">图 2：提单扣减流程</p></div>
<p data-nodeid="11502">图 2 展示的是扣减场景中的提单扣减流程，属于一个大型业务之下的某个系统的技术诉求，比如库存的扣减、次数的限制、支付金额的扣减等。虽然这几个系统都会对外提供诸如查询库存、次数等能力，<strong data-nodeid="11669">但它最重要的是保障扣减的高可用，因为一般扣减都是和提单共同发生。如果扣减失败，那么提单也无法成功，所以，扣减业务也是一个需要重点保障的场景</strong>。</p>
<p data-nodeid="11503">以上，我们使用目的性这个维度对不同类型的公司业务（短视频、微博、新闻资讯、电商、打车等）梳理分类，得出结论 1：</p>
<p data-nodeid="11504"><strong data-nodeid="11675">业务后台系统在系统实现上均可分为读业务、写业务、扣减业务</strong>。</p>
<p data-nodeid="11505">因为业务类型是可归类的、通用的，所以得出结论 2：</p>
<p data-nodeid="11506"><strong data-nodeid="11681">这三大类业务后台系统在技术实现上也是类似的，甚至可以说是统一的</strong>。</p>
<h3 data-nodeid="11507">各类型的技术实现关注点</h3>
<p data-nodeid="11508">通过将形态各异的业务分成三大类，你应该能够解答本讲开篇提出的问题：为什么不同公司的业务后台开发岗的招聘要求有很多重叠？可以把你的思考和答案写在留言区，再来看我接下来的分析。</p>
<p data-nodeid="11509">因为很多公司的业务或者其中的某一个系统，都归属于同一大类，而这些类别的技术实现基本上大同小异，因此所有招聘或者任职要求都是类似的。</p>
<p data-nodeid="11510">上一小节，我从业务场景的角度介绍了读业务、写业务、扣减业务，接下来我们再来看看这三大类场景在技术实现上各自有哪些要求。</p>
<h4 data-nodeid="11511">读业务是越快越好</h4>
<p data-nodeid="11512">首先介绍的是读业务场景。任何业务最基本的要求是高可用，随时保障服务可用。那么读业务除了此要求之外还有其他什么要求吗？</p>
<p data-nodeid="11513">从上述的几个案例中，你会发现资讯类业务（微博、知乎、短视频），它们的“写”即发微博、发短视频，和用户的“读”即浏览新鲜事的次数相差非差大。一个正常的用户，可能阅读了 100 条微博，才会发 1 条微博。这里的读写比例在十倍、百倍的量级，因此读的并发量级非常大。</p>
<p data-nodeid="11514">另外，阅读作为一切业务发起的起点，对于速度的要求至关重要。不管是电商还是现在短视频、微博里的直播带货，首先要保障用户能够快速浏览和切换商品，然后才是进入下一步的购买页面。你可以想象一下，如果一个商品图片加载很慢，或一个资讯类应用新闻半天不展示，你还会耐心等待吗？</p>
<p data-nodeid="11515">因此，作为大多数业务的起点，除了完成高可用外，读业务的实现还要求能够在海量读请求下保障高性能。</p>
<h4 data-nodeid="11516">写业务需要 101% 高可用</h4>
<p data-nodeid="11517">在上一小节，我们在读业务的技术实现分析里提到，保障高可用是基本要求。那么，写入业务如提交订单等场景，还需要再提及高可用吗？</p>
<p data-nodeid="11518">答案当然是要，此小节的标题我用了一个夸张的写法“101% 高可用”。我在本讲写入的场景介绍里提到，写入基本上是提交订单，它和实实在在的企业收入相关。因此，我们需要尽“101%” 的努力去保障可用性。</p>
<p data-nodeid="11519">如果读服务出现存储或应用故障，可以在前端或者终端进行前置缓存抗一段时间。缓存给研发或者运维提供了分钟级别的故障处理、数据修复的可能。</p>
<p data-nodeid="11520">但写入服务是无法使用缓存的。此外，对于各大电商、打车、外卖平台来说，故障恢复的时间需要在一分钟内或者秒级别。故我们在架构设计时需要做到“101%”的高可用，这样在实际生产环境才能高效应对故障的发生。</p>
<h4 data-nodeid="11521">扣减业务要抗住并发和保障数据一致性</h4>
<p data-nodeid="11522"><strong data-nodeid="11701">对于扣减业务，从目的性上讲，最重要的就是抗住并发的扣减量</strong>。除开高可用外，你会觉得扣减和写入有很多类似的地方，甚至可以归为一类。</p>
<p data-nodeid="11523">对于写入业务，以提交订单为例，在写入的时候，所有的数据都是用户从表单里提交过来的，比如购买商品的名称和数量、收货地址等，这些数据是这个用户私有的。在技术实现上，我们只要能够尽“101%”的可能性把它保存下来即可。</p>
<p data-nodeid="11524">而对于扣减则不是，以库存为例，扣减的请求只会包含购买的商品和对应的数量，而具体能不能买，则依赖后台系统存储的当前剩余库存数量。另外，<strong data-nodeid="11708">不同用户在同一时刻可能购买同一个商品，此处就存在并发更新，这种在并发情况下的扣减一致性需要格外注意</strong>。</p>
<p data-nodeid="11525">虽然，扣减类业务也会对外提供一些诸如剩余数量和金额的查询接口，但扣减类系统提供的最重要的能力是被各类订单所依赖的扣减接口。它的稳定性决定了提交订单的稳定性。因此，<strong data-nodeid="11714">扣减类业务的重点就是在并发情况下保障扣减的准确性和抗击高并发的能力</strong>。</p>
<h3 data-nodeid="11526">总结</h3>
<p data-nodeid="11527">在本讲，我向你提供了一个对形态各异的业务模式归类的方法。不管各大公司提供的具体业务是什么，从技术的目的性上看，它们都是提供了三大类技术角度的业务。这也就解答了，为什么各大公司的后台开发岗位的招聘要求是类似的，穿过业务的外皮，它们底层逻辑相同。</p>
<p data-nodeid="11528">另外，有一个点需要你注意，本讲对各公司大的业务层面进行了划分，相信你已经对谁属于读业务、谁又属于写业务有了通透的理解。此时不妨尝试问自己一个问题：是不是经过上述定性后，就可以认为某个公司的系统都是某一特性的业务了（不是读业务就是写业务）？</p>
<p data-nodeid="11529">其实不然，如订单系统，从大的目的性来看它属于写业务。但进一步剖析，会发现它对外提供的订单详情和列表是读业务。<strong data-nodeid="11723">本讲的案例只是在一个比较高的维度对各大公司进行了划分，你可以继续利用目的性对它们做进一步的划分</strong>。</p>
<p data-nodeid="11530">通过不断地划分，你可以将你负责的系统与本讲介绍的三大类业务进行对应，并将你现在负责的业务架构和本专栏后续讲解的技术架构进行对照，有针对性地学习。</p>
<p data-nodeid="12624" class="te-preview-highlight">最后，给你留一道思考题。<strong data-nodeid="12630">你所负责或者了解的属于这三大类型的业务形态有哪些？可以试着举一些例子写在留言区，咱们一起讨论吧</strong>。</p>

---

### 精选评论

##### **9790：
> 架构设计从业务场景分析包括三个场景方向，读业务，写业务，以及扣减业务。而真对这三种业务场景，需要保证的是读业务的快速，写业务的可靠，以及扣减业务数据的一致性。面对不同的业务需求需要考虑需要考虑使用对应了哪些场景从而选择相应的技术方案。感谢大佬的精心讲解，期待后续学习如何实现这三种业务场景的架构方法。如何保证消息的可靠到达等问题是否是在架构中需要考虑的问题？还是直接使用中间件来实现？中间件的选型是否也和业务场景相关，能否介绍一下？

 ###### &nbsp;&nbsp;&nbsp; 讲师回复：
> &nbsp;&nbsp;&nbsp; 首先，技术是服务于业务的，各类中间件的出现就是来解决不同的业务场景问题的，比如缓存的出现就是为了解决性能的问题，因此，中间件的选型要紧贴业务场景的诉求。 消息是否要可靠达到看你的业务场景，如果场景是做日志收集，则不完全需要。但如果是金融资产的对账等场景，则必须保证数据一定不能丢。 至于是业务架构保障还是中间件保障，则要看中间件的能力了，如果可以就交给中间件，没必要重复造轮子。

##### **豪：
> 按照这样的划分，的确很清晰，并且能看出这是实践的总结。

##### **默：
> 老师好，可以剧透下全量缓存的技术选型吗，目前正在做这块的技术调研。😀

 ###### &nbsp;&nbsp;&nbsp; 讲师回复：
> &nbsp;&nbsp;&nbsp; 全缓存一个重要的技术点是如何进行数据同步，因为全缓存是指全以缓存中的数据服务于业务，此时从数据库到缓存的数据同步的性能、简单性、最终一致性就非常重要。落地上，可以采用binlog来进行全缓存的数据同步。

##### **5799：
> 内容非常干货，跟着老师学还赶的上金三银四

##### **安：
> 老师，设计购物车功能时应该注意哪几点？目前我采用将购物车数据保存到缓存，通过MQ进行通知将缓存数据搬到数据库

 ###### &nbsp;&nbsp;&nbsp; 讲师回复：
> &nbsp;&nbsp;&nbsp; 建议可以缓存双集群，出现故障时可以灾备。写完缓存再发送消息存在分布式事务问题，在发送消息处，可以增加告警、日志等降级方案，来应对缓存写入成功，而MQ发送失败的场景。

##### **福：
> 业务后台是不是要进一步拆分成业务中台和技术中台

 ###### &nbsp;&nbsp;&nbsp; 讲师回复：
> &nbsp;&nbsp;&nbsp; 是的，可以这样划分。技术中台主要负责中间件的建设，比如缓存集群、数据库集群、RPC框架、消息中间件等的建设。业务中台是在这些中间件基础上建立的，面向业务的中台，如用户中台、评论中台等业务模块。

##### **波：
> 目的性，值得去停下几分钟思考下，没有这个纬度，所有的系统都是CRUD，但是因为目的不同，不同系统间才有了差异，读取和写入的调用比例天差地别，对一个服务而言，要问问这个服务是干啥的，技术是为业务服务，为业务提供解决方案

##### *中：
> 老师，我看你讲库存扣减。有个疑问-购物车商品库存批量扣减是怎么实现的，mysql批量更新容易死锁

 ###### &nbsp;&nbsp;&nbsp; 讲师回复：
> &nbsp;&nbsp;&nbsp; 导致死锁的主要原因是批量+并发。对于商品的批量+并发的扣减场景，并不适合采用数据库进行扣减。可以参考本专栏的第13、14讲里介绍的采用缓存的方案

##### **前：
> 不同类型的业务使用的技术大同小异，比如读业务，主要是提供读的可靠性及性能，使用高速缓存、数据保存多副本；写服务，提供高可用性、在极端情况下使用降级、限流，保证基本交易能正常进行；扣减业务、保证事务的一致性、使用分布式事务。

##### *明：
> 系统简单来讲，就是查看和录入。只要保证这两点即可。

##### **福：
> 可以归类为读，写，扣等

##### 我：
> 期待，学习

##### **8956：
> 不错不错

